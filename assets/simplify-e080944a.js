import"./modulepreload-polyfill-3cfb730f.js";import{c as QS,g as tC,a as eC,b as Zg,f as wE,i as rC,p as nC,d as jv,r as iC,l as oC,e as sC}from"./index-5775ba86.js";var EE={exports:{}};(function(h,n){(function(u,p){h.exports=p()})(QS,function(){var u,p,m;function b(s,O){if(!u)u=O;else if(!p)p=O;else{var V="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+p+")(sharedChunk); self.onerror = null;",G={};u(G),m=O(G),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}b(["exports"],function(s){var O="3.2.0";let V;const G={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(V==null){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{V={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):e}catch{V=e}}return V},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!G.API_URL)return null;try{const e=new URL(G.API_URL);return e.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":e.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},it={supported:!1,testSupport:function(e){!xt&&dt&&(Wt?ie(e):ot=e)}};let ot,dt,xt=!1,Wt=!1;const Vt=typeof self<"u"?self:{};function ie(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,dt),e.isContextLost())return;it.supported=!0}catch{}e.deleteTexture(t),xt=!0}Vt.document&&(dt=Vt.document.createElement("img"),dt.onload=function(){ot&&ie(ot),ot=null,Wt=!0},dt.onerror=function(){xt=!0,ot=null},dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const he="01";function ue(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ne=je;function je(e,t,r,i){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=i}je.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,i=0;i<8;i++){var a=this.sampleCurveX(r)-e;if(Math.abs(a)<t)return r;var c=this.sampleCurveDerivativeX(r);if(Math.abs(c)<1e-6)break;r-=a/c}var f=0,g=1;for(r=e,i=0;i<20&&(a=this.sampleCurveX(r),!(Math.abs(a-e)<t));i++)e>a?f=r:g=r,r=.5*(g-f)+f;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var qe=ue(Ne),rr=tr;function tr(e,t){this.x=e,this.y=t}tr.prototype={clone:function(){return new tr(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),i=Math.sin(e),a=t.y+i*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-i*(this.y-t.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},tr.convert=function(e){return e instanceof tr?e:Array.isArray(e)?new tr(e[0],e[1]):e};var At=ue(rr);const hn=Math.PI/180,Vr=180/Math.PI;function ae(e){return e*hn}function Tr(e){return e*Vr}const Oe=[[0,0],[1,0],[1,1],[0,1]];function vr(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}function $r(e,t,r,i){const a=new qe(e,t,r,i);return function(c){return a.solve(c)}}const Vn=$r(.25,.1,.25,1);function ke(e,t,r){return Math.min(r,Math.max(t,e))}function Qn(e,t,r){return(r=ke((r-e)/(t-e),0,1))*r*(3-2*r)}function ti(e,t,r){const i=r-t,a=((e-t)%i+i)%i+t;return a===t?r:a}function Pn(e,t,r){if(!e.length)return r(null,[]);let i=e.length;const a=new Array(e.length);let c=null;e.forEach((f,g)=>{t(f,(y,x)=>{y&&(c=y),a[g]=x,--i==0&&r(c,a)})})}function Ui(e){const t=[];for(const r in e)t.push(e[r]);return t}function Qr(e,...t){for(const r of t)for(const i in r)e[i]=r[i];return e}let Ys=1;function go(){return Ys++}function ul(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function cl(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function nh(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function eu(e,t){e.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function ru(e,t){return e.indexOf(t,e.length-t.length)!==-1}function Hu(e,t,r){const i={};for(const a in e)i[a]=t.call(r||this,e[a],a,e);return i}function ih(e,t,r){const i={};for(const a in e)t.call(r||this,e[a],a,e)&&(i[a]=e[a]);return i}function Ho(e){return Array.isArray(e)?e.map(Ho):typeof e=="object"&&e?Hu(e,Ho):e}const oh={};function pn(e){oh[e]||(typeof console<"u"&&console.warn(e),oh[e]=!0)}function $t(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function rt(e){let t=0;for(let r,i,a=0,c=e.length,f=c-1;a<c;f=a++)r=e[a],i=e[f],t+=(i.x-r.x)*(r.y+i.y);return t}function at([e,t,r]){const i=ae(t+90),a=ae(r);return{x:e*Math.cos(i)*Math.sin(a),y:e*Math.sin(i)*Math.sin(a),z:e*Math.cos(a),azimuthal:t,polar:r}}function _t(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Zt(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,i,a,c)=>{const f=a||c;return t[i]=!f||f.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}let jt=null;function ye(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Te(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Ht(e,t,r,i){for(;t<r;){const a=t+r>>1;e[a]<i?t=a+1:r=a}return t}function ze(e,t,r,i){for(;t<r;){const a=t+r>>1;e[a]<=i?t=a+1:r=a}return t}const Fe="mapbox-tiles";let Ve=500,Ur=50,tn,Un;function Jr(){try{return caches}catch{}}function en(){const e=Jr();e&&!tn&&(tn=e.open(Fe))}function Gr(e){const t=e.indexOf("?");if(t<0)return e;const r=function(a){const c=a.indexOf("?");return c>0?a.slice(c+1).split("&"):[]}(e),i=r.filter(a=>{const c=a.split("=");return c[0]==="language"||c[0]==="worldview"});return i.length?`${e.slice(0,t)}?${i.join("&")}`:e.slice(0,t)}let ei=1/0;const ui={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ui);class Mo extends Error{constructor(t,r,i){r===401&&te(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=r,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Gi=_t()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,$s=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Gi())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(i,a){const c=new AbortController,f=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Gi(),referrerPolicy:i.referrerPolicy,signal:c.signal});let g=!1,y=!1;const x=(E=f.url).indexOf("sku=")>0&&te(E);var E;i.type==="json"&&f.headers.set("Accept","application/json");const S=(A,L,R)=>{if(y)return;if(A&&A.message!=="SecurityError"&&pn(A.toString()),L&&R)return M(L);const N=Date.now();fetch(f).then(F=>{if(F.ok){const W=x?F.clone():null;return M(F,W,N)}return a(new Mo(F.statusText,F.status,i.url))}).catch(F=>{F.name!=="AbortError"&&a(new Error(`${F.message} ${i.url}`))})},M=(A,L,R)=>{(i.type==="arrayBuffer"?A.arrayBuffer():i.type==="json"?A.json():A.text()).then(N=>{y||(L&&R&&function(F,W,H){if(en(),!tn)return;const $={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach((ct,ft)=>$.headers.set(ft,ct));const Q=Zt(W.headers.get("Cache-Control")||"");if(Q["no-store"])return;Q["max-age"]&&$.headers.set("Expires",new Date(H+1e3*Q["max-age"]).toUTCString());const et=$.headers.get("Expires");et&&(new Date(et).getTime()-H<42e4||function(ct,ft){if(Un===void 0)try{new Response(new ReadableStream),Un=!0}catch{Un=!1}Un?ft(ct.body):ct.blob().then(ft)}(W,ct=>{const ft=new Response(ct,$);en(),tn&&tn.then(gt=>gt.put(Gr(F.url),ft)).catch(gt=>pn(gt.message))}))}(f,L,R),g=!0,a(null,N,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(N=>{y||a(new Error(N.message))})};return x?function(A,L){if(en(),!tn)return L(null);const R=Gr(A.url);tn.then(N=>{N.match(R).then(F=>{const W=function(H){if(!H)return!1;const $=new Date(H.headers.get("Expires")||0),Q=Zt(H.headers.get("Cache-Control")||"");return $>Date.now()&&!Q["no-cache"]}(F);N.delete(R),W&&N.put(R,F.clone()),L(null,F,W)}).catch(L)}).catch(L)}(f,S):S(null,null),{cancel:()=>{y=!0,g||c.abort()}}}(e,t);if(_t()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(i,a){const c=new XMLHttpRequest;c.open(i.method||"GET",i.url,!0),i.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const f in i.headers)c.setRequestHeader(f,i.headers[f]);return i.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=i.credentials==="include",c.onerror=()=>{a(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let f=c.response;if(i.type==="json")try{f=JSON.parse(c.response)}catch(g){return a(g)}a(null,f,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else a(new Mo(c.statusText,c.status,i.url))},c.send(i.body),{cancel:()=>c.abort()}}(e,t)},ci=function(e,t){return $s(Qr(e,{type:"arrayBuffer"}),t)};function Js(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const Ta="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let hi,Ot;hi=[],Ot=0;const kt=function(e,t){if(it.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ot>=G.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return hi.push(c),c}Ot++;let r=!1;const i=()=>{if(!r)for(r=!0,Ot--;hi.length&&Ot<G.MAX_PARALLEL_IMAGE_REQUESTS;){const c=hi.shift(),{requestParameters:f,callback:g,cancelled:y}=c;y||(c.cancel=kt(f,g).cancel)}},a=ci(e,(c,f,g,y)=>{i(),c?t(c):f&&(self.createImageBitmap?function(x,E){const S=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(S).then(M=>{E(null,M)}).catch(M=>{E(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(x,E)=>t(x,E,g,y)):function(x,E){const S=new Image;S.onload=()=>{E(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame(()=>{S.src=Ta})},S.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(x)],{type:"image/png"});S.src=x.byteLength?URL.createObjectURL(M):Ta}(f,(x,E)=>t(x,E,g,y)))});return{cancel:()=>{a.cancel(),i()}}},Yt="NO_ACCESS_TOKEN";function Jt(e){return e.indexOf("mapbox:")===0}function te(e){return G.API_URL_REGEX.test(e)}function se(e){return G.API_CDN_URL_REGEX.test(e)}function le(e){return G.API_STYLE_REGEX.test(e)&&!re(e)}function re(e){return G.API_SPRITE_REGEX.test(e)}const ve=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qt(e){const t=e.match(ve);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function He(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const Sr="mapbox.eventData";function Ae(e){if(!e)return null;const t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Lr{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=Ae(G.ACCESS_TOKEN);let i="";return i=r&&r.u?btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c)))):G.ACCESS_TOKEN||"",t?`${Sr}.${t}:${i}`:`${Sr}:${i}`}fetchEventData(){const t=ye("localStorage"),r=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{const a=localStorage.getItem(r);a&&(this.eventData=JSON.parse(a));const c=localStorage.getItem(i);c&&(this.anonId=c)}catch{pn("Unable to read from LocalStorage")}}saveEventData(){const t=ye("localStorage"),r=this.getStorageKey(),i=this.getStorageKey("uuid"),a=this.anonId;if(t&&a)try{localStorage.setItem(i,a),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{pn("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,i,a){if(!G.EVENTS_URL)return;const c=Qt(G.EVENTS_URL);c.params.push(`access_token=${a||G.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(t).toISOString()},g=r?Qr(f,r):f,y={url:He(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=function(x,E){return $s(Qr(x,{method:"POST"}),E)}(y,x=>{this.pendingRequest=null,i(x),this.saveEventData(),this.processRequests(a)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const _n=new class extends Lr{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){G.EVENTS_URL&&G.ACCESS_TOKEN&&Array.isArray(e)&&e.some(r=>Jt(r)||te(r))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ae(G.ACCESS_TOKEN),r=t?t.u:G.ACCESS_TOKEN;let i=r!==this.eventData.tokenU;nh(this.anonId)||(this.anonId=ul(),i=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),f=new Date(a),g=(a-this.eventData.lastSuccess)/864e5;i=i||g>=1||g<-1||c.getDate()!==f.getDate()}else i=!0;i?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:he,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=a,this.eventData.tokenU=r)},e):this.processRequests()}},xn=_n.postTurnstileEvent.bind(_n),Ln=new class extends Lr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,r,i){this.skuToken=t,this.errorCb=i,G.EVENTS_URL&&(r||G.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(Yt)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),nh(this.anonId)||(this.anonId=ul()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:he,skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):t&&(this.success[t]=!0)},e))}},bi=Ln.postMapLoadEvent.bind(Ln),_o=new class extends Lr{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){G.EVENTS_URL&&(e||G.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),i=function(a){const c=performance.getEntriesByType("resource"),f=performance.getEntriesByType("mark"),g=function(A){const L={};if(A){for(const R in A)if(R!=="other")for(const N of A[R]){const F=`${R}ResolveRangeMin`,W=`${R}ResolveRangeMax`,H=`${R}RequestCount`,$=`${R}RequestCachedCount`;L[F]=Math.min(L[F]||1/0,N.startTime),L[W]=Math.max(L[W]||-1/0,N.responseEnd);const Q=et=>{L[et]===void 0&&(L[et]=0),++L[et]};N.transferSize!==void 0&&N.transferSize===0&&Q($),Q(H)}}return L}(function(A,L){const R={};if(A)for(const N of A){const F=L(N);R[F]===void 0&&(R[F]=[]),R[F].push(N)}return R}(c,nu)),y=window.devicePixelRatio,x=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=x?x.effectiveType:void 0,S={counters:[],metadata:[],attributes:[]},M=(A,L,R)=>{R!=null&&A.push({name:L,value:R.toString()})};for(const A in g)M(S.counters,A,g[A]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(M(S.counters,"interactionRangeMin",a.interactionRange[0]),M(S.counters,"interactionRangeMax",a.interactionRange[1])),f)for(const A of Object.keys(Ks)){const L=Ks[A],R=f.find(N=>N.name===L);R&&M(S.counters,L,R.startTime)}return M(S.counters,"visibilityHidden",a.visibilityHidden),M(S.attributes,"style",function(A){if(A)for(const L of A){const R=L.name.split("?")[0];if(le(R)){const N=R.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(c)),M(S.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),M(S.attributes,"fogEnabled",a.fogEnabled?"true":"false"),M(S.attributes,"projection",a.projection),M(S.attributes,"zoom",a.zoom),M(S.metadata,"devicePixelRatio",y),M(S.metadata,"connectionEffectiveType",E),M(S.metadata,"navigatorUserAgent",navigator.userAgent),M(S.metadata,"screenWidth",window.screen.width),M(S.metadata,"screenHeight",window.screen.height),M(S.metadata,"windowWidth",window.innerWidth),M(S.metadata,"windowHeight",window.innerHeight),M(S.metadata,"mapWidth",a.width/y),M(S.metadata,"mapHeight",a.height/y),M(S.metadata,"webglRenderer",a.renderer),M(S.metadata,"webglVendor",a.vendor),M(S.metadata,"sdkVersion",O),M(S.metadata,"sdkIdentifier","mapbox-gl-js"),S}(r);for(const a of i.metadata);for(const a of i.counters);for(const a of i.attributes);this.postEvent(t,i,()=>{},e)}},Ao=_o.postPerformanceEvent.bind(_o),yo=new class extends Lr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,r,i){if(!G.API_URL||!G.SESSION_PATH)return;const a=Qt(G.API_URL+G.SESSION_PATH);a.params.push(`sku=${t||""}`),a.params.push(`access_token=${i||G.ACCESS_TOKEN||""}`);const c={url:He(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(f,g){return $s(Qr(f,{method:"GET"}),g)}(c,f=>{this.pendingRequest=null,r(f),this.saveEventData(),this.processRequests(i)})}getSessionAPI(e,t,r,i){this.skuToken=t,this.errorCb=i,G.SESSION_PATH&&G.API_URL&&(r||G.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(Yt)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,i=>{i?this.errorCb(i):t&&(this.success[t]=!0)},e)}},wi=yo.getSessionAPI.bind(yo),ro=new Set,Ks={create:"create",load:"load",fullLoad:"fullLoad"};function nu(e){const t=e.name.split("?")[0];return se(t)&&t.includes("mapbox-gl.js")?"javascript":se(t)&&t.includes("mapbox-gl.css")?"css":function(r){return G.API_FONTS_REGEX.test(r)}(t)?"fontRange":re(t)?"sprite":le(t)?"style":function(r){return G.API_TILEJSON_REGEX.test(r)}(t)?"tilejson":"other"}function kp(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}let sh,ah,Fp,Yu,hl;function Zd(){return sh==null&&(sh=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),sh}const ji={now:()=>Yu!==void 0?Yu:performance.now(),setNow(e){Yu=e},restoreNow(){Yu=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:r,height:i}=e;hl||(hl=document.createElement("canvas"));const a=hl.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(r>hl.width||i>hl.height)&&(hl.width=r,hl.height=i),a.clearRect(-t,-t,r+2*t,i+2*t),a.drawImage(e,0,0,r,i),a.getImageData(-t,-t,r+2*t,i+2*t)},resolveURL:e=>(ah||(ah=document.createElement("a")),ah.href=e,ah.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Fp==null&&(Fp=window.matchMedia("(prefers-reduced-motion: reduce)")),Fp.matches)},hasCanvasFingerprintNoise(){if(!Zd())return!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let r=0;for(let a=0;a<e.width;++a)t.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,t.fillRect(a,0,1,1);const i=t.getImageData(0,0,e.width,e.height);r=0;for(let a=0;a<i.data.length;++a)if(a%4!=3&&r++!==i.data[a])return!0;return!1}};function lh(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function pl(e,t,r){if(r&&r[e]){const i=r[e].indexOf(t);i!==-1&&r[e].splice(i,1)}}class Yo{constructor(t,r={}){Qr(this,r),this.type=t}}class fl extends Yo{constructor(t,r={}){super("error",Qr({error:t},r))}}class xs{on(t,r){return this._listeners=this._listeners||{},lh(t,r,this._listeners),this}off(t,r){return pl(t,r,this._listeners),pl(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},lh(t,r,this._oneTimeListeners),this):new Promise(i=>this.once(t,i))}fire(t,r){typeof t=="string"&&(t=new Yo(t,r||{}));const i=t.type;if(this.listens(i)){t.target=this;const a=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const g of a)g.call(this,t);const c=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const g of c)pl(i,g,this._oneTimeListeners),g.call(this,t);const f=this._eventedParent;f&&(Qr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof fl&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var bt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class xe{constructor(t,r,i,a){this.message=(t?`${t}: `:"")+i,a&&(this.identifier=a),r!=null&&r.__line__&&(this.line=r.__line__)}}class bs extends xe{}function $o(e,...t){for(const r of t)for(const i in r)e[i]=r[i];return e}function Dn(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Qs(e){if(Array.isArray(e))return e.map(Qs);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=Qs(e[r]);return t}return Dn(e)}class x_ extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}var Jo=x_;class Bp{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[i,a]of r)this.bindings[i]=a}concat(t){return new Bp(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var b_=Bp;const dl={kind:"null"},Bt={kind:"number"},fr={kind:"string"},mr={kind:"boolean"},Po={kind:"color"},iu={kind:"object"},ur={kind:"value"},ml={kind:"collator"},Sa={kind:"formatted"},$u={kind:"resolvedImage"};function qi(e,t){return{kind:"array",itemType:e,N:t}}function jr(e){if(e.kind==="array"){const t=jr(e.itemType);return typeof e.N=="number"?`array<${t}, ${e.N}>`:e.itemType.kind==="value"?"array":`array<${t}>`}return e.kind}const w_=[dl,Bt,fr,mr,Po,Sa,iu,qi(ur),$u];function gl(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!gl(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(const r of w_)if(!gl(r,t))return null}}return`Expected ${jr(e)} but found ${jr(t)} instead.`}function Vp(e,t){return t.some(r=>r.kind===e.kind)}function _l(e,t){return t.some(r=>r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e)}var uh,ou={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function su(e){return(e=Math.round(e))<0?0:e>255?255:e}function Up(e){return su(e[e.length-1]==="%"?parseFloat(e)/100*255:parseInt(e))}function ch(e){return(t=e[e.length-1]==="%"?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Gp(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{uh={}.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in ou)return ou[r].slice();if(r[0]==="#")return r.length===4?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:r.length===7&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var i=r.indexOf("("),a=r.indexOf(")");if(i!==-1&&a+1===r.length){var c=r.substr(0,i),f=r.substr(i+1,a-(i+1)).split(","),g=1;switch(c){case"rgba":if(f.length!==4)return null;g=ch(f.pop());case"rgb":return f.length!==3?null:[Up(f[0]),Up(f[1]),Up(f[2]),g];case"hsla":if(f.length!==4)return null;g=ch(f.pop());case"hsl":if(f.length!==3)return null;var y=(parseFloat(f[0])%360+360)%360/360,x=ch(f[1]),E=ch(f[2]),S=E<=.5?E*(x+1):E+x-E*x,M=2*E-S;return[su(255*Gp(M,S,y+1/3)),su(255*Gp(M,S,y)),su(255*Gp(M,S,y-1/3)),g];default:return null}}return null}}catch{}class Zi{constructor(t,r,i,a=1){this.r=t,this.g=r,this.b=i,this.a=a}static parse(t){if(!t)return;if(t instanceof Zi)return t;if(typeof t!="string")return;const r=uh(t);return r?new Zi(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[t,r,i,a]=this.toArray();return`rgba(${Math.round(t)},${Math.round(r)},${Math.round(i)},${a})`}toArray(){const{r:t,g:r,b:i,a}=this;return a===0?[0,0,0,0]:[255*t/a,255*r/a,255*i/a,a]}toArray01(){const{r:t,g:r,b:i,a}=this;return a===0?[0,0,0,0]:[t/a,r/a,i/a,a]}toArray01Scaled(t){const{r,g:i,b:a,a:c}=this;return c===0?[0,0,0]:[r/c*t,i/c*t,a/c*t]}toArray01PremultipliedAlpha(){const{r:t,g:r,b:i,a}=this;return[t,r,i,a]}toArray01Linear(){const{r:t,g:r,b:i,a}=this;return a===0?[0,0,0,0]:[Math.pow(t/a,2.2),Math.pow(r/a,2.2),Math.pow(i/a,2.2),a]}}Zi.black=new Zi(0,0,0,1),Zi.white=new Zi(1,1,1,1),Zi.transparent=new Zi(0,0,0,0),Zi.red=new Zi(1,0,0,1),Zi.blue=new Zi(0,0,1,1);var rn=Zi;class jp{constructor(t,r,i){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yl{constructor(t,r,i,a,c){this.text=t.normalize?t.normalize():t,this.image=r,this.scale=i,this.fontStack=a,this.textColor=c}}class Xi{constructor(t){this.sections=t}static fromString(t){return new Xi([new yl(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof Xi?t:Xi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const r of this.sections){if(r.image){t.push(["image",r.image.namePrimary]);continue}t.push(r.text);const i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(i)}return t}}class Lo{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,r){return t?new Lo({namePrimary:t,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Xd(e,t,r,i){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?i===void 0||typeof i=="number"&&i>=0&&i<=1?null:`Invalid rgba value [${[e,t,r,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof i=="number"?[e,t,r,i]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function au(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof rn||e instanceof jp||e instanceof Xi||e instanceof Lo)return!0;if(Array.isArray(e)){for(const t of e)if(!au(t))return!1;return!0}if(typeof e=="object"){for(const t in e)if(!au(e[t]))return!1;return!0}return!1}function Zn(e){if(e===null)return dl;if(typeof e=="string")return fr;if(typeof e=="boolean")return mr;if(typeof e=="number")return Bt;if(e instanceof rn)return Po;if(e instanceof jp)return ml;if(e instanceof Xi)return Sa;if(e instanceof Lo)return $u;if(Array.isArray(e)){const t=e.length;let r;for(const i of e){const a=Zn(i);if(r){if(r===a)continue;r=ur;break}r=a}return qi(r||ur,t)}return iu}function Ju(e){const t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof rn||e instanceof Xi||e instanceof Lo?e.toString():JSON.stringify(e)}class qp{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!au(t[1]))return r.error("invalid value");const i=t[1];let a=Zn(i);const c=r.expectedType;return a.kind!=="array"||a.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(a=c),new qp(a,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof rn?["rgba"].concat(this.value.toArray()):this.value instanceof Xi?this.value.serialize():this.value}}var lu=qp,Rn=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Zp={string:fr,number:Bt,boolean:mr,object:iu};class Xp{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let i,a=1;const c=t[0];if(c==="array"){let g,y;if(t.length>2){const x=t[1];if(typeof x!="string"||!(x in Zp)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=Zp[x],a++}else g=ur;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);y=t[2],a++}i=qi(g,y)}else i=Zp[c];const f=[];for(;a<t.length;a++){const g=r.parse(t[a],a,ur);if(!g)return null;f.push(g)}return new Xp(i,f)}evaluate(t){for(let r=0;r<this.args.length;r++){const i=this.args[r].evaluate(t);if(!gl(this.type,Zn(i)))return i;if(r===this.args.length-1)throw new Rn(`Expected value to be of type ${jr(this.type)}, but found ${jr(Zn(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,r=[t.kind];if(t.kind==="array"){const i=t.itemType;if(i.kind==="string"||i.kind==="number"||i.kind==="boolean"){r.push(i.kind);const a=t.N;(typeof a=="number"||this.args.length>1)&&r.push(a)}}return r.concat(this.args.map(i=>i.serialize()))}}var Ko=Xp;class Ku{constructor(t){this.type=Sa,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&typeof i=="object")return r.error("First argument must be an image or text section.");const a=[];let c=!1;for(let f=1;f<=t.length-1;++f){const g=t[f];if(c&&typeof g=="object"&&!Array.isArray(g)){c=!1;let y=null;if(g["font-scale"]&&(y=r.parse(g["font-scale"],1,Bt),!y))return null;let x=null;if(g["text-font"]&&(x=r.parse(g["text-font"],1,qi(fr)),!x))return null;let E=null;if(g["text-color"]&&(E=r.parse(g["text-color"],1,Po),!E))return null;const S=a[a.length-1];S.scale=y,S.font=x,S.textColor=E}else{const y=r.parse(t[f],1,ur);if(!y)return null;const x=y.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,a.push({content:y,scale:null,font:null,textColor:null})}}return new Ku(a)}evaluate(t){return new Xi(this.sections.map(r=>{const i=r.content.evaluate(t);return Zn(i)===$u?new yl("",i,null,null,null):new yl(Ju(i),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const r of this.sections){t.push(r.content.serialize());const i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),t.push(i)}return t}}class Qu{constructor(t,r){this.type=$u,this.inputPrimary=t,this.inputSecondary=r}static parse(t,r){if(t.length<2)return r.error("Expected two or more arguments.");const i=r.parse(t[1],1,fr);if(!i)return r.error("No image name provided.");if(t.length===2)return new Qu(i);const a=r.parse(t[2],1,fr);return a?new Qu(i,a):r.error("Secondary image variant is not a string.")}evaluate(t){const r=Lo.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&t.availableImages&&(r.available=t.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Er(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}const E_={"to-boolean":mr,"to-color":Po,"to-number":Bt,"to-string":fr};class hh{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const i=t[0],a=[];let c=dl;if(i==="to-array"){if(!Array.isArray(t[1]))return null;const f=t[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);c=qi(r.expectedType.itemType,f)}else{if(!(f>0&&au(t[1][0])))return null;c=qi(Zn(t[1][0]),f)}for(let g=0;g<f;g++){const y=t[1][g];let x;if(Er(y)==="array")x=r.parse(y,void 0,c.itemType);else{const E=Er(y);if(E!==c.itemType.kind)return r.error(`Expected ${c.itemType.kind} but found ${E}.`);x=r.registry.literal.parse(["literal",y===void 0?null:y],r)}if(!x)return null;a.push(x)}}else{if((i==="to-boolean"||i==="to-string")&&t.length!==2)return r.error("Expected one argument.");c=E_[i];for(let f=1;f<t.length;f++){const g=r.parse(t[f],f,ur);if(!g)return null;a.push(g)}}return new hh(c,a)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let r,i;for(const a of this.args){if(r=a.evaluate(t),i=null,r instanceof rn)return r;if(typeof r=="string"){const c=t.parseColor(r);if(c)return c}else if(Array.isArray(r)&&(i=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Xd(r[0],r[1],r[2],r[3]),!i))return new rn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Rn(i||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const i of this.args){if(r=i.evaluate(t),r===null)return 0;const a=Number(r);if(!isNaN(a))return a}throw new Rn(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Xi.fromString(Ju(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Lo.fromString(Ju(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(r=>r.evaluate(t)):Ju(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ku([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Qu(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{t.push(r.serialize())}),t}}var Ca=hh;const Wd=["Unknown","Point","LineString","Polygon"];var Wp=class{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=rn.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Ma{constructor(t,r,i,a,c){this.name=t,this.type=r,this._evaluate=i,this.args=a,this._overloadIndex=c}evaluate(t){if(!this._evaluate){const r=Ma.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,r){const i=t[0],a=Ma.definitions[i];if(!a)return r.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(a)?a[0]:a.type,f=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,g=[];let y=null,x=-1;for(const[E,S]of f){if(Array.isArray(E)&&E.length!==t.length-1)continue;g.push(E),x++,y=new uf(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const M=[];let A=!1;for(let L=1;L<t.length;L++){const R=t[L],N=Array.isArray(E)?E[L-1]:E.type,F=y.parse(R,1+M.length,N);if(!F){A=!0;break}M.push(F)}if(!A)if(Array.isArray(E)&&E.length!==M.length)y.error(`Expected ${E.length} arguments, but found ${M.length} instead.`);else{for(let L=0;L<M.length;L++){const R=Array.isArray(E)?E[L]:E.type,N=M[L];y.concat(L+1).checkSubtype(R,N.type)}if(y.errors.length===0)return new Ma(i,c,S,M,x)}}if(g.length===1)r.errors.push(...y.errors);else{const E=(g.length?g:f.map(([M])=>M)).map(Hd).join(" | "),S=[];for(let M=1;M<t.length;M++){const A=r.parse(t[M],1+S.length);if(!A)return null;S.push(jr(A.type))}r.error(`Expected arguments of type ${E}, but found (${S.join(", ")}) instead.`)}return null}static register(t,r){Ma.definitions=r;for(const i in r)t[i]=Ma}}function Hd(e){return Array.isArray(e)?`(${e.map(jr).join(", ")})`:`(${jr(e.type)}...)`}var Qo=Ma;class tc{constructor(t,r,i){this.type=ml,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const i=t[1];if(typeof i!="object"||Array.isArray(i))return r.error("Collator options argument must be an object.");const a=r.parse(i["case-sensitive"]!==void 0&&i["case-sensitive"],1,mr);if(!a)return null;const c=r.parse(i["diacritic-sensitive"]!==void 0&&i["diacritic-sensitive"],1,mr);if(!c)return null;let f=null;return i.locale&&(f=r.parse(i.locale,1,fr),!f)?null:new tc(a,c,f)}evaluate(t){return new jp(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var Hp={exports:{}};Hp.exports=function(){function e(i,a,c,f,g){for(;f>c;){if(f-c>600){var y=f-c+1,x=a-c+1,E=Math.log(y),S=.5*Math.exp(2*E/3),M=.5*Math.sqrt(E*S*(y-S)/y)*(x-y/2<0?-1:1);e(i,a,Math.max(c,Math.floor(a-x*S/y+M)),Math.min(f,Math.floor(a+(y-x)*S/y+M)),g)}var A=i[a],L=c,R=f;for(t(i,c,a),g(i[f],A)>0&&t(i,c,f);L<R;){for(t(i,L,R),L++,R--;g(i[L],A)<0;)L++;for(;g(i[R],A)>0;)R--}g(i[c],A)===0?t(i,c,R):t(i,++R,f),R<=a&&(c=R+1),a<=R&&(f=R-1)}}function t(i,a,c){var f=i[a];i[a]=i[c],i[c]=f}function r(i,a){return i<a?-1:i>a?1:0}return function(i,a,c,f,g){e(i,a,c||0,f||i.length-1,g||r)}}();var Yd=ue(Hp.exports);function ph(e){let t=0;for(let r,i,a=0,c=e.length,f=c-1;a<c;f=a++)r=e[a],i=e[f],t+=(i.x-r.x)*(r.y+i.y);return t}function Aa(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Pa(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function $d(e,t,r){const i=e[0]-t[0],a=e[1]-t[1],c=e[0]-r[0],f=e[1]-r[1];return i*f-c*a==0&&i*c<=0&&a*f<=0}function vl(e,t,r=!1){let i=!1;for(let g=0,y=t.length;g<y;g++){const x=t[g];for(let E=0,S=x.length,M=S-1;E<S;M=E++){const A=x[M],L=x[E];if($d(e,A,L))return r;(c=A)[1]>(a=e)[1]!=(f=L)[1]>a[1]&&a[0]<(f[0]-c[0])*(a[1]-c[1])/(f[1]-c[1])+c[0]&&(i=!i)}}var a,c,f;return i}function Yp(e,t,r,i){const a=i[0]-r[0],c=i[1]-r[1],f=(e[0]-r[0])*c-a*(e[1]-r[1]),g=(t[0]-r[0])*c-a*(t[1]-r[1]);return f>0&&g<0||f<0&&g>0}function ta(e,t,r,i){return(a=[i[0]-r[0],i[1]-r[1]])[0]*(c=[t[0]-e[0],t[1]-e[1]])[1]-a[1]*c[0]!=0&&!(!Yp(e,t,r,i)||!Yp(r,i,e,t));var a,c}const ar=8192;function I_(e,t){const r=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,a=Math.pow(2,t.z);return[Math.round(r*a*ar),Math.round(i*a*ar)]}function T_(e,t){for(let r=0;r<t.length;r++)if(vl(e,t[r]))return!0;return!1}function S_(e,t,r){for(const i of r)for(let a=0,c=i.length,f=c-1;a<c;f=a++)if(ta(e,t,i[f],i[a]))return!0;return!1}function $p(e,t){for(let r=0;r<e.length;++r)if(!vl(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(S_(e[r],e[r+1],t))return!1;return!0}function C_(e,t){for(let r=0;r<t.length;r++)if($p(e,t[r]))return!0;return!1}function fh(e,t,r){const i=[];for(let a=0;a<e.length;a++){const c=[];for(let f=0;f<e[a].length;f++){const g=I_(e[a][f],r);Aa(t,g),c.push(g)}i.push(c)}return i}function Jp(e,t,r){const i=[];for(let a=0;a<e.length;a++){const c=fh(e[a],t,r);i.push(c)}return i}function Kp(e,t,r,i){if(e[0]<r[0]||e[0]>r[2]){const a=.5*i;let c=e[0]-r[0]>a?-i:r[0]-e[0]>a?i:0;c===0&&(c=e[0]-r[2]>a?-i:r[2]-e[0]>a?i:0),e[0]+=c}Aa(t,e)}function xl(e,t,r,i){const a=Math.pow(2,i.z)*ar,c=[i.x*ar,i.y*ar],f=[];if(!e)return f;for(const g of e)for(const y of g){const x=[y.x+c[0],y.y+c[1]];Kp(x,t,r,a),f.push(x)}return f}function Qp(e,t,r,i){const a=Math.pow(2,i.z)*ar,c=[i.x*ar,i.y*ar],f=[];if(!e)return f;for(const y of e){const x=[];for(const E of y){const S=[E.x+c[0],E.y+c[1]];Aa(t,S),x.push(S)}f.push(x)}if(t[2]-t[0]<=a/2){(g=t)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const y of f)for(const x of y)Kp(x,t,r,a)}var g;return f}class ws{constructor(t,r){this.type=mr,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(au(t[1])){const i=t[1];if(i.type==="FeatureCollection")for(let a=0;a<i.features.length;++a){const c=i.features[a].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ws(i,i.features[a].geometry)}else if(i.type==="Feature"){const a=i.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new ws(i,i.geometry)}else if(i.type==="Polygon"||i.type==="MultiPolygon")return new ws(i,i)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,i){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(i.type==="Polygon"){const g=fh(i.coordinates,c,f),y=xl(r.geometry(),a,c,f);if(!Pa(a,c))return!1;for(const x of y)if(!vl(x,g))return!1}if(i.type==="MultiPolygon"){const g=Jp(i.coordinates,c,f),y=xl(r.geometry(),a,c,f);if(!Pa(a,c))return!1;for(const x of y)if(!T_(x,g))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,i){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(i.type==="Polygon"){const g=fh(i.coordinates,c,f),y=Qp(r.geometry(),a,c,f);if(!Pa(a,c))return!1;for(const x of y)if(!$p(x,g))return!1}if(i.type==="MultiPolygon"){const g=Jp(i.coordinates,c,f),y=Qp(r.geometry(),a,c,f);if(!Pa(a,c))return!1;for(const x of y)if(!C_(x,g))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var dh=ws,tf={exports:{}};tf.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,r=t*(2-t),i=Math.PI/180,a=function(x,E){if(x===void 0)throw new Error("No latitude given.");if(E&&!e[E])throw new Error("Unknown unit "+E+". Use one of: "+Object.keys(e).join(", "));var S=6378.137*i*(E?e[E]:1),M=Math.cos(x*i),A=1/(1-r*(1-M*M)),L=Math.sqrt(A);this.kx=S*L*M,this.ky=S*L*A*(1-r)},c={units:{configurable:!0}};function f(x,E){return x[0]===E[0]&&x[1]===E[1]}function g(x,E,S){var M=y(E[0]-x[0]);return[x[0]+M*S,x[1]+(E[1]-x[1])*S]}function y(x){for(;x<-180;)x+=360;for(;x>180;)x-=360;return x}return a.fromTile=function(x,E,S){var M=Math.PI*(1-2*(x+.5)/Math.pow(2,E)),A=Math.atan(.5*(Math.exp(M)-Math.exp(-M)))/i;return new a(A,S)},c.units.get=function(){return e},a.prototype.distance=function(x,E){var S=y(x[0]-E[0])*this.kx,M=(x[1]-E[1])*this.ky;return Math.sqrt(S*S+M*M)},a.prototype.bearing=function(x,E){var S=y(E[0]-x[0])*this.kx;return Math.atan2(S,(E[1]-x[1])*this.ky)/i},a.prototype.destination=function(x,E,S){var M=S*i;return this.offset(x,Math.sin(M)*E,Math.cos(M)*E)},a.prototype.offset=function(x,E,S){return[x[0]+E/this.kx,x[1]+S/this.ky]},a.prototype.lineDistance=function(x){for(var E=0,S=0;S<x.length-1;S++)E+=this.distance(x[S],x[S+1]);return E},a.prototype.area=function(x){for(var E=0,S=0;S<x.length;S++)for(var M=x[S],A=0,L=M.length,R=L-1;A<L;R=A++)E+=y(M[A][0]-M[R][0])*(M[A][1]+M[R][1])*(S?-1:1);return Math.abs(E)/2*this.kx*this.ky},a.prototype.along=function(x,E){var S=0;if(E<=0)return x[0];for(var M=0;M<x.length-1;M++){var A=x[M],L=x[M+1],R=this.distance(A,L);if((S+=R)>E)return g(A,L,(E-(S-R))/R)}return x[x.length-1]},a.prototype.pointToSegmentDistance=function(x,E,S){var M=E[0],A=E[1],L=y(S[0]-M)*this.kx,R=(S[1]-A)*this.ky,N=0;return L===0&&R===0||((N=(y(x[0]-M)*this.kx*L+(x[1]-A)*this.ky*R)/(L*L+R*R))>1?(M=S[0],A=S[1]):N>0&&(M+=L/this.kx*N,A+=R/this.ky*N)),L=y(x[0]-M)*this.kx,R=(x[1]-A)*this.ky,Math.sqrt(L*L+R*R)},a.prototype.pointOnLine=function(x,E){for(var S,M,A,L,R=1/0,N=0;N<x.length-1;N++){var F=x[N][0],W=x[N][1],H=y(x[N+1][0]-F)*this.kx,$=(x[N+1][1]-W)*this.ky,Q=0;H===0&&$===0||((Q=(y(E[0]-F)*this.kx*H+(E[1]-W)*this.ky*$)/(H*H+$*$))>1?(F=x[N+1][0],W=x[N+1][1]):Q>0&&(F+=H/this.kx*Q,W+=$/this.ky*Q));var et=(H=y(E[0]-F)*this.kx)*H+($=(E[1]-W)*this.ky)*$;et<R&&(R=et,S=F,M=W,A=N,L=Q)}return{point:[S,M],index:A,t:Math.max(0,Math.min(1,L))}},a.prototype.lineSlice=function(x,E,S){var M=this.pointOnLine(S,x),A=this.pointOnLine(S,E);if(M.index>A.index||M.index===A.index&&M.t>A.t){var L=M;M=A,A=L}var R=[M.point],N=M.index+1,F=A.index;!f(S[N],R[0])&&N<=F&&R.push(S[N]);for(var W=N+1;W<=F;W++)R.push(S[W]);return f(S[F],A.point)||R.push(A.point),R},a.prototype.lineSliceAlong=function(x,E,S){for(var M=0,A=[],L=0;L<S.length-1;L++){var R=S[L],N=S[L+1],F=this.distance(R,N);if((M+=F)>x&&A.length===0&&A.push(g(R,N,(x-(M-F))/F)),M>=E)return A.push(g(R,N,(E-(M-F))/F)),A;M>x&&A.push(N)}return A},a.prototype.bufferPoint=function(x,E){var S=E/this.ky,M=E/this.kx;return[x[0]-M,x[1]-S,x[0]+M,x[1]+S]},a.prototype.bufferBBox=function(x,E){var S=E/this.ky,M=E/this.kx;return[x[0]-M,x[1]-S,x[2]+M,x[3]+S]},a.prototype.insideBBox=function(x,E){return y(x[0]-E[0])>=0&&y(x[0]-E[2])<=0&&x[1]>=E[1]&&x[1]<=E[3]},Object.defineProperties(a,c),a}();var ef=ue(tf.exports),mh={exports:{}};mh.exports=function(){var e=function(r,i){if(r===void 0&&(r=[]),i===void 0&&(i=t),this.data=r,this.length=this.data.length,this.compare=i,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function t(r,i){return r<i?-1:r>i?1:0}return e.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(this.length!==0){var r=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),r}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(r){for(var i=this.data,a=this.compare,c=i[r];r>0;){var f=r-1>>1,g=i[f];if(a(c,g)>=0)break;i[r]=g,r=f}i[r]=c},e.prototype._down=function(r){for(var i=this.data,a=this.compare,c=this.length>>1,f=i[r];r<c;){var g=1+(r<<1),y=i[g],x=g+1;if(x<this.length&&a(i[x],y)<0&&(g=x,y=i[x]),a(y,f)>=0)break;i[r]=y,r=g}i[r]=f},e}();var gh=ue(mh.exports),ee=8192;function Jd(e,t){return t.dist-e.dist}const _h=100,rf=50;function Kd(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function yh(e){return e[1]-e[0]+1}function ea(e,t){const r=e[1]>=e[0]&&e[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function vh(e,t){if(e[0]>e[1])return[null,null];const r=yh(e);if(t){if(r===2)return[e,null];const i=Math.floor(r/2);return[[e[0],e[0]+i],[e[0]+i,e[1]]]}{if(r===1)return[e,null];const i=Math.floor(r/2)-1;return[[e[0],e[0]+i],[e[0]+i+1,e[1]]]}}function La(e,t){const r=[1/0,1/0,-1/0,-1/0];if(!ea(t,e.length))return r;for(let i=t[0];i<=t[1];++i)Aa(r,e[i]);return r}function xh(e){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<e.length;++r)for(let i=0;i<e[r].length;++i)Aa(t,e[r][i]);return t}function bl(e,t,r){if(Kd(e)||Kd(t))return NaN;let i=0,a=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(a=e[1]-t[3]),e[3]<t[1]&&(a=t[1]-e[3]),r.distance([0,0],[i,a])}function nf(e,t){const r=Math.pow(2,t.z);return[(a=(e.x/ee+t.x)/r,360*a-180),(i=(e.y/ee+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,a}function M_(e,t){const r=[];for(let i=0;i<e.length;++i)r.push(nf(e[i],t));return r}function of(e,t,r){const i=r.pointOnLine(t,e).point;return r.distance(e,i)}function sf(e,t,r,i,a){const c=r.slice(i[0],i[1]+1);let f=1/0;for(let g=t[0];g<=t[1];++g)if((f=Math.min(f,of(e[g],c,a)))===0)return 0;return f}function af(e,t,r,i,a){const c=Math.min(a.pointToSegmentDistance(e,r,i),a.pointToSegmentDistance(t,r,i)),f=Math.min(a.pointToSegmentDistance(r,e,t),a.pointToSegmentDistance(i,e,t));return Math.min(c,f)}function A_(e,t,r,i,a){if(!ea(t,e.length)||!ea(i,r.length))return NaN;let c=1/0;for(let f=t[0];f<t[1];++f)for(let g=i[0];g<i[1];++g){if(ta(e[f],e[f+1],r[g],r[g+1]))return 0;c=Math.min(c,af(e[f],e[f+1],r[g],r[g+1],a))}return c}function P_(e,t,r,i,a){if(!ea(t,e.length)||!ea(i,r.length))return NaN;let c=1/0;for(let f=t[0];f<=t[1];++f)for(let g=i[0];g<=i[1];++g)if((c=Math.min(c,a.distance(e[f],r[g])))===0)return c;return c}function Qd(e,t,r){if(vl(e,t,!0))return 0;let i=1/0;for(const a of t){const c=a.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[c-1]&&(i=Math.min(i,r.pointToSegmentDistance(e,a[c-1],a[0])))===0||(i=Math.min(i,of(e,a,r)))===0)return i}return i}function L_(e,t,r,i){if(!ea(t,e.length))return NaN;for(let c=t[0];c<=t[1];++c)if(vl(e[c],r,!0))return 0;let a=1/0;for(let c=t[0];c<t[1];++c)for(const f of r)for(let g=0,y=f.length,x=y-1;g<y;x=g++){if(ta(e[c],e[c+1],f[x],f[g]))return 0;a=Math.min(a,af(e[c],e[c+1],f[x],f[g],i))}return a}function tm(e,t){for(const r of e)for(let i=0;i<=r.length-1;++i)if(vl(r[i],t,!0))return!0;return!1}function em(e,t,r,i=1/0){const a=xh(e),c=xh(t);if(i!==1/0&&bl(a,c,r)>=i)return i;if(Pa(a,c)){if(tm(e,t))return 0}else if(tm(t,e))return 0;let f=i;for(const g of e)for(let y=0,x=g.length,E=x-1;y<x;E=y++)for(const S of t)for(let M=0,A=S.length,L=A-1;M<A;L=M++){if(ta(g[E],g[y],S[L],S[M]))return 0;f=Math.min(f,af(g[E],g[y],S[L],S[M],r))}return f}function bh(e,t,r,i,a,c,f){if(c===null||f===null)return;const g=bl(La(i,c),La(a,f),r);g<t&&e.push({dist:g,range1:c,range2:f})}function D_(e,t,r,i,a=1/0){let c=Math.min(i.distance(e[0],r[0][0]),a);if(c===0)return c;const f=new gh([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Jd),g=t?rf:_h,y=xh(r);for(;f.length;){const x=f.pop();if(x.dist>=c)continue;const E=x.range1;if(yh(E)<=g){if(!ea(E,e.length))return NaN;if(t){const S=L_(e,E,r,i);if((c=Math.min(c,S))===0)return c}else for(let S=E[0];S<=E[1];++S){const M=Qd(e[S],r,i);if((c=Math.min(c,M))===0)return c}}else{const S=vh(E,t);if(S[0]!==null){const M=bl(La(e,S[0]),y,i);M<c&&f.push({dist:M,range1:S[0],range2:[0,0]})}if(S[1]!==null){const M=bl(La(e,S[1]),y,i);M<c&&f.push({dist:M,range1:S[1],range2:[0,0]})}}}return c}function rm(e,t,r,i,a,c=1/0){let f=Math.min(c,a.distance(e[0],r[0]));if(f===0)return f;const g=new gh([{dist:0,range1:[0,e.length-1],range2:[0,r.length-1]}],Jd),y=t?rf:_h,x=i?rf:_h;for(;g.length;){const E=g.pop();if(E.dist>=f)continue;const S=E.range1,M=E.range2;if(yh(S)<=y&&yh(M)<=x){if(!ea(S,e.length)||!ea(M,r.length))return NaN;if(t&&i?f=Math.min(f,A_(e,S,r,M,a)):t||i?t&&!i?f=Math.min(f,sf(r,M,e,S,a)):!t&&i&&(f=Math.min(f,sf(e,S,r,M,a))):f=Math.min(f,P_(e,S,r,M,a)),f===0)return f}else{const A=vh(S,t),L=vh(M,i);bh(g,f,a,e,r,A[0],L[0]),bh(g,f,a,e,r,A[0],L[1]),bh(g,f,a,e,r,A[1],L[0]),bh(g,f,a,e,r,A[1],L[1])}}return f}function wh(e,t,r,i,a=1/0){let c=a;const f=La(e,[0,e.length-1]);for(const g of r)if(!(c!==1/0&&bl(f,La(g,[0,g.length-1]),i)>=c)&&(c=Math.min(c,rm(e,t,g,!0,i,c)),c===0))return c;return c}function ec(e,t,r,i,a=1/0){let c=a;const f=La(e,[0,e.length-1]);for(const g of r){if(c!==1/0&&bl(f,xh(g),i)>=c)continue;const y=D_(e,t,g,i,c);if(isNaN(y))return y;if((c=Math.min(c,y))===0)return c}return c}function Eh(e){return e==="Point"||e==="MultiPoint"||e==="LineString"||e==="MultiLineString"||e==="Polygon"||e==="MultiPolygon"}class rc{constructor(t,r){this.type=Bt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(au(t[1])){const i=t[1];if(i.type==="FeatureCollection"){for(let a=0;a<i.features.length;++a)if(Eh(i.features[a].geometry.type))return new rc(i,i.features[a].geometry)}else if(i.type==="Feature"){if(Eh(i.geometry.type))return new rc(i,i.geometry)}else if(Eh(i.type))return new rc(i,i)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const r=t.geometry(),i=t.canonicalID();if(r!=null&&i!=null){if(t.geometryType()==="Point")return function(a,c,f){const g=[];for(const x of a)for(const E of x)g.push(nf(E,c));const y=new ef(g[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?rm(g,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y):f.type==="MultiLineString"?wh(g,!1,f.coordinates,y):f.type==="Polygon"||f.type==="MultiPolygon"?ec(g,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,y):null}(r,i,this.geometries);if(t.geometryType()==="LineString")return function(a,c,f){const g=[];for(const x of a){const E=[];for(const S of x)E.push(nf(S,c));g.push(E)}const y=new ef(g[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return wh(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,y);if(f.type==="MultiLineString"){let x=1/0;for(let E=0;E<f.coordinates.length;E++){const S=wh(f.coordinates[E],!0,g,y,x);if(isNaN(S))return S;if((x=Math.min(x,S))===0)return x}return x}if(f.type==="Polygon"||f.type==="MultiPolygon"){let x=1/0;for(let E=0;E<g.length;E++){const S=ec(g[E],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,y,x);if(isNaN(S))return S;if((x=Math.min(x,S))===0)return x}return x}return null}(r,i,this.geometries);if(t.geometryType()==="Polygon")return function(a,c,f){const g=[];for(const x of function(E,S){const M=E.length;if(M<=1)return[E];const A=[];let L,R;for(let N=0;N<M;N++){const F=ph(E[N]);F!==0&&(E[N].area=Math.abs(F),R===void 0&&(R=F<0),R===F<0?(L&&A.push(L),L=[E[N]]):L.push(E[N]))}return L&&A.push(L),A}(a)){const E=[];for(let S=0;S<x.length;++S)E.push(M_(x[S],c));g.push(E)}const y=new ef(g[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return ec(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,y);if(f.type==="MultiLineString"){let x=1/0;for(let E=0;E<f.coordinates.length;E++){const S=ec(f.coordinates[E],!0,g,y,x);if(isNaN(S))return S;if((x=Math.min(x,S))===0)return x}return x}return f.type==="Polygon"||f.type==="MultiPolygon"?function(x,E,S){let M=1/0;for(const A of x)for(const L of E){const R=em(A,L,S,M);if(isNaN(R))return R;if((M=Math.min(M,R))===0)return M}return M}(f.type==="Polygon"?[f.coordinates]:f.coordinates,g,y):null}(r,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var lf=rc;function uu(e){if(e instanceof Qo&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof dh||e instanceof lf)return!1;let t=!0;return e.eachChild(r=>{t&&!uu(r)&&(t=!1)}),t}function pi(e){if(e instanceof Qo&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(r=>{t&&!pi(r)&&(t=!1)}),t}function nc(e){if(e instanceof Qo&&e.name==="config")return!1;let t=!0;return e.eachChild(r=>{t&&!nc(r)&&(t=!1)}),t}function wl(e,t){if(e instanceof Qo&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild(i=>{r&&!wl(i,t)&&(r=!1)}),r}class Ih{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const i=t[1];return r.scope.has(i)?new Ih(i,r.scope.get(i)):r.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var nm=Ih;class cu{constructor(t,r=[],i,a=new b_,c=[],f,g){this.registry=t,this.path=r,this.key=r.map(y=>`[${y}]`).join(""),this.scope=a,this.errors=c,this.expectedType=i,this._scope=f,this.options=g}parse(t,r,i,a,c={}){return r||i?this.concat(r,i,a)._parse(t,c):this._parse(t,c)}_parse(t,r){function i(a,c,f){return f==="assert"?new Ko(c,[a]):f==="coerce"?new Ca(c,[a]):a}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(a){let c=a.parse(t,this);if(!c)return null;if(this.expectedType){const f=this.expectedType,g=c.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(f,g))return null}else c=i(c,f,r.typeAnnotation||"coerce");else c=i(c,f,r.typeAnnotation||"assert")}if(!(c instanceof lu)&&c.type.kind!=="resolvedImage"&&Th(c)){const f=new Wp(this._scope,this.options);try{c=new lu(c.type,c.evaluate(f))}catch(g){return this.error(g.message),null}}return c}return Ca.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,i){const a=typeof t=="number"?this.path.concat(t):this.path,c=i?this.scope.concat(i):this.scope;return new cu(this.registry,a,r||null,c,this.errors,this._scope,this.options)}error(t,...r){const i=`${this.key}${r.map(a=>`[${a}]`).join("")}`;this.errors.push(new Jo(i,t))}checkSubtype(t,r){const i=gl(t,r);return i&&this.error(i),i}}var uf=cu;function Th(e){if(e instanceof nm)return Th(e.boundExpression);if(e instanceof Qo&&e.name==="error"||e instanceof Qo&&e.name==="config"||e instanceof tc||e instanceof dh||e instanceof lf)return!1;const t=e instanceof Ca||e instanceof Ko;let r=!0;return e.eachChild(i=>{r=t?r&&Th(i):r&&i instanceof lu}),!!r&&uu(e)&&wl(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Sh(e,t){const r=e.length-1;let i,a,c=0,f=r,g=0;for(;c<=f;)if(g=Math.floor((c+f)/2),i=e[g],a=e[g+1],i<=t){if(g===r||t<a)return g;c=g+1}else{if(!(i>t))throw new Rn("Input is not a number.");f=g-1}return 0}class cf{constructor(t,r,i){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[a,c]of i)this.labels.push(a),this.outputs.push(c)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const i=r.parse(t[1],1,Bt);if(!i)return null;const a=[];let c=null;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);for(let f=1;f<t.length;f+=2){const g=f===1?-1/0:t[f],y=t[f+1],x=f,E=f+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(a.length&&a[a.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const S=r.parse(y,E,c);if(!S)return null;c=c||S.type,a.push([g,S])}return new cf(c,i,a)}evaluate(t){const r=this.labels,i=this.outputs;if(r.length===1)return i[0].evaluate(t);const a=this.input.evaluate(t);if(a<=r[0])return i[0].evaluate(t);const c=r.length;return a>=r[c-1]?i[c-1].evaluate(t):i[Sh(r,a)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&t.push(this.labels[r]),t.push(this.outputs[r].serialize());return t}}var hf=cf;function nr(e,t,r){return e*(1-r)+t*r}function Ch(e,t,r){return e.map((i,a)=>nr(i,t[a],r))}var ic=Object.freeze({__proto__:null,array:Ch,color:function(e,t,r){return new rn(nr(e.r,t.r,r),nr(e.g,t.g,r),nr(e.b,t.b,r),nr(e.a,t.a,r))},number:nr});const oc=.95047,El=1.08883,im=4/29,hu=6/29,om=3*hu*hu,R_=hu*hu*hu,O_=Math.PI/180,z_=180/Math.PI;function pf(e){return e>R_?Math.pow(e,1/3):e/om+im}function ff(e){return e>hu?e*e*e:om*(e-im)}function df(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function mf(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function sm(e){const t=mf(e.r),r=mf(e.g),i=mf(e.b),a=pf((.4124564*t+.3575761*r+.1804375*i)/oc),c=pf((.2126729*t+.7151522*r+.072175*i)/1);return{l:116*c-16,a:500*(a-c),b:200*(c-pf((.0193339*t+.119192*r+.9503041*i)/El)),alpha:e.a}}function Il(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*ff(t),r=oc*ff(r),i=El*ff(i),new rn(df(3.2404542*r-1.5371385*t-.4985314*i),df(-.969266*r+1.8760108*t+.041556*i),df(.0556434*r-.2040259*t+1.0572252*i),e.alpha)}function am(e,t,r){const i=t-e;return e+r*(i>180||i<-180?i-360*Math.round(i/360):i)}const pu={forward:sm,reverse:Il,interpolate:function(e,t,r){return{l:nr(e.l,t.l,r),a:nr(e.a,t.a,r),b:nr(e.b,t.b,r),alpha:nr(e.alpha,t.alpha,r)}}},Da={forward:function(e){const{l:t,a:r,b:i}=sm(e),a=Math.atan2(i,r)*z_;return{h:a<0?a+360:a,c:Math.sqrt(r*r+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*O_,r=e.c;return Il({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:am(e.h,t.h,r),c:nr(e.c,t.c,r),l:nr(e.l,t.l,r),alpha:nr(e.alpha,t.alpha,r)}}};var lm=Object.freeze({__proto__:null,hcl:Da,lab:pu});class Mh{constructor(t,r,i,a,c){this.type=t,this.operator=r,this.interpolation=i,this.input=a,this.labels=[],this.outputs=[];for(const[f,g]of c)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(t,r,i,a){let c=0;if(t.name==="exponential")c=Es(r,t.base,i,a);else if(t.name==="linear")c=Es(r,1,i,a);else if(t.name==="cubic-bezier"){const f=t.controlPoints;c=new qe(f[0],f[1],f[2],f[3]).solve(Es(r,1,i,a))}return c}static parse(t,r){let[i,a,c,...f]=t;if(!Array.isArray(a)||a.length===0)return r.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const x=a[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:x}}else{if(a[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const x=a.slice(1);if(x.length!==4||x.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:x}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(c=r.parse(c,2,Bt),!c)return null;const g=[];let y=null;i==="interpolate-hcl"||i==="interpolate-lab"?y=Po:r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let x=0;x<f.length;x+=2){const E=f[x],S=f[x+1],M=x+3,A=x+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const L=r.parse(S,A,y);if(!L)return null;y=y||L.type,g.push([E,L])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Mh(y,i,a,c,g):r.error(`Type ${jr(y)} is not interpolatable.`)}evaluate(t){const r=this.labels,i=this.outputs;if(r.length===1)return i[0].evaluate(t);const a=this.input.evaluate(t);if(a<=r[0])return i[0].evaluate(t);const c=r.length;if(a>=r[c-1])return i[c-1].evaluate(t);const f=Sh(r,a),g=Mh.interpolationFactor(this.interpolation,a,r[f],r[f+1]),y=i[f].evaluate(t),x=i[f+1].evaluate(t);return this.operator==="interpolate"?ic[this.type.kind.toLowerCase()](y,x,g):this.operator==="interpolate-hcl"?Da.reverse(Da.interpolate(Da.forward(y),Da.forward(x),g)):pu.reverse(pu.interpolate(pu.forward(y),pu.forward(x),g))}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,t,this.input.serialize()];for(let i=0;i<this.labels.length;i++)r.push(this.labels[i],this.outputs[i].serialize());return r}}function Es(e,t,r,i){const a=i-r,c=e-r;return a===0?0:t===1?c/a:(Math.pow(t,c)-1)/(Math.pow(t,a)-1)}var ts=Mh;class Ra{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let i=null;const a=r.expectedType;a&&a.kind!=="value"&&(i=a);const c=[];for(const g of t.slice(1)){const y=r.parse(g,1+c.length,i,void 0,{typeAnnotation:"omit"});if(!y)return null;i=i||y.type,c.push(y)}const f=a&&c.some(g=>gl(a,g.type));return new Ra(f?ur:i,c)}evaluate(t){let r,i=null,a=0;for(const c of this.args){if(a++,i=c.evaluate(t),i&&i instanceof Lo&&!i.available&&(r||(r=i),i=null,a===this.args.length))return r;if(i!==null)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var um=Ra;class gf{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let c=1;c<t.length-1;c+=2){const f=t[c];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,c);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",c);const g=r.parse(t[c+1],c+1);if(!g)return null;i.push([f,g])}const a=r.parse(t[t.length-1],t.length-1,r.expectedType,i);return a?new gf(i,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[r,i]of this.bindings)t.push(r,i.serialize());return t.push(this.result.serialize()),t}}var cm=gf;class _f{constructor(t,r,i){this.type=t,this.index=r,this.input=i}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=r.parse(t[1],1,Bt),a=r.parse(t[2],2,qi(r.expectedType||ur));return i&&a?new _f(a.type.itemType,i,a):null}evaluate(t){const r=this.index.evaluate(t),i=this.input.evaluate(t);if(r<0)throw new Rn(`Array index out of bounds: ${r} < 0.`);if(r>=i.length)throw new Rn(`Array index out of bounds: ${r} > ${i.length-1}.`);if(r!==Math.floor(r))throw new Rn(`Array index must be an integer, but found ${r} instead.`);return i[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var N_=_f;class Ah{constructor(t,r){this.type=mr,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=r.parse(t[1],1,ur),a=r.parse(t[2],2,ur);return i&&a?Vp(i.type,[mr,fr,Bt,dl,ur])?new Ah(i,a):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${jr(i.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(i==null)return!1;if(!_l(r,["boolean","string","number","null"]))throw new Rn(`Expected first argument to be of type boolean, string, number or null, but found ${jr(Zn(r))} instead.`);if(!_l(i,["string","array"]))throw new Rn(`Expected second argument to be of type array or string, but found ${jr(Zn(i))} instead.`);return i.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var yf=Ah;class Tl{constructor(t,r,i){this.type=Bt,this.needle=t,this.haystack=r,this.fromIndex=i}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=r.parse(t[1],1,ur),a=r.parse(t[2],2,ur);if(!i||!a)return null;if(!Vp(i.type,[mr,fr,Bt,dl,ur]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${jr(i.type)} instead`);if(t.length===4){const c=r.parse(t[3],3,Bt);return c?new Tl(i,a,c):null}return new Tl(i,a)}evaluate(t){const r=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!_l(r,["boolean","string","number","null"]))throw new Rn(`Expected first argument to be of type boolean, string, number or null, but found ${jr(Zn(r))} instead.`);if(!_l(i,["string","array"]))throw new Rn(`Expected second argument to be of type array or string, but found ${jr(Zn(i))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(t);return i.indexOf(r,a)}return i.indexOf(r)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var hm=Tl;class sc{constructor(t,r,i,a,c,f){this.inputType=t,this.type=r,this.input=i,this.cases=a,this.outputs=c,this.otherwise=f}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let i,a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const c={},f=[];for(let x=2;x<t.length-1;x+=2){let E=t[x];const S=t[x+1];Array.isArray(E)||(E=[E]);const M=r.concat(x);if(E.length===0)return M.error("Expected at least one branch label.");for(const L of E){if(typeof L!="number"&&typeof L!="string")return M.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return M.error("Numeric branch labels must be integer values.");if(i){if(M.checkSubtype(i,Zn(L)))return null}else i=Zn(L);if(c[String(L)]!==void 0)return M.error("Branch labels must be unique.");c[String(L)]=f.length}const A=r.parse(S,x,a);if(!A)return null;a=a||A.type,f.push(A)}const g=r.parse(t[1],1,ur);if(!g)return null;const y=r.parse(t[t.length-1],t.length-1,a);return y?g.type.kind!=="value"&&r.concat(1).checkSubtype(i,g.type)?null:new sc(i,a,g,c,f,y):null}evaluate(t){const r=this.input.evaluate(t);return(Zn(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),i=[],a={};for(const f of r){const g=a[this.cases[f]];g===void 0?(a[this.cases[f]]=i.length,i.push([this.cases[f],[f]])):i[g][1].push(f)}const c=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,g]of i)t.push(g.length===1?c(g[0]):g.map(c)),t.push(this.outputs[f].serialize());return t.push(this.otherwise.serialize()),t}}var k_=sc;class Do{constructor(t,r,i){this.type=t,this.branches=r,this.otherwise=i}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let i;r.expectedType&&r.expectedType.kind!=="value"&&(i=r.expectedType);const a=[];for(let f=1;f<t.length-1;f+=2){const g=r.parse(t[f],f,mr);if(!g)return null;const y=r.parse(t[f+1],f+1,i);if(!y)return null;a.push([g,y]),i=i||y.type}const c=r.parse(t[t.length-1],t.length-1,i);return c?new Do(i,a,c):null}evaluate(t){for(const[r,i]of this.branches)if(r.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,i]of this.branches)t(r),t(i);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(r=>{t.push(r.serialize())}),t}}var F_=Do;class ac{constructor(t,r,i,a){this.type=t,this.input=r,this.beginIndex=i,this.endIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=r.parse(t[1],1,ur),a=r.parse(t[2],2,Bt);if(!i||!a)return null;if(!Vp(i.type,[qi(ur),fr,ur]))return r.error(`Expected first argument to be of type array or string, but found ${jr(i.type)} instead`);if(t.length===4){const c=r.parse(t[3],3,Bt);return c?new ac(i.type,i,a,c):null}return new ac(i.type,i,a)}evaluate(t){const r=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!_l(r,["string","array"]))throw new Rn(`Expected first argument to be of type array or string, but found ${jr(Zn(r))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(t);return r.slice(i,a)}return r.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var B_=ac;function pm(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function fm(e,t,r,i){return i.compare(t,r)===0}function fu(e,t,r){const i=e!=="=="&&e!=="!=";return class IE{constructor(c,f,g){this.type=mr,this.lhs=c,this.rhs=f,this.collator=g,this.hasUntypedArgument=c.type.kind==="value"||f.type.kind==="value"}static parse(c,f){if(c.length!==3&&c.length!==4)return f.error("Expected two or three arguments.");const g=c[0];let y=f.parse(c[1],1,ur);if(!y)return null;if(!pm(g,y.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${jr(y.type)}'.`);let x=f.parse(c[2],2,ur);if(!x)return null;if(!pm(g,x.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${jr(x.type)}'.`);if(y.type.kind!==x.type.kind&&y.type.kind!=="value"&&x.type.kind!=="value")return f.error(`Cannot compare types '${jr(y.type)}' and '${jr(x.type)}'.`);i&&(y.type.kind==="value"&&x.type.kind!=="value"?y=new Ko(x.type,[y]):y.type.kind!=="value"&&x.type.kind==="value"&&(x=new Ko(y.type,[x])));let E=null;if(c.length===4){if(y.type.kind!=="string"&&x.type.kind!=="string"&&y.type.kind!=="value"&&x.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(E=f.parse(c[3],3,ml),!E)return null}return new IE(y,x,E)}evaluate(c){const f=this.lhs.evaluate(c),g=this.rhs.evaluate(c);if(i&&this.hasUntypedArgument){const y=Zn(f),x=Zn(g);if(y.kind!==x.kind||y.kind!=="string"&&y.kind!=="number")throw new Rn(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${y.kind}, ${x.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const y=Zn(f),x=Zn(g);if(y.kind!=="string"||x.kind!=="string")return t(c,f,g)}return this.collator?r(c,f,g,this.collator.evaluate(c)):t(c,f,g)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[e];return this.eachChild(f=>{c.push(f.serialize())}),c}}}const dm=fu("==",function(e,t,r){return t===r},fm),vf=fu("!=",function(e,t,r){return t!==r},function(e,t,r,i){return!fm(0,t,r,i)}),mm=fu("<",function(e,t,r){return t<r},function(e,t,r,i){return i.compare(t,r)<0}),V_=fu(">",function(e,t,r){return t>r},function(e,t,r,i){return i.compare(t,r)>0}),no=fu("<=",function(e,t,r){return t<=r},function(e,t,r,i){return i.compare(t,r)<=0}),U_=fu(">=",function(e,t,r){return t>=r},function(e,t,r,i){return i.compare(t,r)>=0});class xf{constructor(t,r,i,a,c,f){this.type=fr,this.number=t,this.locale=r,this.currency=i,this.unit=a,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const i=r.parse(t[1],1,Bt);if(!i)return null;const a=t[2];if(typeof a!="object"||Array.isArray(a))return r.error("NumberFormat options argument must be an object.");let c=null;if(a.locale&&(c=r.parse(a.locale,1,fr),!c))return null;let f=null;if(a.currency&&(f=r.parse(a.currency,1,fr),!f))return null;let g=null;if(a.unit&&(g=r.parse(a.unit,1,fr),!g))return null;let y=null;if(a["min-fraction-digits"]&&(y=r.parse(a["min-fraction-digits"],1,Bt),!y))return null;let x=null;return a["max-fraction-digits"]&&(x=r.parse(a["max-fraction-digits"],1,Bt),!x)?null:new xf(i,c,f,g,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class bf{constructor(t){this.type=Bt,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=r.parse(t[1],1);return i?i.type.kind!=="array"&&i.type.kind!=="string"&&i.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${jr(i.type)} instead.`):new bf(i):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Rn(`Expected value to be of type string or array, but found ${jr(Zn(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(r=>{t.push(r.serialize())}),t}}function lc(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const wf={"==":dm,"!=":vf,">":V_,"<":mm,">=":U_,"<=":no,array:Ko,at:N_,boolean:Ko,case:F_,coalesce:um,collator:tc,format:Ku,image:Qu,in:yf,"index-of":hm,interpolate:ts,"interpolate-hcl":ts,"interpolate-lab":ts,length:bf,let:cm,literal:lu,match:k_,number:Ko,"number-format":xf,object:Ko,slice:B_,step:hf,string:Ko,"to-boolean":Ca,"to-color":Ca,"to-number":Ca,"to-string":Ca,var:nm,within:dh,distance:lf};function Ph(e,[t,r,i,a]){t=t.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);const c=a?a.evaluate(e):1,f=Xd(t,r,i,c);if(f)throw new Rn(f);return new rn(t/255*c,r/255*c,i/255*c,c)}function gm(e,[t,r,i,a]){t=t.evaluate(e),r=r.evaluate(e),i=i.evaluate(e);const c=a?a.evaluate(e):1,f=function(x,E,S,M){return typeof x=="number"&&x>=0&&x<=360?typeof E=="number"&&E>=0&&E<=100&&typeof S=="number"&&S>=0&&S<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[x,E,S,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[x,E,S,M]:[x,E,S]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[x,E,S,M]:[x,E,S]).join(", ")}]: 'h' must be between 0 and 360.`}(t,r,i,c);if(f)throw new Rn(f);const g=`hsla(${t}, ${r}%, ${i}%, ${c})`,y=rn.parse(g);if(!y)throw new Rn(`Failed to parse HSLA color: ${g}`);return y}function _m(e,t){return e in t}function Sl(e,t){const r=t[e];return r===void 0?null:r}function ym(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return rn.parse(t)}return t}function vm(e,t,r,i){return i!==void 0&&(e=i*Math.round(e/i)),t!==void 0&&e<t&&(e=t),r!==void 0&&e>r&&(e=r),e}function Ef(e,t,r){t=[t,r,e.scope].filter(Boolean).join("");const i=e.getConfig(t);if(!i)return null;const{type:a,value:c,values:f,minValue:g,maxValue:y,stepValue:x}=i,E=i.default.evaluate(e);let S=E;if(c){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),S=c.evaluate(e),e.scope=M}return a&&(S=ym(a,S)),c!==void 0&&S!==void 0&&f&&!f.includes(S)&&(S=E,a&&(S=ym(a,S))),S===void 0||g===void 0&&y===void 0&&x===void 0||(typeof S=="number"?S=vm(S,g,y,x):Array.isArray(S)&&(S=S.map(M=>typeof M=="number"?vm(M,g,y,x):M))),S}function Oa(e){return{type:e}}Qo.register(wf,{error:[{kind:"error"},[fr],(e,[t])=>{throw new Rn(t.evaluate(e))}],typeof:[fr,[ur],(e,[t])=>jr(Zn(t.evaluate(e)))],"to-rgba":[qi(Bt,4),[Po],(e,[t])=>t.evaluate(e).toArray()],rgb:[Po,[Bt,Bt,Bt],Ph],rgba:[Po,[Bt,Bt,Bt,Bt],Ph],hsl:[Po,[Bt,Bt,Bt],gm],hsla:[Po,[Bt,Bt,Bt,Bt],gm],has:{type:mr,overloads:[[[fr],(e,[t])=>_m(t.evaluate(e),e.properties())],[[fr,iu],(e,[t,r])=>_m(t.evaluate(e),r.evaluate(e))]]},get:{type:ur,overloads:[[[fr],(e,[t])=>Sl(t.evaluate(e),e.properties())],[[fr,iu],(e,[t,r])=>Sl(t.evaluate(e),r.evaluate(e))]]},config:{type:ur,overloads:[[[fr],(e,[t])=>Ef(e,t.evaluate(e))],[[fr,fr],(e,[t,r])=>Ef(e,t.evaluate(e),r.evaluate(e))]]},"feature-state":[ur,[fr],(e,[t])=>Sl(t.evaluate(e),e.featureState||{})],properties:[iu,[],e=>e.properties()],"geometry-type":[fr,[],e=>e.geometryType()],id:[ur,[],e=>e.id()],zoom:[Bt,[],e=>e.globals.zoom],pitch:[Bt,[],e=>e.globals.pitch||0],"distance-from-center":[Bt,[],e=>e.distanceFromCenter()],"measure-light":[Bt,[fr],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[Bt,[],e=>e.globals.heatmapDensity||0],"line-progress":[Bt,[],e=>e.globals.lineProgress||0],"raster-value":[Bt,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[Bt,[],e=>e.globals.skyRadialProgress||0],accumulated:[ur,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[Bt,Oa(Bt),(e,t)=>{let r=0;for(const i of t)r+=i.evaluate(e);return r}],"*":[Bt,Oa(Bt),(e,t)=>{let r=1;for(const i of t)r*=i.evaluate(e);return r}],"-":{type:Bt,overloads:[[[Bt,Bt],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[Bt],(e,[t])=>-t.evaluate(e)]]},"/":[Bt,[Bt,Bt],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[Bt,[Bt,Bt],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[Bt,[],()=>Math.LN2],pi:[Bt,[],()=>Math.PI],e:[Bt,[],()=>Math.E],"^":[Bt,[Bt,Bt],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[Bt,[Bt],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Bt,[Bt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Bt,[Bt],(e,[t])=>Math.log(t.evaluate(e))],log2:[Bt,[Bt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Bt,[Bt],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Bt,[Bt],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Bt,[Bt],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Bt,[Bt],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Bt,[Bt],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Bt,[Bt],(e,[t])=>Math.atan(t.evaluate(e))],min:[Bt,Oa(Bt),(e,t)=>Math.min(...t.map(r=>r.evaluate(e)))],max:[Bt,Oa(Bt),(e,t)=>Math.max(...t.map(r=>r.evaluate(e)))],abs:[Bt,[Bt],(e,[t])=>Math.abs(t.evaluate(e))],round:[Bt,[Bt],(e,[t])=>{const r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[Bt,[Bt],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Bt,[Bt],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[mr,[fr,ur],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[mr,[ur],(e,[t])=>e.id()===t.value],"filter-type-==":[mr,[fr],(e,[t])=>e.geometryType()===t.value],"filter-<":[mr,[fr,ur],(e,[t,r])=>{const i=e.properties()[t.value],a=r.value;return typeof i==typeof a&&i<a}],"filter-id-<":[mr,[ur],(e,[t])=>{const r=e.id(),i=t.value;return typeof r==typeof i&&r<i}],"filter->":[mr,[fr,ur],(e,[t,r])=>{const i=e.properties()[t.value],a=r.value;return typeof i==typeof a&&i>a}],"filter-id->":[mr,[ur],(e,[t])=>{const r=e.id(),i=t.value;return typeof r==typeof i&&r>i}],"filter-<=":[mr,[fr,ur],(e,[t,r])=>{const i=e.properties()[t.value],a=r.value;return typeof i==typeof a&&i<=a}],"filter-id-<=":[mr,[ur],(e,[t])=>{const r=e.id(),i=t.value;return typeof r==typeof i&&r<=i}],"filter->=":[mr,[fr,ur],(e,[t,r])=>{const i=e.properties()[t.value],a=r.value;return typeof i==typeof a&&i>=a}],"filter-id->=":[mr,[ur],(e,[t])=>{const r=e.id(),i=t.value;return typeof r==typeof i&&r>=i}],"filter-has":[mr,[ur],(e,[t])=>t.value in e.properties()],"filter-has-id":[mr,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[mr,[qi(fr)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[mr,[qi(ur)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[mr,[fr,qi(ur)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[mr,[fr,qi(ur)],(e,[t,r])=>function(i,a,c,f){for(;c<=f;){const g=c+f>>1;if(a[g]===i)return!0;a[g]>i?f=g-1:c=g+1}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:mr,overloads:[[[mr,mr],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[Oa(mr),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:mr,overloads:[[[mr,mr],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[Oa(mr),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[mr,[mr],(e,[t])=>!t.evaluate(e)],"is-supported-script":[mr,[fr],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[fr,[fr],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[fr,[fr],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[fr,Oa(ur),(e,t)=>t.map(r=>Ju(r.evaluate(e))).join("")],"resolved-locale":[fr,[ml],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[Bt,[Bt,Bt,ur],(e,t)=>{const[r,i,a]=t.map(f=>f.evaluate(e));if(r>i||r===i)return r;let c;if(typeof a=="string")c=function(f){let g=0;if(f.length===0)return g;for(let y=0;y<f.length;y++)g=(g<<5)-g+f.charCodeAt(y),g&=g;return g}(a);else{if(typeof a!="number")throw new Rn(`Invalid seed input: ${a}`);c=a}return r+lc(c)()*(i-r)}]});var uc=wf;function Ro(e){return{result:"success",value:e}}function za(e){return{result:"error",value:e}}function xm(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Na(e){return e["property-type"]==="data-driven"}function cc(e){return xm(e.expression,"measure-light")}function If(e){return xm(e.expression,"zoom")}function Tf(e){return!!e.expression&&e.expression.interpolated}function Lh(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function G_(e){return e}function bm(e,t){const r=t.type==="color",i=e.stops&&typeof e.stops[0][0]=="object",a=i||!(i||e.property!==void 0),c=e.type||(Tf(t)?"exponential":"interval");if(r&&((e=$o({},e)).stops&&(e.stops=e.stops.map(x=>[x[0],rn.parse(x[1])])),e.default=rn.parse(e.default?e.default:t.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!lm[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let f,g,y;if(c==="exponential")f=hc;else if(c==="interval")f=vo;else if(c==="categorical"){f=Dh,g=Object.create(null);for(const x of e.stops)g[x[0]]=x[1];y=typeof e.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);f=j_}if(i){const x={},E=[];for(let A=0;A<e.stops.length;A++){const L=e.stops[A],R=L[0].zoom;x[R]===void 0&&(x[R]={zoom:R,type:e.type,property:e.property,default:e.default,stops:[]},E.push(R)),x[R].stops.push([L[0].value,L[1]])}const S=[];for(const A of E)S.push([x[A].zoom,bm(x[A],t)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:ts.interpolationFactor.bind(void 0,M),zoomStops:S.map(A=>A[0]),evaluate:({zoom:A},L)=>hc({stops:S,base:e.base},t,A).evaluate(A,L)}}if(a){const x=c==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:ts.interpolationFactor.bind(void 0,x),zoomStops:e.stops.map(E=>E[0]),evaluate:({zoom:E})=>f(e,t,E,g,y)}}return{kind:"source",evaluate(x,E){const S=E&&E.properties?E.properties[e.property]:void 0;return S===void 0?ka(e.default,t.default):f(e,t,S,g,y)}}}function ka(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function Dh(e,t,r,i,a){return ka(typeof r===a?i[r]:void 0,e.default,t.default)}function vo(e,t,r){if(Er(r)!=="number")return ka(e.default,t.default);const i=e.stops.length;if(i===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];const a=Sh(e.stops.map(c=>c[0]),r);return e.stops[a][1]}function hc(e,t,r){const i=e.base!==void 0?e.base:1;if(Er(r)!=="number")return ka(e.default,t.default);const a=e.stops.length;if(a===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[a-1][0])return e.stops[a-1][1];const c=Sh(e.stops.map(E=>E[0]),r),f=function(E,S,M,A){const L=A-M,R=E-M;return L===0?0:S===1?R/L:(Math.pow(S,R)-1)/(Math.pow(S,L)-1)}(r,i,e.stops[c][0],e.stops[c+1][0]),g=e.stops[c][1],y=e.stops[c+1][1];let x=ic[t.type]||G_;if(e.colorSpace&&e.colorSpace!=="rgb"){const E=lm[e.colorSpace];x=(S,M)=>E.reverse(E.interpolate(E.forward(S),E.forward(M),f))}return typeof g.evaluate=="function"?{evaluate(...E){const S=g.evaluate.apply(void 0,E),M=y.evaluate.apply(void 0,E);if(S!==void 0&&M!==void 0)return x(S,M,f)}}:x(g,y,f)}function j_(e,t,r){return t.type==="color"?r=rn.parse(r):t.type==="formatted"?r=Xi.fromString(r.toString()):t.type==="resolvedImage"?r=Lo.fromString(r.toString()):Er(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),ka(r,e.default,t.default)}class Sf{constructor(t,r,i,a){this.expression=t,this._warningHistory={},this._evaluator=new Wp(i,a),this._defaultValue=r?function(c){return c.type==="color"&&(Lh(c.default)||Array.isArray(c.default))?new rn(0,0,0,0):c.type==="color"?rn.parse(c.default)||null:c.default===void 0?null:c.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,i,a,c,f,g,y){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=i,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(t,r,i,a,c,f,g,y){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=i||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Rn(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Rh(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in uc}function pc(e,t,r,i){const a=new uf(uc,[],t?function(f){const g={color:Po,string:fr,number:Bt,enum:fr,boolean:mr,formatted:Sa,resolvedImage:$u};return f.type==="array"?qi(g[f.value]||ur,f.length):g[f.type]}(t):void 0,void 0,void 0,r,i),c=a.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Ro(new Sf(c,t,r,i)):za(a.errors)}class fc{constructor(t,r,i){this.kind=t,this._styleExpression=r,this.isLightConstant=i,this.isStateDependent=t!=="constant"&&!pi(r.expression),this.isConfigDependent=!nc(r.expression)}evaluateWithoutErrorHandling(t,r,i,a,c,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,i,a,c,f)}evaluate(t,r,i,a,c,f){return this._styleExpression.evaluate(t,r,i,a,c,f)}}class dc{constructor(t,r,i,a,c){this.kind=t,this.zoomStops=i,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!pi(r.expression),this.isLightConstant=c,this.isConfigDependent=!nc(r.expression),this.interpolationType=a}evaluateWithoutErrorHandling(t,r,i,a,c,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,i,a,c,f)}evaluate(t,r,i,a,c,f){return this._styleExpression.evaluate(t,r,i,a,c,f)}interpolationFactor(t,r,i){return this.interpolationType?ts.interpolationFactor(this.interpolationType,t,r,i):0}}function mc(e,t,r,i){if((e=pc(e,t,r,i)).result==="error")return e;const a=e.value.expression,c=uu(a);if(!c&&!Na(t))return za([new Jo("","data expressions not supported")]);const f=wl(a,["zoom","pitch","distance-from-center"]);if(!f&&!If(t))return za([new Jo("","zoom expressions not supported")]);const g=wl(a,["measure-light"]);if(!g&&!cc(t))return za([new Jo("","measure-light expression not supported")]);const y=t.expression&&t.expression.relaxZoomRestriction,x=zh(a);return x||f||y?x instanceof Jo?za([x]):x instanceof ts&&!Tf(t)?za([new Jo("",'"interpolate" expressions cannot be used with this property')]):Ro(x?new dc(c?"camera":"composite",e.value,x.labels,x instanceof ts?x.interpolation:void 0,g):new fc(c?"constant":"source",e.value,g)):za([new Jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Oh{constructor(t,r){this._parameters=t,this._specification=r,$o(this,bm(this._parameters,this._specification))}static deserialize(t){return new Oh(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function zh(e){let t=null;if(e instanceof cm)t=zh(e.result);else if(e instanceof um){for(const r of e.args)if(t=zh(r),t)break}else(e instanceof hf||e instanceof ts)&&e.input instanceof Qo&&e.input.name==="zoom"&&(t=e);return t instanceof Jo||e.eachChild(r=>{const i=zh(r);i instanceof Jo?t=i:t&&i&&t!==i&&(t=new Jo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function io(e){const t=e.key,r=e.value,i=e.valueSpec||{},a=e.objectElementValidators||{},c=e.style,f=e.styleSpec;let g=[];const y=Er(r);if(y!=="object")return[new xe(t,r,`object expected, ${y} found`)];for(const x in r){const E=x.split(".")[0];let S;a[E]?S=a[E]:i[E]?S=Xn:a["*"]?S=a["*"]:i["*"]&&(S=Xn),S?g=g.concat(S({key:(t&&`${t}.`)+x,value:r[x],valueSpec:i[E]||i["*"],style:c,styleSpec:f,object:r,objectKey:x},r)):g.push(new bs(t,r[x],`unknown property "${x}"`))}for(const x in i)a[x]||i[x].required&&i[x].default===void 0&&r[x]===void 0&&g.push(new xe(t,r,`missing required property "${x}"`));return g}function wm(e){const t=e.value,r=e.valueSpec,i=e.style,a=e.styleSpec,c=e.key,f=e.arrayElementValidator||Xn;if(Er(t)!=="array")return[new xe(c,t,`array expected, ${Er(t)} found`)];if(r.length&&t.length!==r.length)return[new xe(c,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new xe(c,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let g={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};a.$version<7&&(g.function=r.function),Er(r.value)==="object"&&(g=r.value);let y=[];for(let x=0;x<t.length;x++)y=y.concat(f({array:t,arrayIndex:x,value:t[x],valueSpec:g,style:i,styleSpec:a,key:`${c}[${x}]`},!0));return y}function Cf(e){const t=e.key,r=e.value,i=e.valueSpec;let a=Er(r);if(a==="number"&&r!=r&&(a="NaN"),a!=="number")return[new xe(t,r,`number expected, ${a} found`)];if("minimum"in i){let c=i.minimum;if(Er(i.minimum)==="array"&&(c=i.minimum[e.arrayIndex]),r<c)return[new xe(t,r,`${r} is less than the minimum value ${c}`)]}if("maximum"in i){let c=i.maximum;if(Er(i.maximum)==="array"&&(c=i.maximum[e.arrayIndex]),r>c)return[new xe(t,r,`${r} is greater than the maximum value ${c}`)]}return[]}function Mf(e){const t=e.valueSpec,r=Dn(e.value.type);let i,a,c,f={};const g=r!=="categorical"&&e.value.property===void 0,y=!g,x=Er(e.value.stops)==="array"&&Er(e.value.stops[0])==="array"&&Er(e.value.stops[0][0])==="object",E=io({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(A){if(r==="identity")return[new xe(A.key,A.value,'identity function may not have a "stops" property')];let L=[];const R=A.value;return L=L.concat(wm({key:A.key,value:R,valueSpec:A.valueSpec,style:A.style,styleSpec:A.styleSpec,arrayElementValidator:S})),Er(R)==="array"&&R.length===0&&L.push(new xe(A.key,R,"array must have at least one stop")),L},default:function(A){return Xn({key:A.key,value:A.value,valueSpec:t,style:A.style,styleSpec:A.styleSpec})}}});return r==="identity"&&g&&E.push(new xe(e.key,e.value,'missing required property "property"')),r==="identity"||e.value.stops||E.push(new xe(e.key,e.value,'missing required property "stops"')),r==="exponential"&&e.valueSpec.expression&&!Tf(e.valueSpec)&&E.push(new xe(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(y&&!Na(e.valueSpec)?E.push(new xe(e.key,e.value,"property functions not supported")):g&&!If(e.valueSpec)&&E.push(new xe(e.key,e.value,"zoom functions not supported"))),r!=="categorical"&&!x||e.value.property!==void 0||E.push(new xe(e.key,e.value,'"property" property is required')),E;function S(A){let L=[];const R=A.value,N=A.key;if(Er(R)!=="array")return[new xe(N,R,`array expected, ${Er(R)} found`)];if(R.length!==2)return[new xe(N,R,`array length 2 expected, length ${R.length} found`)];if(x){if(Er(R[0])!=="object")return[new xe(N,R,`object expected, ${Er(R[0])} found`)];if(R[0].zoom===void 0)return[new xe(N,R,"object stop key must have zoom")];if(R[0].value===void 0)return[new xe(N,R,"object stop key must have value")];const F=Dn(R[0].zoom);if(typeof F!="number")return[new xe(N,R[0].zoom,"stop zoom values must be numbers")];if(c&&c>F)return[new xe(N,R[0].zoom,"stop zoom values must appear in ascending order")];F!==c&&(c=F,a=void 0,f={}),L=L.concat(io({key:`${N}[0]`,value:R[0],valueSpec:{zoom:{}},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{zoom:Cf,value:M}}))}else L=L.concat(M({key:`${N}[0]`,value:R[0],valueSpec:{},style:A.style,styleSpec:A.styleSpec},R));return Rh(Qs(R[1]))?L.concat([new xe(`${N}[1]`,R[1],"expressions are not allowed in function stops.")]):L.concat(Xn({key:`${N}[1]`,value:R[1],valueSpec:t,style:A.style,styleSpec:A.styleSpec}))}function M(A,L){const R=Er(A.value),N=Dn(A.value),F=A.value!==null?A.value:L;if(i){if(R!==i)return[new xe(A.key,F,`${R} stop domain type must match previous stop domain type ${i}`)]}else i=R;if(R!=="number"&&R!=="string"&&R!=="boolean"&&typeof N!="number"&&typeof N!="string"&&typeof N!="boolean")return[new xe(A.key,F,"stop domain value must be a number, string, or boolean")];if(R!=="number"&&r!=="categorical"){let W=`number expected, ${R} found`;return Na(t)&&r===void 0&&(W+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xe(A.key,F,W)]}return r!=="categorical"||R!=="number"||typeof N=="number"&&isFinite(N)&&Math.floor(N)===N?r!=="categorical"&&R==="number"&&typeof N=="number"&&typeof a=="number"&&a!==void 0&&N<a?[new xe(A.key,F,"stop domain values must appear in ascending order")]:(a=N,r==="categorical"&&N in f?[new xe(A.key,F,"stop domain values must be unique")]:(f[N]=!0,[])):[new xe(A.key,F,`integer expected, found ${String(N)}`)]}}function Cl(e){const t=(e.expressionContext==="property"?mc:pc)(Qs(e.value),e.valueSpec);if(t.result==="error")return t.value.map(i=>new xe(`${e.key}${i.key}`,e.value,i.message));const r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new xe(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!pi(r))return[new xe(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter")return Nh(r,e);if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!wl(r,["zoom","feature-state"]))return[new xe(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!uu(r))return[new xe(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nh(e,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const a of t.valueSpec.expression.parameters)r.delete(a);if(r.size===0)return[];const i=[];return e instanceof Qo&&r.has(e.name)?[new xe(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(a=>{i.push(...Nh(a,t))}),i)}function Ml(e){const t=e.key,r=e.value,i=e.valueSpec,a=[];return Array.isArray(i.values)?i.values.indexOf(Dn(r))===-1&&a.push(new xe(t,r,`expected one of [${i.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(i.values).indexOf(Dn(r))===-1&&a.push(new xe(t,r,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(r)} found`)),a}function kh(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!kh(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Fh(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};kh(e)||(e=Bh(e));const r=e;let i=!0;try{i=function(x){if(!Fa(x))return x;let E=Qs(x);return Em(E),E=Af(E),E}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const a=bt[`filter_${t}`],c=pc(i,a);let f=null;if(c.result==="error")throw new Error(c.value.map(x=>`${x.key}: ${x.message}`).join(", "));f=(x,E,S)=>c.value.evaluate(x,E,{},S);let g=null,y=null;if(i!==r){const x=pc(r,a);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,S,M,A,L)=>x.value.evaluate(E,S,{},M,void 0,void 0,A,L),y=!uu(x.value.expression)}return{filter:f,dynamicFilter:g||void 0,needGeometry:Im(i),needFeature:!!y}}function Af(e){if(!Array.isArray(e))return e;const t=function(r){if(q_.has(r[0])){for(let i=1;i<r.length;i++)if(Fa(r[i]))return!0}return r}(e);return t===!0?t:t.map(r=>Af(r))}function Em(e){let t=!1;const r=[];if(e[0]==="case"){for(let i=1;i<e.length-1;i+=2)t=t||Fa(e[i]),r.push(e[i+1]);r.push(e[e.length-1])}else if(e[0]==="match"){t=t||Fa(e[1]);for(let i=2;i<e.length-1;i+=2)r.push(e[i+1]);r.push(e[e.length-1])}else if(e[0]==="step"){t=t||Fa(e[1]);for(let i=1;i<e.length-1;i+=2)r.push(e[i+1])}t&&(e.length=0,e.push("any",...r));for(let i=1;i<e.length;i++)Em(e[i])}function Fa(e){if(!Array.isArray(e))return!1;if((t=e[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let r=1;r<e.length;r++)if(Fa(e[r]))return!0;return!1}const q_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Z_(e,t){return e<t?-1:e>t?1:0}function Im(e){if(!Array.isArray(e))return!1;if(e[0]==="within"||e[0]==="distance")return!0;for(let t=1;t<e.length;t++)if(Im(e[t]))return!0;return!1}function Bh(e){if(!e)return!0;const t=e[0];return e.length<=1?t!=="any":t==="=="?Vh(e[1],e[2],"=="):t==="!="?Uh(Vh(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Vh(e[1],e[2],t):t==="any"?(r=e.slice(1),["any"].concat(r.map(Bh))):t==="all"?["all"].concat(e.slice(1).map(Bh)):t==="none"?["all"].concat(e.slice(1).map(Bh).map(Uh)):t==="in"?Tm(e[1],e.slice(2)):t==="!in"?Uh(Tm(e[1],e.slice(2))):t==="has"?Sm(e[1]):t!=="!has"||Uh(Sm(e[1]));var r}function Vh(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function Tm(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Z_)]]:["filter-in-small",e,["literal",t]]}}function Sm(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Uh(e){return["!",e]}function Pf(e){return kh(Qs(e.value))?Cl($o({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):Cm(e)}function Cm(e){const t=e.value,r=e.key;if(Er(t)!=="array")return[new xe(r,t,`array expected, ${Er(t)} found`)];const i=e.styleSpec;let a,c=[];if(t.length<1)return[new xe(r,t,"filter array must have at least 1 element")];switch(c=c.concat(Ml({key:`${r}[0]`,value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),Dn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Dn(t[1])==="$type"&&c.push(new xe(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&c.push(new xe(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(a=Er(t[1]),a!=="string"&&c.push(new xe(`${r}[1]`,t[1],`string expected, ${a} found`)));for(let f=2;f<t.length;f++)a=Er(t[f]),Dn(t[1])==="$type"?c=c.concat(Ml({key:`${r}[${f}]`,value:t[f],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&c.push(new xe(`${r}[${f}]`,t[f],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)c=c.concat(Cm({key:`${r}[${f}]`,value:t[f],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":a=Er(t[1]),t.length!==2?c.push(new xe(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):a!=="string"&&c.push(new xe(`${r}[1]`,t[1],`string expected, ${a} found`))}return c}function Mm(e,t){const r=e.key,i=e.style,a=e.layer,c=e.styleSpec,f=e.value,g=e.objectKey,y=c[`${t}_${e.layerType}`];if(!y)return[];const x=g.match(/^(.*)-transition$/);if(t==="paint"&&x&&y[x[1]]&&y[x[1]].transition)return Xn({key:r,value:f,valueSpec:c.transition,style:i,styleSpec:c});const E=e.valueSpec||y[g];if(!E)return[new bs(r,f,`unknown property "${g}"`)];let S;if(Er(f)==="string"&&Na(E)&&!E.tokens&&(S=/^{([^}]+)}$/.exec(f))){const A=`\`{ "type": "identity", "property": ${S?JSON.stringify(S[1]):'"_"'} }\``;return[new xe(r,f,`"${g}" does not support interpolation syntax
Use an identity property function instead: ${A}.`)]}const M=[];if(e.layerType==="symbol")g!=="text-field"||!i||i.glyphs||i.imports||M.push(new xe(r,f,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&Lh(Qs(f))&&Dn(f.type)==="identity"&&M.push(new xe(r,f,'"text-font" does not support identity functions'));else if(e.layerType==="model"&&t==="paint"&&a&&a.layout&&a.layout.hasOwnProperty("model-id")&&Na(E)&&(cc(E)||If(E))){const A=mc(Qs(f),E),L=A.value.expression||A.value._styleExpression.expression;L&&!wl(L,["measure-light"])&&(g==="model-emissive-strength"&&uu(L)&&pi(L)||M.push(new xe(r,f,`${g} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return M.concat(Xn({key:e.key,value:f,valueSpec:E,style:i,styleSpec:c,expressionContext:"property",propertyType:t,propertyKey:g}))}function Am(e){return Mm(e,"paint")}function gc(e){return Mm(e,"layout")}function Pm(e){let t=[];const r=e.value,i=e.key,a=e.style,c=e.styleSpec;r.type||r.ref||t.push(new xe(i,r,'either "type" or "ref" is required'));let f=Dn(r.type);const g=Dn(r.ref);if(r.id){const y=Dn(r.id);for(let x=0;x<e.arrayIndex;x++){const E=a.layers[x];Dn(E.id)===y&&t.push(new xe(i,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let y;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&t.push(new xe(i,r[x],`"${x}" is prohibited for ref layers`))}),a.layers.forEach(x=>{Dn(x.id)===g&&(y=x)}),y?y.ref?t.push(new xe(i,r.ref,"ref cannot reference another ref layer")):f=Dn(y.type):typeof g=="string"&&t.push(new xe(i,r.ref,`ref layer "${g}" not found`))}else if(f!=="background"&&f!=="sky"&&f!=="slot")if(r.source){const y=a.sources&&a.sources[r.source],x=y&&Dn(y.type);y?x==="vector"&&f==="raster"?t.push(new xe(i,r.source,`layer "${r.id}" requires a raster source`)):x==="raster"&&f!=="raster"?t.push(new xe(i,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&f!=="hillshade"?t.push(new xe(i,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||x==="geojson"&&y.lineMetrics||t.push(new xe(i,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new xe(i,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new xe(i,r.source,`source "${r.source}" not found`))}else t.push(new xe(i,r,'missing required property "source"'));return t=t.concat(io({key:i,value:r,valueSpec:c.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Xn({key:`${i}.type`,value:r.type,valueSpec:c.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"}),filter:y=>Pf($o({layerType:f},y)),layout:y=>io({layer:r,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":x=>gc($o({layerType:f},x))}}),paint:y=>io({layer:r,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":x=>Am($o({layerType:f,layer:r},x))}})}})),t}function du(e){const t=e.value,r=e.key,i=Er(t);return i!=="string"?[new xe(r,t,`string expected, ${i} found`)]:[]}const _c={promoteId:function({key:e,value:t}){if(Er(t)==="string")return du({key:e,value:t});{const r=[];for(const i in t)r.push(...du({key:`${e}.${i}`,value:t[i]}));return r}}};function Lm(e){const t=e.value,r=e.key,i=e.styleSpec,a=e.style;if(!t.type)return[new xe(r,t,'"type" is required')];const c=Dn(t.type);let f=[];switch(["vector","raster","raster-dem"].includes(c)&&(t.url||t.tiles||f.push(new bs(r,t,'Either "url" or "tiles" is required.'))),c){case"vector":case"raster":case"raster-dem":return f=f.concat(io({key:r,value:t,valueSpec:i[`source_${c.replace("-","_")}`],style:e.style,styleSpec:i,objectElementValidators:_c})),f;case"geojson":if(f=io({key:r,value:t,valueSpec:i.source_geojson,style:a,styleSpec:i,objectElementValidators:_c}),t.cluster)for(const g in t.clusterProperties){const[y,x]=t.clusterProperties[g],E=typeof y=="string"?[y,["accumulated"],["get",g]]:y;f.push(...Cl({key:`${r}.${g}.map`,value:x,expressionContext:"cluster-map"})),f.push(...Cl({key:`${r}.${g}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return f;case"video":return io({key:r,value:t,valueSpec:i.source_video,style:a,styleSpec:i});case"image":return io({key:r,value:t,valueSpec:i.source_image,style:a,styleSpec:i});case"canvas":return[new xe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ml({key:`${r}.type`,value:t.type,valueSpec:{values:Dm(i)},style:a,styleSpec:i})}}function Dm(e){return e.source.reduce((t,r)=>{const i=e[r];return i.type.type==="enum"&&(t=t.concat(Object.keys(i.type.values))),t},[])}function Rm(e){const t=e.value;let r=[];if(!t)return r;const i=Er(t);return i!=="string"?(r=r.concat([new xe(e.key,t,`string expected, "${i}" found`)]),r):(function(a){const c=a.indexOf("://")===-1;try{return new URL(a,c?"http://example.com":void 0),!0}catch{return!1}}(t)||(r=r.concat([new xe(e.key,t,`invalid url "${t}"`)])),r)}function Lf(e){const t=e.value,r=e.styleSpec,i=r.light,a=e.style;let c=[];const f=Er(t);if(t===void 0)return c;if(f!=="object")return c=c.concat([new xe("light",t,`object expected, ${f} found`)]),c;for(const g in t){const y=g.match(/^(.*)-transition$/);c=c.concat(y&&i[y[1]]&&i[y[1]].transition?Xn({key:g,value:t[g],valueSpec:r.transition,style:a,styleSpec:r}):i[g]?Xn({key:g,value:t[g],valueSpec:i[g],style:a,styleSpec:r}):[new xe(g,t[g],`unknown property "${g}"`)])}return c}function Df(e){const t=e.value;let r=[];if(!t)return r;const i=Er(t);if(i!=="object")return r=r.concat([new xe("light-3d",t,`object expected, ${i} found`)]),r;const a=e.styleSpec,c=a["light-3d"],f=e.key,g=e.style,y=e.style.lights;for(const S of["type","id"])if(!(S in t))return r=r.concat([new xe("light-3d",t,`missing property ${S} on light`)]),r;if(t.type&&y)for(let S=0;S<e.arrayIndex;S++){const M=Dn(t.type),A=y[S];Dn(A.type)===M&&r.push(new xe(f,t.id,`duplicate light type "${t.type}", previously defined at line ${A.id.__line__}`))}const x=`properties_light_${t.type}`;if(!(x in a))return r=r.concat([new xe("light-3d",t,`Invalid light type ${t.type}`)]),r;const E=a[x];for(const S in t)if(S==="properties"){const M=t[S],A=Er(M);if(A!=="object")return r=r.concat([new xe("properties",M,`object expected, ${A} found`)]),r;for(const L in M)r=r.concat(E[L]?Xn({key:L,value:M[L],valueSpec:E[L],style:g,styleSpec:a}):[new bs(e.key,M[L],`unknown property "${L}"`)])}else{const M=S.match(/^(.*)-transition$/);r=r.concat(M&&c[M[1]]&&c[M[1]].transition?Xn({key:S,value:t[S],valueSpec:a.transition,style:g,styleSpec:a}):c[S]?Xn({key:S,value:t[S],valueSpec:c[S],style:g,styleSpec:a}):[new bs(S,t[S],`unknown property "${S}"`)])}return r}function Rf(e){const t=e.value,r=e.key,i=e.style,a=e.styleSpec,c=a.terrain;let f=[];const g=Er(t);if(t===void 0||g==="null")return f;if(g!=="object")return f=f.concat([new xe("terrain",t,`object expected, ${g} found`)]),f;for(const y in t){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&c[x[1]]&&c[x[1]].transition?Xn({key:y,value:t[y],valueSpec:a.transition,style:i,styleSpec:a}):c[y]?Xn({key:y,value:t[y],valueSpec:c[y],style:i,styleSpec:a}):[new bs(y,t[y],`unknown property "${y}"`)])}if(t.source){const y=i.sources&&i.sources[t.source],x=y&&Dn(y.type);y?x!=="raster-dem"&&f.push(new xe(r,t.source,`terrain cannot be used with a source of type ${String(x)}, it only be used with a "raster-dem" source type`)):f.push(new xe(r,t.source,`source "${t.source}" not found`))}else f.push(new xe(r,t,'terrain is missing required property "source"'));return f}function Of(e){const t=e.value,r=e.style,i=e.styleSpec,a=i.fog;let c=[];const f=Er(t);if(t===void 0)return c;if(f!=="object")return c=c.concat([new xe("fog",t,`object expected, ${f} found`)]),c;for(const g in t){const y=g.match(/^(.*)-transition$/);c=c.concat(y&&a[y[1]]&&a[y[1]].transition?Xn({key:g,value:t[g],valueSpec:i.transition,style:r,styleSpec:i}):a[g]?Xn({key:g,value:t[g],valueSpec:a[g],style:r,styleSpec:i}):[new bs(g,t[g],`unknown property "${g}"`)])}return c}const Gh={"*":()=>[],array:wm,boolean:function(e){const t=e.value,r=e.key,i=Er(t);return i!=="boolean"?[new xe(r,t,`boolean expected, ${i} found`)]:[]},number:Cf,color:function(e){const t=e.key,r=e.value,i=Er(r);return i!=="string"?[new xe(t,r,`color expected, ${i} found`)]:uh(r)===null?[new xe(t,r,`color expected, "${r}" found`)]:[]},enum:Ml,filter:Pf,function:Mf,layer:Pm,object:io,source:Lm,model:Rm,light:Lf,"light-3d":Df,terrain:Rf,fog:Of,string:du,formatted:function(e){return du(e).length===0?[]:Cl(e)},resolvedImage:function(e){return du(e).length===0?[]:Cl(e)},projection:function(e){const t=e.value,r=e.styleSpec,i=r.projection,a=e.style;let c=[];const f=Er(t);if(f==="object")for(const g in t)c=c.concat(Xn({key:g,value:t[g],valueSpec:i[g],style:a,styleSpec:r}));else f!=="string"&&(c=c.concat([new xe("projection",t,`object or string expected, ${f} found`)]));return c},import:function(e){const{value:t,styleSpec:r}=e,{data:i,...a}=t;Object.defineProperty(a,"__line__",{value:t.__line__,enumerable:!1});let c=io($o({},e,{value:a,valueSpec:r.import}));return Dn(a.id)===""&&c.push(new xe(`${e.key}.id`,a,"import id can't be an empty string")),i&&(c=c.concat(Om(i,r,{key:`${e.key}.data`}))),c}};function Xn(e,t=!1){const r=e.value,i=e.valueSpec,a=e.styleSpec;if(i.expression&&Lh(Dn(r)))return Mf(e);if(i.expression&&Rh(Qs(r)))return Cl(e);if(i.type&&Gh[i.type]){const c=Gh[i.type](e);return t===!0&&c.length>0&&Er(e.value)==="array"?Cl(e):c}return io($o({},e,{valueSpec:i.type?a[i.type]:i}))}function X_(e){const t=e.value,r=e.key,i=du(e);return i.length||(t.indexOf("{fontstack}")===-1&&i.push(new xe(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&i.push(new xe(r,t,'"glyphs" url must include a "{range}" token'))),i}function Om(e,t=bt,r={}){return Xn({key:r.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:X_,"*":()=>[]}})}function zf(e,t=bt){return es(Om(e,t))}const W_=e=>es(Am(e)),H_=e=>es(gc(e));function es(e){return e.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function zm(e,t){let r=!1;if(t&&t.length)for(const i of t)i instanceof bs?pn(i.message):(e.fire(new fl(new Error(i.message))),r=!0);return r}var Y_=Is,Ba=3;function Is(e,t,r){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var a=new Int32Array(this.arrayBuffer);e=a[0],this.d=(t=a[1])+2*(r=a[2]);for(var c=0;c<this.d*this.d;c++){var f=a[Ba+c],g=a[Ba+c+1];i.push(f===g?null:a.subarray(f,g))}var y=a[Ba+i.length+1];this.keys=a.subarray(a[Ba+i.length],y),this.bboxes=a.subarray(y),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var x=0;x<this.d*this.d;x++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var E=r/t*e;this.min=-E,this.max=e+E}Is.prototype.insert=function(e,t,r,i,a){this._forEachCell(t,r,i,a,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(a)},Is.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Is.prototype._insertCell=function(e,t,r,i,a,c){this.cells[a].push(c)},Is.prototype.query=function(e,t,r,i,a){var c=this.min,f=this.max;if(e<=c&&t<=c&&f<=r&&f<=i&&!a)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(e,t,r,i,this._queryCell,g,{},a),g},Is.prototype._queryCell=function(e,t,r,i,a,c,f,g){var y=this.cells[a];if(y!==null)for(var x=this.keys,E=this.bboxes,S=0;S<y.length;S++){var M=y[S];if(f[M]===void 0){var A=4*M;(g?g(E[A+0],E[A+1],E[A+2],E[A+3]):e<=E[A+2]&&t<=E[A+3]&&r>=E[A+0]&&i>=E[A+1])?(f[M]=!0,c.push(x[M])):f[M]=!1}}},Is.prototype._forEachCell=function(e,t,r,i,a,c,f,g){for(var y=this._convertToCellCoord(e),x=this._convertToCellCoord(t),E=this._convertToCellCoord(r),S=this._convertToCellCoord(i),M=y;M<=E;M++)for(var A=x;A<=S;A++){var L=this.d*A+M;if((!g||g(this._convertFromCellCoord(M),this._convertFromCellCoord(A),this._convertFromCellCoord(M+1),this._convertFromCellCoord(A+1)))&&a.call(this,e,t,r,i,L,c,f,g))return}},Is.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Is.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Is.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Ba+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var a=new Int32Array(t+r+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var c=t,f=0;f<e.length;f++){var g=e[f];a[Ba+f]=c,a.set(g,c),c+=g.length}return a[Ba+e.length]=c,a.set(this.keys,c),a[Ba+e.length+1]=c+=this.keys.length,a.set(this.bboxes,c),c+=this.bboxes.length,a.buffer};var mu=ue(Y_);const jh={};function me(e,t,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),jh[t]={klass:e,omit:r.omit||[]}}me(Object,"Object"),mu.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.add(r),{buffer:r}},mu.deserialize=function(e){return new mu(e.buffer)},Object.defineProperty(mu,"name",{value:"Grid"}),me(mu,"Grid"),me(rn,"Color"),me(Error,"Error"),me(Xi,"Formatted"),me(yl,"FormattedSection"),me(Mo,"AJAXError"),me(Lo,"ResolvedImage"),me(Oh,"StylePropertyFunction"),me(Sf,"StyleExpression",{omit:["_evaluator"]}),me(dc,"ZoomDependentExpression"),me(fc,"ZoomConstantExpression"),me(Qo,"CompoundExpression",{omit:["_evaluate"]});for(const e in uc)jh[uc[e]._classRegistryKey]||me(uc[e],`Expression${e}`);function d(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function o(e){return self.ImageBitmap&&e instanceof ImageBitmap}function l(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(d(e)||o(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const r=e;return t&&t.add(r.buffer),r}if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const i of e)r.push(l(i,t));return r}if(e instanceof Map){const r={$name:"Map"};for(const[i,a]of e.entries())r[i]=l(a);return r}if(typeof e=="object"){const r=e.constructor,i=r._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);const a=r.serialize?r.serialize(e,t):{};if(!r.serialize){for(const c in e)e.hasOwnProperty(c)&&(jh[i].omit.indexOf(c)>=0||(a[c]=l(e[c],t)));e instanceof Error&&(a.message=e.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(a.$name=i),a}throw new Error("can't serialize object of type "+typeof e)}function _(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||d(e)||o(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(_);if(typeof e=="object"){const t=e.$name||"Object";if(t==="Map"){const a=new Map;for(const c of Object.keys(e))c!=="$name"&&a.set(c,_(e[c]));return a}const{klass:r}=jh[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(e);const i=Object.create(r.prototype);for(const a of Object.keys(e))a!=="$name"&&(i[a]=_(e[a]));return i}throw new Error("can't deserialize object of type "+typeof e)}const v={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function w(e){for(const t of e)if(P(t.charCodeAt(0)))return!0;return!1}function I(e){for(const t of e)if(!C(t.charCodeAt(0)))return!1;return!0}function C(e){return!(v.Arabic(e)||v["Arabic Supplement"](e)||v["Arabic Extended-A"](e)||v["Arabic Presentation Forms-A"](e)||v["Arabic Presentation Forms-B"](e))}function P(e){return!(e!==746&&e!==747&&(e<4352||!(v["Bopomofo Extended"](e)||v.Bopomofo(e)||v["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||v["CJK Compatibility Ideographs"](e)||v["CJK Compatibility"](e)||v["CJK Radicals Supplement"](e)||v["CJK Strokes"](e)||!(!v["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||v["CJK Unified Ideographs Extension A"](e)||v["CJK Unified Ideographs"](e)||v["Enclosed CJK Letters and Months"](e)||v["Hangul Compatibility Jamo"](e)||v["Hangul Jamo Extended-A"](e)||v["Hangul Jamo Extended-B"](e)||v["Hangul Jamo"](e)||v["Hangul Syllables"](e)||v.Hiragana(e)||v["Ideographic Description Characters"](e)||v.Kanbun(e)||v["Kangxi Radicals"](e)||v["Katakana Phonetic Extensions"](e)||v.Katakana(e)&&e!==12540||!(!v["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!v["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||v["Unified Canadian Aboriginal Syllabics"](e)||v["Unified Canadian Aboriginal Syllabics Extended"](e)||v["Vertical Forms"](e)||v["Yijing Hexagram Symbols"](e)||v["Yi Syllables"](e)||v["Yi Radicals"](e))))}function D(e){return!(P(e)||function(t){return!!(v["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||v["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||v["Letterlike Symbols"](t)||v["Number Forms"](t)||v["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||v["Control Pictures"](t)&&t!==9251||v["Optical Character Recognition"](t)||v["Enclosed Alphanumerics"](t)||v["Geometric Shapes"](t)||v["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||v["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||v["CJK Symbols and Punctuation"](t)||v.Katakana(t)||v["Private Use Area"](t)||v["CJK Compatibility Forms"](t)||v["Small Form Variants"](t)||v["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function z(e){return e>=1424&&e<=2303||v["Arabic Presentation Forms-A"](e)||v["Arabic Presentation Forms-B"](e)}function k(e,t){return!(!t&&z(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||v.Khmer(e))}function B(e){for(const t of e)if(z(t.charCodeAt(0)))return!0;return!1}const U="deferred",q="loading",X="loaded";let Z=null,j="unavailable",J=null;const nt=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(j="error"),Z&&Z(e)};function st(){Y.fire(new Yo("pluginStateChange",{pluginStatus:j,pluginURL:J}))}const Y=new xs,K=function(){return j},lt=function(){if(j!==U||!J)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");j=q,st(),J&&ci({url:J},e=>{e?nt(e):(j=X,st())})},ht={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>j===X||ht.applyArabicShaping!=null,isLoading:()=>j===q,setState(e){j=e.pluginStatus,J=e.pluginURL},isParsed:()=>ht.applyArabicShaping!=null&&ht.processBidirectionalText!=null&&ht.processStyledBidirectionalText!=null,getPluginURL:()=>J};class ut{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(r,i){for(const a of r)if(!k(a.charCodeAt(0),i))return!1;return!0}(t,ht.isLoaded())}}class pt{constructor(t,r,i,a){this.property=t,this.value=r,this.expression=function(c,f,g,y){if(Lh(c))return new Oh(c,f);if(Rh(c)||Array.isArray(c)&&c.length>0){const x=mc(c,f,g,y);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));return x.value}{let x=c;return typeof c=="string"&&f.type==="color"&&(x=rn.parse(c)),{kind:"constant",isConfigDependent:!1,evaluate:()=>x}}}(r===void 0?t.specification.default:r,t.specification,i,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,i){return this.property.possiblyEvaluate(this,t,r,i)}}class Dt{constructor(t,r,i){this.property=t,this.value=new pt(t,void 0,r,i)}transitioned(t,r){return new St(this.property,this.value,r,Qr({},t.transition,this.transition),t.now)}untransitioned(){return new St(this.property,this.value,null,{},0)}}class wt{constructor(t,r,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=r,this._options=i,this.isConfigDependent=!1}getValue(t){return Ho(this._values[t].value.value)}setValue(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Dt(this._values[t].property,this._scope,this._options)),this._values[t].value=new pt(this._values[t].property,r===null?void 0:Ho(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,r){r&&(this._options=r);const i=this._properties.properties;if(t)for(const a in t){const c=t[a];if(ru(a,"-transition")){const f=a.slice(0,-11);i[f]&&this.setTransition(f,c)}else i[a]&&this.setValue(a,c)}}getTransition(t){return Ho(this._values[t].transition)}setTransition(t,r){this._values.hasOwnProperty(t)||(this._values[t]=new Dt(this._values[t].property)),this._values[t].transition=Ho(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const i=this.getValue(r);i!==void 0&&(t[r]=i);const a=this.getTransition(r);a!==void 0&&(t[`${r}-transition`]=a)}return t}transitioned(t,r){const i=new mt(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].transitioned(t,r._values[a]);return i}untransitioned(){const t=new mt(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class St{constructor(t,r,i,a,c){const f=a.delay||0,g=a.duration||0;c=c||0,this.property=t,this.value=r,this.begin=c+f,this.end=this.begin+g,t.specification.transition&&(a.delay||a.duration)&&(this.prior=i)}possiblyEvaluate(t,r,i){const a=t.now||0,c=this.value.possiblyEvaluate(t,r,i),f=this.prior;if(f){if(a>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(a<this.begin)return f.possiblyEvaluate(t,r,i);{const g=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,r,i),c,vr(g))}}return c}}class mt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,i){const a=new zt(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(t,r,i);return a}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Lt{constructor(t,r,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=r,this._options=i,this.isConfigDependent=!1}getValue(t){return Ho(this._values[t].value)}setValue(t,r){this._values[t]=new pt(this._values[t].property,r===null?void 0:Ho(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const r of Object.keys(this._values)){const i=this.getValue(r);i!==void 0&&(t[r]=i)}return t}possiblyEvaluate(t,r,i){const a=new zt(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(t,r,i);return a}}class Tt{constructor(t,r,i){this.property=t,this.value=r,this.parameters=i}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,i,a){return this.property.evaluate(this.value,this.parameters,t,r,i,a)}}class zt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class tt{constructor(t){this.specification=t}possiblyEvaluate(t,r){return t.expression.evaluate(r)}interpolate(t,r,i){const a=ic[this.specification.type];return a?a(t,r,i):t}}class yt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,i,a){return new Tt(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},i,a)}:t.expression,r)}interpolate(t,r,i){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Tt(this,{kind:"constant",value:void 0},t.parameters);const a=ic[this.specification.type];return a?new Tt(this,{kind:"constant",value:a(t.value.value,r.value.value,i)},t.parameters):t}evaluate(t,r,i,a,c,f){return t.kind==="constant"?t.value:t.evaluate(r,i,a,c,f)}}class Gt{constructor(t){this.specification=t}possiblyEvaluate(t,r,i,a){return!!t.expression.evaluate(r,null,{},i,a)}interpolate(){return!1}}class Ft{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new ut(0,{});for(const i in t){const a=t[i];a.specification.overridable&&this.overridableProperties.push(i);const c=this.defaultPropertyValues[i]=new pt(a,void 0),f=this.defaultTransitionablePropertyValues[i]=new Dt(a);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=c.possiblyEvaluate(r)}}}me(yt,"DataDrivenProperty"),me(tt,"DataConstantProperty"),me(Gt,"ColorRampProperty");const ge="";function ce(e,t){return t?`${e}${ge}${t}`:e}const Se="-transition";class fe extends xs{constructor(t,r,i,a){if(super(),this.id=t.id,this.fqid=ce(this.id,i),this.type=t.type,this.scope=i,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),r.layout&&(this._unevaluatedLayout=new Lt(r.layout,this.scope,a),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new wt(r.paint,this.scope,a);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new zt(r.paint)}}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,i={}){if(r!=null&&this._validate(H_,`layers.${this.id}.layout.${t}`,t,r,i))return;if(this.type==="custom"&&t==="visibility")return void(this.visibility=r);const a=this._unevaluatedLayout;a._properties.properties[t]&&(a.setValue(t,r),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return ru(t,Se)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,i={}){if(r!=null&&this._validate(W_,`layers.${this.id}.paint.${t}`,t,r,i))return!1;const a=this._transitionablePaint,c=a._properties.properties;if(ru(t,Se)){const M=t.slice(0,-11);return c[M]&&a.setTransition(M,r||void 0),!1}if(!c[t])return!1;const f=a._values[t],g=f.value.isDataDriven(),y=f.value;a.setValue(t,r),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const x=a._values[t].value,E=x.isDataDriven(),S=ru(t,"pattern")||t==="line-dasharray";return E||g||S||this._handleOverridablePaintPropertyUpdate(t,y,x)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,r){return null}_handleOverridablePaintPropertyUpdate(t,r,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){return ih({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,r)=>!(t===void 0||r==="layout"&&!Object.keys(t).length||r==="paint"&&!Object.keys(t).length))}_validate(t,r,i,a,c={}){return(!c||c.validate!==!1)&&zm(this,t.call(zf,{key:r,layerType:this.type,objectKey:i,value:a,styleSpec:bt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Tt&&Na(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Fh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}const Pe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Le{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class we{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ee(e,t=1){let r=0,i=0;return{members:e.map(a=>{const c=Pe[a.type].BYTES_PER_ELEMENT,f=r=dr(r,Math.max(t,c)),g=a.components||1;return i=Math.max(i,c),r+=c*g,{name:a.name,type:a.type,components:g,offset:f}}),size:dr(r,Math.max(i,t)),alignment:t}}function dr(e,t){return Math.ceil(e/t)*t}class Xe extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,r)}emplace(t,r,i){const a=2*t;return this.int16[a+0]=r,this.int16[a+1]=i,t}}Xe.prototype.bytesPerElement=4,me(Xe,"StructArrayLayout2i4");class Zr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,r,i)}emplace(t,r,i,a){const c=3*t;return this.int16[c+0]=r,this.int16[c+1]=i,this.int16[c+2]=a,t}}Zr.prototype.bytesPerElement=6,me(Zr,"StructArrayLayout3i6");class Dr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,i,a)}emplace(t,r,i,a,c){const f=4*t;return this.int16[f+0]=r,this.int16[f+1]=i,this.int16[f+2]=a,this.int16[f+3]=c,t}}Dr.prototype.bytesPerElement=8,me(Dr,"StructArrayLayout4i8");class Wi extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,i,a,c)}emplace(t,r,i,a,c,f){const g=5*t;return this.int16[g+0]=r,this.int16[g+1]=i,this.int16[g+2]=a,this.int16[g+3]=c,this.int16[g+4]=f,t}}Wi.prototype.bytesPerElement=10,me(Wi,"StructArrayLayout5i10");class Oo extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,i,a,c,f,g)}emplace(t,r,i,a,c,f,g,y){const x=6*t,E=12*t,S=3*t;return this.int16[x+0]=r,this.int16[x+1]=i,this.uint8[E+4]=a,this.uint8[E+5]=c,this.uint8[E+6]=f,this.uint8[E+7]=g,this.float32[S+2]=y,t}}Oo.prototype.bytesPerElement=12,me(Oo,"StructArrayLayout2i4ub1f12");class Mr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,i,a)}emplace(t,r,i,a,c){const f=4*t;return this.float32[f+0]=r,this.float32[f+1]=i,this.float32[f+2]=a,this.float32[f+3]=c,t}}Mr.prototype.bytesPerElement=16,me(Mr,"StructArrayLayout4f16");class gr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,i,a,c)}emplace(t,r,i,a,c,f){const g=6*t,y=3*t;return this.uint16[g+0]=r,this.uint16[g+1]=i,this.uint16[g+2]=a,this.uint16[g+3]=c,this.float32[y+2]=f,t}}gr.prototype.bytesPerElement=12,me(gr,"StructArrayLayout4ui1f12");class xr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,i,a)}emplace(t,r,i,a,c){const f=4*t;return this.uint16[f+0]=r,this.uint16[f+1]=i,this.uint16[f+2]=a,this.uint16[f+3]=c,t}}xr.prototype.bytesPerElement=8,me(xr,"StructArrayLayout4ui8");class nn extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,i,a,c,f)}emplace(t,r,i,a,c,f,g){const y=6*t;return this.int16[y+0]=r,this.int16[y+1]=i,this.int16[y+2]=a,this.int16[y+3]=c,this.int16[y+4]=f,this.int16[y+5]=g,t}}nn.prototype.bytesPerElement=12,me(nn,"StructArrayLayout6i12");class ri extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f,g,y,x,E,S,M){const A=this.length;return this.resize(A+1),this.emplace(A,t,r,i,a,c,f,g,y,x,E,S,M)}emplace(t,r,i,a,c,f,g,y,x,E,S,M,A){const L=12*t;return this.int16[L+0]=r,this.int16[L+1]=i,this.int16[L+2]=a,this.int16[L+3]=c,this.uint16[L+4]=f,this.uint16[L+5]=g,this.uint16[L+6]=y,this.uint16[L+7]=x,this.int16[L+8]=E,this.int16[L+9]=S,this.int16[L+10]=M,this.int16[L+11]=A,t}}ri.prototype.bytesPerElement=24,me(ri,"StructArrayLayout4i4ui4i24");class Hr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,i,a,c,f)}emplace(t,r,i,a,c,f,g){const y=10*t,x=5*t;return this.int16[y+0]=r,this.int16[y+1]=i,this.int16[y+2]=a,this.float32[x+2]=c,this.float32[x+3]=f,this.float32[x+4]=g,t}}Hr.prototype.bytesPerElement=20,me(Hr,"StructArrayLayout3i3f20");class Ei extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Ei.prototype.bytesPerElement=4,me(Ei,"StructArrayLayout1ul4");class Hi extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,r)}emplace(t,r,i){const a=2*t;return this.uint16[a+0]=r,this.uint16[a+1]=i,t}}Hi.prototype.bytesPerElement=4,me(Hi,"StructArrayLayout2ui4");class Ii extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f,g,y,x,E,S,M,A){const L=this.length;return this.resize(L+1),this.emplace(L,t,r,i,a,c,f,g,y,x,E,S,M,A)}emplace(t,r,i,a,c,f,g,y,x,E,S,M,A,L){const R=20*t,N=10*t;return this.int16[R+0]=r,this.int16[R+1]=i,this.int16[R+2]=a,this.int16[R+3]=c,this.int16[R+4]=f,this.float32[N+3]=g,this.float32[N+4]=y,this.float32[N+5]=x,this.float32[N+6]=E,this.int16[R+14]=S,this.uint32[N+8]=M,this.uint16[R+18]=A,this.uint16[R+19]=L,t}}Ii.prototype.bytesPerElement=40,me(Ii,"StructArrayLayout5i4f1i1ul2ui40");class zo extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,i,a,c,f,g)}emplace(t,r,i,a,c,f,g,y){const x=8*t;return this.int16[x+0]=r,this.int16[x+1]=i,this.int16[x+2]=a,this.int16[x+4]=c,this.int16[x+5]=f,this.int16[x+6]=g,this.int16[x+7]=y,t}}zo.prototype.bytesPerElement=16,me(zo,"StructArrayLayout3i2i2i16");class ra extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,i,a,c)}emplace(t,r,i,a,c,f){const g=4*t,y=8*t;return this.float32[g+0]=r,this.float32[g+1]=i,this.float32[g+2]=a,this.int16[y+6]=c,this.int16[y+7]=f,t}}ra.prototype.bytesPerElement=16,me(ra,"StructArrayLayout2f1f2i16");class rs extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,i,a)}emplace(t,r,i,a,c){const f=12*t,g=3*t;return this.uint8[f+0]=r,this.uint8[f+1]=i,this.float32[g+1]=a,this.float32[g+2]=c,t}}rs.prototype.bytesPerElement=12,me(rs,"StructArrayLayout2ub2f12");class Or extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,r,i)}emplace(t,r,i,a){const c=3*t;return this.uint16[c+0]=r,this.uint16[c+1]=i,this.uint16[c+2]=a,t}}Or.prototype.bytesPerElement=6,me(Or,"StructArrayLayout3ui6");class ns extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N,F,W,H,$,Q){const et=this.length;return this.resize(et+1),this.emplace(et,t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N,F,W,H,$,Q)}emplace(t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N,F,W,H,$,Q,et){const ct=30*t,ft=15*t,gt=60*t;return this.int16[ct+0]=r,this.int16[ct+1]=i,this.int16[ct+2]=a,this.float32[ft+2]=c,this.float32[ft+3]=f,this.uint16[ct+8]=g,this.uint16[ct+9]=y,this.uint32[ft+5]=x,this.uint32[ft+6]=E,this.uint32[ft+7]=S,this.uint16[ct+16]=M,this.uint16[ct+17]=A,this.uint16[ct+18]=L,this.float32[ft+10]=R,this.float32[ft+11]=N,this.uint8[gt+48]=F,this.uint8[gt+49]=W,this.uint8[gt+50]=H,this.uint32[ft+13]=$,this.int16[ct+28]=Q,this.uint8[gt+58]=et,t}}ns.prototype.bytesPerElement=60,me(ns,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ts extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N,F,W,H,$,Q,et,ct,ft,gt,Et,vt,Rt,Xt,Pt,Ut,Mt){const oe=this.length;return this.resize(oe+1),this.emplace(oe,t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N,F,W,H,$,Q,et,ct,ft,gt,Et,vt,Rt,Xt,Pt,Ut,Mt)}emplace(t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N,F,W,H,$,Q,et,ct,ft,gt,Et,vt,Rt,Xt,Pt,Ut,Mt,oe){const de=20*t,qt=40*t,De=80*t;return this.float32[de+0]=r,this.float32[de+1]=i,this.int16[qt+4]=a,this.int16[qt+5]=c,this.int16[qt+6]=f,this.int16[qt+7]=g,this.int16[qt+8]=y,this.int16[qt+9]=x,this.int16[qt+10]=E,this.int16[qt+11]=S,this.int16[qt+12]=M,this.uint16[qt+13]=A,this.uint16[qt+14]=L,this.uint16[qt+15]=R,this.uint16[qt+16]=N,this.uint16[qt+17]=F,this.uint16[qt+18]=W,this.uint16[qt+19]=H,this.uint16[qt+20]=$,this.uint16[qt+21]=Q,this.uint16[qt+22]=et,this.uint16[qt+23]=ct,this.uint16[qt+24]=ft,this.uint16[qt+25]=gt,this.uint16[qt+26]=Et,this.uint16[qt+27]=vt,this.uint32[de+14]=Rt,this.float32[de+15]=Xt,this.float32[de+16]=Pt,this.float32[de+17]=Ut,this.float32[de+18]=Mt,this.uint8[De+76]=oe,t}}Ts.prototype.bytesPerElement=80,me(Ts,"StructArrayLayout2f9i15ui1ul4f1ub80");class na extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}na.prototype.bytesPerElement=4,me(na,"StructArrayLayout1f4");class yc extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,i,a,c)}emplace(t,r,i,a,c,f){const g=5*t;return this.float32[g+0]=r,this.float32[g+1]=i,this.float32[g+2]=a,this.float32[g+3]=c,this.float32[g+4]=f,t}}yc.prototype.bytesPerElement=20,me(yc,"StructArrayLayout5f20");class $_ extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,i,a,c,f,g)}emplace(t,r,i,a,c,f,g,y){const x=7*t;return this.float32[x+0]=r,this.float32[x+1]=i,this.float32[x+2]=a,this.float32[x+3]=c,this.float32[x+4]=f,this.float32[x+5]=g,this.float32[x+6]=y,t}}$_.prototype.bytesPerElement=28,me($_,"StructArrayLayout7f28");class J_ extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,i,a)}emplace(t,r,i,a,c){const f=6*t;return this.uint32[3*t+0]=r,this.uint16[f+2]=i,this.uint16[f+3]=a,this.uint16[f+4]=c,t}}J_.prototype.bytesPerElement=12,me(J_,"StructArrayLayout1ul3ui12");class Nf extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Nf.prototype.bytesPerElement=2,me(Nf,"StructArrayLayout1ui2");class vc extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,r,i)}emplace(t,r,i,a){const c=3*t;return this.float32[c+0]=r,this.float32[c+1]=i,this.float32[c+2]=a,t}}vc.prototype.bytesPerElement=12,me(vc,"StructArrayLayout3f12");class kf extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,r)}emplace(t,r,i){const a=2*t;return this.float32[a+0]=r,this.float32[a+1]=i,t}}kf.prototype.bytesPerElement=8,me(kf,"StructArrayLayout2f8");class K_ extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N){const F=this.length;return this.resize(F+1),this.emplace(F,t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N)}emplace(t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N,F){const W=16*t;return this.float32[W+0]=r,this.float32[W+1]=i,this.float32[W+2]=a,this.float32[W+3]=c,this.float32[W+4]=f,this.float32[W+5]=g,this.float32[W+6]=y,this.float32[W+7]=x,this.float32[W+8]=E,this.float32[W+9]=S,this.float32[W+10]=M,this.float32[W+11]=A,this.float32[W+12]=L,this.float32[W+13]=R,this.float32[W+14]=N,this.float32[W+15]=F,t}}K_.prototype.bytesPerElement=64,me(K_,"StructArrayLayout16f64");class Nm extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,i,a,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,i,a,c,f,g)}emplace(t,r,i,a,c,f,g,y){const x=10*t,E=5*t;return this.uint16[x+0]=r,this.uint16[x+1]=i,this.uint16[x+2]=a,this.uint16[x+3]=c,this.float32[E+2]=f,this.float32[E+3]=g,this.float32[E+4]=y,t}}Nm.prototype.bytesPerElement=20,me(Nm,"StructArrayLayout4ui3f20");class Q_ extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint8[1*t+0]=r,t}}Q_.prototype.bytesPerElement=1,me(Q_,"StructArrayLayout1ub1");class v0 extends Le{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}v0.prototype.size=40;class ty extends Ii{get(t){return new v0(this,t)}}me(ty,"CollisionBoxArray");class x0 extends Le{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}x0.prototype.size=60;class b0 extends ns{get(t){return new x0(this,t)}}me(b0,"PlacedSymbolArray");class w0 extends Le{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}w0.prototype.size=80;class E0 extends Ts{get(t){return new w0(this,t)}}me(E0,"SymbolInstanceArray");class I0 extends na{getoffsetX(t){return this.float32[1*t+0]}}me(I0,"GlyphOffsetArray");class T0 extends Xe{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}me(T0,"SymbolLineVertexArray");class S0 extends Le{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}S0.prototype.size=12;class C0 extends J_{get(t){return new S0(this,t)}}me(C0,"FeatureIndexArray");class M0 extends Hi{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}me(M0,"FillExtrusionCentroidArray");const v2=Ee([{name:"a_pos",components:2,type:"Int16"}],4),x2=Ee([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class fn{constructor(t=[]){this.segments=t}_prepareSegment(t,r,i,a){let c=this.segments[this.segments.length-1];return t>fn.MAX_VERTEX_ARRAY_LENGTH&&pn(`Max vertices per segment is ${fn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!c||c.vertexLength+t>fn.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==a)&&(c={vertexOffset:r,primitiveOffset:i,vertexLength:0,primitiveLength:0},a!==void 0&&(c.sortKey=a),this.segments.push(c)),c}prepareSegment(t,r,i,a){return this._prepareSegment(t,r.length,i.length,a)}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,i,a){return new fn([{vertexOffset:t,primitiveOffset:r,vertexLength:i,primitiveLength:a,vaos:{},sortKey:0}])}}function A0(e,t){return 256*(e=ke(Math.floor(e),0,255))+ke(Math.floor(t),0,255)}fn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,me(fn,"SegmentVector");const b2=Ee([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),w2=Ee([{name:"a_dash",components:4,type:"Uint16"}]);var km={exports:{}},P0={exports:{}};(function(e){e.exports=function(t,r){var i,a,c,f,g,y,x,E;for(a=t.length-(i=3&t.length),c=r,g=3432918353,y=461845907,E=0;E<a;)x=255&t.charCodeAt(E)|(255&t.charCodeAt(++E))<<8|(255&t.charCodeAt(++E))<<16|(255&t.charCodeAt(++E))<<24,++E,c=27492+(65535&(f=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,i){case 3:x^=(255&t.charCodeAt(E+2))<<16;case 2:x^=(255&t.charCodeAt(E+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&t.charCodeAt(E)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return c^=t.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}})(P0);var E2=P0.exports,L0={exports:{}};(function(e){e.exports=function(t,r){for(var i,a=t.length,c=r^a,f=0;a>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++f;switch(a){case 3:c^=(255&t.charCodeAt(f+2))<<16;case 2:c^=(255&t.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&t.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}})(L0);var D0=E2,I2=L0.exports;km.exports=D0,km.exports.murmur3=D0,km.exports.murmur2=I2;var ey=ue(km.exports);class Ff{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,r,i,a){this.ids.push(R0(t)),this.positions.push(r,i,a)}eachPosition(t,r){const i=R0(t);let a=0,c=this.ids.length-1;for(;a<c;){const f=a+c>>1;this.ids[f]>=i?c=f:a=f+1}for(;this.ids[a]===i;)r(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(t,r){const i=new Float64Array(t.ids),a=new Uint32Array(t.positions);return ry(i,a,0,i.length-1),r&&(r.add(i.buffer),r.add(a.buffer)),{ids:i,positions:a}}static deserialize(t){const r=new Ff;let i;r.ids=t.ids,r.positions=t.positions;for(const a of r.ids)a!==i&&r.uniqueIds.push(a),i=a;return r.indexed=!0,r}}function R0(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:ey(String(e))}function ry(e,t,r,i){for(;r<i;){const a=e[r+i>>1];let c=r-1,f=i+1;for(;;){do c++;while(e[c]<a);do f--;while(e[f]>a);if(c>=f)break;Fm(e,c,f),Fm(t,3*c,3*f),Fm(t,3*c+1,3*f+1),Fm(t,3*c+2,3*f+2)}f-r<i-f?(ry(e,t,r,f),r=f+1):(ry(e,t,f+1,i),i=f)}}function Fm(e,t,r){const i=e[t];e[t]=e[r],e[r]=i}me(Ff,"FeaturePositionMap");class Al{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,r),this.initialized=!0),!!this.location}}class Bm extends Al{constructor(t){super(t),this.current=0}set(t,r,i){this.fetchUniformLocation(t,r)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class oo extends Al{constructor(t){super(t),this.current=0}set(t,r,i){this.fetchUniformLocation(t,r)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class xc extends Al{constructor(t){super(t),this.current=[0,0]}set(t,r,i){this.fetchUniformLocation(t,r)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class ny extends Al{constructor(t){super(t),this.current=[0,0,0]}set(t,r,i){this.fetchUniformLocation(t,r)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class O0 extends Al{constructor(t){super(t),this.current=[0,0,0,0]}set(t,r,i){this.fetchUniformLocation(t,r)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class z0 extends Al{constructor(t){super(t),this.current=rn.transparent}set(t,r,i){this.fetchUniformLocation(t,r)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const T2=new Float32Array(16);class Bf extends Al{constructor(t){super(t),this.current=T2}set(t,r,i){if(this.fetchUniformLocation(t,r)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let a=1;a<16;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const S2=new Float32Array(9),C2=new Float32Array(4);class iy extends Al{constructor(t){super(t),this.current=C2}set(t,r,i){if(this.fetchUniformLocation(t,r)){for(let a=0;a<4;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}}function oy(e){return[A0(255*e.r,255*e.g),A0(255*e.b,255*e.a)]}class Vf{constructor(t,r,i){this.value=t,this.uniformNames=r.map(a=>`u_${a}`),this.type=i}setUniform(t,r,i,a,c){r.set(t,c,a.constantOr(this.value))}getBinding(t,r){return this.type==="color"?new z0(t):new oo(t)}}class qh{constructor(t,r){this.uniformNames=r.map(i=>`u_${i}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,r,i,a,c){const f=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;f&&r.set(t,c,f)}getBinding(t,r){return r==="u_pattern"||r==="u_dash"?new O0(t):new oo(t)}}class Pl{constructor(t,r,i,a){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=r.map(c=>({name:`a_${c}`,type:"Float32",components:i==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(t,r,i,a,c,f,g){const y=this.paintVertexArray.length,x=this.expression.evaluate(new ut(0,{brightness:f}),r,{},c,a,g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,x)}updatePaintArray(t,r,i,a,c,f,g){const y=this.expression.evaluate({zoom:0,brightness:g},i,a,void 0,c);this._setPaintValue(t,r,y)}_setPaintValue(t,r,i){if(this.type==="color"){const a=oy(i);for(let c=t;c<r;c++)this.paintVertexArray.emplace(c,a[0],a[1])}else{for(let a=t;a<r;a++)this.paintVertexArray.emplace(a,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ia{constructor(t,r,i,a,c,f){this.expression=t,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=i,this.useIntegerZoom=a,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:i==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,r,i,a,c,f,g){const y=this.expression.evaluate(new ut(this.zoom,{brightness:f}),r,{},c,a,g),x=this.expression.evaluate(new ut(this.zoom+1,{brightness:f}),r,{},c,a,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,y,x)}updatePaintArray(t,r,i,a,c,f,g){const y=this.expression.evaluate({zoom:this.zoom,brightness:g},i,a,void 0,c),x=this.expression.evaluate({zoom:this.zoom+1,brightness:g},i,a,void 0,c);this._setPaintValue(t,r,y,x)}_setPaintValue(t,r,i,a){if(this.type==="color"){const c=oy(i),f=oy(a);for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,c[0],c[1],f[0],f[1])}else{for(let c=t;c<r;c++)this.paintVertexArray.emplace(c,i,a);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r,i,a,c){const f=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,g=ke(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);r.set(t,c,g)}getBinding(t,r){return new oo(t)}}class gu{constructor(t,r,i,a,c){this.expression=t,this.layerId=c,this.paintVertexAttributes=(i==="array"?w2:b2).members;for(let f=0;f<r.length;++f);this.paintVertexArray=new a}populatePaintArray(t,r,i){const a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(a,t,r.patterns&&r.patterns[this.layerId],i)}updatePaintArray(t,r,i,a,c,f,g){this._setPaintValues(t,r,i.patterns&&i.patterns[this.layerId],f)}_setPaintValues(t,r,i,a){if(!a||!i)return;const c=a[i];if(!c)return;const{tl:f,br:g,pixelRatio:y}=c;for(let x=t;x<r;x++)this.paintVertexArray.emplace(x,f[0],f[1],g[0],g[1],y)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bc{constructor(t,r,i=()=>!0){this.binders={},this._buffers=[];const a=[];for(const c in t.paint._values){const f=t.paint.get(c);if(!i(c)||!(f instanceof Tt&&Na(f.property.specification)))continue;const g=A2(c,t.type),y=f.value,x=f.property.specification.type,E=!!f.property.useIntegerZoom,S=c==="line-dasharray"||c.endsWith("pattern"),M=c==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||M)if(y.kind==="source"||M||S){const A=N0(c,x,"source");this.binders[c]=S?new gu(y,g,x,A,t.id):new Pl(y,g,x,A),a.push(`/a_${c}`)}else{const A=N0(c,x,"composite");this.binders[c]=new ia(y,g,x,E,r,A),a.push(`/z_${c}`)}else this.binders[c]=S?new qh(y.value,g):new Vf(y.value,g,x),a.push(`/u_${c}`)}this.cacheKey=a.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Pl||r instanceof ia?r.maxValue:0}populatePaintArrays(t,r,i,a,c,f,g){for(const y in this.binders){const x=this.binders[y];(x instanceof Pl||x instanceof ia||x instanceof gu)&&x.populatePaintArray(t,r,i,a,c,f,g)}}setConstantPatternPositions(t){for(const r in this.binders){const i=this.binders[r];i instanceof qh&&i.setConstantPatternPositions(t)}}updatePaintArrays(t,r,i,a,c,f,g,y){let x=!1;const E=Object.keys(t),S=E.length!==0,M=S?E:r.uniqueIds;for(const A in this.binders){const L=this.binders[A];if((L instanceof Pl||L instanceof ia||L instanceof gu)&&(L.expression.isStateDependent===!0||L.expression.isLightConstant===!1)){const R=c.paint.get(A);L.expression=R.value;for(const N of M){const F=t[N.toString()];r.eachPosition(N,(W,H,$)=>{const Q=a.feature(W);L.updatePaintArray(H,$,Q,F,f,g,y)})}if(!S)for(const N of i.uniqueIds){const F=t[N.toString()];i.eachPosition(N,(W,H,$)=>{const Q=a.feature(W);L.updatePaintArray(H,$,Q,F,f,g,y)})}x=!0}}return x}defines(){const t=[];for(const r in this.binders){const i=this.binders[r];(i instanceof Vf||i instanceof qh)&&t.push(...i.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof Pl||i instanceof ia||i instanceof gu)for(let a=0;a<i.paintVertexAttributes.length;a++)t.push(i.paintVertexAttributes[a].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof Vf||i instanceof qh||i instanceof ia)for(const a of i.uniformNames)t.push(a)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const r=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Vf||a instanceof qh||a instanceof ia)for(const c of a.uniformNames)r.push({name:c,property:i,binding:a.getBinding(t,c)})}return r}setUniforms(t,r,i,a,c){for(const{name:f,property:g,binding:y}of i)this.binders[g].setUniform(t,y,c,a.get(g),f)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Pl||r instanceof ia||r instanceof gu)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(t){for(const r in this.binders){const i=this.binders[r];(i instanceof Pl||i instanceof ia||i instanceof gu)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Pl||r instanceof ia||r instanceof gu)&&r.destroy()}}}class _u{constructor(t,r,i=()=>!0){this.programConfigurations={};for(const a of t)this.programConfigurations[a.id]=new bc(a,r,i);this.needsUpload=!1,this._featureMap=new Ff,this._featureMapWithoutIds=new Ff,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,r,i,a,c,f,g,y){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,r,a,c,f,g,y);r.id!==void 0?this._featureMap.add(r.id,i,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,i,a,c,f){for(const g of i)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,r,g,a,c,f||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const M2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function A2(e,t){return M2[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const P2={"line-pattern":{source:gr,composite:gr},"fill-pattern":{source:gr,composite:gr},"fill-extrusion-pattern":{source:gr,composite:gr},"line-dasharray":{source:xr,composite:xr}},L2={color:{source:kf,composite:Mr},number:{source:na,composite:kf}};function N0(e,t,r){const i=P2[e];return i&&i[r]||L2[t][r]}me(Vf,"ConstantBinder"),me(qh,"PatternConstantBinder"),me(Pl,"SourceExpressionBinder"),me(gu,"PatternCompositeBinder"),me(ia,"CompositeExpressionBinder"),me(bc,"ProgramConfiguration",{omit:["_buffers"]}),me(_u,"ProgramConfigurationSet");class yu{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Ar?new Ar(t.lng,t.lat):Ar.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ar?new Ar(t.lng,t.lat):Ar.convert(t),this}extend(t){const r=this._sw,i=this._ne;let a,c;if(t instanceof Ar)a=t,c=t;else{if(!(t instanceof yu))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(yu.convert(t)):this.extend(Ar.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Ar.convert(t)):this;if(a=t._sw,c=t._ne,!a||!c)return this}return r||i?(r.lng=Math.min(a.lng,r.lng),r.lat=Math.min(a.lat,r.lat),i.lng=Math.max(c.lng,i.lng),i.lat=Math.max(c.lat,i.lat)):(this._sw=new Ar(a.lng,a.lat),this._ne=new Ar(c.lng,c.lat)),this}getCenter(){return new Ar((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ar(this.getWest(),this.getNorth())}getSouthEast(){return new Ar(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:i}=Ar.convert(t);let a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&a}static convert(t){return!t||t instanceof yu?t:new yu(t)}}var ni={},ii={};Object.defineProperty(ii,"__esModule",{value:!0}),ii.setMatrixArrayType=function(e){ii.ARRAY_TYPE=F0=e},ii.toRadian=function(e){return e*R2},ii.equals=function(e,t){return Math.abs(e-t)<=k0*Math.max(1,Math.abs(e),Math.abs(t))},ii.RANDOM=ii.ARRAY_TYPE=ii.EPSILON=void 0;var k0=1e-6;ii.EPSILON=k0;var F0=typeof Float32Array<"u"?Float32Array:Array;ii.ARRAY_TYPE=F0;var D2=Math.random;ii.RANDOM=D2;var R2=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var dn={};function sy(e){return sy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sy(e)}Object.defineProperty(dn,"__esModule",{value:!0}),dn.create=function(){var e=new vu.ARRAY_TYPE(4);return vu.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},dn.clone=function(e){var t=new vu.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},dn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},dn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},dn.fromValues=function(e,t,r,i){var a=new vu.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a},dn.set=function(e,t,r,i,a){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e},dn.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},dn.invert=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=r*c-a*i;return f?(e[0]=c*(f=1/f),e[1]=-i*f,e[2]=-a*f,e[3]=r*f,e):null},dn.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},dn.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},dn.multiply=V0,dn.rotate=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=Math.sin(r),y=Math.cos(r);return e[0]=i*y+c*g,e[1]=a*y+f*g,e[2]=i*-g+c*y,e[3]=a*-g+f*y,e},dn.scale=function(e,t,r){var i=t[1],a=t[2],c=t[3],f=r[0],g=r[1];return e[0]=t[0]*f,e[1]=i*f,e[2]=a*g,e[3]=c*g,e},dn.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},dn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},dn.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},dn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},dn.LDU=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},dn.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},dn.subtract=U0,dn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},dn.equals=function(e,t){var r=e[0],i=e[1],a=e[2],c=e[3],f=t[0],g=t[1],y=t[2],x=t[3];return Math.abs(r-f)<=vu.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-g)<=vu.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(a-y)<=vu.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(c-x)<=vu.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))},dn.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},dn.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},dn.sub=dn.mul=void 0;var vu=function(e,t){if(e&&e.__esModule)return e;if(e===null||sy(e)!=="object"&&typeof e!="function")return{default:e};var r=B0(void 0);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}(ii);function B0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(B0=function(i){return i?r:t})(e)}function V0(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=r[0],y=r[1],x=r[2],E=r[3];return e[0]=i*g+c*y,e[1]=a*g+f*y,e[2]=i*x+c*E,e[3]=a*x+f*E,e}function U0(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}dn.mul=V0,dn.sub=U0;var mn={};function ay(e){return ay=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ay(e)}Object.defineProperty(mn,"__esModule",{value:!0}),mn.create=function(){var e=new Va.ARRAY_TYPE(6);return Va.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},mn.clone=function(e){var t=new Va.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},mn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},mn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},mn.fromValues=function(e,t,r,i,a,c){var f=new Va.ARRAY_TYPE(6);return f[0]=e,f[1]=t,f[2]=r,f[3]=i,f[4]=a,f[5]=c,f},mn.set=function(e,t,r,i,a,c,f){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e[4]=c,e[5]=f,e},mn.invert=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=t[4],g=t[5],y=r*c-i*a;return y?(e[0]=c*(y=1/y),e[1]=-i*y,e[2]=-a*y,e[3]=r*y,e[4]=(a*g-c*f)*y,e[5]=(i*f-r*g)*y,e):null},mn.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},mn.multiply=j0,mn.rotate=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=t[4],y=t[5],x=Math.sin(r),E=Math.cos(r);return e[0]=i*E+c*x,e[1]=a*E+f*x,e[2]=i*-x+c*E,e[3]=a*-x+f*E,e[4]=g,e[5]=y,e},mn.scale=function(e,t,r){var i=t[1],a=t[2],c=t[3],f=t[4],g=t[5],y=r[0],x=r[1];return e[0]=t[0]*y,e[1]=i*y,e[2]=a*x,e[3]=c*x,e[4]=f,e[5]=g,e},mn.translate=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=t[4],y=t[5],x=r[0],E=r[1];return e[0]=i,e[1]=a,e[2]=c,e[3]=f,e[4]=i*x+c*E+g,e[5]=a*x+f*E+y,e},mn.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e},mn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},mn.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},mn.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},mn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},mn.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},mn.subtract=q0,mn.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},mn.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},mn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},mn.equals=function(e,t){var r=e[0],i=e[1],a=e[2],c=e[3],f=e[4],g=e[5],y=t[0],x=t[1],E=t[2],S=t[3],M=t[4],A=t[5];return Math.abs(r-y)<=Va.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-x)<=Va.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(a-E)<=Va.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(c-S)<=Va.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(f-M)<=Va.EPSILON*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(g-A)<=Va.EPSILON*Math.max(1,Math.abs(g),Math.abs(A))},mn.sub=mn.mul=void 0;var Va=function(e,t){if(e&&e.__esModule)return e;if(e===null||ay(e)!=="object"&&typeof e!="function")return{default:e};var r=G0(void 0);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}(ii);function G0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(G0=function(i){return i?r:t})(e)}function j0(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=t[4],y=t[5],x=r[0],E=r[1],S=r[2],M=r[3],A=r[4],L=r[5];return e[0]=i*x+c*E,e[1]=a*x+f*E,e[2]=i*S+c*M,e[3]=a*S+f*M,e[4]=i*A+c*L+g,e[5]=a*A+f*L+y,e}function q0(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}mn.mul=j0,mn.sub=q0;var zr={};function ly(e){return ly=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ly(e)}Object.defineProperty(zr,"__esModule",{value:!0}),zr.create=function(){var e=new is.ARRAY_TYPE(9);return is.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},zr.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},zr.clone=function(e){var t=new is.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},zr.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},zr.fromValues=function(e,t,r,i,a,c,f,g,y){var x=new is.ARRAY_TYPE(9);return x[0]=e,x[1]=t,x[2]=r,x[3]=i,x[4]=a,x[5]=c,x[6]=f,x[7]=g,x[8]=y,x},zr.set=function(e,t,r,i,a,c,f,g,y,x){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e[4]=c,e[5]=f,e[6]=g,e[7]=y,e[8]=x,e},zr.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},zr.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},zr.invert=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=t[4],g=t[5],y=t[6],x=t[7],E=t[8],S=E*f-g*x,M=-E*c+g*y,A=x*c-f*y,L=r*S+i*M+a*A;return L?(e[0]=S*(L=1/L),e[1]=(-E*i+a*x)*L,e[2]=(g*i-a*f)*L,e[3]=M*L,e[4]=(E*r-a*y)*L,e[5]=(-g*r+a*c)*L,e[6]=A*L,e[7]=(-x*r+i*y)*L,e[8]=(f*r-i*c)*L,e):null},zr.adjoint=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=t[4],g=t[5],y=t[6],x=t[7],E=t[8];return e[0]=f*E-g*x,e[1]=a*x-i*E,e[2]=i*g-a*f,e[3]=g*y-c*E,e[4]=r*E-a*y,e[5]=a*c-r*g,e[6]=c*x-f*y,e[7]=i*y-r*x,e[8]=r*f-i*c,e},zr.determinant=function(e){var t=e[3],r=e[4],i=e[5],a=e[6],c=e[7],f=e[8];return e[0]*(f*r-i*c)+e[1]*(-f*t+i*a)+e[2]*(c*t-r*a)},zr.multiply=X0,zr.translate=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=t[4],y=t[5],x=t[6],E=t[7],S=t[8],M=r[0],A=r[1];return e[0]=i,e[1]=a,e[2]=c,e[3]=f,e[4]=g,e[5]=y,e[6]=M*i+A*f+x,e[7]=M*a+A*g+E,e[8]=M*c+A*y+S,e},zr.rotate=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=t[4],y=t[5],x=t[6],E=t[7],S=t[8],M=Math.sin(r),A=Math.cos(r);return e[0]=A*i+M*f,e[1]=A*a+M*g,e[2]=A*c+M*y,e[3]=A*f-M*i,e[4]=A*g-M*a,e[5]=A*y-M*c,e[6]=x,e[7]=E,e[8]=S,e},zr.scale=function(e,t,r){var i=r[0],a=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},zr.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},zr.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},zr.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},zr.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},zr.fromQuat=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=r+r,g=i+i,y=a+a,x=r*f,E=i*f,S=i*g,M=a*f,A=a*g,L=a*y,R=c*f,N=c*g,F=c*y;return e[0]=1-S-L,e[3]=E-F,e[6]=M+N,e[1]=E+F,e[4]=1-x-L,e[7]=A-R,e[2]=M-N,e[5]=A+R,e[8]=1-x-S,e},zr.normalFromMat4=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=t[4],g=t[5],y=t[6],x=t[7],E=t[8],S=t[9],M=t[10],A=t[11],L=t[12],R=t[13],N=t[14],F=t[15],W=r*g-i*f,H=r*y-a*f,$=r*x-c*f,Q=i*y-a*g,et=i*x-c*g,ct=a*x-c*y,ft=E*R-S*L,gt=E*N-M*L,Et=E*F-A*L,vt=S*N-M*R,Rt=S*F-A*R,Xt=M*F-A*N,Pt=W*Xt-H*Rt+$*vt+Q*Et-et*gt+ct*ft;return Pt?(e[0]=(g*Xt-y*Rt+x*vt)*(Pt=1/Pt),e[1]=(y*Et-f*Xt-x*gt)*Pt,e[2]=(f*Rt-g*Et+x*ft)*Pt,e[3]=(a*Rt-i*Xt-c*vt)*Pt,e[4]=(r*Xt-a*Et+c*gt)*Pt,e[5]=(i*Et-r*Rt-c*ft)*Pt,e[6]=(R*ct-N*et+F*Q)*Pt,e[7]=(N*$-L*ct-F*H)*Pt,e[8]=(L*et-R*$+F*W)*Pt,e):null},zr.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},zr.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},zr.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},zr.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},zr.subtract=W0,zr.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},zr.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},zr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},zr.equals=function(e,t){var r=e[0],i=e[1],a=e[2],c=e[3],f=e[4],g=e[5],y=e[6],x=e[7],E=e[8],S=t[0],M=t[1],A=t[2],L=t[3],R=t[4],N=t[5],F=t[6],W=t[7],H=t[8];return Math.abs(r-S)<=is.EPSILON*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(i-M)<=is.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(a-A)<=is.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(c-L)<=is.EPSILON*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(f-R)<=is.EPSILON*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(g-N)<=is.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(y-F)<=is.EPSILON*Math.max(1,Math.abs(y),Math.abs(F))&&Math.abs(x-W)<=is.EPSILON*Math.max(1,Math.abs(x),Math.abs(W))&&Math.abs(E-H)<=is.EPSILON*Math.max(1,Math.abs(E),Math.abs(H))},zr.sub=zr.mul=void 0;var is=function(e,t){if(e&&e.__esModule)return e;if(e===null||ly(e)!=="object"&&typeof e!="function")return{default:e};var r=Z0(void 0);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}(ii);function Z0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Z0=function(i){return i?r:t})(e)}function X0(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=t[4],y=t[5],x=t[6],E=t[7],S=t[8],M=r[0],A=r[1],L=r[2],R=r[3],N=r[4],F=r[5],W=r[6],H=r[7],$=r[8];return e[0]=M*i+A*f+L*x,e[1]=M*a+A*g+L*E,e[2]=M*c+A*y+L*S,e[3]=R*i+N*f+F*x,e[4]=R*a+N*g+F*E,e[5]=R*c+N*y+F*S,e[6]=W*i+H*f+$*x,e[7]=W*a+H*g+$*E,e[8]=W*c+H*y+$*S,e}function W0(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}zr.mul=X0,zr.sub=W0;var $e={};function uy(e){return uy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uy(e)}Object.defineProperty($e,"__esModule",{value:!0}),$e.create=function(){var e=new bn.ARRAY_TYPE(16);return bn.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},$e.clone=function(e){var t=new bn.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},$e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},$e.fromValues=function(e,t,r,i,a,c,f,g,y,x,E,S,M,A,L,R){var N=new bn.ARRAY_TYPE(16);return N[0]=e,N[1]=t,N[2]=r,N[3]=i,N[4]=a,N[5]=c,N[6]=f,N[7]=g,N[8]=y,N[9]=x,N[10]=E,N[11]=S,N[12]=M,N[13]=A,N[14]=L,N[15]=R,N},$e.set=function(e,t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e[4]=c,e[5]=f,e[6]=g,e[7]=y,e[8]=x,e[9]=E,e[10]=S,e[11]=M,e[12]=A,e[13]=L,e[14]=R,e[15]=N,e},$e.identity=Y0,$e.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],a=t[3],c=t[6],f=t[7],g=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=c,e[11]=t[14],e[12]=a,e[13]=f,e[14]=g}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},$e.invert=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=t[4],g=t[5],y=t[6],x=t[7],E=t[8],S=t[9],M=t[10],A=t[11],L=t[12],R=t[13],N=t[14],F=t[15],W=r*g-i*f,H=r*y-a*f,$=r*x-c*f,Q=i*y-a*g,et=i*x-c*g,ct=a*x-c*y,ft=E*R-S*L,gt=E*N-M*L,Et=E*F-A*L,vt=S*N-M*R,Rt=S*F-A*R,Xt=M*F-A*N,Pt=W*Xt-H*Rt+$*vt+Q*Et-et*gt+ct*ft;return Pt?(e[0]=(g*Xt-y*Rt+x*vt)*(Pt=1/Pt),e[1]=(a*Rt-i*Xt-c*vt)*Pt,e[2]=(R*ct-N*et+F*Q)*Pt,e[3]=(M*et-S*ct-A*Q)*Pt,e[4]=(y*Et-f*Xt-x*gt)*Pt,e[5]=(r*Xt-a*Et+c*gt)*Pt,e[6]=(N*$-L*ct-F*H)*Pt,e[7]=(E*ct-M*$+A*H)*Pt,e[8]=(f*Rt-g*Et+x*ft)*Pt,e[9]=(i*Et-r*Rt-c*ft)*Pt,e[10]=(L*et-R*$+F*W)*Pt,e[11]=(S*$-E*et-A*W)*Pt,e[12]=(g*gt-f*vt-y*ft)*Pt,e[13]=(r*vt-i*gt+a*ft)*Pt,e[14]=(R*H-L*Q-N*W)*Pt,e[15]=(E*Q-S*H+M*W)*Pt,e):null},$e.adjoint=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=t[4],g=t[5],y=t[6],x=t[7],E=t[8],S=t[9],M=t[10],A=t[11],L=t[12],R=t[13],N=t[14],F=t[15];return e[0]=g*(M*F-A*N)-S*(y*F-x*N)+R*(y*A-x*M),e[1]=-(i*(M*F-A*N)-S*(a*F-c*N)+R*(a*A-c*M)),e[2]=i*(y*F-x*N)-g*(a*F-c*N)+R*(a*x-c*y),e[3]=-(i*(y*A-x*M)-g*(a*A-c*M)+S*(a*x-c*y)),e[4]=-(f*(M*F-A*N)-E*(y*F-x*N)+L*(y*A-x*M)),e[5]=r*(M*F-A*N)-E*(a*F-c*N)+L*(a*A-c*M),e[6]=-(r*(y*F-x*N)-f*(a*F-c*N)+L*(a*x-c*y)),e[7]=r*(y*A-x*M)-f*(a*A-c*M)+E*(a*x-c*y),e[8]=f*(S*F-A*R)-E*(g*F-x*R)+L*(g*A-x*S),e[9]=-(r*(S*F-A*R)-E*(i*F-c*R)+L*(i*A-c*S)),e[10]=r*(g*F-x*R)-f*(i*F-c*R)+L*(i*x-c*g),e[11]=-(r*(g*A-x*S)-f*(i*A-c*S)+E*(i*x-c*g)),e[12]=-(f*(S*N-M*R)-E*(g*N-y*R)+L*(g*M-y*S)),e[13]=r*(S*N-M*R)-E*(i*N-a*R)+L*(i*M-a*S),e[14]=-(r*(g*N-y*R)-f*(i*N-a*R)+L*(i*y-a*g)),e[15]=r*(g*M-y*S)-f*(i*M-a*S)+E*(i*y-a*g),e},$e.determinant=function(e){var t=e[0],r=e[1],i=e[2],a=e[3],c=e[4],f=e[5],g=e[6],y=e[7],x=e[8],E=e[9],S=e[10],M=e[11],A=e[12],L=e[13],R=e[14],N=e[15];return(t*f-r*c)*(S*N-M*R)-(t*g-i*c)*(E*N-M*L)+(t*y-a*c)*(E*R-S*L)+(r*g-i*f)*(x*N-M*A)-(r*y-a*f)*(x*R-S*A)+(i*y-a*g)*(x*L-E*A)},$e.multiply=$0,$e.translate=function(e,t,r){var i,a,c,f,g,y,x,E,S,M,A,L,R=r[0],N=r[1],F=r[2];return t===e?(e[12]=t[0]*R+t[4]*N+t[8]*F+t[12],e[13]=t[1]*R+t[5]*N+t[9]*F+t[13],e[14]=t[2]*R+t[6]*N+t[10]*F+t[14],e[15]=t[3]*R+t[7]*N+t[11]*F+t[15]):(a=t[1],c=t[2],f=t[3],g=t[4],y=t[5],x=t[6],E=t[7],S=t[8],M=t[9],A=t[10],L=t[11],e[0]=i=t[0],e[1]=a,e[2]=c,e[3]=f,e[4]=g,e[5]=y,e[6]=x,e[7]=E,e[8]=S,e[9]=M,e[10]=A,e[11]=L,e[12]=i*R+g*N+S*F+t[12],e[13]=a*R+y*N+M*F+t[13],e[14]=c*R+x*N+A*F+t[14],e[15]=f*R+E*N+L*F+t[15]),e},$e.scale=function(e,t,r){var i=r[0],a=r[1],c=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*c,e[9]=t[9]*c,e[10]=t[10]*c,e[11]=t[11]*c,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},$e.rotate=function(e,t,r,i){var a,c,f,g,y,x,E,S,M,A,L,R,N,F,W,H,$,Q,et,ct,ft,gt,Et,vt,Rt=i[0],Xt=i[1],Pt=i[2],Ut=Math.hypot(Rt,Xt,Pt);return Ut<bn.EPSILON?null:(Rt*=Ut=1/Ut,Xt*=Ut,Pt*=Ut,a=Math.sin(r),c=Math.cos(r),y=t[1],x=t[2],E=t[3],M=t[5],A=t[6],L=t[7],N=t[9],F=t[10],W=t[11],et=Rt*Xt*(f=1-c)-Pt*a,ct=Xt*Xt*f+c,ft=Pt*Xt*f+Rt*a,gt=Rt*Pt*f+Xt*a,Et=Xt*Pt*f-Rt*a,vt=Pt*Pt*f+c,e[0]=(g=t[0])*(H=Rt*Rt*f+c)+(S=t[4])*($=Xt*Rt*f+Pt*a)+(R=t[8])*(Q=Pt*Rt*f-Xt*a),e[1]=y*H+M*$+N*Q,e[2]=x*H+A*$+F*Q,e[3]=E*H+L*$+W*Q,e[4]=g*et+S*ct+R*ft,e[5]=y*et+M*ct+N*ft,e[6]=x*et+A*ct+F*ft,e[7]=E*et+L*ct+W*ft,e[8]=g*gt+S*Et+R*vt,e[9]=y*gt+M*Et+N*vt,e[10]=x*gt+A*Et+F*vt,e[11]=E*gt+L*Et+W*vt,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},$e.rotateX=function(e,t,r){var i=Math.sin(r),a=Math.cos(r),c=t[4],f=t[5],g=t[6],y=t[7],x=t[8],E=t[9],S=t[10],M=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=c*a+x*i,e[5]=f*a+E*i,e[6]=g*a+S*i,e[7]=y*a+M*i,e[8]=x*a-c*i,e[9]=E*a-f*i,e[10]=S*a-g*i,e[11]=M*a-y*i,e},$e.rotateY=function(e,t,r){var i=Math.sin(r),a=Math.cos(r),c=t[0],f=t[1],g=t[2],y=t[3],x=t[8],E=t[9],S=t[10],M=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=c*a-x*i,e[1]=f*a-E*i,e[2]=g*a-S*i,e[3]=y*a-M*i,e[8]=c*i+x*a,e[9]=f*i+E*a,e[10]=g*i+S*a,e[11]=y*i+M*a,e},$e.rotateZ=function(e,t,r){var i=Math.sin(r),a=Math.cos(r),c=t[0],f=t[1],g=t[2],y=t[3],x=t[4],E=t[5],S=t[6],M=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=c*a+x*i,e[1]=f*a+E*i,e[2]=g*a+S*i,e[3]=y*a+M*i,e[4]=x*a-c*i,e[5]=E*a-f*i,e[6]=S*a-g*i,e[7]=M*a-y*i,e},$e.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},$e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},$e.fromRotation=function(e,t,r){var i,a,c,f=r[0],g=r[1],y=r[2],x=Math.hypot(f,g,y);return x<bn.EPSILON?null:(f*=x=1/x,g*=x,y*=x,i=Math.sin(t),a=Math.cos(t),e[0]=f*f*(c=1-a)+a,e[1]=g*f*c+y*i,e[2]=y*f*c-g*i,e[3]=0,e[4]=f*g*c-y*i,e[5]=g*g*c+a,e[6]=y*g*c+f*i,e[7]=0,e[8]=f*y*c+g*i,e[9]=g*y*c-f*i,e[10]=y*y*c+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},$e.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},$e.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},$e.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},$e.fromRotationTranslation=J0,$e.fromQuat2=function(e,t){var r=new bn.ARRAY_TYPE(3),i=-t[0],a=-t[1],c=-t[2],f=t[3],g=t[4],y=t[5],x=t[6],E=t[7],S=i*i+a*a+c*c+f*f;return S>0?(r[0]=2*(g*f+E*i+y*c-x*a)/S,r[1]=2*(y*f+E*a+x*i-g*c)/S,r[2]=2*(x*f+E*c+g*a-y*i)/S):(r[0]=2*(g*f+E*i+y*c-x*a),r[1]=2*(y*f+E*a+x*i-g*c),r[2]=2*(x*f+E*c+g*a-y*i)),J0(e,t,r),e},$e.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},$e.getScaling=K0,$e.getRotation=function(e,t){var r=new bn.ARRAY_TYPE(3);K0(r,t);var i=1/r[0],a=1/r[1],c=1/r[2],f=t[0]*i,g=t[1]*a,y=t[2]*c,x=t[4]*i,E=t[5]*a,S=t[6]*c,M=t[8]*i,A=t[9]*a,L=t[10]*c,R=f+E+L,N=0;return R>0?(N=2*Math.sqrt(R+1),e[3]=.25*N,e[0]=(S-A)/N,e[1]=(M-y)/N,e[2]=(g-x)/N):f>E&&f>L?(N=2*Math.sqrt(1+f-E-L),e[3]=(S-A)/N,e[0]=.25*N,e[1]=(g+x)/N,e[2]=(M+y)/N):E>L?(N=2*Math.sqrt(1+E-f-L),e[3]=(M-y)/N,e[0]=(g+x)/N,e[1]=.25*N,e[2]=(S+A)/N):(N=2*Math.sqrt(1+L-f-E),e[3]=(g-x)/N,e[0]=(M+y)/N,e[1]=(S+A)/N,e[2]=.25*N),e},$e.fromRotationTranslationScale=function(e,t,r,i){var a=t[0],c=t[1],f=t[2],g=t[3],y=a+a,x=c+c,E=f+f,S=a*y,M=a*x,A=a*E,L=c*x,R=c*E,N=f*E,F=g*y,W=g*x,H=g*E,$=i[0],Q=i[1],et=i[2];return e[0]=(1-(L+N))*$,e[1]=(M+H)*$,e[2]=(A-W)*$,e[3]=0,e[4]=(M-H)*Q,e[5]=(1-(S+N))*Q,e[6]=(R+F)*Q,e[7]=0,e[8]=(A+W)*et,e[9]=(R-F)*et,e[10]=(1-(S+L))*et,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},$e.fromRotationTranslationScaleOrigin=function(e,t,r,i,a){var c=t[0],f=t[1],g=t[2],y=t[3],x=c+c,E=f+f,S=g+g,M=c*x,A=c*E,L=c*S,R=f*E,N=f*S,F=g*S,W=y*x,H=y*E,$=y*S,Q=i[0],et=i[1],ct=i[2],ft=a[0],gt=a[1],Et=a[2],vt=(1-(R+F))*Q,Rt=(A+$)*Q,Xt=(L-H)*Q,Pt=(A-$)*et,Ut=(1-(M+F))*et,Mt=(N+W)*et,oe=(L+H)*ct,de=(N-W)*ct,qt=(1-(M+R))*ct;return e[0]=vt,e[1]=Rt,e[2]=Xt,e[3]=0,e[4]=Pt,e[5]=Ut,e[6]=Mt,e[7]=0,e[8]=oe,e[9]=de,e[10]=qt,e[11]=0,e[12]=r[0]+ft-(vt*ft+Pt*gt+oe*Et),e[13]=r[1]+gt-(Rt*ft+Ut*gt+de*Et),e[14]=r[2]+Et-(Xt*ft+Mt*gt+qt*Et),e[15]=1,e},$e.fromQuat=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=r+r,g=i+i,y=a+a,x=r*f,E=i*f,S=i*g,M=a*f,A=a*g,L=a*y,R=c*f,N=c*g,F=c*y;return e[0]=1-S-L,e[1]=E+F,e[2]=M-N,e[3]=0,e[4]=E-F,e[5]=1-x-L,e[6]=A+R,e[7]=0,e[8]=M+N,e[9]=A-R,e[10]=1-x-S,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},$e.frustum=function(e,t,r,i,a,c,f){var g=1/(r-t),y=1/(a-i),x=1/(c-f);return e[0]=2*c*g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*c*y,e[6]=0,e[7]=0,e[8]=(r+t)*g,e[9]=(a+i)*y,e[10]=(f+c)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*c*2*x,e[15]=0,e},$e.perspectiveNO=Q0,$e.perspectiveZO=function(e,t,r,i,a){var c,f=1/Math.tan(t/2);return e[0]=f/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(e[10]=a*(c=1/(i-a)),e[14]=a*i*c):(e[10]=-1,e[14]=-i),e},$e.perspectiveFromFieldOfView=function(e,t,r,i){var a=Math.tan(t.upDegrees*Math.PI/180),c=Math.tan(t.downDegrees*Math.PI/180),f=Math.tan(t.leftDegrees*Math.PI/180),g=Math.tan(t.rightDegrees*Math.PI/180),y=2/(f+g),x=2/(a+c);return e[0]=y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-(f-g)*y*.5,e[9]=(a-c)*x*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},$e.orthoNO=tx,$e.orthoZO=function(e,t,r,i,a,c,f){var g=1/(t-r),y=1/(i-a),x=1/(c-f);return e[0]=-2*g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(t+r)*g,e[13]=(a+i)*y,e[14]=c*x,e[15]=1,e},$e.lookAt=function(e,t,r,i){var a,c,f,g,y,x,E,S,M,A,L=t[0],R=t[1],N=t[2],F=i[0],W=i[1],H=i[2],$=r[0],Q=r[1],et=r[2];return Math.abs(L-$)<bn.EPSILON&&Math.abs(R-Q)<bn.EPSILON&&Math.abs(N-et)<bn.EPSILON?Y0(e):(E=L-$,S=R-Q,M=N-et,a=W*(M*=A=1/Math.hypot(E,S,M))-H*(S*=A),c=H*(E*=A)-F*M,f=F*S-W*E,(A=Math.hypot(a,c,f))?(a*=A=1/A,c*=A,f*=A):(a=0,c=0,f=0),g=S*f-M*c,y=M*a-E*f,x=E*c-S*a,(A=Math.hypot(g,y,x))?(g*=A=1/A,y*=A,x*=A):(g=0,y=0,x=0),e[0]=a,e[1]=g,e[2]=E,e[3]=0,e[4]=c,e[5]=y,e[6]=S,e[7]=0,e[8]=f,e[9]=x,e[10]=M,e[11]=0,e[12]=-(a*L+c*R+f*N),e[13]=-(g*L+y*R+x*N),e[14]=-(E*L+S*R+M*N),e[15]=1,e)},$e.targetTo=function(e,t,r,i){var a=t[0],c=t[1],f=t[2],g=i[0],y=i[1],x=i[2],E=a-r[0],S=c-r[1],M=f-r[2],A=E*E+S*S+M*M;A>0&&(E*=A=1/Math.sqrt(A),S*=A,M*=A);var L=y*M-x*S,R=x*E-g*M,N=g*S-y*E;return(A=L*L+R*R+N*N)>0&&(L*=A=1/Math.sqrt(A),R*=A,N*=A),e[0]=L,e[1]=R,e[2]=N,e[3]=0,e[4]=S*N-M*R,e[5]=M*L-E*N,e[6]=E*R-S*L,e[7]=0,e[8]=E,e[9]=S,e[10]=M,e[11]=0,e[12]=a,e[13]=c,e[14]=f,e[15]=1,e},$e.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},$e.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},$e.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},$e.subtract=ex,$e.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},$e.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},$e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},$e.equals=function(e,t){var r=e[0],i=e[1],a=e[2],c=e[3],f=e[4],g=e[5],y=e[6],x=e[7],E=e[8],S=e[9],M=e[10],A=e[11],L=e[12],R=e[13],N=e[14],F=e[15],W=t[0],H=t[1],$=t[2],Q=t[3],et=t[4],ct=t[5],ft=t[6],gt=t[7],Et=t[8],vt=t[9],Rt=t[10],Xt=t[11],Pt=t[12],Ut=t[13],Mt=t[14],oe=t[15];return Math.abs(r-W)<=bn.EPSILON*Math.max(1,Math.abs(r),Math.abs(W))&&Math.abs(i-H)<=bn.EPSILON*Math.max(1,Math.abs(i),Math.abs(H))&&Math.abs(a-$)<=bn.EPSILON*Math.max(1,Math.abs(a),Math.abs($))&&Math.abs(c-Q)<=bn.EPSILON*Math.max(1,Math.abs(c),Math.abs(Q))&&Math.abs(f-et)<=bn.EPSILON*Math.max(1,Math.abs(f),Math.abs(et))&&Math.abs(g-ct)<=bn.EPSILON*Math.max(1,Math.abs(g),Math.abs(ct))&&Math.abs(y-ft)<=bn.EPSILON*Math.max(1,Math.abs(y),Math.abs(ft))&&Math.abs(x-gt)<=bn.EPSILON*Math.max(1,Math.abs(x),Math.abs(gt))&&Math.abs(E-Et)<=bn.EPSILON*Math.max(1,Math.abs(E),Math.abs(Et))&&Math.abs(S-vt)<=bn.EPSILON*Math.max(1,Math.abs(S),Math.abs(vt))&&Math.abs(M-Rt)<=bn.EPSILON*Math.max(1,Math.abs(M),Math.abs(Rt))&&Math.abs(A-Xt)<=bn.EPSILON*Math.max(1,Math.abs(A),Math.abs(Xt))&&Math.abs(L-Pt)<=bn.EPSILON*Math.max(1,Math.abs(L),Math.abs(Pt))&&Math.abs(R-Ut)<=bn.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ut))&&Math.abs(N-Mt)<=bn.EPSILON*Math.max(1,Math.abs(N),Math.abs(Mt))&&Math.abs(F-oe)<=bn.EPSILON*Math.max(1,Math.abs(F),Math.abs(oe))},$e.sub=$e.mul=$e.ortho=$e.perspective=void 0;var bn=function(e,t){if(e&&e.__esModule)return e;if(e===null||uy(e)!=="object"&&typeof e!="function")return{default:e};var r=H0(void 0);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}(ii);function H0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(H0=function(i){return i?r:t})(e)}function Y0(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $0(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=t[4],y=t[5],x=t[6],E=t[7],S=t[8],M=t[9],A=t[10],L=t[11],R=t[12],N=t[13],F=t[14],W=t[15],H=r[0],$=r[1],Q=r[2],et=r[3];return e[0]=H*i+$*g+Q*S+et*R,e[1]=H*a+$*y+Q*M+et*N,e[2]=H*c+$*x+Q*A+et*F,e[3]=H*f+$*E+Q*L+et*W,e[4]=(H=r[4])*i+($=r[5])*g+(Q=r[6])*S+(et=r[7])*R,e[5]=H*a+$*y+Q*M+et*N,e[6]=H*c+$*x+Q*A+et*F,e[7]=H*f+$*E+Q*L+et*W,e[8]=(H=r[8])*i+($=r[9])*g+(Q=r[10])*S+(et=r[11])*R,e[9]=H*a+$*y+Q*M+et*N,e[10]=H*c+$*x+Q*A+et*F,e[11]=H*f+$*E+Q*L+et*W,e[12]=(H=r[12])*i+($=r[13])*g+(Q=r[14])*S+(et=r[15])*R,e[13]=H*a+$*y+Q*M+et*N,e[14]=H*c+$*x+Q*A+et*F,e[15]=H*f+$*E+Q*L+et*W,e}function J0(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=i+i,y=a+a,x=c+c,E=i*g,S=i*y,M=i*x,A=a*y,L=a*x,R=c*x,N=f*g,F=f*y,W=f*x;return e[0]=1-(A+R),e[1]=S+W,e[2]=M-F,e[3]=0,e[4]=S-W,e[5]=1-(E+R),e[6]=L+N,e[7]=0,e[8]=M+F,e[9]=L-N,e[10]=1-(E+A),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function K0(e,t){var r=t[4],i=t[5],a=t[6],c=t[8],f=t[9],g=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(r,i,a),e[2]=Math.hypot(c,f,g),e}function Q0(e,t,r,i,a){var c,f=1/Math.tan(t/2);return e[0]=f/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(e[10]=(a+i)*(c=1/(i-a)),e[14]=2*a*i*c):(e[10]=-1,e[14]=-2*i),e}function tx(e,t,r,i,a,c,f){var g=1/(t-r),y=1/(i-a),x=1/(c-f);return e[0]=-2*g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(t+r)*g,e[13]=(a+i)*y,e[14]=(f+c)*x,e[15]=1,e}function ex(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}$e.perspective=Q0,$e.ortho=tx,$e.mul=$0,$e.sub=ex;var Ze={},Ye={};function cy(e){return cy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cy(e)}Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.create=nx,Ye.clone=function(e){var t=new Ll.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Ye.length=ix,Ye.fromValues=function(e,t,r){var i=new Ll.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i},Ye.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Ye.set=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},Ye.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},Ye.subtract=ox,Ye.multiply=sx,Ye.divide=ax,Ye.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Ye.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Ye.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},Ye.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},Ye.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Ye.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},Ye.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},Ye.distance=lx,Ye.squaredDistance=ux,Ye.squaredLength=cx,Ye.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Ye.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Ye.normalize=function(e,t){var r=t[0],i=t[1],a=t[2],c=r*r+i*i+a*a;return c>0&&(c=1/Math.sqrt(c)),e[0]=t[0]*c,e[1]=t[1]*c,e[2]=t[2]*c,e},Ye.dot=hx,Ye.cross=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=r[0],g=r[1],y=r[2];return e[0]=a*y-c*g,e[1]=c*f-i*y,e[2]=i*g-a*f,e},Ye.lerp=function(e,t,r,i){var a=t[0],c=t[1],f=t[2];return e[0]=a+i*(r[0]-a),e[1]=c+i*(r[1]-c),e[2]=f+i*(r[2]-f),e},Ye.hermite=function(e,t,r,i,a,c){var f=c*c,g=f*(2*c-3)+1,y=f*(c-2)+c,x=f*(c-1),E=f*(3-2*c);return e[0]=t[0]*g+r[0]*y+i[0]*x+a[0]*E,e[1]=t[1]*g+r[1]*y+i[1]*x+a[1]*E,e[2]=t[2]*g+r[2]*y+i[2]*x+a[2]*E,e},Ye.bezier=function(e,t,r,i,a,c){var f=1-c,g=f*f,y=c*c,x=g*f,E=3*c*g,S=3*y*f,M=y*c;return e[0]=t[0]*x+r[0]*E+i[0]*S+a[0]*M,e[1]=t[1]*x+r[1]*E+i[1]*S+a[1]*M,e[2]=t[2]*x+r[2]*E+i[2]*S+a[2]*M,e},Ye.random=function(e,t){t=t||1;var r=2*Ll.RANDOM()*Math.PI,i=2*Ll.RANDOM()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=i*t,e},Ye.transformMat4=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=r[3]*i+r[7]*a+r[11]*c+r[15];return e[0]=(r[0]*i+r[4]*a+r[8]*c+r[12])/(f=f||1),e[1]=(r[1]*i+r[5]*a+r[9]*c+r[13])/f,e[2]=(r[2]*i+r[6]*a+r[10]*c+r[14])/f,e},Ye.transformMat3=function(e,t,r){var i=t[0],a=t[1],c=t[2];return e[0]=i*r[0]+a*r[3]+c*r[6],e[1]=i*r[1]+a*r[4]+c*r[7],e[2]=i*r[2]+a*r[5]+c*r[8],e},Ye.transformQuat=function(e,t,r){var i=r[0],a=r[1],c=r[2],f=t[0],g=t[1],y=t[2],x=a*y-c*g,E=c*f-i*y,S=i*g-a*f,M=a*S-c*E,A=c*x-i*S,L=i*E-a*x,R=2*r[3];return E*=R,S*=R,A*=2,L*=2,e[0]=f+(x*=R)+(M*=2),e[1]=g+E+A,e[2]=y+S+L,e},Ye.rotateX=function(e,t,r,i){var a=[],c=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],c[0]=a[0],c[1]=a[1]*Math.cos(i)-a[2]*Math.sin(i),c[2]=a[1]*Math.sin(i)+a[2]*Math.cos(i),e[0]=c[0]+r[0],e[1]=c[1]+r[1],e[2]=c[2]+r[2],e},Ye.rotateY=function(e,t,r,i){var a=[],c=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],c[0]=a[2]*Math.sin(i)+a[0]*Math.cos(i),c[1]=a[1],c[2]=a[2]*Math.cos(i)-a[0]*Math.sin(i),e[0]=c[0]+r[0],e[1]=c[1]+r[1],e[2]=c[2]+r[2],e},Ye.rotateZ=function(e,t,r,i){var a=[],c=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],c[0]=a[0]*Math.cos(i)-a[1]*Math.sin(i),c[1]=a[0]*Math.sin(i)+a[1]*Math.cos(i),c[2]=a[2],e[0]=c[0]+r[0],e[1]=c[1]+r[1],e[2]=c[2]+r[2],e},Ye.angle=function(e,t){var r=e[0],i=e[1],a=e[2],c=t[0],f=t[1],g=t[2],y=Math.sqrt(r*r+i*i+a*a)*Math.sqrt(c*c+f*f+g*g),x=y&&hx(e,t)/y;return Math.acos(Math.min(Math.max(x,-1),1))},Ye.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Ye.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Ye.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Ye.equals=function(e,t){var r=e[0],i=e[1],a=e[2],c=t[0],f=t[1],g=t[2];return Math.abs(r-c)<=Ll.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-f)<=Ll.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-g)<=Ll.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))},Ye.forEach=Ye.sqrLen=Ye.len=Ye.sqrDist=Ye.dist=Ye.div=Ye.mul=Ye.sub=void 0;var Ll=function(e,t){if(e&&e.__esModule)return e;if(e===null||cy(e)!=="object"&&typeof e!="function")return{default:e};var r=rx(void 0);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}(ii);function rx(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(rx=function(i){return i?r:t})(e)}function nx(){var e=new Ll.ARRAY_TYPE(3);return Ll.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ix(e){return Math.hypot(e[0],e[1],e[2])}function ox(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function sx(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function ax(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function lx(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function ux(e,t){var r=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2];return r*r+i*i+a*a}function cx(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function hx(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Ye.sub=ox,Ye.mul=sx,Ye.div=ax,Ye.dist=lx,Ye.sqrDist=ux,Ye.len=ix,Ye.sqrLen=cx;var Dl,O2=(Dl=nx(),function(e,t,r,i,a,c){var f,g;for(t||(t=3),r||(r=0),g=i?Math.min(i*t+r,e.length):e.length,f=r;f<g;f+=t)Dl[0]=e[f],Dl[1]=e[f+1],Dl[2]=e[f+2],a(Dl,Dl,c),e[f]=Dl[0],e[f+1]=Dl[1],e[f+2]=Dl[2];return e});Ye.forEach=O2;var ir={};function hy(e){return hy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hy(e)}Object.defineProperty(ir,"__esModule",{value:!0}),ir.create=fx,ir.clone=function(e){var t=new Ss.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ir.fromValues=function(e,t,r,i){var a=new Ss.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a},ir.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ir.set=function(e,t,r,i,a){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e},ir.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},ir.subtract=dx,ir.multiply=mx,ir.divide=gx,ir.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},ir.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},ir.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},ir.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},ir.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},ir.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},ir.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},ir.distance=_x,ir.squaredDistance=yx,ir.length=vx,ir.squaredLength=xx,ir.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},ir.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},ir.normalize=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=r*r+i*i+a*a+c*c;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=i*f,e[2]=a*f,e[3]=c*f,e},ir.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},ir.cross=function(e,t,r,i){var a=r[0]*i[1]-r[1]*i[0],c=r[0]*i[2]-r[2]*i[0],f=r[0]*i[3]-r[3]*i[0],g=r[1]*i[2]-r[2]*i[1],y=r[1]*i[3]-r[3]*i[1],x=r[2]*i[3]-r[3]*i[2],E=t[0],S=t[1],M=t[2],A=t[3];return e[0]=S*x-M*y+A*g,e[1]=-E*x+M*f-A*c,e[2]=E*y-S*f+A*a,e[3]=-E*g+S*c-M*a,e},ir.lerp=function(e,t,r,i){var a=t[0],c=t[1],f=t[2],g=t[3];return e[0]=a+i*(r[0]-a),e[1]=c+i*(r[1]-c),e[2]=f+i*(r[2]-f),e[3]=g+i*(r[3]-g),e},ir.random=function(e,t){var r,i,a,c,f,g;t=t||1;do f=(r=2*Ss.RANDOM()-1)*r+(i=2*Ss.RANDOM()-1)*i;while(f>=1);do g=(a=2*Ss.RANDOM()-1)*a+(c=2*Ss.RANDOM()-1)*c;while(g>=1);var y=Math.sqrt((1-f)/g);return e[0]=t*r,e[1]=t*i,e[2]=t*a*y,e[3]=t*c*y,e},ir.transformMat4=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3];return e[0]=r[0]*i+r[4]*a+r[8]*c+r[12]*f,e[1]=r[1]*i+r[5]*a+r[9]*c+r[13]*f,e[2]=r[2]*i+r[6]*a+r[10]*c+r[14]*f,e[3]=r[3]*i+r[7]*a+r[11]*c+r[15]*f,e},ir.transformQuat=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=r[0],g=r[1],y=r[2],x=r[3],E=x*i+g*c-y*a,S=x*a+y*i-f*c,M=x*c+f*a-g*i,A=-f*i-g*a-y*c;return e[0]=E*x+A*-f+S*-y-M*-g,e[1]=S*x+A*-g+M*-f-E*-y,e[2]=M*x+A*-y+E*-g-S*-f,e[3]=t[3],e},ir.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},ir.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ir.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},ir.equals=function(e,t){var r=e[0],i=e[1],a=e[2],c=e[3],f=t[0],g=t[1],y=t[2],x=t[3];return Math.abs(r-f)<=Ss.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-g)<=Ss.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(a-y)<=Ss.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(c-x)<=Ss.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))},ir.forEach=ir.sqrLen=ir.len=ir.sqrDist=ir.dist=ir.div=ir.mul=ir.sub=void 0;var Ss=function(e,t){if(e&&e.__esModule)return e;if(e===null||hy(e)!=="object"&&typeof e!="function")return{default:e};var r=px(void 0);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}(ii);function px(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(px=function(i){return i?r:t})(e)}function fx(){var e=new Ss.ARRAY_TYPE(4);return Ss.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function dx(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function mx(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function gx(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function _x(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function yx(e,t){var r=t[0]-e[0],i=t[1]-e[1],a=t[2]-e[2],c=t[3]-e[3];return r*r+i*i+a*a+c*c}function vx(e){return Math.hypot(e[0],e[1],e[2],e[3])}function xx(e){var t=e[0],r=e[1],i=e[2],a=e[3];return t*t+r*r+i*i+a*a}ir.sub=dx,ir.mul=mx,ir.div=gx,ir.dist=_x,ir.sqrDist=yx,ir.len=vx,ir.sqrLen=xx;var z2=function(){var e=fx();return function(t,r,i,a,c,f){var g,y;for(r||(r=4),i||(i=0),y=a?Math.min(a*r+i,t.length):t.length,g=i;g<y;g+=r)e[0]=t[g],e[1]=t[g+1],e[2]=t[g+2],e[3]=t[g+3],c(e,e,f),t[g]=e[0],t[g+1]=e[1],t[g+2]=e[2],t[g+3]=e[3];return t}}();function py(e){return py=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},py(e)}ir.forEach=z2,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.create=fy,Ze.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Ze.setAxisAngle=wx,Ze.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>wc.EPSILON?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},Ze.getAngle=function(e,t){var r=Mx(e,t);return Math.acos(2*r*r-1)},Ze.multiply=Ex,Ze.rotateX=function(e,t,r){r*=.5;var i=t[0],a=t[1],c=t[2],f=t[3],g=Math.sin(r),y=Math.cos(r);return e[0]=i*y+f*g,e[1]=a*y+c*g,e[2]=c*y-a*g,e[3]=f*y-i*g,e},Ze.rotateY=function(e,t,r){r*=.5;var i=t[0],a=t[1],c=t[2],f=t[3],g=Math.sin(r),y=Math.cos(r);return e[0]=i*y-c*g,e[1]=a*y+f*g,e[2]=c*y+i*g,e[3]=f*y-a*g,e},Ze.rotateZ=function(e,t,r){r*=.5;var i=t[0],a=t[1],c=t[2],f=t[3],g=Math.sin(r),y=Math.cos(r);return e[0]=i*y+a*g,e[1]=a*y-i*g,e[2]=c*y+f*g,e[3]=f*y-c*g,e},Ze.calculateW=function(e,t){var r=t[0],i=t[1],a=t[2];return e[0]=r,e[1]=i,e[2]=a,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-a*a)),e},Ze.exp=Ix,Ze.ln=Tx,Ze.pow=function(e,t,r){return Tx(e,t),Cx(e,e,r),Ix(e,e),e},Ze.slerp=Um,Ze.random=function(e){var t=wc.RANDOM(),r=wc.RANDOM(),i=wc.RANDOM(),a=Math.sqrt(1-t),c=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*r),e[1]=a*Math.cos(2*Math.PI*r),e[2]=c*Math.sin(2*Math.PI*i),e[3]=c*Math.cos(2*Math.PI*i),e},Ze.invert=function(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=r*r+i*i+a*a+c*c,g=f?1/f:0;return e[0]=-r*g,e[1]=-i*g,e[2]=-a*g,e[3]=c*g,e},Ze.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Ze.fromMat3=Sx,Ze.fromEuler=function(e,t,r,i){var a=.5*Math.PI/180;t*=a,r*=a,i*=a;var c=Math.sin(t),f=Math.cos(t),g=Math.sin(r),y=Math.cos(r),x=Math.sin(i),E=Math.cos(i);return e[0]=c*y*E-f*g*x,e[1]=f*g*E+c*y*x,e[2]=f*y*x-c*g*E,e[3]=f*y*E+c*g*x,e},Ze.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Ze.setAxes=Ze.sqlerp=Ze.rotationTo=Ze.equals=Ze.exactEquals=Ze.normalize=Ze.sqrLen=Ze.squaredLength=Ze.len=Ze.length=Ze.lerp=Ze.dot=Ze.scale=Ze.mul=Ze.add=Ze.set=Ze.copy=Ze.fromValues=Ze.clone=void 0;var wc=Vm(ii),N2=Vm(zr),Rl=Vm(Ye),os=Vm(ir);function bx(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(bx=function(i){return i?r:t})(e)}function Vm(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||py(e)!=="object"&&typeof e!="function")return{default:e};var r=bx(t);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}function fy(){var e=new wc.ARRAY_TYPE(4);return wc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function wx(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function Ex(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=r[0],y=r[1],x=r[2],E=r[3];return e[0]=i*E+f*g+a*x-c*y,e[1]=a*E+f*y+c*g-i*x,e[2]=c*E+f*x+i*y-a*g,e[3]=f*E-i*g-a*y-c*x,e}function Ix(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=Math.sqrt(r*r+i*i+a*a),g=Math.exp(c),y=f>0?g*Math.sin(f)/f:0;return e[0]=r*y,e[1]=i*y,e[2]=a*y,e[3]=g*Math.cos(f),e}function Tx(e,t){var r=t[0],i=t[1],a=t[2],c=t[3],f=Math.sqrt(r*r+i*i+a*a),g=f>0?Math.atan2(f,c)/f:0;return e[0]=r*g,e[1]=i*g,e[2]=a*g,e[3]=.5*Math.log(r*r+i*i+a*a+c*c),e}function Um(e,t,r,i){var a,c,f,g,y,x=t[0],E=t[1],S=t[2],M=t[3],A=r[0],L=r[1],R=r[2],N=r[3];return(c=x*A+E*L+S*R+M*N)<0&&(c=-c,A=-A,L=-L,R=-R,N=-N),1-c>wc.EPSILON?(a=Math.acos(c),f=Math.sin(a),g=Math.sin((1-i)*a)/f,y=Math.sin(i*a)/f):(g=1-i,y=i),e[0]=g*x+y*A,e[1]=g*E+y*L,e[2]=g*S+y*R,e[3]=g*M+y*N,e}function Sx(e,t){var r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,e[0]=(t[5]-t[7])*(r=.5/r),e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var c=(a+1)%3,f=(a+2)%3;r=Math.sqrt(t[3*a+a]-t[3*c+c]-t[3*f+f]+1),e[a]=.5*r,e[3]=(t[3*c+f]-t[3*f+c])*(r=.5/r),e[c]=(t[3*c+a]+t[3*a+c])*r,e[f]=(t[3*f+a]+t[3*a+f])*r}return e}Ze.clone=os.clone,Ze.fromValues=os.fromValues,Ze.copy=os.copy,Ze.set=os.set,Ze.add=os.add,Ze.mul=Ex;var Cx=os.scale;Ze.scale=Cx;var Mx=os.dot;Ze.dot=Mx,Ze.lerp=os.lerp;var Ax=os.length;Ze.length=Ax,Ze.len=Ax;var Px=os.squaredLength;Ze.squaredLength=Px,Ze.sqrLen=Px;var dy=os.normalize;Ze.normalize=dy,Ze.exactEquals=os.exactEquals,Ze.equals=os.equals;var oa,Lx,Dx,k2=(oa=Rl.create(),Lx=Rl.fromValues(1,0,0),Dx=Rl.fromValues(0,1,0),function(e,t,r){var i=Rl.dot(t,r);return i<-.999999?(Rl.cross(oa,Lx,t),Rl.len(oa)<1e-6&&Rl.cross(oa,Dx,t),Rl.normalize(oa,oa),wx(e,oa,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Rl.cross(oa,t,r),e[0]=oa[0],e[1]=oa[1],e[2]=oa[2],e[3]=1+i,dy(e,e))});Ze.rotationTo=k2;var my,gy,F2=(my=fy(),gy=fy(),function(e,t,r,i,a,c){return Um(my,t,a,c),Um(gy,r,i,c),Um(e,my,gy,2*c*(1-c)),e});Ze.sqlerp=F2;var sa,B2=(sa=N2.create(),function(e,t,r,i){return sa[0]=r[0],sa[3]=r[1],sa[6]=r[2],sa[1]=i[0],sa[4]=i[1],sa[7]=i[2],sa[2]=-t[0],sa[5]=-t[1],sa[8]=-t[2],dy(e,Sx(e,sa))});Ze.setAxes=B2;var cr={};function _y(e){return _y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_y(e)}Object.defineProperty(cr,"__esModule",{value:!0}),cr.create=function(){var e=new xo.ARRAY_TYPE(8);return xo.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},cr.clone=function(e){var t=new xo.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},cr.fromValues=function(e,t,r,i,a,c,f,g){var y=new xo.ARRAY_TYPE(8);return y[0]=e,y[1]=t,y[2]=r,y[3]=i,y[4]=a,y[5]=c,y[6]=f,y[7]=g,y},cr.fromRotationTranslationValues=function(e,t,r,i,a,c,f){var g=new xo.ARRAY_TYPE(8);g[0]=e,g[1]=t,g[2]=r,g[3]=i;var y=.5*a,x=.5*c,E=.5*f;return g[4]=y*i+x*r-E*t,g[5]=x*i+E*e-y*r,g[6]=E*i+y*t-x*e,g[7]=-y*e-x*t-E*r,g},cr.fromRotationTranslation=zx,cr.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},cr.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},cr.fromMat4=function(e,t){var r=Ol.create();Rx.getRotation(r,t);var i=new xo.ARRAY_TYPE(3);return Rx.getTranslation(i,t),zx(e,r,i),e},cr.copy=Nx,cr.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},cr.set=function(e,t,r,i,a,c,f,g,y){return e[0]=t,e[1]=r,e[2]=i,e[3]=a,e[4]=c,e[5]=f,e[6]=g,e[7]=y,e},cr.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},cr.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},cr.getTranslation=function(e,t){var r=t[4],i=t[5],a=t[6],c=t[7],f=-t[0],g=-t[1],y=-t[2],x=t[3];return e[0]=2*(r*x+c*f+i*y-a*g),e[1]=2*(i*x+c*g+a*f-r*y),e[2]=2*(a*x+c*y+r*g-i*f),e},cr.translate=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=.5*r[0],y=.5*r[1],x=.5*r[2],E=t[4],S=t[5],M=t[6],A=t[7];return e[0]=i,e[1]=a,e[2]=c,e[3]=f,e[4]=f*g+a*x-c*y+E,e[5]=f*y+c*g-i*x+S,e[6]=f*x+i*y-a*g+M,e[7]=-i*g-a*y-c*x+A,e},cr.rotateX=function(e,t,r){var i=-t[0],a=-t[1],c=-t[2],f=t[3],g=t[4],y=t[5],x=t[6],E=t[7],S=g*f+E*i+y*c-x*a,M=y*f+E*a+x*i-g*c,A=x*f+E*c+g*a-y*i,L=E*f-g*i-y*a-x*c;return Ol.rotateX(e,t,r),e[4]=S*(f=e[3])+L*(i=e[0])+M*(c=e[2])-A*(a=e[1]),e[5]=M*f+L*a+A*i-S*c,e[6]=A*f+L*c+S*a-M*i,e[7]=L*f-S*i-M*a-A*c,e},cr.rotateY=function(e,t,r){var i=-t[0],a=-t[1],c=-t[2],f=t[3],g=t[4],y=t[5],x=t[6],E=t[7],S=g*f+E*i+y*c-x*a,M=y*f+E*a+x*i-g*c,A=x*f+E*c+g*a-y*i,L=E*f-g*i-y*a-x*c;return Ol.rotateY(e,t,r),e[4]=S*(f=e[3])+L*(i=e[0])+M*(c=e[2])-A*(a=e[1]),e[5]=M*f+L*a+A*i-S*c,e[6]=A*f+L*c+S*a-M*i,e[7]=L*f-S*i-M*a-A*c,e},cr.rotateZ=function(e,t,r){var i=-t[0],a=-t[1],c=-t[2],f=t[3],g=t[4],y=t[5],x=t[6],E=t[7],S=g*f+E*i+y*c-x*a,M=y*f+E*a+x*i-g*c,A=x*f+E*c+g*a-y*i,L=E*f-g*i-y*a-x*c;return Ol.rotateZ(e,t,r),e[4]=S*(f=e[3])+L*(i=e[0])+M*(c=e[2])-A*(a=e[1]),e[5]=M*f+L*a+A*i-S*c,e[6]=A*f+L*c+S*a-M*i,e[7]=L*f-S*i-M*a-A*c,e},cr.rotateByQuatAppend=function(e,t,r){var i=r[0],a=r[1],c=r[2],f=r[3],g=t[0],y=t[1],x=t[2],E=t[3];return e[0]=g*f+E*i+y*c-x*a,e[1]=y*f+E*a+x*i-g*c,e[2]=x*f+E*c+g*a-y*i,e[3]=E*f-g*i-y*a-x*c,e[4]=(g=t[4])*f+(E=t[7])*i+(y=t[5])*c-(x=t[6])*a,e[5]=y*f+E*a+x*i-g*c,e[6]=x*f+E*c+g*a-y*i,e[7]=E*f-g*i-y*a-x*c,e},cr.rotateByQuatPrepend=function(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=r[0],y=r[1],x=r[2],E=r[3];return e[0]=i*E+f*g+a*x-c*y,e[1]=a*E+f*y+c*g-i*x,e[2]=c*E+f*x+i*y-a*g,e[3]=f*E-i*g-a*y-c*x,e[4]=i*(E=r[7])+f*(g=r[4])+a*(x=r[6])-c*(y=r[5]),e[5]=a*E+f*y+c*g-i*x,e[6]=c*E+f*x+i*y-a*g,e[7]=f*E-i*g-a*y-c*x,e},cr.rotateAroundAxis=function(e,t,r,i){if(Math.abs(i)<xo.EPSILON)return Nx(e,t);var a=Math.hypot(r[0],r[1],r[2]);i*=.5;var c=Math.sin(i),f=c*r[0]/a,g=c*r[1]/a,y=c*r[2]/a,x=Math.cos(i),E=t[0],S=t[1],M=t[2],A=t[3];e[0]=E*x+A*f+S*y-M*g,e[1]=S*x+A*g+M*f-E*y,e[2]=M*x+A*y+E*g-S*f,e[3]=A*x-E*f-S*g-M*y;var L=t[4],R=t[5],N=t[6],F=t[7];return e[4]=L*x+F*f+R*y-N*g,e[5]=R*x+F*g+N*f-L*y,e[6]=N*x+F*y+L*g-R*f,e[7]=F*x-L*f-R*g-N*y,e},cr.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},cr.multiply=kx,cr.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},cr.lerp=function(e,t,r,i){var a=1-i;return Fx(t,r)<0&&(i=-i),e[0]=t[0]*a+r[0]*i,e[1]=t[1]*a+r[1]*i,e[2]=t[2]*a+r[2]*i,e[3]=t[3]*a+r[3]*i,e[4]=t[4]*a+r[4]*i,e[5]=t[5]*a+r[5]*i,e[6]=t[6]*a+r[6]*i,e[7]=t[7]*a+r[7]*i,e},cr.invert=function(e,t){var r=Gm(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},cr.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},cr.normalize=function(e,t){var r=Gm(t);if(r>0){r=Math.sqrt(r);var i=t[0]/r,a=t[1]/r,c=t[2]/r,f=t[3]/r,g=t[4],y=t[5],x=t[6],E=t[7],S=i*g+a*y+c*x+f*E;e[0]=i,e[1]=a,e[2]=c,e[3]=f,e[4]=(g-i*S)/r,e[5]=(y-a*S)/r,e[6]=(x-c*S)/r,e[7]=(E-f*S)/r}return e},cr.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},cr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},cr.equals=function(e,t){var r=e[0],i=e[1],a=e[2],c=e[3],f=e[4],g=e[5],y=e[6],x=e[7],E=t[0],S=t[1],M=t[2],A=t[3],L=t[4],R=t[5],N=t[6],F=t[7];return Math.abs(r-E)<=xo.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(i-S)<=xo.EPSILON*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(a-M)<=xo.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(c-A)<=xo.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(f-L)<=xo.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(g-R)<=xo.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(y-N)<=xo.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(x-F)<=xo.EPSILON*Math.max(1,Math.abs(x),Math.abs(F))},cr.sqrLen=cr.squaredLength=cr.len=cr.length=cr.dot=cr.mul=cr.setReal=cr.getReal=void 0;var xo=yy(ii),Ol=yy(Ze),Rx=yy($e);function Ox(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Ox=function(i){return i?r:t})(e)}function yy(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||_y(e)!=="object"&&typeof e!="function")return{default:e};var r=Ox(t);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}function zx(e,t,r){var i=.5*r[0],a=.5*r[1],c=.5*r[2],f=t[0],g=t[1],y=t[2],x=t[3];return e[0]=f,e[1]=g,e[2]=y,e[3]=x,e[4]=i*x+a*y-c*g,e[5]=a*x+c*f-i*y,e[6]=c*x+i*g-a*f,e[7]=-i*f-a*g-c*y,e}function Nx(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function kx(e,t,r){var i=t[0],a=t[1],c=t[2],f=t[3],g=r[4],y=r[5],x=r[6],E=r[7],S=t[4],M=t[5],A=t[6],L=t[7],R=r[0],N=r[1],F=r[2],W=r[3];return e[0]=i*W+f*R+a*F-c*N,e[1]=a*W+f*N+c*R-i*F,e[2]=c*W+f*F+i*N-a*R,e[3]=f*W-i*R-a*N-c*F,e[4]=i*E+f*g+a*x-c*y+S*W+L*R+M*F-A*N,e[5]=a*E+f*y+c*g-i*x+M*W+L*N+A*R-S*F,e[6]=c*E+f*x+i*y-a*g+A*W+L*F+S*N-M*R,e[7]=f*E-i*g-a*y-c*x+L*W-S*R-M*N-A*F,e}cr.getReal=Ol.copy,cr.setReal=Ol.copy,cr.mul=kx;var Fx=Ol.dot;cr.dot=Fx;var Bx=Ol.length;cr.length=Bx,cr.len=Bx;var Gm=Ol.squaredLength;cr.squaredLength=Gm,cr.sqrLen=Gm;var er={};function vy(e){return vy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vy(e)}Object.defineProperty(er,"__esModule",{value:!0}),er.create=Ux,er.clone=function(e){var t=new Ec.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},er.fromValues=function(e,t){var r=new Ec.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},er.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},er.set=function(e,t,r){return e[0]=t,e[1]=r,e},er.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},er.subtract=Gx,er.multiply=jx,er.divide=qx,er.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},er.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},er.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},er.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},er.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},er.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},er.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},er.distance=Zx,er.squaredDistance=Xx,er.length=Wx,er.squaredLength=Hx,er.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},er.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},er.normalize=function(e,t){var r=t[0],i=t[1],a=r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e},er.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},er.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},er.lerp=function(e,t,r,i){var a=t[0],c=t[1];return e[0]=a+i*(r[0]-a),e[1]=c+i*(r[1]-c),e},er.random=function(e,t){t=t||1;var r=2*Ec.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},er.transformMat2=function(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[2]*a,e[1]=r[1]*i+r[3]*a,e},er.transformMat2d=function(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[2]*a+r[4],e[1]=r[1]*i+r[3]*a+r[5],e},er.transformMat3=function(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[3]*a+r[6],e[1]=r[1]*i+r[4]*a+r[7],e},er.transformMat4=function(e,t,r){var i=t[0],a=t[1];return e[0]=r[0]*i+r[4]*a+r[12],e[1]=r[1]*i+r[5]*a+r[13],e},er.rotate=function(e,t,r,i){var a=t[0]-r[0],c=t[1]-r[1],f=Math.sin(i),g=Math.cos(i);return e[0]=a*g-c*f+r[0],e[1]=a*f+c*g+r[1],e},er.angle=function(e,t){var r=e[0],i=e[1],a=t[0],c=t[1],f=Math.sqrt(r*r+i*i)*Math.sqrt(a*a+c*c);return Math.acos(Math.min(Math.max(f&&(r*a+i*c)/f,-1),1))},er.zero=function(e){return e[0]=0,e[1]=0,e},er.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},er.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},er.equals=function(e,t){var r=e[0],i=e[1],a=t[0],c=t[1];return Math.abs(r-a)<=Ec.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-c)<=Ec.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))},er.forEach=er.sqrLen=er.sqrDist=er.dist=er.div=er.mul=er.sub=er.len=void 0;var Ec=function(e,t){if(e&&e.__esModule)return e;if(e===null||vy(e)!=="object"&&typeof e!="function")return{default:e};var r=Vx(void 0);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}(ii);function Vx(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Vx=function(i){return i?r:t})(e)}function Ux(){var e=new Ec.ARRAY_TYPE(2);return Ec.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function Gx(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function jx(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function qx(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Zx(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function Xx(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function Wx(e){return Math.hypot(e[0],e[1])}function Hx(e){var t=e[0],r=e[1];return t*t+r*r}er.len=Wx,er.sub=Gx,er.mul=jx,er.div=qx,er.dist=Zx,er.sqrDist=Xx,er.sqrLen=Hx;var V2=function(){var e=Ux();return function(t,r,i,a,c,f){var g,y;for(r||(r=2),i||(i=0),y=a?Math.min(a*r+i,t.length):t.length,g=i;g<y;g+=r)e[0]=t[g],e[1]=t[g+1],c(e,e,f),t[g]=e[0],t[g+1]=e[1];return t}}();function xy(e){return xy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xy(e)}er.forEach=V2,Object.defineProperty(ni,"__esModule",{value:!0}),s.e=ni.vec4=s.v=ni.vec3=ni.vec2=ni.quat2=s.q=ni.quat=s.m=ni.mat4=s.bx=ni.mat3=ni.mat2d=s.h=ni.mat2=ni.glMatrix=void 0;var U2=Ua(ii);ni.glMatrix=U2;var G2=Ua(dn);s.h=ni.mat2=G2;var j2=Ua(mn);ni.mat2d=j2;var q2=Ua(zr);s.bx=ni.mat3=q2;var Z2=Ua($e);s.m=ni.mat4=Z2;var X2=Ua(Ze);s.q=ni.quat=X2;var W2=Ua(cr);ni.quat2=W2;var H2=Ua(er);ni.vec2=H2;var Y2=Ua(Ye);s.v=ni.vec3=Y2;var $2=Ua(ir);function Yx(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,r=new WeakMap;return(Yx=function(i){return i?r:t})(e)}function Ua(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||xy(e)!=="object"&&typeof e!="function")return{default:e};var r=Yx(t);if(r&&r.has(e))return r.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var f=a?Object.getOwnPropertyDescriptor(e,c):null;f&&(f.get||f.set)?Object.defineProperty(i,c,f):i[c]=e[c]}return i.default=e,r&&r.set(e,i),i}s.e=ni.vec4=$2;const J2=Ee([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:jm}=J2,$x=Ee([{name:"a_pos_3",components:3,type:"Int16"}]);var Uf=Ee([{name:"a_pos",type:"Int16",components:2}]),Jx={};(function(e,t){(function(r){function i(c,f,g){var y=a(256*c,256*(f=Math.pow(2,g)-f-1),g),x=a(256*(c+1),256*(f+1),g);return y[0]+","+y[1]+","+x[0]+","+x[1]}function a(c,f,g){var y=2*Math.PI*6378137/256/Math.pow(2,g);return[c*y-2*Math.PI*6378137/2,f*y-2*Math.PI*6378137/2]}r.getURL=function(c,f,g,y,x,E){return E=E||{},c+"?"+["bbox="+i(g,y,x),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+f].join("&")},r.getTileBBox=i,r.getMercCoords=a,Object.defineProperty(r,"__esModule",{value:!0})})(t)})(0,Jx);var K2=Jx;class Ic{constructor(t,r,i){this.z=t,this.x=r,this.y=i,this.key=Gf(0,t,t,r,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r){const i=K2.getTileBBox(this.x,this.y,this.z),a=function(c,f,g){let y,x="";for(let E=c;E>0;E--)y=1<<E-1,x+=(f&y?1:0)+(g&y?2:0);return x}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kx{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Gf(t,r.z,r.z,r.x,r.y)}}class fi{constructor(t,r,i,a,c){this.overscaledZ=t,this.wrap=r,this.canonical=new Ic(i,+a,+c),this.key=r===0&&t===i?this.canonical.key:Gf(r,t,i,a,c)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const r=this.canonical.z-t;return t>this.canonical.z?new fi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fi(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r=!0){if(this.overscaledZ===t&&r)return this.key;if(t>this.canonical.z)return Gf(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return Gf(this.wrap*+r,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new fi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,i=2*this.canonical.x,a=2*this.canonical.y;return[new fi(r,this.wrap,r,i,a),new fi(r,this.wrap,r,i+1,a),new fi(r,this.wrap,r,i,a+1),new fi(r,this.wrap,r,i+1,a+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new fi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new fi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gf(e,t,r,i,a){const c=1<<Math.min(r,22);let f=c*(a%c)+i%c;return e&&r<22&&(f+=c*c*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*f+r)+(t-r)}const Q2=[e=>{let t=e.canonical.x-1,r=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,r--),new fi(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,r=e.wrap;return t===1<<e.canonical.z&&(t=0,r++),new fi(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>new fi(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(e.canonical.y===0?1<<e.canonical.z:e.canonical.y)-1),e=>new fi(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];me(Ic,"CanonicalTileID"),me(fi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class by{constructor(t,r){this.pos=t,this.dir=r}intersectsPlane(t,r,i){const a=s.v.dot(r,this.dir);if(Math.abs(a)<1e-6)return!1;const c=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/a;return i[0]=this.pos[0]+this.dir[0]*c,i[1]=this.pos[1]+this.dir[1]*c,i[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(t,r,i){if(s.v.equals(this.pos,t)||r===0)return i[0]=i[1]=i[2]=0,!1;const[a,c,f]=this.dir,g=this.pos[0]-t[0],y=this.pos[1]-t[1],x=this.pos[2]-t[2],E=a*a+c*c+f*f,S=2*(g*a+y*c+x*f),M=S*S-4*E*(g*g+y*y+x*x-r*r);if(M<0){const A=Math.max(-S/2,0),L=g+a*A,R=y+c*A,N=x+f*A,F=Math.hypot(L,R,N);return i[0]=L*r/F,i[1]=R*r/F,i[2]=N*r/F,!1}{const A=(-S-Math.sqrt(M))/(2*E);if(A<0){const L=Math.hypot(g,y,x);return i[0]=g*r/L,i[1]=y*r/L,i[2]=x*r/L,!1}return i[0]=g+a*A,i[1]=y+c*A,i[2]=x+f*A,!0}}}class wy{constructor(t,r,i,a,c){this.TL=t,this.TR=r,this.BR=i,this.BL=a,this.horizon=c}static fromInvProjectionMatrix(t,r,i){const a=[-1,1,1],c=[1,1,1],f=[1,-1,1],g=[-1,-1,1],y=s.v.transformMat4(a,a,t),x=s.v.transformMat4(c,c,t),E=s.v.transformMat4(f,f,t),S=s.v.transformMat4(g,g,t);return new wy(y,x,E,S,r/i)}}function jf(e,t,r){let i=1/0,a=-1/0;const c=[];for(const f of e){s.v.sub(c,f,t);const g=s.v.dot(c,r);i=Math.min(i,g),a=Math.max(a,g)}return[i,a]}function Qx(e,t){let r=!0;for(let i=0;i<e.planes.length;i++){const a=e.planes[i];let c=0;for(let f=0;f<t.length;f++)c+=s.v.dot(a,t[f])+a[3]>=0;if(c===0)return 0;c!==t.length&&(r=!1)}return r?2:1}function t1(e,t){for(const r of e.projections){const i=jf(t,e.points[0],r.axis);if(r.projection[1]<i[0]||r.projection[0]>i[1])return 0}return 1}function e1(e,t){let r=0;const i=[0,0,0,0];for(let a=0;a<e.length;a++)i[0]=e[a][0],i[1]=e[a][1],i[2]=e[a][2],i[3]=1,s.e.dot(i,t)>=0&&r++;return r}class Ey{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=On.fromPoints(this.points),this.projections=[],this.frustumEdges=[s.v.sub([],this.points[2],this.points[3]),s.v.sub([],this.points[0],this.points[3]),s.v.sub([],this.points[4],this.points[0]),s.v.sub([],this.points[5],this.points[1]),s.v.sub([],this.points[6],this.points[2]),s.v.sub([],this.points[7],this.points[3])];for(const i of this.frustumEdges){const a=[0,-i[2],i[1]],c=[i[2],0,-i[0]];this.projections.push({axis:a,projection:jf(this.points,this.points[0],a)}),this.projections.push({axis:c,projection:jf(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(t,r,i,a){const c=Math.pow(2,i),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const E=s.e.transformMat4([],x,t),S=1/E[3]/r*c;return s.e.mul(E,E,[S,S,a?1/E[3]:S,S])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const E=s.v.sub([],f[x[0]],f[x[1]]),S=s.v.sub([],f[x[2]],f[x[1]]),M=s.v.normalize([],s.v.cross([],E,S)),A=-s.v.dot(M,f[x[1]]);return M.concat(A)}),y=[];for(let x=0;x<f.length;x++)y.push([f[x][0],f[x][1],f[x][2]]);return new Ey(y,g)}intersectsPrecise(t,r,i){for(let a=0;a<r.length;a++)if(!e1(t,r[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!e1(t,this.planes[a]))return 0;for(const a of i)for(const c of this.frustumEdges){const f=s.v.cross([],a,c),g=s.v.length(f);if(g===0)continue;s.v.scale(f,f,1/g);const y=jf(this.points,this.points[0],f),x=jf(t,this.points[0],f);if(y[0]>x[1]||x[0]>y[1])return 0}return 1}}class On{static fromPoints(t){const r=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const a of t)s.v.min(r,r,a),s.v.max(i,i,a);return new On(r,i)}static fromTileIdAndHeight(t,r,i){const a=1<<t.canonical.z,c=t.canonical.x,f=t.canonical.y;return new On([c/a,f/a,r],[(c+1)/a,(f+1)/a,i])}static applyTransform(t,r){const i=t.getCorners();for(let a=0;a<i.length;++a)s.v.transformMat4(i[a],i[a],r);return On.fromPoints(i)}static projectAabbCorners(t,r){const i=t.getCorners();for(let a=0;a<i.length;++a)s.v.transformMat4(i[a],i[a],r);return i}constructor(t,r){this.min=t,this.max=r,this.center=s.v.scale([],s.v.add([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],i=s.v.clone(this.min),a=s.v.clone(this.max);for(let c=0;c<r.length;c++)i[c]=r[c]?this.min[c]:this.center[c],a[c]=r[c]?this.center[c]:this.max[c];return a[2]=this.max[2],new On(i,a)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,r=this.max;return[[t[0],t[1],t[2]],[r[0],t[1],t[2]],[r[0],r[1],t[2]],[t[0],r[1],t[2]],[t[0],t[1],r[2]],[r[0],t[1],r[2]],[r[0],r[1],r[2]],[t[0],r[1],r[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Qx(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Qx(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,r){return r||this.intersects(t)?t1(t,this.getCorners()):0}intersectsPreciseFlat(t,r){return r||this.intersectsFlat(t)?t1(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let r=0;r<3;++r)if(this.min[r]>t.max[r]||t.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t.min[r]),this.max[r]=Math.max(this.max[r],t.max[r])}encapsulatePoint(t){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],t[r]),this.max[r]=Math.max(this.max[r],t[r])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}me(On,"Aabb");const Iy=5,r1=6,ss=ee/Math.PI/2,tI=16383,Zh=64,Ty=[Zh,32,16],Cs=-ss,Ms=ss,eI=[new On([Cs,Cs,Cs],[Ms,Ms,Ms]),new On([Cs,Cs,Cs],[0,0,Ms]),new On([0,Cs,Cs],[Ms,0,Ms]),new On([Cs,0,Cs],[0,Ms,Ms]),new On([0,0,Cs],[Ms,Ms,Ms])];function qm(e){return e*ss/Xf}function n1(e,t,r,i=!0){const a=s.v.scale([],e._camera.position,e.worldSize),c=[t,r,1,1];s.e.transformMat4(c,c,e.pixelMatrixInverse),s.e.scale(c,c,1/c[3]);const f=s.v.sub([],c,a),g=s.v.normalize([],f),y=e.globeMatrix,x=[y[12],y[13],y[14]],E=s.v.sub([],x,a),S=s.v.length(E),M=s.v.normalize([],E),A=e.worldSize/(2*Math.PI),L=s.v.dot(M,g),R=Math.asin(A/S);if(R<Math.acos(L)){if(!i)return null;const vt=[],Rt=[];s.v.scale(vt,g,S/L),s.v.normalize(Rt,s.v.sub(Rt,vt,E)),s.v.normalize(g,s.v.add(g,E,s.v.scale(g,Rt,Math.tan(R)*S)))}const N=[];new by(a,g).closestPointOnSphere(x,A,N);const F=s.v.normalize([],Te(y,0)),W=s.v.normalize([],Te(y,1)),H=s.v.normalize([],Te(y,2)),$=s.v.dot(F,N),Q=s.v.dot(W,N),et=s.v.dot(H,N),ct=Tr(Math.asin(-Q/A));let ft=Tr(Math.atan2($,et));ft=e.center.lng+function(vt,Rt){const Xt=(Rt-vt+180)%360-180;return Xt<-180?Xt+360:Xt}(e.center.lng,ft);const gt=ja(ft),Et=ke(qa(ct),0,1);return new Li(gt,Et)}class rI{constructor(t,r,i){this.a=s.v.sub([],t,i),this.b=s.v.sub([],r,i),this.center=i;const a=s.v.normalize([],this.a),c=s.v.normalize([],this.b);this.angle=Math.acos(s.v.dot(a,c))}}function Sy(e,t){if(e.angle===0)return null;let r;return r=e.a[t]===0?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),r<0||r>1?null:function(i,a,c,f){const g=Math.sin(c);return i*(Math.sin((1-f)*c)/g)+a*(Math.sin(f*c)/g)}(e.a[t],e.b[t],e.angle,ke(r,0,1))+e.center[t]}function Ga(e){if(e.z<=1)return eI[e.z+2*e.y+e.x];const t=Cy(Zm(e));return On.fromPoints(t)}function zl(e,t,r){return s.v.scale(e,e,1-r),s.v.scaleAndAdd(e,e,t,r)}function i1(e,t){const r=Nl(t.zoom);if(r===0)return Ga(e);const i=Zm(e),a=Cy(i),c=ja(i.getWest())*t.worldSize,f=ja(i.getEast())*t.worldSize,g=qa(i.getNorth())*t.worldSize,y=qa(i.getSouth())*t.worldSize,x=[c,g,0],E=[f,g,0],S=[c,y,0],M=[f,y,0],A=s.m.invert([],t.globeMatrix);return s.v.transformMat4(x,x,A),s.v.transformMat4(E,E,A),s.v.transformMat4(S,S,A),s.v.transformMat4(M,M,A),a[0]=zl(a[0],S,r),a[1]=zl(a[1],M,r),a[2]=zl(a[2],E,r),a[3]=zl(a[3],x,r),On.fromPoints(a)}function o1(e,t,r){for(const i of e)s.v.transformMat4(i,i,t),s.v.scale(i,i,r)}function s1(e,t,r,i){const a=t/e.worldSize,c=e.globeMatrix;if(r.z<=1){const gt=Ga(r).getCorners();return o1(gt,c,a),On.fromPoints(gt)}const f=Zm(r,i),g=Cy(f);o1(g,c,a);const y=Number.MAX_VALUE,x=[-y,-y,-y],E=[y,y,y];if(f.contains(e.center)){for(const vt of g)s.v.min(E,E,vt),s.v.max(x,x,vt);x[2]=0;const gt=e.point,Et=[gt.x*a,gt.y*a,0];return s.v.min(E,E,Et),s.v.max(x,x,Et),new On(E,x)}const S=[c[12]*a,c[13]*a,c[14]*a],M=f.getCenter(),A=ke(e.center.lat,-Tn,Tn),L=ke(M.lat,-Tn,Tn),R=ja(e.center.lng),N=qa(A);let F=R-ja(M.lng);const W=N-qa(L);F>.5?F-=1:F<-.5&&(F+=1);let H=0;if(Math.abs(F)>Math.abs(W))H=F>=0?1:3;else{H=W>=0?0:2;const gt=[c[4]*a,c[5]*a,c[6]*a],Et=-Math.sin(ae(W>=0?f.getSouth():f.getNorth()))*ss;s.v.scaleAndAdd(S,S,gt,Et)}const $=g[H],Q=g[(H+1)%4],et=new rI($,Q,S),ct=[Sy(et,0)||$[0],Sy(et,1)||$[1],Sy(et,2)||$[2]],ft=Nl(e.zoom);if(ft>0){const gt=function({x:vt,y:Rt,z:Xt},Pt,Ut,Mt,oe){const de=1/(1<<Xt);let qt=vt*de,De=qt+de,_e=Rt*de,ne=_e+de,Re=0;const Ie=(qt+De)/2-Mt;return Ie>.5?Re=-1:Ie<-.5&&(Re=1),qt=((qt+Re)*Pt-(Mt*=Pt))*Ut+Mt,De=((De+Re)*Pt-Mt)*Ut+Mt,_e=(_e*Pt-(oe*=Pt))*Ut+oe,ne=(ne*Pt-oe)*Ut+oe,[[qt,ne,0],[De,ne,0],[De,_e,0],[qt,_e,0]]}(r,t,e._pixelsPerMercatorPixel,R,N);for(let vt=0;vt<g.length;vt++)zl(g[vt],gt[vt],ft);const Et=s.v.add([],gt[H],gt[(H+1)%4]);s.v.scale(Et,Et,.5),zl(ct,Et,ft)}for(const gt of g)s.v.min(E,E,gt),s.v.max(x,x,gt);return E[2]=Math.min($[2],Q[2]),s.v.min(E,E,ct),s.v.max(x,x,ct),new On(E,x)}function Zm({x:e,y:t,z:r},i=!1){const a=1/(1<<r),c=new Ar(No(e*a),t===(1<<r)-1&&i?-90:Ti((t+1)*a)),f=new Ar(No((e+1)*a),t===0&&i?90:Ti(t*a));return new yu(c,f)}function Cy(e){const t=ae(e.getNorth()),r=ae(e.getSouth()),i=Math.cos(t),a=Math.cos(r),c=Math.sin(t),f=Math.sin(r),g=e.getWest(),y=e.getEast();return[Xh(a,f,g),Xh(a,f,y),Xh(i,c,y),Xh(i,c,g)]}function Xh(e,t,r,i=ss){return r=ae(r),[e*Math.sin(r)*i,-t*i,e*Math.cos(r)*i]}function Tc(e,t,r){return Xh(Math.cos(ae(e)),Math.sin(ae(e)),t,r)}function qf(e,t,r,i){const a=1<<r.z,c=(e/ee+r.x)/a;return Tc(Ti((t/ee+r.y)/a),No(c),i)}function Xm({min:e,max:t}){return tI/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const a1=new Float64Array(16);function Zf(e){const t=Xm(e),r=s.m.fromScaling(a1,[t,t,t]);return s.m.translate(r,r,s.v.negate([],e.min))}function My(e){const t=s.m.fromTranslation(a1,e.min),r=1/Xm(e);return s.m.scale(t,t,[r,r,r])}function Ay(e){const t=ee/(2*Math.PI);return e/(2*Math.PI)/t}function l1(e,t){return ee/(512*Math.pow(2,e))*Xm(Ga(t))}function u1(e,t,r,i,a){const c=Ay(r),f=[e,t,-r/(2*Math.PI)],g=s.m.identity(new Float64Array(16));return s.m.translate(g,g,f),s.m.scale(g,g,[c,c,c]),s.m.rotateX(g,g,ae(-a)),s.m.rotateY(g,g,ae(-i)),g}function Nl(e){return Qn(Iy,r1,e)}function c1(e,t){const r=Tc(t.lat,t.lng),i=function(c){const f=Tc(c._center.lat,c._center.lng),g=s.v.fromValues(0,1,0);let y=s.v.cross([],g,f);const x=s.m.fromRotation([],-c.angle,f);y=s.v.transformMat4(y,y,x),s.m.fromRotation(x,-c._pitch,y);const E=s.v.normalize([],f);return s.v.scale(E,E,qm(c.cameraToCenterDistance/c.pixelsPerMeter)),s.v.transformMat4(E,E,x),s.v.add([],f,E)}(e),a=s.v.subtract([],i,r);return s.v.angle(a,r)}function Py(e,t){return c1(e,t)>Math.PI/2*1.01}const h1=ae(85),nI=Math.cos(h1),iI=Math.sin(h1),Xf=63710088e-1,Ly=2*Math.PI*Xf;class xu{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xu(ti(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,i=this.lat*r,a=t.lat*r,c=Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos((t.lng-this.lng)*r);return Xf*Math.acos(Math.min(c,1))}toBounds(t=0){const r=360*t/40075017,i=r/Math.cos(Math.PI/180*this.lat);return new yu(new xu(this.lng-i,this.lat-r),new xu(this.lng+i,this.lat+r))}toEcef(t){const r=qm(t);return Tc(this.lat,this.lng,ss+r)}static convert(t){if(t instanceof xu)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new xu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new xu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ar=xu;const oI=0,sI=25.5;function Dy(e){return Ly*Math.cos(e*Math.PI/180)}function ja(e){return(180+e)/360}function qa(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function so(e,t){return e/Dy(t)}function No(e){return 360*e-180}function Ti(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function p1(e,t){return e*Dy(Ti(t))}const Tn=85.051129;function f1(e){return Math.cos(ae(ke(e,-Tn,Tn)))}function Sc(e,t){const r=ke(t,oI,sI),i=Math.pow(2,r);return f1(e)*Ly/(512*i)}function d1(e){return 1/Math.cos(e*Math.PI/180)}function Wm(e,t=0){const r=Math.exp(Math.PI*(1-(e.y+t/ee)/(1<<e.z)*2));return 80150034*r/(r*r+1)/ee/(1<<e.z)}class Li{constructor(t,r,i=0){this.x=+t,this.y=+r,this.z=+i}static fromLngLat(t,r=0){const i=Ar.convert(t);return new Li(ja(i.lng),qa(i.lat),so(r,i.lat))}toLngLat(){return new Ar(No(this.x),Ti(this.y))}toAltitude(){return p1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ly*d1(Ti(this.y))}}function Ry(e,t,r,i,a,c,f,g,y){const x=(t+i)/2,E=(r+a)/2,S=new At(x,E);g(S),function(M,A,L,R,N,F){const W=L-N,H=R-F;return Math.abs((R-A)*W-(L-M)*H)/Math.hypot(W,H)}(S.x,S.y,c.x,c.y,f.x,f.y)>=y?(Ry(e,t,r,x,E,c,S,g,y),Ry(e,x,E,i,a,S,f,g,y)):e.push(f)}function m1(e,t,r){let i=e[0],a=i.x,c=i.y;t(i);const f=[i];for(let g=1;g<e.length;g++){const y=e[g],{x,y:E}=y;t(y),Ry(f,a,c,x,E,i,y,t,r),a=x,c=E,i=y}return f}function Oy(e,t,r,i){if(i(t,r)){const a=t.add(r)._mult(.5);Oy(e,t,a,i),Oy(e,a,r,i)}else e.push(r)}function aI(e,t){let r=e[0];const i=[r];for(let a=1;a<e.length;a++){const c=e[a];Oy(i,r,c,t),r=c}return i}const zy=Math.pow(2,14)-1,g1=-zy-1;function lI(e,t){const r=Math.round(e.x*t),i=Math.round(e.y*t);return e.x=ke(r,g1,zy),e.y=ke(i,g1,zy),(r<e.x||r>e.x+1||i<e.y||i>e.y+1)&&pn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Za(e,t,r){const i=e.loadGeometry(),a=e.extent,c=ee/a;if(t&&r&&r.projection.isReprojectedInTileSpace){const f=1<<t.z,{scale:g,x:y,y:x,projection:E}=r,S=M=>{const A=No((t.x+M.x/a)/f),L=Ti((t.y+M.y/a)/f),R=E.project(A,L);M.x=(R.x*g-y)*a,M.y=(R.y*g-x)*a};for(let M=0;M<i.length;M++)if(e.type!==1)i[M]=m1(i[M],S,1);else{const A=[];for(const L of i[M])L.x<0||L.x>=a||L.y<0||L.y>=a||(S(L),A.push(L));i[M]=A}}for(const f of i)for(const g of f)lI(g,c);return i}function bu(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Za(e):[]}}function Hm(e,t,r,i,a){e.emplaceBack(2*t+(i+1)/2,2*r+(a+1)/2)}function Ym(e,t,r){e.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ny{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Xe,this.indexArray=new Or,this.segments=new fn,this.programConfigurations=new _u(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,i,a){const c=this.layers[0],f=[];let g=null;c.type==="circle"&&(g=c.layout.get("circle-sort-key"));for(const{feature:x,id:E,index:S,sourceLayerIndex:M}of t){const A=this.layers[0]._featureFilter.needGeometry,L=bu(x,A);if(!this.layers[0]._featureFilter.filter(new ut(this.zoom),L,i))continue;const R=g?g.evaluate(L,{},i):void 0,N={id:E,properties:x.properties,type:x.type,sourceLayerIndex:M,index:S,geometry:A?L.geometry:Za(x,i,a),patterns:{},sortKey:R};f.push(N)}g&&f.sort((x,E)=>x.sortKey-E.sortKey);let y=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new nn,y=a.projection);for(const x of f){const{geometry:E,index:S,sourceLayerIndex:M}=x,A=t[S].feature;this.addFeature(x,E,S,r.availableImages,i,y,r.brightness),r.featureIndex.insert(A,E,S,M,this.index)}}update(t,r,i,a,c){const f=Object.keys(t).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,f?this.stateDependentLayers:this.layers,i,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,v2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,x2.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,r,i,a,c,f,g){for(const y of r)for(const x of y){const E=x.x,S=x.y;if(E<0||E>=ee||S<0||S>=ee)continue;if(f){const L=f.projectTilePoint(E,S,c),R=f.upVector(c,E,S),N=this.globeExtVertexArray;Ym(N,L,R),Ym(N,L,R),Ym(N,L,R),Ym(N,L,R)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=M.vertexLength;Hm(this.layoutVertexArray,E,S,-1,-1),Hm(this.layoutVertexArray,E,S,1,-1),Hm(this.layoutVertexArray,E,S,1,1),Hm(this.layoutVertexArray,E,S,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},a,c,g)}}function _1(e,t){for(let r=0;r<e.length;r++)if(Cc(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(Cc(e,t[r]))return!0;return!!ky(e,t)}function uI(e,t,r){return!!Cc(e,t)||!!Fy(t,e,r)}function y1(e,t){if(e.length===1)return x1(t,e[0]);for(let r=0;r<t.length;r++){const i=t[r];for(let a=0;a<i.length;a++)if(Cc(e,i[a]))return!0}for(let r=0;r<e.length;r++)if(x1(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(ky(e,t[r]))return!0;return!1}function cI(e,t,r){if(e.length>1){if(ky(e,t))return!0;for(let i=0;i<t.length;i++)if(Fy(t[i],e,r))return!0}for(let i=0;i<e.length;i++)if(Fy(e[i],t,r))return!0;return!1}function ky(e,t){if(e.length===0||t.length===0)return!1;for(let r=0;r<e.length-1;r++){const i=e[r],a=e[r+1];for(let c=0;c<t.length-1;c++)if(hI(i,a,t[c],t[c+1]))return!0}return!1}function hI(e,t,r,i){return $t(e,r,i)!==$t(t,r,i)&&$t(e,t,r)!==$t(e,t,i)}function Fy(e,t,r){const i=r*r;if(t.length===1)return e.distSqr(t[0])<i;for(let a=1;a<t.length;a++)if(v1(e,t[a-1],t[a])<i)return!0;return!1}function v1(e,t,r){const i=t.distSqr(r);if(i===0)return e.distSqr(t);const a=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/i;return e.distSqr(a<0?t:a>1?r:r.sub(t)._mult(a)._add(t))}function x1(e,t){let r,i,a,c=!1;for(let f=0;f<e.length;f++){r=e[f];for(let g=0,y=r.length-1;g<r.length;y=g++)i=r[g],a=r[y],i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(c=!c)}return c}function Cc(e,t){let r=!1;for(let i=0,a=e.length-1;i<e.length;a=i++){const c=e[i],f=e[a];c.y>t.y!=f.y>t.y&&t.x<(f.x-c.x)*(t.y-c.y)/(f.y-c.y)+c.x&&(r=!r)}return r}function b1(e,t,r,i,a){for(const f of e)if(t<=f.x&&r<=f.y&&i>=f.x&&a>=f.y)return!0;const c=[new At(t,r),new At(t,a),new At(i,a),new At(i,r)];if(e.length>2){for(const f of c)if(Cc(e,f))return!0}for(let f=0;f<e.length-1;f++)if(pI(e[f],e[f+1],c))return!0;return!1}function pI(e,t,r){const i=r[0],a=r[2];if(e.x<i.x&&t.x<i.x||e.x>a.x&&t.x>a.x||e.y<i.y&&t.y<i.y||e.y>a.y&&t.y>a.y)return!1;const c=$t(e,t,r[0]);return c!==$t(e,t,r[1])||c!==$t(e,t,r[2])||c!==$t(e,t,r[3])}function Wh(e,t,r,i,a,c){let f=t.y-e.y,g=e.x-t.x;if(c=c||0){const y=f*f+g*g;if(y===0)return!0;const x=Math.sqrt(y);f/=x,g/=x}return!((r.x-e.x)*f+(r.y-e.y)*g-c<0||(i.x-e.x)*f+(i.y-e.y)*g-c<0||(a.x-e.x)*f+(a.y-e.y)*g-c<0)}function By(e,t,r,i,a,c,f){return!(Wh(e,t,i,a,c,f)||Wh(t,r,i,a,c,f)||Wh(r,e,i,a,c,f)||Wh(i,a,e,t,r,f)||Wh(a,c,e,t,r,f)||Wh(c,i,e,t,r,f))}function Hh(e,t,r){const i=t.paint.get(e).value;return i.kind==="constant"?i.value:r.programConfigurations.get(t.id).getMaxValue(e)}function $m(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function w1(e,t,r,i,a){if(!t[0]&&!t[1])return e;const c=At.convert(t)._mult(a);r==="viewport"&&c._rotate(-i);const f=[];for(let g=0;g<e.length;g++)f.push(e[g].sub(c));return f}function E1(e,t,r,i){const a=At.convert(e)._mult(i);return t==="viewport"&&a._rotate(-r),a}me(Ny,"CircleBucket",{omit:["layers"]});const fI=new Ft({"circle-sort-key":new yt(bt.layout_circle["circle-sort-key"]),visibility:new tt(bt.layout_circle.visibility)});var dI={paint:new Ft({"circle-radius":new yt(bt.paint_circle["circle-radius"]),"circle-color":new yt(bt.paint_circle["circle-color"]),"circle-blur":new yt(bt.paint_circle["circle-blur"]),"circle-opacity":new yt(bt.paint_circle["circle-opacity"]),"circle-translate":new tt(bt.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yt(bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yt(bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yt(bt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new tt(bt.paint_circle["circle-emissive-strength"])}),layout:fI};const mI=s.m.create(),I1=e=>{const t=[];return e.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),e.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function T1(e,t,r,i,a,c,f,g,y){if(c&&e.queryGeometry.isAboveHorizon)return!1;c&&(y*=e.pixelToTileUnitsFactor);const x=e.tileID.canonical,E=r.projection.upVectorScale(x,r.center.lat,r.worldSize).metersToTile;for(const S of t)for(const M of S){const A=M.add(g),L=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(A.x,A.y,!0):0,R=r.projection.projectTilePoint(A.x,A.y,x);if(L>0){const H=r.projection.upVector(x,A.x,A.y);R.x+=H[0]*E*L,R.y+=H[1]*E*L,R.z+=H[2]*E*L}const N=c?A:gI(R.x,R.y,R.z,i),F=c?e.tilespaceRays.map(H=>yI(H,L)):e.queryGeometry.screenGeometry,W=s.e.transformMat4([],[R.x,R.y,R.z,1],i);if(!f&&c?y*=W[3]/r.cameraToCenterDistance:f&&!c&&(y*=r.cameraToCenterDistance/W[3]),c){const H=Ti((M.y/ee+x.y)/(1<<x.z));y/=r.projection.pixelsPerMeter(H,1)/so(1,H)}if(uI(F,N,y))return!0}return!1}function gI(e,t,r,i){const a=s.e.transformMat4([],[e,t,r,1],i);return new At(a[0]/a[3],a[1]/a[3])}const S1=s.v.fromValues(0,0,0),_I=s.v.fromValues(0,0,1);function yI(e,t){const r=s.v.create();return S1[2]=t,e.intersectsPlane(S1,_I,r),new At(r[0],r[1])}class C1 extends Ny{}function M1(e,{width:t,height:r},i,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==t*r*i)throw new RangeError("mismatched image size")}else a=new Uint8Array(t*r*i);return e.width=t,e.height=r,e.data=a,e}function A1(e,t,r){const{width:i,height:a}=t;i===e.width&&a===e.height||(Vy(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,i),height:Math.min(e.height,a)},r),e.width=i,e.height=a,e.data=t.data)}function Vy(e,t,r,i,a,c,f){if(a.width===0||a.height===0)return t;if(a.width>e.width||a.height>e.height||r.x>e.width-a.width||r.y>e.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const g=e.data,y=t.data,x=c===4&&f;for(let E=0;E<a.height;E++){const S=((r.y+E)*e.width+r.x)*c,M=((i.y+E)*t.width+i.x)*c;if(x)for(let A=0;A<a.width;A++){const L=S+A*c+3,R=M+A*c;y[R+0]=255,y[R+1]=255,y[R+2]=255,y[R+3]=g[L]}else for(let A=0;A<a.width*c;A++)y[M+A]=g[S+A]}return t}me(C1,"HeatmapBucket",{omit:["layers"]});class kl{constructor(t,r){M1(this,t,1,r)}resize(t){A1(this,new kl(t),1)}clone(){return new kl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,i,a,c){Vy(t,r,i,a,c,1)}}class as{constructor(t,r){M1(this,t,4,r)}resize(t){A1(this,new as(t),4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new as({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,i,a,c,f){Vy(t,r,i,a,c,4,f)}}class P1{constructor(t,r){this.width=t.width,this.height=t.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}me(kl,"AlphaImage"),me(as,"RGBAImage");const vI=new Ft({visibility:new tt(bt.layout_heatmap.visibility)});var xI={paint:new Ft({"heatmap-radius":new yt(bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yt(bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gt(bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(bt.paint_heatmap["heatmap-opacity"])}),layout:vI};function Jm(e){const t={},r=e.resolution||256,i=e.clips?e.clips.length:1,a=e.image||new as({width:r,height:i}),c=(f,g,y)=>{t[e.evaluationKey]=y;const x=e.expression.evaluate(t);x&&(a.data[f+g+0]=Math.floor(255*x.r/x.a),a.data[f+g+1]=Math.floor(255*x.g/x.a),a.data[f+g+2]=Math.floor(255*x.b/x.a),a.data[f+g+3]=Math.floor(255*x.a))};if(e.clips)for(let f=0,g=0;f<i;++f,g+=4*r)for(let y=0,x=0;y<r;y++,x+=4){const E=y/(r-1),{start:S,end:M}=e.clips[f];c(g,x,S*(1-E)+M*E)}else for(let f=0,g=0;f<r;f++,g+=4)c(0,g,f/(r-1));return a}const bI=new Ft({visibility:new tt(bt.layout_hillshade.visibility)});var wI={paint:new Ft({"hillshade-illumination-direction":new tt(bt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(bt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(bt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(bt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(bt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(bt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new tt(bt.paint_hillshade["hillshade-emissive-strength"])}),layout:bI};const EI=Ee([{name:"a_pos",components:2,type:"Int16"}],4),{members:II}=EI;var Uy={exports:{}};function Km(e,t,r){r=r||2;var i,a,c,f,g,y,x,E=t&&t.length,S=E?t[0]*r:e.length,M=L1(e,0,S,r,!0),A=[];if(!M||M.next===M.prev)return A;if(E&&(M=function(R,N,F,W){var H,$,Q,et=[];for(H=0,$=N.length;H<$;H++)(Q=L1(R,N[H]*W,H<$-1?N[H+1]*W:R.length,W,!1))===Q.next&&(Q.steiner=!0),et.push(DI(Q));for(et.sort(AI),H=0;H<et.length;H++)F=PI(et[H],F);return F}(e,t,M,r)),e.length>80*r){i=c=e[0],a=f=e[1];for(var L=r;L<S;L+=r)(g=e[L])<i&&(i=g),(y=e[L+1])<a&&(a=y),g>c&&(c=g),y>f&&(f=y);x=(x=Math.max(c-i,f-a))!==0?32767/x:0}return Wf(M,A,r,i,a,x,0),A}function L1(e,t,r,i,a){var c,f;if(a===qy(e,t,r,i)>0)for(c=t;c<r;c+=i)f=O1(c,e[c],e[c+1],f);else for(c=r-i;c>=t;c-=i)f=O1(c,e[c],e[c+1],f);return f&&Qm(f,f.next)&&(Yf(f),f=f.next),f}function Mc(e,t){if(!e)return e;t||(t=e);var r,i=e;do if(r=!1,i.steiner||!Qm(i,i.next)&&Wn(i.prev,i,i.next)!==0)i=i.next;else{if(Yf(i),(i=t=i.prev)===i.next)break;r=!0}while(r||i!==t);return t}function Wf(e,t,r,i,a,c,f){if(e){!f&&c&&function(E,S,M,A){var L=E;do L.z===0&&(L.z=Gy(L.x,L.y,S,M,A)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==E);L.prevZ.nextZ=null,L.prevZ=null,function(R){var N,F,W,H,$,Q,et,ct,ft=1;do{for(F=R,R=null,$=null,Q=0;F;){for(Q++,W=F,et=0,N=0;N<ft&&(et++,W=W.nextZ);N++);for(ct=ft;et>0||ct>0&&W;)et!==0&&(ct===0||!W||F.z<=W.z)?(H=F,F=F.nextZ,et--):(H=W,W=W.nextZ,ct--),$?$.nextZ=H:R=H,H.prevZ=$,$=H;F=W}$.nextZ=null,ft*=2}while(Q>1)}(L)}(e,i,a,c);for(var g,y,x=e;e.prev!==e.next;)if(g=e.prev,y=e.next,c?SI(e,i,a,c):TI(e))t.push(g.i/r|0),t.push(e.i/r|0),t.push(y.i/r|0),Yf(e),e=y.next,x=y.next;else if((e=y)===x){f?f===1?Wf(e=CI(Mc(e),t,r),t,r,i,a,c,2):f===2&&MI(e,t,r,i,a,c):Wf(Mc(e),t,r,i,a,c,1);break}}}function TI(e){var t=e.prev,r=e,i=e.next;if(Wn(t,r,i)>=0)return!1;for(var a=t.x,c=r.x,f=i.x,g=t.y,y=r.y,x=i.y,E=a<c?a<f?a:f:c<f?c:f,S=g<y?g<x?g:x:y<x?y:x,M=a>c?a>f?a:f:c>f?c:f,A=g>y?g>x?g:x:y>x?y:x,L=i.next;L!==t;){if(L.x>=E&&L.x<=M&&L.y>=S&&L.y<=A&&Yh(a,g,c,y,f,x,L.x,L.y)&&Wn(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function SI(e,t,r,i){var a=e.prev,c=e,f=e.next;if(Wn(a,c,f)>=0)return!1;for(var g=a.x,y=c.x,x=f.x,E=a.y,S=c.y,M=f.y,A=g<y?g<x?g:x:y<x?y:x,L=E<S?E<M?E:M:S<M?S:M,R=g>y?g>x?g:x:y>x?y:x,N=E>S?E>M?E:M:S>M?S:M,F=Gy(A,L,t,r,i),W=Gy(R,N,t,r,i),H=e.prevZ,$=e.nextZ;H&&H.z>=F&&$&&$.z<=W;){if(H.x>=A&&H.x<=R&&H.y>=L&&H.y<=N&&H!==a&&H!==f&&Yh(g,E,y,S,x,M,H.x,H.y)&&Wn(H.prev,H,H.next)>=0||(H=H.prevZ,$.x>=A&&$.x<=R&&$.y>=L&&$.y<=N&&$!==a&&$!==f&&Yh(g,E,y,S,x,M,$.x,$.y)&&Wn($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;H&&H.z>=F;){if(H.x>=A&&H.x<=R&&H.y>=L&&H.y<=N&&H!==a&&H!==f&&Yh(g,E,y,S,x,M,H.x,H.y)&&Wn(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;$&&$.z<=W;){if($.x>=A&&$.x<=R&&$.y>=L&&$.y<=N&&$!==a&&$!==f&&Yh(g,E,y,S,x,M,$.x,$.y)&&Wn($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function CI(e,t,r){var i=e;do{var a=i.prev,c=i.next.next;!Qm(a,c)&&D1(a,i,i.next,c)&&Hf(a,c)&&Hf(c,a)&&(t.push(a.i/r|0),t.push(i.i/r|0),t.push(c.i/r|0),Yf(i),Yf(i.next),i=e=c),i=i.next}while(i!==e);return Mc(i)}function MI(e,t,r,i,a,c){var f=e;do{for(var g=f.next.next;g!==f.prev;){if(f.i!==g.i&&RI(f,g)){var y=R1(f,g);return f=Mc(f,f.next),y=Mc(y,y.next),Wf(f,t,r,i,a,c,0),void Wf(y,t,r,i,a,c,0)}g=g.next}f=f.next}while(f!==e)}function AI(e,t){return e.x-t.x}function PI(e,t){var r=function(a,c){var f,g=c,y=a.x,x=a.y,E=-1/0;do{if(x<=g.y&&x>=g.next.y&&g.next.y!==g.y){var S=g.x+(x-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(S<=y&&S>E&&(E=S,f=g.x<g.next.x?g:g.next,S===y))return f}g=g.next}while(g!==c);if(!f)return null;var M,A=f,L=f.x,R=f.y,N=1/0;g=f;do y>=g.x&&g.x>=L&&y!==g.x&&Yh(x<R?y:E,x,L,R,x<R?E:y,x,g.x,g.y)&&(M=Math.abs(x-g.y)/(y-g.x),Hf(g,a)&&(M<N||M===N&&(g.x>f.x||g.x===f.x&&LI(f,g)))&&(f=g,N=M)),g=g.next;while(g!==A);return f}(e,t);if(!r)return t;var i=R1(r,e);return Mc(i,i.next),Mc(r,r.next)}function LI(e,t){return Wn(e.prev,e,t.prev)<0&&Wn(t.next,e,e.next)<0}function Gy(e,t,r,i,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function DI(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Yh(e,t,r,i,a,c,f,g){return(a-f)*(t-g)>=(e-f)*(c-g)&&(e-f)*(i-g)>=(r-f)*(t-g)&&(r-f)*(c-g)>=(a-f)*(i-g)}function RI(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,i){var a=r;do{if(a.i!==r.i&&a.next.i!==r.i&&a.i!==i.i&&a.next.i!==i.i&&D1(a,a.next,r,i))return!0;a=a.next}while(a!==r);return!1}(e,t)&&(Hf(e,t)&&Hf(t,e)&&function(r,i){var a=r,c=!1,f=(r.x+i.x)/2,g=(r.y+i.y)/2;do a.y>g!=a.next.y>g&&a.next.y!==a.y&&f<(a.next.x-a.x)*(g-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next;while(a!==r);return c}(e,t)&&(Wn(e.prev,e,t.prev)||Wn(e,t.prev,t))||Qm(e,t)&&Wn(e.prev,e,e.next)>0&&Wn(t.prev,t,t.next)>0)}function Wn(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Qm(e,t){return e.x===t.x&&e.y===t.y}function D1(e,t,r,i){var a=eg(Wn(e,t,r)),c=eg(Wn(e,t,i)),f=eg(Wn(r,i,e)),g=eg(Wn(r,i,t));return a!==c&&f!==g||!(a!==0||!tg(e,r,t))||!(c!==0||!tg(e,i,t))||!(f!==0||!tg(r,e,i))||!(g!==0||!tg(r,t,i))}function tg(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function eg(e){return e>0?1:e<0?-1:0}function Hf(e,t){return Wn(e.prev,e,e.next)<0?Wn(e,t,e.next)>=0&&Wn(e,e.prev,t)>=0:Wn(e,t,e.prev)<0||Wn(e,e.next,t)<0}function R1(e,t){var r=new jy(e.i,e.x,e.y),i=new jy(t.i,t.x,t.y),a=e.next,c=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,i.next=r,r.prev=i,c.next=i,i.prev=c,i}function O1(e,t,r,i){var a=new jy(e,t,r);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}function Yf(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jy(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qy(e,t,r,i){for(var a=0,c=t,f=r-i;c<r;c+=i)a+=(e[f]-e[c])*(e[c+1]+e[f+1]),f=c;return a}Uy.exports=Km,Uy.exports.default=Km,Km.deviation=function(e,t,r,i){var a=t&&t.length,c=Math.abs(qy(e,0,a?t[0]*r:e.length,r));if(a)for(var f=0,g=t.length;f<g;f++)c-=Math.abs(qy(e,t[f]*r,f<g-1?t[f+1]*r:e.length,r));var y=0;for(f=0;f<i.length;f+=3){var x=i[f]*r,E=i[f+1]*r,S=i[f+2]*r;y+=Math.abs((e[x]-e[S])*(e[E+1]-e[x+1])-(e[x]-e[E])*(e[S+1]-e[x+1]))}return c===0&&y===0?0:Math.abs((y-c)/c)},Km.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,a=0;a<e.length;a++){for(var c=0;c<e[a].length;c++)for(var f=0;f<t;f++)r.vertices.push(e[a][c][f]);a>0&&r.holes.push(i+=e[a-1].length)}return r};var rg=ue(Uy.exports);function Zy(e,t){const r=e.length;if(r<=1)return[e];const i=[];let a,c;for(let f=0;f<r;f++){const g=rt(e[f]);g!==0&&(e[f].area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(a&&i.push(a),a=[e[f]]):a.push(e[f]))}if(a&&i.push(a),t>1)for(let f=0;f<i.length;f++)i[f].length<=t||(Yd(i[f],t,1,i[f].length-1,OI),i[f]=i[f].slice(0,t));return i}function OI(e,t){return t.area-e.area}function Xy(e,t,r){const i=r.patternDependencies;let a=!1;for(const c of t){const f=c.paint.get(`${e}-pattern`);f.isConstant()||(a=!0);const g=f.constantOr(null);g&&(a=!0,i[g]=!0)}return a}function Wy(e,t,r,i,a){const c=a.patternDependencies;for(const f of t){const g=f.paint.get(`${e}-pattern`).value;if(g.kind!=="constant"){let y=g.evaluate({zoom:i},r,{},a.availableImages);y=y&&y.name?y.name:y,c[y]=!0,r.patterns[f.id]=y}}return r}class ng{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xe,this.indexArray=new Or,this.indexArray2=new Hi,this.programConfigurations=new _u(t.layers,t.zoom),this.segments=new fn,this.segments2=new fn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=t.projection}populate(t,r,i,a){this.hasPattern=Xy("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:g,id:y,index:x,sourceLayerIndex:E}of t){const S=this.layers[0]._featureFilter.needGeometry,M=bu(g,S);if(!this.layers[0]._featureFilter.filter(new ut(this.zoom),M,i))continue;const A=c?c.evaluate(M,{},i,r.availableImages):void 0,L={id:y,properties:g.properties,type:g.type,sourceLayerIndex:E,index:x,geometry:S?M.geometry:Za(g,i,a),patterns:{},sortKey:A};f.push(L)}c&&f.sort((g,y)=>g.sortKey-y.sortKey);for(const g of f){const{geometry:y,index:x,sourceLayerIndex:E}=g;if(this.hasPattern){const S=Wy("fill",this.layers,g,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(g,y,x,i,{},r.availableImages,r.brightness);r.featureIndex.insert(t[x].feature,y,x,E,this.index)}}update(t,r,i,a,c){const f=Object.keys(t).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,f?this.stateDependentLayers:this.layers,i,a,c)}addFeatures(t,r,i,a,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,i,a,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,II),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,i,a,c,f=[],g){for(const y of Zy(r,500)){let x=0;for(const R of y)x+=R.length;const E=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),S=E.vertexLength,M=[],A=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&A.push(M.length/2);const N=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),F=N.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(F+R.length-1,F),M.push(R[0].x),M.push(R[0].y);for(let W=1;W<R.length;W++)this.layoutVertexArray.emplaceBack(R[W].x,R[W].y),this.indexArray2.emplaceBack(F+W-1,F+W),M.push(R[W].x),M.push(R[W].y);N.vertexLength+=R.length,N.primitiveLength+=R.length}const L=rg(M,A);for(let R=0;R<L.length;R+=3)this.indexArray.emplaceBack(S+L[R],S+L[R+1],S+L[R+2]);E.vertexLength+=x,E.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,c,f,a,g)}}me(ng,"FillBucket",{omit:["layers","patternFeatures"]});const zI=new Ft({"fill-sort-key":new yt(bt.layout_fill["fill-sort-key"]),visibility:new tt(bt.layout_fill.visibility)});var NI={paint:new Ft({"fill-antialias":new tt(bt.paint_fill["fill-antialias"]),"fill-opacity":new yt(bt.paint_fill["fill-opacity"]),"fill-color":new yt(bt.paint_fill["fill-color"]),"fill-outline-color":new yt(bt.paint_fill["fill-outline-color"]),"fill-translate":new tt(bt.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new yt(bt.paint_fill["fill-pattern"]),"fill-emissive-strength":new tt(bt.paint_fill["fill-emissive-strength"])}),layout:zI};const kI=Ee([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),FI=Ee([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),BI=Ee([{name:"a_centroid_pos",components:2,type:"Uint16"}]),VI=Ee([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),UI=Ee([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:GI}=kI;var ig={},jI=rr,z1=$h;function $h(e,t,r,i,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=a,e.readFields(qI,this,t)}function qI(e,t,r){e==1?t.id=r.readVarint():e==2?function(i,a){for(var c=i.readVarint()+i.pos;i.pos<c;){var f=a._keys[i.readVarint()],g=a._values[i.readVarint()];a.properties[f]=g}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function ZI(e){for(var t,r,i=0,a=0,c=e.length,f=c-1;a<c;f=a++)i+=((r=e[f]).x-(t=e[a]).x)*(t.y+r.y);return i}$h.types=["Unknown","Point","LineString","Polygon"],$h.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,a=0,c=0,f=0,g=[];e.pos<r;){if(a<=0){var y=e.readVarint();i=7&y,a=y>>3}if(a--,i===1||i===2)c+=e.readSVarint(),f+=e.readSVarint(),i===1&&(t&&g.push(t),t=[]),t.push(new jI(c,f));else{if(i!==7)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&g.push(t),g},$h.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,a=0,c=0,f=1/0,g=-1/0,y=1/0,x=-1/0;e.pos<t;){if(i<=0){var E=e.readVarint();r=7&E,i=E>>3}if(i--,r===1||r===2)(a+=e.readSVarint())<f&&(f=a),a>g&&(g=a),(c+=e.readSVarint())<y&&(y=c),c>x&&(x=c);else if(r!==7)throw new Error("unknown command "+r)}return[f,y,g,x]},$h.prototype.toGeoJSON=function(e,t,r){var i,a,c=this.extent*Math.pow(2,r),f=this.extent*e,g=this.extent*t,y=this.loadGeometry(),x=$h.types[this.type];function E(A){for(var L=0;L<A.length;L++){var R=A[L];A[L]=[360*(R.x+f)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(R.y+g)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(i=0;i<y.length;i++)S[i]=y[i][0];E(y=S);break;case 2:for(i=0;i<y.length;i++)E(y[i]);break;case 3:for(y=function(A){var L=A.length;if(L<=1)return[A];for(var R,N,F=[],W=0;W<L;W++){var H=ZI(A[W]);H!==0&&(N===void 0&&(N=H<0),N===H<0?(R&&F.push(R),R=[A[W]]):R.push(A[W]))}return R&&F.push(R),F}(y),i=0;i<y.length;i++)for(a=0;a<y[i].length;a++)E(y[i][a])}y.length===1?y=y[0]:x="Multi"+x;var M={type:"Feature",geometry:{type:x,coordinates:y},properties:this.properties};return"id"in this&&(M.id=this.id),M};var XI=z1,N1=k1;function k1(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(WI,this,t),this.length=this._features.length}function WI(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(i){for(var a=null,c=i.readVarint()+i.pos;i.pos<c;){var f=i.readVarint()>>3;a=f===1?i.readString():f===2?i.readFloat():f===3?i.readDouble():f===4?i.readVarint64():f===5?i.readVarint():f===6?i.readSVarint():f===7?i.readBoolean():null}return a}(r))}k1.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new XI(this._pbf,t,this.extent,this._keys,this._values)};var HI=N1;function YI(e,t,r){if(e===3){var i=new HI(r,r.readVarint()+r.pos);i.length&&(t[i.name]=i)}}var Hy=ig.VectorTile=function(e,t){this.layers=e.readFields(YI,{},t)},og=ig.VectorTileFeature=z1;function sg(e,t,r,i){const a=[],c=i===0?(f,g,y,x,E,S)=>{f.push(new At(S,y+(S-g)/(x-g)*(E-y)))}:(f,g,y,x,E,S)=>{f.push(new At(g+(S-y)/(E-y)*(x-g),S))};for(const f of e){const g=[];for(const y of f){if(y.length<=2)continue;const x=[];for(let M=0;M<y.length-1;M++){const A=y[M].x,L=y[M].y,R=y[M+1].x,N=y[M+1].y,F=i===0?A:L,W=i===0?R:N;F<t?W>t&&c(x,A,L,R,N,t):F>r?W<r&&c(x,A,L,R,N,r):x.push(y[M]),W<t&&F>=t&&c(x,A,L,R,N,t),W>r&&F<=r&&c(x,A,L,R,N,r)}let E=y[y.length-1];const S=i===0?E.x:E.y;S>=t&&S<=r&&x.push(E),x.length&&(E=x[x.length-1],x[0].x===E.x&&x[0].y===E.y||x.push(x[0]),g.push(x))}g.length&&a.push(g)}return a}ig.VectorTileLayer=N1;class F1{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const i=t[r];this._stringToNumber[i]=r,this._numberToString[r]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var $I={read:function(e,t,r,i,a){var c,f,g=8*a-i-1,y=(1<<g)-1,x=y>>1,E=-7,S=r?a-1:0,M=r?-1:1,A=e[t+S];for(S+=M,c=A&(1<<-E)-1,A>>=-E,E+=g;E>0;c=256*c+e[t+S],S+=M,E-=8);for(f=c&(1<<-E)-1,c>>=-E,E+=i;E>0;f=256*f+e[t+S],S+=M,E-=8);if(c===0)c=1-x;else{if(c===y)return f?NaN:1/0*(A?-1:1);f+=Math.pow(2,i),c-=x}return(A?-1:1)*f*Math.pow(2,c-i)},write:function(e,t,r,i,a,c){var f,g,y,x=8*c-a-1,E=(1<<x)-1,S=E>>1,M=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=i?0:c-1,L=i?1:-1,R=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(g=isNaN(t)?1:0,f=E):(f=Math.floor(Math.log(t)/Math.LN2),t*(y=Math.pow(2,-f))<1&&(f--,y*=2),(t+=f+S>=1?M/y:M*Math.pow(2,1-S))*y>=2&&(f++,y/=2),f+S>=E?(g=0,f=E):f+S>=1?(g=(t*y-1)*Math.pow(2,a),f+=S):(g=t*Math.pow(2,S-1)*Math.pow(2,a),f=0));a>=8;e[r+A]=255&g,A+=L,g/=256,a-=8);for(f=f<<a|g,x+=a;x>0;e[r+A]=255&f,A+=L,f/=256,x-=8);e[r+A-L]|=128*R}},B1=on,ag=$I;function on(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}on.Varint=0,on.Fixed64=1,on.Bytes=2,on.Fixed32=5;var Yy=4294967296,V1=1/Yy,U1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Fl(e){return e.type===on.Bytes?e.readVarint()+e.pos:e.pos+1}function Jh(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function G1(e,t,r){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(i);for(var a=r.pos-1;a>=e;a--)r.buf[a+i]=r.buf[a]}function JI(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function KI(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function QI(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function tT(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function eT(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function rT(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function nT(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function iT(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function oT(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function lg(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Kh(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function j1(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}on.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),a=i>>3,c=this.pos;this.type=7&i,e(a,t,this),this.pos===c&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=lg(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=j1(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=lg(this.buf,this.pos)+lg(this.buf,this.pos+4)*Yy;return this.pos+=8,e},readSFixed64:function(){var e=lg(this.buf,this.pos)+j1(this.buf,this.pos+4)*Yy;return this.pos+=8,e},readFloat:function(){var e=ag.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=ag.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,i=this.buf;return t=127&(r=i[this.pos++]),r<128?t:(t|=(127&(r=i[this.pos++]))<<7,r<128?t:(t|=(127&(r=i[this.pos++]))<<14,r<128?t:(t|=(127&(r=i[this.pos++]))<<21,r<128?t:function(a,c,f){var g,y,x=f.buf;if(g=(112&(y=x[f.pos++]))>>4,y<128||(g|=(127&(y=x[f.pos++]))<<3,y<128)||(g|=(127&(y=x[f.pos++]))<<10,y<128)||(g|=(127&(y=x[f.pos++]))<<17,y<128)||(g|=(127&(y=x[f.pos++]))<<24,y<128)||(g|=(1&(y=x[f.pos++]))<<31,y<128))return Jh(a,g,c);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&U1?function(r,i,a){return U1.decode(r.subarray(i,a))}(this.buf,t,e):function(r,i,a){for(var c="",f=i;f<a;){var g,y,x,E=r[f],S=null,M=E>239?4:E>223?3:E>191?2:1;if(f+M>a)break;M===1?E<128&&(S=E):M===2?(192&(g=r[f+1]))==128&&(S=(31&E)<<6|63&g)<=127&&(S=null):M===3?(y=r[f+2],(192&(g=r[f+1]))==128&&(192&y)==128&&((S=(15&E)<<12|(63&g)<<6|63&y)<=2047||S>=55296&&S<=57343)&&(S=null)):M===4&&(y=r[f+2],x=r[f+3],(192&(g=r[f+1]))==128&&(192&y)==128&&(192&x)==128&&((S=(15&E)<<18|(63&g)<<12|(63&y)<<6|63&x)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,M=1):S>65535&&(S-=65536,c+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),c+=String.fromCharCode(S),f+=M}return c}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==on.Bytes)return e.push(this.readVarint(t));var r=Fl(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==on.Bytes)return e.push(this.readSVarint());var t=Fl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==on.Bytes)return e.push(this.readBoolean());var t=Fl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==on.Bytes)return e.push(this.readFloat());var t=Fl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==on.Bytes)return e.push(this.readDouble());var t=Fl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==on.Bytes)return e.push(this.readFixed32());var t=Fl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==on.Bytes)return e.push(this.readSFixed32());var t=Fl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==on.Bytes)return e.push(this.readFixed64());var t=Fl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==on.Bytes)return e.push(this.readSFixed64());var t=Fl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===on.Varint)for(;this.buf[this.pos++]>127;);else if(t===on.Bytes)this.pos=this.readVarint()+this.pos;else if(t===on.Fixed32)this.pos+=4;else{if(t!==on.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Kh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Kh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Kh(this.buf,-1&e,this.pos),Kh(this.buf,Math.floor(e*V1),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Kh(this.buf,-1&e,this.pos),Kh(this.buf,Math.floor(e*V1),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var i,a;if(t>=0?(i=t%4294967296|0,a=t/4294967296|0):(a=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,a=a+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(c,f,g){g.buf[g.pos++]=127&c|128,c>>>=7,g.buf[g.pos++]=127&c|128,c>>>=7,g.buf[g.pos++]=127&c|128,c>>>=7,g.buf[g.pos++]=127&c|128,g.buf[g.pos]=127&(c>>>=7)}(i,0,r),function(c,f){var g=(7&c)<<4;f.buf[f.pos++]|=g|((c>>>=3)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c|((c>>>=7)?128:0),c&&(f.buf[f.pos++]=127&c)))))}(a,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(i,a,c){for(var f,g,y=0;y<a.length;y++){if((f=a.charCodeAt(y))>55295&&f<57344){if(!g){f>56319||y+1===a.length?(i[c++]=239,i[c++]=191,i[c++]=189):g=f;continue}if(f<56320){i[c++]=239,i[c++]=191,i[c++]=189,g=f;continue}f=g-55296<<10|f-56320|65536,g=null}else g&&(i[c++]=239,i[c++]=191,i[c++]=189,g=null);f<128?i[c++]=f:(f<2048?i[c++]=f>>6|192:(f<65536?i[c++]=f>>12|224:(i[c++]=f>>18|240,i[c++]=f>>12&63|128),i[c++]=f>>6&63|128),i[c++]=63&f|128)}return c}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&G1(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),ag.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ag.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var i=this.pos-r;i>=128&&G1(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,r){this.writeTag(e,on.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,JI,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,KI,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,eT,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,QI,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,tT,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,rT,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,nT,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,iT,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,oT,t)},writeBytesField:function(e,t){this.writeTag(e,on.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,on.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,on.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,on.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,on.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,on.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,on.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,on.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,on.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,on.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var ug=ue(B1);const sT=["tile","layer","source","sourceLayer","state"];class q1{constructor(t,r,i,a,c){this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=i,this._y=a,this.properties=t.properties,this.id=c}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const r of sT)this[r]!==void 0&&(t[r]=this[r]);return t}}class aT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,i){const a=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][a]=this.stateChanges[t][a]||{},Qr(this.stateChanges[t][a],i),this.deletedStates[t]===null){this.deletedStates[t]={};for(const c in this.state[t])c!==a&&(this.deletedStates[t][c]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][a]===null){this.deletedStates[t][a]={};for(const c in this.state[t][a])i[c]||(this.deletedStates[t][a][c]=null)}else for(const c in i)this.deletedStates[t]&&this.deletedStates[t][a]&&this.deletedStates[t][a][c]===null&&delete this.deletedStates[t][a][c]}removeFeatureState(t,r,i){if(this.deletedStates[t]===null)return;const a=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&r!==void 0)this.deletedStates[t][a]!==null&&(this.deletedStates[t][a]=this.deletedStates[t][a]||{},this.deletedStates[t][a][i]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][a])for(i in this.deletedStates[t][a]={},this.stateChanges[t][a])this.deletedStates[t][a][i]=null;else this.deletedStates[t][a]=null;else this.deletedStates[t]=null}getState(t,r){const i=String(r),a=Qr({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const c=this.deletedStates[t][r];if(c===null)return{};for(const f in c)delete a[f]}return a}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const i={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const c={};for(const f in this.stateChanges[a])this.state[a][f]||(this.state[a][f]={}),Qr(this.state[a][f],this.stateChanges[a][f]),c[f]=this.state[a][f];i[a]=c}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const c={};if(this.deletedStates[a]===null)for(const f in this.state[a])c[f]={},this.state[a][f]={};else for(const f in this.deletedStates[a]){if(this.deletedStates[a][f]===null)this.state[a][f]={};else if(this.state[a][f])for(const g of Object.keys(this.deletedStates[a][f]))delete this.state[a][f][g];c[f]=this.state[a][f]}i[a]=i[a]||{},Qr(i[a],c)}if(this.stateChanges={},this.deletedStates={},Object.keys(i).length!==0)for(const a in t)t[a].setFeatureState(i,r)}}class Z1{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,r){const i=this.toIdx(t,r);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,r){return this.leaves[this.toIdx(t,r)]}toIdx(t,r){return r*this.size+t}}function X1(e,t,r,i){let a=0,c=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(i[f])<1e-15){if(r[f]<e[f]||r[f]>t[f])return null}else{const g=1/i[f];let y=(e[f]-r[f])*g,x=(t[f]-r[f])*g;if(y>x){const E=y;y=x,x=E}if(y>a&&(a=y),x<c&&(c=x),a>c)return null}return a}function W1(e,t,r,i,a,c,f,g,y,x,E){const S=i-e,M=a-t,A=c-r,L=f-e,R=g-t,N=y-r,F=E[1]*N-E[2]*R,W=E[2]*L-E[0]*N,H=E[0]*R-E[1]*L,$=S*F+M*W+A*H;if(Math.abs($)<1e-15)return null;const Q=1/$,et=x[0]-e,ct=x[1]-t,ft=x[2]-r,gt=(et*F+ct*W+ft*H)*Q;if(gt<0||gt>1)return null;const Et=ct*A-ft*M,vt=ft*S-et*A,Rt=et*M-ct*S,Xt=(E[0]*Et+E[1]*vt+E[2]*Rt)*Q;return Xt<0||gt+Xt>1?null:(L*Et+R*vt+N*Rt)*Q}function H1(e,t,r){return(e-t)/(r-t)}function Y1(e,t,r,i,a,c,f,g,y){const x=1<<r,E=c-i,S=f-a,M=(e+1)/x*E+i,A=(t+0)/x*S+a,L=(t+1)/x*S+a;g[0]=(e+0)/x*E+i,g[1]=A,y[0]=M,y[1]=L}class $1{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(c){const f=Math.ceil(Math.log2(c.dim/8)),g=[];let y=Math.ceil(Math.pow(2,f));const x=1/y,E=(A,L,R,N,F)=>{const W=N?1:0,H=(A+1)*R-W,$=L*R,Q=(L+1)*R-W;F[0]=A*R,F[1]=$,F[2]=H,F[3]=Q};let S=new Z1(y);const M=[];for(let A=0;A<y*y;A++){E(A%y,Math.floor(A/y),x,!1,M);const L=wu(M[0],M[1],c),R=wu(M[2],M[1],c),N=wu(M[2],M[3],c),F=wu(M[0],M[3],c);S.minimums.push(Math.min(L,R,N,F)),S.maximums.push(Math.max(L,R,N,F)),S.leaves.push(1)}for(g.push(S),y/=2;y>=1;y/=2){const A=g[g.length-1];S=new Z1(y);for(let L=0;L<y*y;L++){E(L%y,Math.floor(L/y),2,!0,M);const R=A.getElevation(M[0],M[1]),N=A.getElevation(M[2],M[1]),F=A.getElevation(M[2],M[3]),W=A.getElevation(M[0],M[3]),H=A.isLeaf(M[0],M[1]),$=A.isLeaf(M[2],M[1]),Q=A.isLeaf(M[2],M[3]),et=A.isLeaf(M[0],M[3]),ct=Math.min(R.min,N.min,F.min,W.min),ft=Math.max(R.max,N.max,F.max,W.max),gt=H&&$&&Q&&et;S.maximums.push(ft),S.minimums.push(ct),S.leaves.push(ft-ct<=5&&gt?1:0)}g.push(S)}return g}(this.dem),i=r.length-1,a=r[i];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(r,0,0,i,0)}raycastRoot(t,r,i,a,c,f,g=1){return X1([t,r,-100],[i,a,this.maximums[0]*g],c,f)}raycast(t,r,i,a,c,f,g=1){if(!this.nodeCount)return null;const y=this.raycastRoot(t,r,i,a,c,f,g);if(y==null)return null;const x=[],E=[],S=[],M=[],A=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;A.length>0;){const{idx:L,t:R,nodex:N,nodey:F,depth:W}=A.pop();if(this.leaves[L]){Y1(N,F,W,t,r,i,a,S,M);const $=1<<W,Q=(N+0)/$,et=(N+1)/$,ct=(F+0)/$,ft=(F+1)/$,gt=wu(Q,ct,this.dem)*g,Et=wu(et,ct,this.dem)*g,vt=wu(et,ft,this.dem)*g,Rt=wu(Q,ft,this.dem)*g,Xt=W1(S[0],S[1],gt,M[0],S[1],Et,M[0],M[1],vt,c,f),Pt=W1(M[0],M[1],vt,S[0],M[1],Rt,S[0],S[1],gt,c,f),Ut=Math.min(Xt!==null?Xt:Number.MAX_VALUE,Pt!==null?Pt:Number.MAX_VALUE);if(Ut!==Number.MAX_VALUE)return Ut;{const Mt=s.v.scaleAndAdd([],c,f,R);if(J1(gt,Et,Rt,vt,H1(Mt[0],S[0],M[0]),H1(Mt[1],S[1],M[1]))>=Mt[2])return R}continue}let H=0;for(let $=0;$<this._siblingOffset.length;$++){Y1((N<<1)+this._siblingOffset[$][0],(F<<1)+this._siblingOffset[$][1],W+1,t,r,i,a,S,M),S[2]=-100,M[2]=this.maximums[this.childOffsets[L]+$]*g;const Q=X1(S,M,c,f);if(Q!=null){const et=Q;x[$]=et;let ct=!1;for(let ft=0;ft<H&&!ct;ft++)et>=x[E[ft]]&&(E.splice(ft,0,$),ct=!0);ct||(E[H]=$),H++}}for(let $=0;$<H;$++){const Q=E[$];A.push({idx:this.childOffsets[L]+Q,t:x[Q],nodex:(N<<1)+this._siblingOffset[Q][0],nodey:(F<<1)+this._siblingOffset[Q][1],depth:W+1})}}return null}_addNode(t,r,i){return this.minimums.push(t),this.maximums.push(r),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,r,i,a,c){if(t[a].isLeaf(r,i)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const f=a-1,g=t[f];let y=0,x=0;for(let E=0;E<this._siblingOffset.length;E++){const S=2*r+this._siblingOffset[E][0],M=2*i+this._siblingOffset[E][1],A=g.getElevation(S,M),L=g.isLeaf(S,M),R=this._addNode(A.min,A.max,L);L&&(y|=1<<E),x||(x=R)}for(let E=0;E<this._siblingOffset.length;E++)y&1<<E||this._construct(t,2*r+this._siblingOffset[E][0],2*i+this._siblingOffset[E][1],f,x+E)}}function J1(e,t,r,i,a,c){return nr(nr(e,r,c),nr(t,i,c),a)}function wu(e,t,r){const i=r.dim,a=ke(e*i-.5,0,i-1),c=ke(t*i-.5,0,i-1),f=Math.floor(a),g=Math.floor(c),y=Math.min(f+1,i-1),x=Math.min(g+1,i-1);return J1(r.get(f,g),r.get(y,g),r.get(f,x),r.get(y,x),a-f,c-g)}const lT={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function uT(e,t,r){return(256*e*256+256*t+r)/10-1e4}function cT(e,t,r){return 256*e+t+r/256-32768}class cg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,r,i,a=!1){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(i&&i!=="mapbox"&&i!=="terrarium")return pn(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const c=this.dim=r.height-2,f=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let y=0;y<c;y++)f[this._idx(-1,y)]=f[this._idx(0,y)],f[this._idx(c,y)]=f[this._idx(c-1,y)],f[this._idx(y,-1)]=f[this._idx(y,0)],f[this._idx(y,c)]=f[this._idx(y,c-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(c,-1)]=f[this._idx(c-1,0)],f[this._idx(-1,c)]=f[this._idx(0,c-1)],f[this._idx(c,c)]=f[this._idx(c-1,c-1)]}const g=i==="terrarium"?cT:uT;for(let y=0;y<f.length;++y){const x=4*y;this.floatView[y]=g(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=ji.now()}_buildQuadTree(){this._tree=new $1(this)}get(t,r,i=!1){i&&(t=ke(t,-1,this.dim),r=ke(r,-1,this.dim));const a=this._idx(t,r);return this.floatView[a]}set(t,r,i){const a=this._idx(t,r),c=this.floatView[a];return this.floatView[a]=i,i-c}static getUnpackVector(t){return lT[t]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}static pack(t,r){const i=[0,0,0,0],a=cg.getUnpackVector(r);let c=Math.floor((t+a[3])/a[2]);return i[2]=c%256,c=Math.floor(c/256),i[1]=c%256,c=Math.floor(c/256),i[0]=c,i}getPixels(){return new P1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,r,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let a=r*this.dim,c=r*this.dim+this.dim,f=i*this.dim,g=i*this.dim+this.dim;switch(r){case-1:a=c-1;break;case 1:c=a+1}switch(i){case-1:f=g-1;break;case 1:g=f+1}const y=-r*this.dim,x=-i*this.dim;for(let E=f;E<g;E++)for(let S=a;S<c;S++){const M=4*this._idx(S,E),A=4*this._idx(S+y,E+x);this.pixels[M+0]=t.pixels[A+0],this.pixels[M+1]=t.pixels[A+1],this.pixels[M+2]=t.pixels[A+2],this.pixels[M+3]=t.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}me(cg,"DEMData"),me($1,"DemMinMaxQuadTree",{omit:["dem"]});class Qh{constructor(t,r,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=i}static create(t,r,i){const a=i||t.findDEMTileFor(r);if(!a||!a.dem)return;const c=a.dem,f=a.tileID,g=1<<r.canonical.z-f.canonical.z;return new Qh(a,c.dim/ee/g,[(r.canonical.x/g-f.canonical.x)*c.dim,(r.canonical.y/g-f.canonical.y)*c.dim])}tileCoordToPixel(t,r){const i=r*this._scale+this._offset[1],a=Math.floor(t*this._scale+this._offset[0]),c=Math.floor(i);return new At(a,c)}getElevationAt(t,r,i,a){const c=t*this._scale+this._offset[0],f=r*this._scale+this._offset[1],g=Math.floor(c),y=Math.floor(f),x=this._dem;return a=!!a,i?nr(nr(x.get(g,y,a),x.get(g,y+1,a),f-y),nr(x.get(g+1,y,a),x.get(g+1,y+1,a),f-y),c-g):x.get(g,y,a)}getElevationAtPixel(t,r,i){return this._dem.get(t,r,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*so(1,t)*this._dem.stride}}class $y{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new mu(ee,16,0),this.featureIndexArray=new C0,this.promoteId=r}insert(t,r,i,a,c,f=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,a,c,f);const y=this.grid;for(let x=0;x<r.length;x++){const E=r[x],S=[1/0,1/0,-1/0,-1/0];for(let M=0;M<E.length;M++){const A=E[M];S[0]=Math.min(S[0],A.x),S[1]=Math.min(S[1],A.y),S[2]=Math.max(S[2],A.x),S[3]=Math.max(S[3],A.y)}S[0]<ee&&S[1]<ee&&S[2]>=0&&S[3]>=0&&y.insert(g,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Hy(new ug(this.rawTileData)).layers,this.sourceLayerCoder=new F1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,r,i,a){this.loadVTLayers();const c=t.params||{},f=Fh(c.filter),g=t.tileResult,y=t.transform,x=g.bufferedTilespaceBounds,E=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(L,R,N,F)=>b1(g.bufferedTilespaceGeometry,L,R,N,F));E.sort(hT);let S=null;y.elevation&&E.length>0&&(S=Qh.create(y.elevation,this.tileID));const M={};let A;for(let L=0;L<E.length;L++){const R=E[L];if(R===A)continue;A=R;const N=this.featureIndexArray.get(R);let F=null;this.loadMatchingFeature(M,N,f,c.layers,c.availableImages,r,i,a,(W,H,$,Q=0)=>(F||(F=Za(W,this.tileID.canonical,t.tileTransform)),H.queryIntersectsFeature(g,W,$,F,this.z,t.transform,t.pixelPosMatrix,S,Q)))}return M}loadMatchingFeature(t,r,i,a,c,f,g,y,x){const{featureIndex:E,bucketIndex:S,sourceLayerIndex:M,layoutVertexArrayOffset:A}=r,L=this.bucketLayerIDs[S];if(a&&!function(W,H){for(let $=0;$<W.length;$++)if(H.indexOf(W[$])>=0)return!0;return!1}(a,L))return;const R=this.sourceLayerCoder.decode(M),N=this.vtLayers[R].feature(E);if(i.needGeometry){const W=bu(N,!0);if(!i.filter(new ut(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!i.filter(new ut(this.tileID.overscaledZ),N))return;const F=this.getId(N,R);for(let W=0;W<L.length;W++){const H=L[W];if(a&&a.indexOf(H)<0)continue;const $=f[H];if(!$)continue;let Q={};F!==void 0&&y&&(Q=y.getState($.sourceLayer||"_geojsonTileLayer",F));const et=Qr({},g[H]);et.paint=K1(et.paint,$.paint,N,Q,c),et.layout=K1(et.layout,$.layout,N,Q,c);const ct=!x||x(N,$,Q,A);if(!ct)continue;const ft=new q1(N,this.z,this.x,this.y,F);ft.layer=et;let gt=t[H];gt===void 0&&(gt=t[H]=[]),gt.push({featureIndex:E,feature:ft,intersectionZ:ct})}}lookupSymbolFeatures(t,r,i,a,c,f,g,y){const x={};this.loadVTLayers();const E=Fh(c);for(const S of t)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:a,featureIndex:S,layoutVertexArrayOffset:0},E,f,g,y,r);return x}loadFeature(t){const{featureIndex:r,sourceLayerIndex:i}=t;this.loadVTLayers();const a=this.sourceLayerCoder.decode(i),c=this.vtFeatures[a];if(c[r])return c[r];const f=this.vtLayers[a].feature(r);return c[r]=f,f}hasLayer(t){for(const r of this.bucketLayerIDs)for(const i of r)if(t===i)return!0;return!1}getId(t,r){let i=t.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];a!=null&&(i=t.properties[a]),typeof i=="boolean"&&(i=Number(i))}return i}}function K1(e,t,r,i,a){return Hu(e,(c,f)=>{const g=t instanceof zt?t.get(f):null;return g&&g.evaluate?g.evaluate(r,i,a):g})}function hT(e,t){return t-e}me($y,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const pT=Ee([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fT=Ee([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),dT=Ee([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ee([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const mT=Ee([{name:"a_z_offset",components:1,type:"Float32"}],4),gT=Ee([{name:"a_texb",components:2,type:"Uint16"}]),_T=Ee([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),yT=Ee([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Ee([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Q1=Ee([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vT=Ee([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ee([{name:"triangle",components:3,type:"Uint16"}]),Ee([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ee([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ee([{type:"Float32",name:"offsetX"}]),Ee([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Si=24;const aa=128;function Jy(e,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ut(e+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:i,interpolationType:a}=r;let c=0;for(;c<i.length&&i[c]<=e;)c++;c=Math.max(0,c-1);let f=c;for(;f<i.length&&i[f]<e+1;)f++;f=Math.min(i.length-1,f);const g=i[c],y=i[f];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:y,interpolationType:a}:{kind:"camera",minZoom:g,maxZoom:y,minSize:r.evaluate(new ut(g)),maxSize:r.evaluate(new ut(y)),interpolationType:a}}}function hg(e,{uSize:t,uSizeT:r},{lowerSize:i,upperSize:a}){return e.kind==="source"?i/aa:e.kind==="composite"?nr(i/aa,a/aa,r):t}function tp(e,t){let r=0,i=0;if(e.kind==="constant")i=e.layoutSize;else if(e.kind!=="source"){const{interpolationType:a,minZoom:c,maxZoom:f}=e,g=a?ke(ts.interpolationFactor(a,t,c,f),0,1):0;e.kind==="camera"?i=nr(e.minSize,e.maxSize,g):r=g}return{uSizeT:r,uSize:i}}var xT=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:aa,evaluateSizeForFeature:hg,evaluateSizeForZoom:tp,getSizeData:Jy});function bT(e,t,r){return e.sections.forEach(i=>{i.text=function(a,c,f){const g=c.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?a=a.toLocaleUpperCase():g==="lowercase"&&(a=a.toLocaleLowerCase()),ht.applyArabicShaping&&(a=ht.applyArabicShaping(a)),a}(i.text,t,r)}),e}const $f={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function wT(e){return e==="︶"||e==="﹈"||e==="︸"||e==="﹄"||e==="﹂"||e==="︾"||e==="︼"||e==="︺"||e==="︘"||e==="﹀"||e==="︐"||e==="︓"||e==="︔"||e==="｀"||e==="￣"||e==="︑"||e==="︒"}function ET(e){return e==="︵"||e==="﹇"||e==="︷"||e==="﹃"||e==="﹁"||e==="︽"||e==="︻"||e==="︹"||e==="︗"||e==="︿"}const Ky=3;function IT(e,t,r){t.glyphs=[],e===1&&r.readMessage(TT,t)}function TT(e,t,r){if(e===3){const{id:i,bitmap:a,width:c,height:f,left:g,top:y,advance:x}=r.readMessage(ST,{});t.glyphs.push({id:i,bitmap:new kl({width:c+2*Ky,height:f+2*Ky},a),metrics:{width:c,height:f,left:g,top:y,advance:x}})}else e===4?t.ascender=r.readSVarint():e===5&&(t.descender=r.readSVarint())}function ST(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}const tb=Ky,ls={horizontal:1,vertical:2,horizontalOnly:3},eb=-17;class Jf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const i=new Jf;return i.scale=t||1,i.fontStack=r,i}static forImage(t){const r=new Jf;return r.imageName=t,r}}class ep{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const i=new ep;for(let a=0;a<t.sections.length;a++){const c=t.sections[a];c.image?i.addImageSection(c):i.addTextSection(c,r)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(r,i){let a="";for(let c=0;c<r.length;c++){const f=r.charCodeAt(c+1)||null,g=r.charCodeAt(c-1)||null;a+=!i&&(f&&D(f)&&!$f[r[c+1]]||g&&D(g)&&!$f[r[c-1]])||!$f[r[c]]?r[c]:$f[r[c]]}return a}(this.text,t)}trim(){let t=0;for(let i=0;i<this.text.length&&pg[this.text.charCodeAt(i)];i++)t++;let r=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&pg[this.text.charCodeAt(i)];i--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const i=new ep;return i.text=this.text.substring(t,r),i.sectionIndex=this.sectionIndex.slice(t,r),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Jf.forText(t.scale,t.fontStack||r));const i=this.sections.length-1;for(let a=0;a<t.text.length;++a)this.sectionIndex.push(i)}addImageSection(t){const r=t.image?t.image.namePrimary:"";if(r.length===0)return void pn("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(Jf.forImage(r)),this.sectionIndex.push(this.sections.length-1)):pn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Qy(e,t,r,i,a,c,f,g,y,x,E,S,M,A,L){const R=ep.fromFeature(e,a);S===ls.vertical&&R.verticalizePunctuation(M);let N=[];const F=function(et,ct,ft,gt,Et,vt){if(!et)return[];const Rt=[],Xt=function(oe,de,qt,De,_e,ne){let Re=0;for(let Ie=0;Ie<oe.length();Ie++){const Me=oe.getSection(Ie);Re+=rb(oe.getCodePoint(Ie),Me,De,_e,de,ne)}return Re/Math.max(1,Math.ceil(Re/qt))}(et,ct,ft,gt,Et,vt),Pt=et.text.indexOf("​")>=0;let Ut=0;for(let oe=0;oe<et.length();oe++){const de=et.getSection(oe),qt=et.getCodePoint(oe);if(pg[qt]||(Ut+=rb(qt,de,gt,Et,ct,vt)),oe<et.length()-1){const De=!((Mt=qt)<11904||!(v["Bopomofo Extended"](Mt)||v.Bopomofo(Mt)||v["CJK Compatibility Forms"](Mt)||v["CJK Compatibility Ideographs"](Mt)||v["CJK Compatibility"](Mt)||v["CJK Radicals Supplement"](Mt)||v["CJK Strokes"](Mt)||v["CJK Symbols and Punctuation"](Mt)||v["CJK Unified Ideographs Extension A"](Mt)||v["CJK Unified Ideographs"](Mt)||v["Enclosed CJK Letters and Months"](Mt)||v["Halfwidth and Fullwidth Forms"](Mt)||v.Hiragana(Mt)||v["Ideographic Description Characters"](Mt)||v["Kangxi Radicals"](Mt)||v["Katakana Phonetic Extensions"](Mt)||v.Katakana(Mt)||v["Vertical Forms"](Mt)||v["Yi Radicals"](Mt)||v["Yi Syllables"](Mt)));(CT[qt]||De||de.imageName)&&Rt.push(ib(oe+1,Ut,Xt,Rt,MT(qt,et.getCodePoint(oe+1),De&&Pt),!1))}}var Mt;return ob(ib(et.length(),Ut,Xt,Rt,0,!0))}(R,x,c,t,i,A),{processBidirectionalText:W,processStyledBidirectionalText:H}=ht;if(W&&R.sections.length===1){const et=W(R.toString(),F);for(const ct of et){const ft=new ep;ft.text=ct,ft.sections=R.sections;for(let gt=0;gt<ct.length;gt++)ft.sectionIndex.push(0);N.push(ft)}}else if(H){const et=H(R.text,R.sectionIndex,F);for(const ct of et){const ft=new ep;ft.text=ct[0],ft.sectionIndex=ct[1],ft.sections=R.sections,N.push(ft)}}else N=function(et,ct){const ft=[],gt=et.text;let Et=0;for(const vt of ct)ft.push(et.substring(Et,vt)),Et=vt;return Et<gt.length&&ft.push(et.substring(Et,gt.length)),ft}(R,F);const $=[],Q={positionedLines:$,text:R.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(et,ct,ft,gt,Et,vt,Rt,Xt,Pt,Ut,Mt,oe){let de=0,qt=0,De=0;const _e=Xt==="right"?1:Xt==="left"?0:.5;let ne=!1;for(const hr of Et){const We=hr.getSections();for(const sr of We){if(sr.imageName)continue;const br=ct[sr.fontStack];if(br&&(ne=br.ascender!==void 0&&br.descender!==void 0,!ne))break}if(!ne)break}let Re=0;for(const hr of Et){hr.trim();const We=hr.getMaxScale(),sr=(We-1)*Si,br={positionedGlyphs:[],lineOffset:0};et.positionedLines[Re]=br;const Xr=br.positionedGlyphs;let Qe=0;if(!hr.length()){qt+=vt,++Re;continue}let sn=0,Wr=0;for(let Rr=0;Rr<hr.length();Rr++){const wr=hr.getSection(Rr),yn=hr.getSectionIndex(Rr),an=hr.getCodePoint(Rr);let Sn=wr.scale,oi=null,ao=null,zn=null,wn=Si,Yi=0;const $i=!(Pt===ls.horizontal||!Mt&&!P(an)||Mt&&(pg[an]||(Ie=an,v.Arabic(Ie)||v["Arabic Supplement"](Ie)||v["Arabic Extended-A"](Ie)||v["Arabic Presentation Forms-A"](Ie)||v["Arabic Presentation Forms-B"](Ie))));if(wr.imageName){const lo=gt[wr.imageName];if(!lo)continue;zn=wr.imageName,et.iconsInText=et.iconsInText||!0,ao=lo.paddedRect;const ln=lo.displaySize;Sn=Sn*Si/oe,oi={width:ln[0],height:ln[1],left:0,top:-tb,advance:$i?ln[1]:ln[0],localGlyph:!1},Yi=ne?-oi.height*Sn:eb+We*Si-ln[1]*Sn,wn=oi.advance;const ha=($i?ln[0]:ln[1])*Sn-Si*We;ha>0&&ha>Qe&&(Qe=ha)}else{const lo=ft[wr.fontStack];if(!lo)continue;lo[an]&&(ao=lo[an]);const ln=ct[wr.fontStack];if(!ln)continue;const ha=ln.glyphs[an];if(!ha)continue;if(oi=ha.metrics,wn=an!==8203?Si:0,ne){const lp=ln.ascender!==void 0?Math.abs(ln.ascender):0,Ul=ln.descender!==void 0?Math.abs(ln.descender):0,Gl=(lp+Ul)*Sn;sn<Gl&&(sn=Gl,Wr=(lp-Ul)/2*Sn),Yi=-lp*Sn}else Yi=eb+(We-Sn)*Si}$i?(et.verticalizable=!0,Xr.push({glyph:an,imageName:zn,x:de,y:qt+Yi,vertical:$i,scale:Sn,localGlyph:oi.localGlyph,fontStack:wr.fontStack,sectionIndex:yn,metrics:oi,rect:ao}),de+=wn*Sn+Ut):(Xr.push({glyph:an,imageName:zn,x:de,y:qt+Yi,vertical:$i,scale:Sn,localGlyph:oi.localGlyph,fontStack:wr.fontStack,sectionIndex:yn,metrics:oi,rect:ao}),de+=oi.advance*Sn+Ut)}Xr.length!==0&&(De=Math.max(de-Ut,De),ne?sb(Xr,_e,Qe,Wr,vt*We/2):sb(Xr,_e,Qe,0,vt/2)),de=0;const Pr=vt*We+Qe;br.lineOffset=Math.max(Qe,sr),qt+=Pr,++Re}var Ie;const Me=qt,{horizontalAlign:Kt,verticalAlign:Ue}=tv(Rt);(function(hr,We,sr,br,Xr,Qe){const sn=(We-sr)*Xr,Wr=-Qe*br;for(const Pr of hr)for(const Rr of Pr.positionedGlyphs)Rr.x+=sn,Rr.y+=Wr})(et.positionedLines,_e,Kt,Ue,De,Me),et.top+=-Ue*Me,et.bottom=et.top+Me,et.left+=-Kt*De,et.right=et.left+De,et.hasBaseline=ne}(Q,t,r,i,N,f,g,y,S,x,M,L),!function(et){for(const ct of et)if(ct.positionedGlyphs.length!==0)return!1;return!0}($)&&Q}const pg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},CT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rb(e,t,r,i,a,c){if(t.imageName){const f=i[t.imageName];return f?f.displaySize[0]*t.scale*Si/c+a:0}{const f=r[t.fontStack],g=f&&f.glyphs[e];return g?g.metrics.advance*t.scale+a:0}}function nb(e,t,r,i){const a=Math.pow(e-t,2);return i?e<t?a/2:2*a:a+Math.abs(r)*r}function MT(e,t,r){let i=0;return e===10&&(i-=1e4),r&&(i+=150),e!==40&&e!==65288||(i+=50),t!==41&&t!==65289||(i+=50),i}function ib(e,t,r,i,a,c){let f=null,g=nb(t,r,a,c);for(const y of i){const x=nb(t-y.x,r,a,c)+y.badness;x<=g&&(f=y,g=x)}return{index:e,x:t,priorBreak:f,badness:g}}function ob(e){return e?ob(e.priorBreak).concat(e.index):[]}function tv(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function sb(e,t,r,i,a){if(!(t||r||i||a))return;const c=e.length-1,f=e[c],g=(f.x+f.metrics.advance*f.scale)*t;for(let y=0;y<=c;y++)e[y].x-=g,e[y].y+=r+i+a}function AT(e,t,r,i){const{horizontalAlign:a,verticalAlign:c}=tv(i),f=r[0]-e.displaySize[0]*a,g=r[1]-e.displaySize[1]*c;return{imagePrimary:e,imageSecondary:t,top:g,bottom:g+e.displaySize[1],left:f,right:f+e.displaySize[0]}}function ab(e,t,r,i,a,c){const f=e.imagePrimary;let g;if(f.content){const N=f.content,F=f.pixelRatio||1;g=[N[0]/F,N[1]/F,f.displaySize[0]-N[2]/F,f.displaySize[1]-N[3]/F]}const y=t.left*c,x=t.right*c;let E,S,M,A;r==="width"||r==="both"?(A=a[0]+y-i[3],S=a[0]+x+i[1]):(A=a[0]+(y+x-f.displaySize[0])/2,S=A+f.displaySize[0]);const L=t.top*c,R=t.bottom*c;return r==="height"||r==="both"?(E=a[1]+L-i[0],M=a[1]+R+i[2]):(E=a[1]+(L+R-f.displaySize[1])/2,M=E+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:E,right:S,bottom:M,left:A,collisionPadding:g}}class Bl extends At{constructor(t,r,i,a,c){super(t,r),this.angle=a,this.z=i,c!==void 0&&(this.segment=c)}clone(){return new Bl(this.x,this.y,this.z,this.angle,this.segment)}}function lb(e,t,r,i,a){if(t.segment===void 0)return!0;let c=t,f=t.segment+1,g=0;for(;g>-r/2;){if(f--,f<0)return!1;g-=e[f].dist(c),c=e[f]}g+=e[f].dist(e[f+1]),f++;const y=[];let x=0;for(;g<r/2;){const E=e[f],S=e[f+1];if(!S)return!1;let M=e[f-1].angleTo(E)-E.angleTo(S);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:g,angleDelta:M}),x+=M;g-y[0].distance>i;)x-=y.shift().angleDelta;if(x>a)return!1;f++,g+=E.dist(S)}return!0}function ub(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function cb(e,t,r){return e?.6*t*r:0}function hb(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function PT(e,t,r,i,a,c){const f=cb(r,a,c),g=hb(r,i)*c;let y=0;const x=ub(e)/2;for(let E=0;E<e.length-1;E++){const S=e[E],M=e[E+1],A=S.dist(M);if(y+A>x){const L=(x-y)/A,R=nr(S.x,M.x,L),N=nr(S.y,M.y,L),F=new Bl(R,N,0,M.angleTo(S),E);return!f||lb(e,F,g,f,t)?F:void 0}y+=A}}function LT(e,t,r,i,a,c,f,g,y){const x=cb(i,c,f),E=hb(i,a),S=E*f,M=e[0].x===0||e[0].x===y||e[0].y===0||e[0].y===y;return t-S<t/4&&(t=S+t/4),pb(e,M?t/2*g%t:(E/2+2*c)*f*g%t,t,x,r,S,M,!1,y)}function pb(e,t,r,i,a,c,f,g,y){const x=c/2,E=ub(e);let S=0,M=t-r,A=[];for(let L=0;L<e.length-1;L++){const R=e[L],N=e[L+1],F=R.dist(N),W=N.angleTo(R);for(;M+r<S+F;){M+=r;const H=(M-S)/F,$=nr(R.x,N.x,H),Q=nr(R.y,N.y,H);if($>=0&&$<y&&Q>=0&&Q<y&&M-x>=0&&M+x<=E){const et=new Bl($,Q,0,W,L);i&&!lb(e,et,c,i,a)||A.push(et)}}S+=F}return g||A.length||f||(A=pb(e,S/2,r,i,a,c,f,!0,y)),A}function fb(e,t,r,i,a){const c=[];for(let f=0;f<e.length;f++){const g=e[f];let y;for(let x=0;x<g.length-1;x++){let E=g[x],S=g[x+1];E.x<t&&S.x<t||(E.x<t?E=new At(t,E.y+(t-E.x)/(S.x-E.x)*(S.y-E.y))._round():S.x<t&&(S=new At(t,E.y+(t-E.x)/(S.x-E.x)*(S.y-E.y))._round()),E.y<r&&S.y<r||(E.y<r?E=new At(E.x+(r-E.y)/(S.y-E.y)*(S.x-E.x),r)._round():S.y<r&&(S=new At(E.x+(r-E.y)/(S.y-E.y)*(S.x-E.x),r)._round()),E.x>=i&&S.x>=i||(E.x>=i?E=new At(i,E.y+(i-E.x)/(S.x-E.x)*(S.y-E.y))._round():S.x>=i&&(S=new At(i,E.y+(i-E.x)/(S.x-E.x)*(S.y-E.y))._round()),E.y>=a&&S.y>=a||(E.y>=a?E=new At(E.x+(a-E.y)/(S.y-E.y)*(S.x-E.x),a)._round():S.y>=a&&(S=new At(E.x+(a-E.y)/(S.y-E.y)*(S.x-E.x),a)._round()),y&&E.equals(y[y.length-1])||(y=[E],c.push(y)),y.push(S)))))}}return c}function ev(e){let t=0,r=0;for(const f of e)t+=f.w*f.h,r=Math.max(r,f.w);e.sort((f,g)=>g.h-f.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let a=0,c=0;for(const f of e)for(let g=i.length-1;g>=0;g--){const y=i[g];if(!(f.w>y.w||f.h>y.h)){if(f.x=y.x,f.y=y.y,c=Math.max(c,f.y+f.h),a=Math.max(a,f.x+f.w),f.w===y.w&&f.h===y.h){const x=i.pop();g<i.length&&(i[g]=x)}else f.h===y.h?(y.x+=f.w,y.w-=f.w):f.w===y.w?(y.y+=f.h,y.h-=f.h):(i.push({x:y.x+f.w,y:y.y,w:y.w-f.w,h:f.h}),y.y+=f.h,y.h-=f.h);break}}return{w:a,h:c,fill:t/(a*c)||0}}me(Bl,"Anchor");const ko=1;class rv{constructor(t,{pixelRatio:r,version:i,stretchX:a,stretchY:c,content:f}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=a,this.stretchY=c,this.content=f,this.version=i}get tl(){return[this.paddedRect.x+ko,this.paddedRect.y+ko]}get br(){return[this.paddedRect.x+this.paddedRect.w-ko,this.paddedRect.y+this.paddedRect.h-ko]}get displaySize(){return[(this.paddedRect.w-2*ko)/this.pixelRatio,(this.paddedRect.h-2*ko)/this.pixelRatio]}}class db{constructor(t,r){const i={},a={};this.haveRenderCallbacks=[];const c=[];this.addImages(t,i,c),this.addImages(r,a,c);const{w:f,h:g}=ev(c),y=new as({width:f||1,height:g||1});for(const x in t){const E=t[x],S=i[x].paddedRect;as.copy(E.data,y,{x:0,y:0},{x:S.x+ko,y:S.y+ko},E.data,E.sdf)}for(const x in r){const E=r[x],S=a[x].paddedRect,M=S.x+ko,A=S.y+ko,L=E.data.width,R=E.data.height;as.copy(E.data,y,{x:0,y:0},{x:M,y:A},E.data),as.copy(E.data,y,{x:0,y:R-1},{x:M,y:A-1},{width:L,height:1}),as.copy(E.data,y,{x:0,y:0},{x:M,y:A+R},{width:L,height:1}),as.copy(E.data,y,{x:L-1,y:0},{x:M-1,y:A},{width:1,height:R}),as.copy(E.data,y,{x:0,y:0},{x:M+L,y:A},{width:1,height:R})}this.image=y,this.iconPositions=i,this.patternPositions=a}addImages(t,r,i){for(const a in t){const c=t[a],f={x:0,y:0,w:c.data.width+2*ko,h:c.data.height+2*ko};i.push(f),r[a]=new rv(f,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(t,r,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>t.hasImage(a,i)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const a in t.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[a],t.getImage(a,i),r),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a,i),r)}patchUpdatedImage(t,r,i){if(!t||!r||t.version===r.version)return;t.version=r.version;const[a,c]=t.tl,f=!!Object.keys(this.patternPositions).length;i.update(r.data,{useMipmap:f},{x:a,y:c})}}me(rv,"ImagePosition"),me(db,"ImageAtlas");const Kf=1e20;function mb(e,t,r,i,a,c,f,g,y){for(let x=t;x<t+i;x++)gb(e,r*c+x,c,a,f,g,y);for(let x=r;x<r+a;x++)gb(e,x*c+t,1,i,f,g,y)}function gb(e,t,r,i,a,c,f){c[0]=0,f[0]=-Kf,f[1]=Kf,a[0]=e[t];for(let g=1,y=0,x=0;g<i;g++){a[g]=e[t+g*r];const E=g*g;do{const S=c[y];x=(a[g]-a[S]+E-S*S)/(g-S)/2}while(x<=f[y]&&--y>-1);y++,c[y]=g,f[y]=x,f[y+1]=Kf}for(let g=0,y=0;g<i;g++){for(;f[y+1]<g;)y++;const x=c[y],E=g-x;e[t+g*r]=a[x]+E*E}}const la=2,nv={none:0,ideographs:1,all:2};class rp{constructor(t,r,i){this.requestManager=t,this.localGlyphMode=r,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,r){this.urls[r]=t}getGlyphs(t,r,i){const a=[],c=this.urls[r]||G.GLYPHS_URL;for(const f in t)for(const g of t[f])a.push({stack:f,id:g});Pn(a,({stack:f,id:g},y)=>{let x=this.entries[f];x||(x=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[g];if(E!==void 0)return void y(null,{stack:f,id:g,glyph:E});if(E=this._tinySDF(x,f,g),E)return x.glyphs[g]=E,void y(null,{stack:f,id:g,glyph:E});const S=Math.floor(g/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[S])return void y(null,{stack:f,id:g,glyph:E});let M=x.requests[S];M||(M=x.requests[S]=[],rp.loadGlyphRange(f,S,c,this.requestManager,(A,L)=>{if(L){x.ascender=L.ascender,x.descender=L.descender;for(const R in L.glyphs)this._doesCharSupportLocalGlyph(+R)||(x.glyphs[+R]=L.glyphs[+R]);x.ranges[S]=!0}for(const R of M)R(A,L);delete x.requests[S]})),M.push((A,L)=>{A?y(A):L&&y(null,{stack:f,id:g,glyph:L.glyphs[g]||null})})},(f,g)=>{if(f)i(f);else if(g){const y={};for(const{stack:x,id:E,glyph:S}of g)y[x]===void 0&&(y[x]={}),y[x].glyphs===void 0&&(y[x].glyphs={}),y[x].glyphs[E]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;i(null,y)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==nv.none&&(this.localGlyphMode===nv.all?!!this.localFontFamily:!!this.localFontFamily&&(v["CJK Unified Ideographs"](t)||v["Hangul Syllables"](t)||v.Hiragana(t)||v.Katakana(t)||v["CJK Symbols and Punctuation"](t)||v["CJK Unified Ideographs Extension A"](t)||v["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,r,i){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(i))return;let c=t.tinySDF;if(!c){let R="400";/bold/i.test(r)?R="900":/medium/i.test(r)?R="500":/light/i.test(r)&&(R="200"),c=t.tinySDF=new rp.TinySDF({fontFamily:a,fontWeight:R,fontSize:24*la,buffer:3*la,radius:8*la}),c.fontWeight=R}if(this.localGlyphs[c.fontWeight][i])return this.localGlyphs[c.fontWeight][i];const f=String.fromCodePoint(i),{data:g,width:y,height:x,glyphWidth:E,glyphHeight:S,glyphLeft:M,glyphTop:A,glyphAdvance:L}=c.draw(f);return this.localGlyphs[c.fontWeight][i]={id:i,bitmap:new kl({width:y,height:x},g),metrics:{width:E/la,height:S/la,left:M/la,top:A/la-27,advance:L/la,localGlyph:!0}}}}rp.loadGlyphRange=function(e,t,r,i,a){const c=256*t,f=c+255,g=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",`${c}-${f}`),ui.Glyphs);ci(g,(y,x)=>{if(y)a(y);else if(x){const E={},S=function(M){return new ug(M).readFields(IT,{})}(x);for(const M of S.glyphs)E[M.id]=M;a(null,{glyphs:E,ascender:S.ascender,descender:S.descender})}})},rp.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:i=.25,fontFamily:a="sans-serif",fontWeight:c="normal",fontStyle:f="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=r;const g=this.size=e+4*t,y=this._createCanvas(g),x=this.ctx=y.getContext("2d",{willReadFrequently:!0});x.font=`${f} ${c} ${e}px ${a}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:a,actualBoundingBoxRight:c}=this.ctx.measureText(e),f=Math.ceil(r),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-a))),y=Math.min(this.size-this.buffer,f+Math.ceil(i)),x=g+2*this.buffer,E=y+2*this.buffer,S=Math.max(x*E,0),M=new Uint8ClampedArray(S),A={data:M,width:x,height:E,glyphWidth:g,glyphHeight:y,glyphTop:f,glyphLeft:0,glyphAdvance:t};if(g===0||y===0)return A;const{ctx:L,buffer:R,gridInner:N,gridOuter:F}=this;L.clearRect(R,R,g,y),L.fillText(e,R,R+f);const W=L.getImageData(R,R,g,y);F.fill(Kf,0,S),N.fill(0,0,S);for(let H=0;H<y;H++)for(let $=0;$<g;$++){const Q=W.data[4*(H*g+$)+3]/255;if(Q===0)continue;const et=(H+R)*x+$+R;if(Q===1)F[et]=0,N[et]=Kf;else{const ct=.5-Q;F[et]=ct>0?ct*ct:0,N[et]=ct<0?ct*ct:0}}mb(F,0,0,x,E,x,this.f,this.v,this.z),mb(N,R,R,g,y,x,this.f,this.v,this.z);for(let H=0;H<S;H++){const $=Math.sqrt(F[H])-Math.sqrt(N[H]);M[H]=Math.round(255-255*($/this.radius+this.cutoff))}return A}};const Eu=ko;function _b(e,t,r,i){const a=[],c=e.imagePrimary,f=c.pixelRatio,g=c.paddedRect.w-2*Eu,y=c.paddedRect.h-2*Eu,x=e.right-e.left,E=e.bottom-e.top,S=c.stretchX||[[0,g]],M=c.stretchY||[[0,y]],A=(vt,Rt)=>vt+Rt[1]-Rt[0],L=S.reduce(A,0),R=M.reduce(A,0),N=g-L,F=y-R;let W=0,H=L,$=0,Q=R,et=0,ct=N,ft=0,gt=F;if(c.content&&i){const vt=c.content;W=fg(S,0,vt[0]),$=fg(M,0,vt[1]),H=fg(S,vt[0],vt[2]),Q=fg(M,vt[1],vt[3]),et=vt[0]-W,ft=vt[1]-$,ct=vt[2]-vt[0]-H,gt=vt[3]-vt[1]-Q}const Et=(vt,Rt,Xt,Pt)=>{const Ut=dg(vt.stretch-W,H,x,e.left),Mt=mg(vt.fixed-et,ct,vt.stretch,L),oe=dg(Rt.stretch-$,Q,E,e.top),de=mg(Rt.fixed-ft,gt,Rt.stretch,R),qt=dg(Xt.stretch-W,H,x,e.left),De=mg(Xt.fixed-et,ct,Xt.stretch,L),_e=dg(Pt.stretch-$,Q,E,e.top),ne=mg(Pt.fixed-ft,gt,Pt.stretch,R),Re=new At(Ut,oe),Ie=new At(qt,oe),Me=new At(qt,_e),Kt=new At(Ut,_e),Ue=new At(Mt/f,de/f),hr=new At(De/f,ne/f),We=t*Math.PI/180;if(We){const Wr=Math.sin(We),Pr=Math.cos(We),Rr=[Pr,-Wr,Wr,Pr];Re._matMult(Rr),Ie._matMult(Rr),Kt._matMult(Rr),Me._matMult(Rr)}const sr=vt.stretch+vt.fixed,br=Xt.stretch+Xt.fixed,Xr=Rt.stretch+Rt.fixed,Qe=Pt.stretch+Pt.fixed,sn=e.imageSecondary;return{tl:Re,tr:Ie,bl:Kt,br:Me,texPrimary:{x:c.paddedRect.x+Eu+sr,y:c.paddedRect.y+Eu+Xr,w:br-sr,h:Qe-Xr},texSecondary:sn?{x:sn.paddedRect.x+Eu+sr,y:sn.paddedRect.y+Eu+Xr,w:br-sr,h:Qe-Xr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ue,pixelOffsetBR:hr,minFontScaleX:ct/f/x,minFontScaleY:gt/f/E,isSDF:r}};if(i&&(c.stretchX||c.stretchY)){const vt=yb(S,N,L),Rt=yb(M,F,R);for(let Xt=0;Xt<vt.length-1;Xt++){const Pt=vt[Xt],Ut=vt[Xt+1];for(let Mt=0;Mt<Rt.length-1;Mt++)a.push(Et(Pt,Rt[Mt],Ut,Rt[Mt+1]))}}else a.push(Et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:y+1}));return a}function fg(e,t,r){let i=0;for(const a of e)i+=Math.max(t,Math.min(r,a[1]))-Math.max(t,Math.min(r,a[0]));return i}function yb(e,t,r){const i=[{fixed:-Eu,stretch:0}];for(const[a,c]of e){const f=i[i.length-1];i.push({fixed:a-f.stretch,stretch:f.stretch}),i.push({fixed:a-f.stretch,stretch:f.stretch+(c-a)})}return i.push({fixed:t+Eu,stretch:r}),i}function dg(e,t,r,i){return e/t*r+i}function mg(e,t,r,i){return e-t*r/i}function DT(e,t,r,i){const a=t+e.positionedLines[i].lineOffset;return i===0?r+a/2:r+(a+(t+e.positionedLines[i-1].lineOffset))/2}function RT(e,t=1,r=!1){let i=1/0,a=1/0,c=-1/0,f=-1/0;const g=e[0];for(let A=0;A<g.length;A++){const L=g[A];(!A||L.x<i)&&(i=L.x),(!A||L.y<a)&&(a=L.y),(!A||L.x>c)&&(c=L.x),(!A||L.y>f)&&(f=L.y)}const y=Math.min(c-i,f-a);let x=y/2;const E=new gh([],OT);if(y===0)return new At(i,a);for(let A=i;A<c;A+=y)for(let L=a;L<f;L+=y)E.push(new np(A+x,L+x,x,e));let S=function(A){let L=0,R=0,N=0;const F=A[0];for(let W=0,H=F.length,$=H-1;W<H;$=W++){const Q=F[W],et=F[$],ct=Q.x*et.y-et.x*Q.y;R+=(Q.x+et.x)*ct,N+=(Q.y+et.y)*ct,L+=3*ct}return new np(R/L,N/L,0,A)}(e),M=E.length;for(;E.length;){const A=E.pop();(A.d>S.d||!S.d)&&(S=A,r&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,M)),A.max-S.d<=t||(x=A.h/2,E.push(new np(A.p.x-x,A.p.y-x,x,e)),E.push(new np(A.p.x+x,A.p.y-x,x,e)),E.push(new np(A.p.x-x,A.p.y+x,x,e)),E.push(new np(A.p.x+x,A.p.y+x,x,e)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${S.d}`)),S.p}function OT(e,t){return t.max-e.max}class np{constructor(t,r,i,a){this.p=new At(t,r),this.h=i,this.d=function(c,f){let g=!1,y=1/0;for(let x=0;x<f.length;x++){const E=f[x];for(let S=0,M=E.length,A=M-1;S<M;A=S++){const L=E[S],R=E[A];L.y>c.y!=R.y>c.y&&c.x<(R.x-L.x)*(c.y-L.y)/(R.y-L.y)+L.x&&(g=!g),y=Math.min(y,v1(c,L,R))}}return(g?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const ip=7,iv=Number.POSITIVE_INFINITY,zT=Math.sqrt(2);function vb(e,[t,r]){let i=0,a=0;if(r===iv){t<0&&(t=0);const c=t/zT;switch(e){case"top-right":case"top-left":a=c-ip;break;case"bottom-right":case"bottom-left":a=-c+ip;break;case"bottom":a=-t+ip;break;case"top":a=t-ip}switch(e){case"top-right":case"bottom-right":i=-c;break;case"top-left":case"bottom-left":i=c;break;case"left":i=t;break;case"right":i=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":a=r-ip;break;case"bottom-right":case"bottom-left":case"bottom":a=-r+ip}switch(e){case"top-right":case"bottom-right":case"right":i=-t;break;case"top-left":case"bottom-left":case"left":i=t}}return[i,a]}function NT(e,t,r,i,a,c,f,g,y,x,E){e.createArrays(),e.tilePixelRatio=ee/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const S=e.layers[0].layout,M=e.layers[0]._unevaluatedLayout._values,A={};if(e.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:W}=e.textSizeData;A.compositeTextSizes=[M["text-size"].possiblyEvaluate(new ut(F),g),M["text-size"].possiblyEvaluate(new ut(W),g)]}if(e.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:W}=e.iconSizeData;A.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new ut(F),g),M["icon-size"].possiblyEvaluate(new ut(W),g)]}A.layoutTextSize=M["text-size"].possiblyEvaluate(new ut(y+1),g),A.layoutIconSize=M["icon-size"].possiblyEvaluate(new ut(y+1),g),A.textMaxSize=M["text-size"].possiblyEvaluate(new ut(18),g);const L=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",R=S.get("text-size");let N=!1;for(const F of e.features)if(F.icon&&F.icon.nameSecondary){N=!0;break}for(const F of e.features){const W=S.get("text-font").evaluate(F,{},g).join(","),H=R.evaluate(F,{},g),$=A.layoutTextSize.evaluate(F,{},g),Q=(A.layoutIconSize.evaluate(F,{},g),{horizontal:{},vertical:void 0}),et=F.text;let ct,ft=[0,0];if(et){const vt=et.toString(),Rt=S.get("text-letter-spacing").evaluate(F,{},g)*Si,Xt=S.get("text-line-height").evaluate(F,{},g)*Si,Pt=I(vt)?Rt:0,Ut=S.get("text-anchor").evaluate(F,{},g),Mt=S.get("text-variable-anchor");if(!Mt){const _e=S.get("text-radial-offset").evaluate(F,{},g);ft=_e?vb(Ut,[_e*Si,iv]):S.get("text-offset").evaluate(F,{},g).map(ne=>ne*Si)}let oe=L?"center":S.get("text-justify").evaluate(F,{},g);const de=S.get("symbol-placement")==="point",qt=de?S.get("text-max-width").evaluate(F,{},g)*Si:1/0,De=_e=>{e.allowVerticalPlacement&&w(vt)&&(Q.vertical=Qy(et,t,r,a,W,qt,Xt,Ut,_e,Pt,ft,ls.vertical,!0,$,H))};if(!L&&Mt){const _e=oe==="auto"?Mt.map(Re=>ov(Re)):[oe];let ne=!1;for(let Re=0;Re<_e.length;Re++){const Ie=_e[Re];if(!Q.horizontal[Ie])if(ne)Q.horizontal[Ie]=Q.horizontal[0];else{const Me=Qy(et,t,r,a,W,qt,Xt,"center",Ie,Pt,ft,ls.horizontal,!1,$,H);Me&&(Q.horizontal[Ie]=Me,ne=Me.positionedLines.length===1)}}De("left")}else{if(oe==="auto"&&(oe=ov(Ut)),de||S.get("text-writing-mode").indexOf("horizontal")>=0||!w(vt)){const _e=Qy(et,t,r,a,W,qt,Xt,Ut,oe,Pt,ft,ls.horizontal,!1,$,H);_e&&(Q.horizontal[oe]=_e)}De(de?"left":oe)}}let gt=!1;if(F.icon&&F.icon.namePrimary){const vt=i[F.icon.namePrimary];vt&&(ct=AT(a[F.icon.namePrimary],F.icon.nameSecondary?a[F.icon.nameSecondary]:void 0,S.get("icon-offset").evaluate(F,{},g),S.get("icon-anchor").evaluate(F,{},g)),gt=vt.sdf,e.sdfIcons===void 0?e.sdfIcons=vt.sdf:e.sdfIcons!==vt.sdf&&pn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(vt.pixelRatio!==e.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}const Et=bb(Q.horizontal)||Q.vertical;e.iconsInText||(e.iconsInText=!!Et&&Et.iconsInText),(Et||ct)&&kT(e,F,Q,ct,i,A,$,0,ft,gt,f,g,x,E,N)}c&&e.generateCollisionDebugBuffers(y,e.collisionBoxArray)}function ov(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kT(e,t,r,i,a,c,f,g,y,x,E,S,M,A,L){let R=c.textMaxSize.evaluate(t,{},S);R===void 0&&(R=f);const N=e.layers[0].layout,F=N.get("icon-offset").evaluate(t,{},S),W=bb(r.horizontal)||r.vertical,H=M.name==="globe",$=Si,Q=f/$,et=e.tilePixelRatio*R/$,ct=(Ut=e.overscaling,e.zoom>18&&Ut>2&&(Ut>>=1),Math.max(ee/(512*Ut),1)*N.get("symbol-spacing")),ft=N.get("text-padding")*e.tilePixelRatio,gt=N.get("icon-padding")*e.tilePixelRatio,Et=ae(N.get("text-max-angle")),vt=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Rt=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Xt=N.get("symbol-placement"),Pt=ct/2;var Ut;const Mt=N.get("icon-text-fit").evaluate(t,{},S),oe=N.get("icon-text-fit-padding").evaluate(t,{},S),de=Mt!=="none";let qt;e.hasAnyIconTextFit===!1&&de&&(e.hasAnyIconTextFit=!0),i&&de&&(e.allowVerticalPlacement&&r.vertical&&(qt=ab(i,r.vertical,Mt,oe,F,Q)),W&&(i=ab(i,W,Mt,oe,F,Q)));const De=(_e,ne,Re)=>{if(ne.x<0||ne.x>=ee||ne.y<0||ne.y>=ee)return;let Ie=null;if(H){const{x:Me,y:Kt,z:Ue}=M.projectTilePoint(ne.x,ne.y,Re);Ie={anchor:new Bl(Me,Kt,Ue,0,void 0),up:M.upVector(Re,ne.x,ne.y)}}(function(Me,Kt,Ue,hr,We,sr,br,Xr,Qe,sn,Wr,Pr,Rr,wr,yn,an,Sn,oi,ao,zn,wn,Yi,$i,lo,ln,ha,lp){const Ul=Me.addToLineVertexArray(Kt,hr);let Gl,_d,yd,Bg,Uw,Gw,jw,qw=0,Zw=0,Xw=0,Ww=0,Rv=-1,Ov=-1;const Ha={};let Hw=ey("");const Oc=Ue?Ue.anchor:Kt,zv=Qe.layout.get("icon-text-fit").evaluate(wn,{},ln)!=="none";let Nv=0,kv=0;if(Qe._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Nv,kv]=Qe.layout.get("text-offset").evaluate(wn,{},ln).map(Fo=>Fo*Si):(Nv=Qe.layout.get("text-radial-offset").evaluate(wn,{},ln)*Si,kv=iv),Me.allowVerticalPlacement&&We.vertical){const Fo=We.vertical;if(yn)Gw=sv(Fo),Xr&&(jw=sv(Xr));else{const Bo=Qe.layout.get("text-rotate").evaluate(wn,{},ln)+90;yd=gg(sn,Oc,Kt,Wr,Pr,Rr,Fo,wr,Bo,an),Xr&&(Bg=gg(sn,Oc,Kt,Wr,Pr,Rr,Xr,oi,Bo))}}if(sr){const Fo=Qe.layout.get("icon-rotate").evaluate(wn,{},ln),Bo=_b(sr,Fo,$i,zv),up=Xr?_b(Xr,Fo,$i,zv):void 0;_d=gg(sn,Oc,Kt,Wr,Pr,Rr,sr,oi,Fo),qw=4*Bo.length;const Yw=Me.iconSizeData;let zc=null;Yw.kind==="source"?(zc=[aa*Qe.layout.get("icon-size").evaluate(wn,{},ln)],zc[0]>Iu&&pn(`${Me.layerIds[0]}: Value for "icon-size" is >= ${Qf}. Reduce your "icon-size".`)):Yw.kind==="composite"&&(zc=[aa*Yi.compositeIconSizes[0].evaluate(wn,{},ln),aa*Yi.compositeIconSizes[1].evaluate(wn,{},ln)],(zc[0]>Iu||zc[1]>Iu)&&pn(`${Me.layerIds[0]}: Value for "icon-size" is >= ${Qf}. Reduce your "icon-size".`)),Me.addSymbols(Me.icon,Bo,zc,zn,ao,wn,!1,Ue,Kt,Ul.lineStartIndex,Ul.lineLength,-1,lo,ln,ha,lp),Rv=Me.icon.placedSymbolArray.length-1,up&&(Zw=4*up.length,Me.addSymbols(Me.icon,up,zc,zn,ao,wn,ls.vertical,Ue,Kt,Ul.lineStartIndex,Ul.lineLength,-1,lo,ln,ha,lp),Ov=Me.icon.placedSymbolArray.length-1)}for(const Fo in We.horizontal){const Bo=We.horizontal[Fo];Gl||(Hw=ey(Bo.text),yn?Uw=sv(Bo):Gl=gg(sn,Oc,Kt,Wr,Pr,Rr,Bo,wr,Qe.layout.get("text-rotate").evaluate(wn,{},ln),an));const up=Bo.positionedLines.length===1;if(Xw+=xb(Me,Ue,Kt,Bo,br,Qe,yn,wn,an,Ul,We.vertical?ls.horizontal:ls.horizontalOnly,up?Object.keys(We.horizontal):[Fo],Ha,Rv,Yi,lo,ln,ha),up)break}We.vertical&&(Ww+=xb(Me,Ue,Kt,We.vertical,br,Qe,yn,wn,an,Ul,ls.vertical,["vertical"],Ha,Ov,Yi,lo,ln,ha));let Du=-1;const Fv=(Fo,Bo)=>Fo?Math.max(Fo,Bo):Bo;Du=Fv(Uw,Du),Du=Fv(Gw,Du),Du=Fv(jw,Du);const KS=Du>-1?1:0;Me.glyphOffsetArray.length>=id.MAX_GLYPHS&&pn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wn.sortKey!==void 0&&Me.addToSortKeyRanges(Me.symbolInstances.length,wn.sortKey),Me.symbolInstances.emplaceBack(Kt.x,Kt.y,Oc.x,Oc.y,Oc.z,Ha.right>=0?Ha.right:-1,Ha.center>=0?Ha.center:-1,Ha.left>=0?Ha.left:-1,Ha.vertical>=0?Ha.vertical:-1,Rv,Ov,Hw,Gl!==void 0?Gl:Me.collisionBoxArray.length,Gl!==void 0?Gl+1:Me.collisionBoxArray.length,yd!==void 0?yd:Me.collisionBoxArray.length,yd!==void 0?yd+1:Me.collisionBoxArray.length,_d!==void 0?_d:Me.collisionBoxArray.length,_d!==void 0?_d+1:Me.collisionBoxArray.length,Bg||Me.collisionBoxArray.length,Bg?Bg+1:Me.collisionBoxArray.length,Wr,Xw,Ww,qw,Zw,KS,0,Nv,kv,Du,0,zv?1:0)})(e,ne,Ie,_e,r,i,a,qt,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,ft,vt,y,0,gt,Rt,F,t,c,x,E,S,A,L)};if(Xt==="line")for(const _e of fb(t.geometry,0,0,ee,ee)){const ne=LT(_e,ct,Et,r.vertical||W,i,$,et,e.overscaling,ee);for(const Re of ne)W&&FT(e,W.text,Pt,Re)||De(_e,Re,S)}else if(Xt==="line-center"){for(const _e of t.geometry)if(_e.length>1){const ne=PT(_e,Et,r.vertical||W,i,$,et);ne&&De(_e,ne,S)}}else if(t.type==="Polygon")for(const _e of Zy(t.geometry,0)){const ne=RT(_e,16);De(_e[0],new Bl(ne.x,ne.y,0,0,void 0),S)}else if(t.type==="LineString")for(const _e of t.geometry)De(_e,new Bl(_e[0].x,_e[0].y,0,0,void 0),S);else if(t.type==="Point")for(const _e of t.geometry)for(const ne of _e)De([ne],new Bl(ne.x,ne.y,0,0,void 0),S)}const Qf=255,Iu=Qf*aa;function xb(e,t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N,F){const W=function(Q,et,ct,ft,gt,Et,vt,Rt){const Xt=[];if(et.positionedLines.length===0)return Xt;const Pt=ft.layout.get("text-rotate").evaluate(Et,{})*Math.PI/180,Ut=function(De){const _e=De[0],ne=De[1],Re=_e*ne;return Re>0?[_e,-ne]:Re<0?[-_e,ne]:_e===0?[ne,_e]:[ne,-_e]}(ct);let Mt=Math.abs(et.top-et.bottom);for(const De of et.positionedLines)Mt-=De.lineOffset;const oe=et.positionedLines.length,de=Mt/oe;let qt=et.top-ct[1];for(let De=0;De<oe;++De){const _e=et.positionedLines[De];qt=DT(et,de,qt,De);for(const ne of _e.positionedGlyphs){if(!ne.rect)continue;const Re=ne.rect||{};let Ie=tb+1,Me=!0,Kt=1,Ue=0;if(ne.imageName){const zn=vt[ne.imageName];if(!zn)continue;if(zn.sdf){pn("SDF images are not supported in formatted text and will be ignored.");continue}Me=!1,Kt=zn.pixelRatio,Ie=ko/Kt}const hr=(gt||Rt)&&ne.vertical,We=ne.metrics.advance*ne.scale/2,sr=ne.metrics,br=ne.rect;if(br===null)continue;Rt&&et.verticalizable&&(Ue=ne.imageName?We-ne.metrics.width*ne.scale/2:0);const Xr=gt?[ne.x+We,ne.y]:[0,0];let Qe=[0,0],sn=[0,0],Wr=!1;gt||(hr?(sn=[ne.x+We+Ut[0],ne.y+Ut[1]-Ue],Wr=!0):Qe=[ne.x+We+ct[0],ne.y+ct[1]-Ue]);const Pr=br.w*ne.scale/(Kt*(ne.localGlyph?la:1)),Rr=br.h*ne.scale/(Kt*(ne.localGlyph?la:1));let wr,yn,an,Sn;if(hr){const zn=ne.y-qt,wn=new At(-We,We-zn),Yi=-Math.PI/2,$i=new At(...sn);wr=new At(-We+Qe[0],Qe[1]),wr._rotateAround(Yi,wn)._add($i),wr.x+=-zn+We,wr.y-=(sr.left-Ie)*ne.scale;const lo=ne.imageName?sr.advance*ne.scale:Si*ne.scale,ln=String.fromCodePoint(ne.glyph);wT(ln)?wr.x+=(1-Ie)*ne.scale:ET(ln)?wr.x+=lo-sr.height*ne.scale+(-Ie-1)*ne.scale:wr.x+=ne.imageName||sr.width+2*Ie===br.w&&sr.height+2*Ie===br.h?(lo-Rr)/2:(lo-(sr.height+2*Ie)*ne.scale)/2,yn=new At(wr.x,wr.y-Pr),an=new At(wr.x+Rr,wr.y),Sn=new At(wr.x+Rr,wr.y-Pr)}else{const zn=(sr.left-Ie)*ne.scale-We+Qe[0],wn=(-sr.top-Ie)*ne.scale+Qe[1],Yi=zn+Pr,$i=wn+Rr;wr=new At(zn,wn),yn=new At(Yi,wn),an=new At(zn,$i),Sn=new At(Yi,$i)}if(Pt){let zn;zn=gt?new At(0,0):Wr?new At(Ut[0],Ut[1]):new At(ct[0],ct[1]),wr._rotateAround(Pt,zn),yn._rotateAround(Pt,zn),an._rotateAround(Pt,zn),Sn._rotateAround(Pt,zn)}const oi=new At(0,0),ao=new At(0,0);Xt.push({tl:wr,tr:yn,bl:an,br:Sn,texPrimary:Re,texSecondary:void 0,writingMode:et.writingMode,glyphOffset:Xr,sectionIndex:ne.sectionIndex,isSDF:Me,pixelOffsetTL:oi,pixelOffsetBR:ao,minFontScaleX:0,minFontScaleY:0})}}return Xt}(0,i,y,c,f,g,a,e.allowVerticalPlacement),H=e.textSizeData;let $=null;H.kind==="source"?($=[aa*c.layout.get("text-size").evaluate(g,{},N)],$[0]>Iu&&pn(`${e.layerIds[0]}: Value for "text-size" is >= ${Qf}. Reduce your "text-size".`)):H.kind==="composite"&&($=[aa*L.compositeTextSizes[0].evaluate(g,{},N),aa*L.compositeTextSizes[1].evaluate(g,{},N)],($[0]>Iu||$[1]>Iu)&&pn(`${e.layerIds[0]}: Value for "text-size" is >= ${Qf}. Reduce your "text-size".`)),e.addSymbols(e.text,W,$,y,f,g,E,t,r,x.lineStartIndex,x.lineLength,A,R,N,F,!1);for(const Q of S)M[Q]=e.text.placedSymbolArray.length-1;return 4*W.length}function bb(e){for(const t in e)return e[t];return null}function gg(e,t,r,i,a,c,f,g,y,x){let E=f.top,S=f.bottom,M=f.left,A=f.right;const L=f.collisionPadding;if(L&&(M-=L[0],E-=L[1],A+=L[2],S+=L[3]),y){const R=new At(M,E),N=new At(A,E),F=new At(M,S),W=new At(A,S),H=ae(y);let $=new At(0,0);x&&($=new At(x[0],x[1])),R._rotateAround(H,$),N._rotateAround(H,$),F._rotateAround(H,$),W._rotateAround(H,$),M=Math.min(R.x,N.x,F.x,W.x),A=Math.max(R.x,N.x,F.x,W.x),E=Math.min(R.y,N.y,F.y,W.y),S=Math.max(R.y,N.y,F.y,W.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,M,E,A,S,g,i,a,c),e.length-1}function sv(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function FT(e,t,r,i){const a=e.compareText;if(t in a){const c=a[t];for(let f=c.length-1;f>=0;f--)if(i.dist(c[f])<r)return!0}else a[t]=[];return a[t].push(i),!1}function wb(e,t){const r=e.fovAboveCenter,i=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,a=(e._camera.position[2]*e.worldSize-i)/Math.cos(e._pitch),c=Math.sin(r)*a/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),f=Math.sin(e._pitch)*c+a;return Math.min(1.01*f,a*(1/e._horizonShift))}function Tu(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),i=e.x*r,a=(e.x+1)*r,c=e.y*r,f=(e.y+1)*r,g=No(i),y=No(a),x=Ti(c),E=Ti(f),S=t.project(g,x),M=t.project(y,x),A=t.project(y,E),L=t.project(g,E);let R=Math.min(S.x,M.x,A.x,L.x),N=Math.min(S.y,M.y,A.y,L.y),F=Math.max(S.x,M.x,A.x,L.x),W=Math.max(S.y,M.y,A.y,L.y);const H=r/16;function $(et,ct,ft,gt,Et,vt){const Rt=(ft+Et)/2,Xt=(gt+vt)/2,Pt=t.project(No(Rt),Ti(Xt)),Ut=Math.max(0,R-Pt.x,N-Pt.y,Pt.x-F,Pt.y-W);R=Math.min(R,Pt.x),F=Math.max(F,Pt.x),N=Math.min(N,Pt.y),W=Math.max(W,Pt.y),Ut>H&&($(et,Pt,ft,gt,Rt,Xt),$(Pt,ct,Rt,Xt,Et,vt))}$(S,M,i,c,a,c),$(M,A,a,c,a,f),$(A,L,a,f,i,f),$(L,S,i,f,i,c),R-=H,N-=H,F+=H,W+=H;const Q=1/Math.max(F-R,W-N);return{scale:Q,x:R*Q,y:N*Q,x2:F*Q,y2:W*Q,projection:t}}function Eb(e,{x:t,y:r},i=0){return new At(((t-i)*e.scale-e.x)*ee,(r*e.scale-e.y)*ee)}const BT=s.m.identity(new Float32Array(16));class Su{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,r){return{x:0,y:0,z:0}}unproject(t,r){return new Ar(0,0)}projectTilePoint(t,r,i){return{x:t,y:r,z:0}}locationPoint(t,r,i=!0){return t._coordinatePoint(t.locationCoordinate(r),i)}pixelsPerMeter(t,r){return so(1,t)*r}pixelSpaceConversion(t,r,i){return 1}farthestPixelDistance(t){return wb(t,t.pixelsPerMeter)}pointCoordinate(t,r,i,a){const c=t.horizonLineFromTop(!1),f=new At(r,Math.max(c,i));return t.rayIntersectionCoordinate(t.pointRayIntersection(f,a))}pointCoordinate3D(t,r,i){const a=new At(r,i);if(t.elevation)return t.elevation.pointCoordinate(a);{const c=this.pointCoordinate(t,a.x,a.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(t,r){if(t.elevation)return!this.pointCoordinate3D(t,r.x,r.y);const i=t.horizonLineFromTop();return r.y<i}createInversionMatrix(t,r){return BT}createTileMatrix(t,r,i){let a,c,f;const g=i.canonical,y=s.m.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Tu(g,this);a=1,c=x.x+i.wrap*x.scale,f=x.y,s.m.scale(y,y,[a/x.scale,a/x.scale,t.pixelsPerMeter/r])}else a=r/t.zoomScale(g.z),c=(g.x+Math.pow(2,g.z)*i.wrap)*a,f=g.y*a;return s.m.translate(y,y,[c,f,0]),s.m.scale(y,y,[a/ee,a/ee,1]),y}upVector(t,r,i){return[0,0,1]}upVectorScale(t,r,i){return{metersToTile:1}}}class VT extends Su{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[r,i]=this.parallels=t.parallels||[29.5,45.5],a=Math.sin(ae(r));this.n=(a+Math.sin(ae(i)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(t,r){const{n:i,c:a,r0:c}=this,f=ae(t-this.center[0]),g=ae(r),y=Math.sqrt(a-2*i*Math.sin(g))/i;return{x:y*Math.sin(f*i),y:y*Math.cos(f*i)-c,z:0}}unproject(t,r){const{n:i,c:a,r0:c}=this,f=c+r;let g=Math.atan2(t,Math.abs(f))*Math.sign(f);f*i<0&&(g-=Math.PI*Math.sign(t)*Math.sign(f));const y=ae(this.center[0])*i;g=ti(g,-Math.PI-y,Math.PI-y);const x=ke(Tr(g/i)+this.center[0],-180,180),E=Math.asin(ke((a-(t*t+f*f)*i*i)/(2*i),-1,1)),S=ke(Tr(E),-Tn,Tn);return new Ar(x,S)}}const td=1.340264,ed=-.081106,rd=893e-6,nd=.003796,_g=Math.sqrt(3)/2;class UT extends Su{project(t,r){r=r/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(_g*Math.sin(r)),a=i*i,c=a*a*a;return{x:.5*(t*Math.cos(i)/(_g*(td+3*ed*a+c*(7*rd+9*nd*a)))/Math.PI+.5),y:1-.5*(i*(td+ed*a+c*(rd+nd*a))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let i=r=(2*(1-r)-1)*Math.PI,a=i*i,c=a*a*a;for(let E,S,M,A=0;A<12&&(S=i*(td+ed*a+c*(rd+nd*a))-r,M=td+3*ed*a+c*(7*rd+9*nd*a),E=S/M,i=ke(i-E,-Math.PI/3,Math.PI/3),a=i*i,c=a*a*a,!(Math.abs(E)<1e-12));++A);const f=_g*t*(td+3*ed*a+c*(7*rd+9*nd*a))/Math.cos(i),g=Math.asin(Math.sin(i)/_g),y=ke(180*f/Math.PI,-180,180),x=ke(180*g/Math.PI,-Tn,Tn);return new Ar(y,x)}}class GT extends Su{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){return{x:.5+t/360,y:.5-r/360,z:0}}unproject(t,r){const i=360*(t-.5),a=ke(360*(.5-r),-Tn,Tn);return new Ar(i,a)}}const op=Math.PI/2;function yg(e){return Math.tan((op+e)/2)}class jT extends Su{constructor(t){super(t),this.center=t.center||[0,30];const[r,i]=this.parallels=t.parallels||[30,30];let a=ae(r),c=ae(i);this.southernCenter=a+c<0,this.southernCenter&&(a=-a,c=-c);const f=Math.cos(a),g=yg(a);this.n=a===c?Math.sin(a):Math.log(f/Math.cos(c))/Math.log(yg(c)/g),this.f=f*Math.pow(yg(a),this.n)/this.n}project(t,r){r=ae(r),this.southernCenter&&(r=-r),t=ae(t-this.center[0]);const i=1e-6,{n:a,f:c}=this;c>0?r<-op+i&&(r=-op+i):r>op-i&&(r=op-i);const f=c/Math.pow(yg(r),a);let g=f*Math.sin(a*t),y=c-f*Math.cos(a*t);return g=.5*(g/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:g,y:this.southernCenter?y:1-y,z:0}}unproject(t,r){t=(2*t-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:i,f:a}=this,c=a-r,f=Math.sign(c),g=Math.sign(i)*Math.sqrt(t*t+c*c);let y=Math.atan2(t,Math.abs(c))*f;c*i<0&&(y-=Math.PI*Math.sign(t)*f);const x=ke(Tr(y/i)+this.center[0],-180,180),E=ke(Tr(2*Math.atan(Math.pow(a/g,1/i))-op),-Tn,Tn);return new Ar(x,this.southernCenter?-E:E)}}class Ib extends Su{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,r){return{x:ja(t),y:qa(r),z:0}}unproject(t,r){const i=No(t),a=Ti(r);return new Ar(i,a)}}const Tb=ae(Tn);class qT extends Su{project(t,r){const i=(r=ae(r))*r,a=i*i;return{x:.5*((t=ae(t))*(.8707-.131979*i+a*(a*(.003971*i-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+i*(.015085+a*(.028874*i-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(t,r){t=(2*t-.5)*Math.PI;let i=r=(2*(1-r)-1)*Math.PI,a=25,c=0,f=i*i;do{f=i*i;const x=f*f;c=(i*(1.007226+f*(.015085+x*(.028874*f-.044475-.005916*x)))-r)/(1.007226+f*(.045255+x*(.259866*f-.311325-.005916*11*x))),i=ke(i-c,-Tb,Tb)}while(Math.abs(c)>1e-6&&--a>0);f=i*i;const g=ke(Tr(t/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),y=Tr(i);return new Ar(g,y)}}const Sb=ae(Tn);class ZT extends Su{project(t,r){r=ae(r),t=ae(t);const i=Math.cos(r),a=2/Math.PI,c=Math.acos(i*Math.cos(t/2)),f=Math.sin(c)/c,g=.5*(t*a+2*i*Math.sin(t/2)/f)||0,y=.5*(r+Math.sin(r)/f)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(t,r){let i=t=(2*t-.5)*Math.PI,a=r=(2*(1-r)-1)*Math.PI,c=25;const f=1e-6;let g=0,y=0;do{const x=Math.cos(a),E=Math.sin(a),S=2*E*x,M=E*E,A=x*x,L=Math.cos(i/2),R=Math.sin(i/2),N=2*L*R,F=R*R,W=1-A*L*L,H=W?1/W:0,$=W?Math.acos(x*L)*Math.sqrt(1/W):0,Q=.5*(2*$*x*R+2*i/Math.PI)-t,et=.5*($*E+a)-r,ct=.5*H*(A*F+$*x*L*M)+1/Math.PI,ft=H*(N*S/4-$*E*R),gt=.125*H*(S*R-$*E*A*N),Et=.5*H*(M*L+$*F*x)+.5,vt=ft*gt-Et*ct;g=(et*ft-Q*Et)/vt,y=(Q*gt-et*ct)/vt,i=ke(i-g,-Math.PI,Math.PI),a=ke(a-y,-Sb,Sb)}while((Math.abs(g)>f||Math.abs(y)>f)&&--c>0);return new Ar(Tr(i),Tr(a))}}class Cb extends Su{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ae(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,r){const{scale:i,cosPhi:a}=this;return{x:ae(t)*a*i+.5,y:-Math.sin(ae(r))/a*i+.5,z:0}}unproject(t,r){const{scale:i,cosPhi:a}=this,c=-(r-.5)/i,f=ke(Tr((t-.5)/i)/a,-180,180),g=Math.asin(ke(c*a,-1,1)),y=ke(Tr(g),-Tn,Tn);return new Ar(f,y)}}class XT extends Ib{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,i){const a=qf(t,r,i),c=Zf(Ga(i));return s.v.transformMat4(a,a,c),{x:a[0],y:a[1],z:a[2]}}locationPoint(t,r){const i=Tc(r.lat,r.lng),a=s.v.normalize([],i),c=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude,f=so(1,0)*ee*c;s.v.scaleAndAdd(i,i,a,f);const g=s.m.identity(new Float64Array(16));return s.m.multiply(g,t.pixelMatrix,t.globeMatrix),s.v.transformMat4(i,i,g),new At(i[0],i[1])}pixelsPerMeter(t,r){return so(1,0)*r}pixelSpaceConversion(t,r,i){const a=so(1,t)*r,c=nr(so(1,45)*r,a,i);return this.pixelsPerMeter(t,r)/c}createTileMatrix(t,r,i){const a=My(Ga(i.canonical));return s.m.multiply(new Float64Array(16),t.globeMatrix,a)}createInversionMatrix(t,r){const{center:i}=t,a=Zf(Ga(r));return s.m.rotateY(a,a,ae(i.lng)),s.m.rotateX(a,a,ae(i.lat)),s.m.scale(a,a,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(t,r,i,a){return n1(t,r,i,!0)||new Li(0,0)}pointCoordinate3D(t,r,i){const a=this.pointCoordinate(t,r,i,0);return[a.x,a.y,a.z]}isPointAboveHorizon(t,r){return!n1(t,r.x,r.y,!1)}farthestPixelDistance(t){const r=function(a,c){const f=a.cameraToCenterDistance,g=a._centerAltitude*c,y=a._camera,x=a._camera.forward(),E=s.v.add([],s.v.scale([],x,-f),[0,0,g]),S=a.worldSize/(2*Math.PI),M=[0,0,-S],A=a.width/a.height,L=Math.tan(a.fovAboveCenter),R=s.v.scale([],y.up(),L),N=s.v.scale([],y.right(),L*A),F=s.v.normalize([],s.v.add([],s.v.add([],x,R),N)),W=[];let H;if(new by(E,F).closestPointOnSphere(M,S,W)){const $=s.v.add([],W,M),Q=s.v.sub([],$,E);H=Math.cos(a.fovAboveCenter)*s.v.length(Q)}else{const $=s.v.sub([],E,M),Q=s.v.sub([],M,E);s.v.normalize(Q,Q);const et=s.v.length($)-S;H=Math.sqrt(et*(et+2*S));const ct=Math.acos(H/(S+et))-Math.acos(s.v.dot(x,Q));H*=Math.cos(ct)}return 1.01*H}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),i=Nl(t.zoom);if(i>0){const a=wb(t,so(1,t.center.lat)*t.worldSize),c=t.worldSize/(2*Math.PI),f=Math.max(t.width,t.height)/t.worldSize*Math.PI;return nr(r,a+c*(1-Math.cos(f)),Math.pow(i,10))}return r}upVector(t,r,i){return qf(r,i,t,1)}upVectorScale(t){return{metersToTile:qm(Xm(Ga(t)))}}}function Mb(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Ib(e);case"equirectangular":return new GT(e);case"naturalEarth":return new qT(e);case"equalEarth":return new UT(e);case"winkelTripel":return new ZT(e);case"albers":return r?new Cb(e):new VT(e);case"lambertConformalConic":return r?new Cb(e):new jT(e);case"globe":return new XT(e)}throw new Error(`Invalid projection name: ${e.name}`)}const WT=new Ft({"symbol-placement":new tt(bt.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yt(bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(bt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new tt(bt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new tt(bt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new tt(bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new yt(bt.layout_symbol["icon-size"]),"icon-text-fit":new yt(bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yt(bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new yt(bt.layout_symbol["icon-image"]),"icon-rotate":new yt(bt.layout_symbol["icon-rotate"]),"icon-padding":new tt(bt.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(bt.layout_symbol["icon-keep-upright"]),"icon-offset":new yt(bt.layout_symbol["icon-offset"]),"icon-anchor":new yt(bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(bt.layout_symbol["text-rotation-alignment"]),"text-field":new yt(bt.layout_symbol["text-field"]),"text-font":new yt(bt.layout_symbol["text-font"]),"text-size":new yt(bt.layout_symbol["text-size"]),"text-max-width":new yt(bt.layout_symbol["text-max-width"]),"text-line-height":new yt(bt.layout_symbol["text-line-height"]),"text-letter-spacing":new yt(bt.layout_symbol["text-letter-spacing"]),"text-justify":new yt(bt.layout_symbol["text-justify"]),"text-radial-offset":new yt(bt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(bt.layout_symbol["text-variable-anchor"]),"text-anchor":new yt(bt.layout_symbol["text-anchor"]),"text-max-angle":new tt(bt.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(bt.layout_symbol["text-writing-mode"]),"text-rotate":new yt(bt.layout_symbol["text-rotate"]),"text-padding":new tt(bt.layout_symbol["text-padding"]),"text-keep-upright":new tt(bt.layout_symbol["text-keep-upright"]),"text-transform":new yt(bt.layout_symbol["text-transform"]),"text-offset":new yt(bt.layout_symbol["text-offset"]),"text-allow-overlap":new tt(bt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new tt(bt.layout_symbol["text-ignore-placement"]),"text-optional":new tt(bt.layout_symbol["text-optional"]),visibility:new tt(bt.layout_symbol.visibility)});var av={paint:new Ft({"icon-opacity":new yt(bt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new yt(bt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new yt(bt.paint_symbol["text-emissive-strength"]),"icon-color":new yt(bt.paint_symbol["icon-color"]),"icon-halo-color":new yt(bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new yt(bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yt(bt.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(bt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new yt(bt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new yt(bt.paint_symbol["text-opacity"]),"text-color":new yt(bt.paint_symbol["text-color"],{runtimeType:Po,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new yt(bt.paint_symbol["text-halo-color"]),"text-halo-width":new yt(bt.paint_symbol["text-halo-width"]),"text-halo-blur":new yt(bt.paint_symbol["text-halo-blur"]),"text-translate":new tt(bt.paint_symbol["text-translate"]),"text-translate-anchor":new tt(bt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new tt(bt.paint_symbol["icon-color-saturation"])}),layout:WT};class Ab{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:dl,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}me(Ab,"FormatSectionOverride",{omit:["defaultValue"]});class vg extends fe{constructor(t,r,i){super(t,av,r,i)}recalculate(t,r){super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const a=[];for(const c of i)a.indexOf(c)<0&&a.push(c);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,r,i,a){const c=this.layout.get(t).evaluate(r,{},i,a),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||Rh(f.value)||!c?c:function(g,y){return y.replace(/{([^{}]+)}/g,(x,E)=>E in g?String(g[E]):"")}(r.properties,c)}createBucket(t){return new id(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of av.paint.overridableProperties){if(!vg.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),i=new Ab(r),a=new Sf(i,r.property.specification,this.scope,this.options);let c=null;c=r.value.kind==="constant"||r.value.kind==="source"?new fc("source",a):new dc("composite",a,r.value.zoomStops,r.value._interpolationType),this.paint._values[t]=new Tt(r.property,c,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,i){return!(!this.layout||r.isDataDriven()||i.isDataDriven())&&vg.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const i=t.get("text-field"),a=av.paint.properties[r];let c=!1;const f=g=>{for(const y of g)if(a.overrides&&a.overrides.hasOverride(y))return void(c=!0)};if(i.value.kind==="constant"&&i.value.value instanceof Xi)f(i.value.value.sections);else if(i.value.kind==="source"){const g=x=>{c||(x instanceof lu&&Zn(x.value)===Sa?f(x.value.sections):x instanceof Ku?f(x.sections):x.eachChild(g))},y=i.value;y._styleExpression&&g(y._styleExpression.expression)}return c}getProgramIds(){const t=this.paint.get("icon-opacity").constantOr(1)!==0,r=this.paint.get("text-opacity").constantOr(1)!==0,i=[];return t&&i.push("symbolIcon"),r&&i.push("symbolSDF"),i}getDefaultProgramParams(t,r){return{config:new bc(this,r),overrideFog:!1}}}const HT=og.types,YT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xg(e,t,r,i,a,c,f,g,y,x,E,S,M){const A=g?Math.min(Iu,Math.round(g[0])):0,L=g?Math.min(Iu,Math.round(g[1])):0;e.emplaceBack(t,r,Math.round(32*i),Math.round(32*a),c,f,(A<<1)+(y?1:0),L,16*x,16*E,256*S,256*M)}function bg(e,t,r){e.emplaceBack(t,r)}function wg(e,t,r,i,a,c,f){e.emplaceBack(t,r,i,a,c,f)}function Eg(e,t,r,i,a){e.emplaceBack(t,r,i,a),e.emplaceBack(t,r,i,a),e.emplaceBack(t,r,i,a),e.emplaceBack(t,r,i,a)}function $T(e){for(const t of e.sections)if(B(t.text))return!0;return!1}class lv{constructor(t){this.layoutVertexArray=new ri,this.indexArray=new Or,this.programConfigurations=t,this.segments=new fn,this.dynamicLayoutVertexArray=new Mr,this.opacityVertexArray=new Ei,this.placedSymbolArray=new b0,this.iconTransitioningVertexArray=new Hi,this.globeExtVertexArray=new Hr,this.zOffsetVertexArray=new na}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,r,i,a,c){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pT.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,dT.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,YT,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,gT.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,fT.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,mT.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||a)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}me(lv,"SymbolBuffers");class uv{constructor(t,r,i){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new i,this.segments=new fn,this.collisionVertexArray=new rs,this.collisionVertexArrayExt=new Mr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,_T.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,yT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}me(uv,"CollisionBuffers");class Ig{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=s.m.identity([]),this.placementViewportMatrix=s.m.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jy(this.zoom,r["text-size"]),this.iconSizeData=Jy(this.zoom,r["icon-size"]);const i=this.layers[0].layout,a=i.get("symbol-sort-key"),c=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(f=>ls[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new lv(new _u(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new lv(new _u(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new I0,this.lineVertexArray=new T0,this.symbolInstances=new E0}calculateGlyphDependencies(t,r,i,a,c){for(let f=0;f<t.length;f++){const g=t.codePointAt(f);if(g===void 0)break;if(r[g]=!0,a&&c&&g<=65535){const y=$f[t.charAt(f)];y&&(r[y.charCodeAt(0)]=!0)}}}populate(t,r,i,a){const c=this.layers[0],f=c.layout,g=this.projection.name==="globe",y=f.get("text-font"),x=f.get("text-field"),E=f.get("icon-image"),S=(x.value.kind!=="constant"||x.value.value instanceof Xi&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),M=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,A=f.get("symbol-sort-key");if(this.features=[],!S&&!M)return;const L=r.iconDependencies,R=r.glyphDependencies,N=r.availableImages,F=new ut(this.zoom);for(const{feature:W,id:H,index:$,sourceLayerIndex:Q}of t){const et=c._featureFilter.needGeometry,ct=bu(W,et);if(!c._featureFilter.filter(F,ct,i))continue;if(et||(ct.geometry=Za(W,i,a)),g&&W.type!==1&&i.z<=5){const vt=ct.geometry,Rt=.98078528056,Xt=(Pt,Ut)=>{const Mt=qf(Pt.x,Pt.y,i,1),oe=qf(Ut.x,Ut.y,i,1);return s.v.dot(Mt,oe)<Rt};for(let Pt=0;Pt<vt.length;Pt++)vt[Pt]=aI(vt[Pt],Xt)}let ft,gt;if(S){const vt=c.getValueAndResolveTokens("text-field",ct,i,N),Rt=Xi.factory(vt);$T(Rt)&&(this.hasRTLText=!0),(!this.hasRTLText||K()==="unavailable"||this.hasRTLText&&ht.isParsed())&&(ft=bT(Rt,c,ct))}if(M){const vt=c.getValueAndResolveTokens("icon-image",ct,i,N);gt=vt instanceof Lo?vt:Lo.fromString(vt)}if(!ft&&!gt)continue;const Et=this.sortFeaturesByKey?A.evaluate(ct,{},i):void 0;if(this.features.push({id:H,text:ft,icon:gt,index:$,sourceLayerIndex:Q,geometry:ct.geometry,properties:W.properties,type:HT[W.type],sortKey:Et}),gt&&(L[gt.namePrimary]=!0,gt.nameSecondary&&(L[gt.nameSecondary]=!0)),ft){const vt=y.evaluate(ct,{},i).join(","),Rt=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ls.vertical)>=0;for(const Xt of ft.sections)if(Xt.image)L[Xt.image.namePrimary]=!0;else{const Pt=w(ft.toString()),Ut=Xt.fontStack||vt,Mt=R[Ut]=R[Ut]||{};this.calculateGlyphDependencies(Xt.text,Mt,Rt,this.allowVerticalPlacement,Pt)}}}f.get("symbol-placement")==="line"&&(this.features=function(W){const H={},$={},Q=[];let et=0;function ct(vt){Q.push(W[vt]),et++}function ft(vt,Rt,Xt){const Pt=$[vt];return delete $[vt],$[Rt]=Pt,Q[Pt].geometry[0].pop(),Q[Pt].geometry[0]=Q[Pt].geometry[0].concat(Xt[0]),Pt}function gt(vt,Rt,Xt){const Pt=H[Rt];return delete H[Rt],H[vt]=Pt,Q[Pt].geometry[0].shift(),Q[Pt].geometry[0]=Xt[0].concat(Q[Pt].geometry[0]),Pt}function Et(vt,Rt,Xt){const Pt=Xt?Rt[0][Rt[0].length-1]:Rt[0][0];return`${vt}:${Pt.x}:${Pt.y}`}for(let vt=0;vt<W.length;vt++){const Rt=W[vt],Xt=Rt.geometry,Pt=Rt.text?Rt.text.toString():null;if(!Pt){ct(vt);continue}const Ut=Et(Pt,Xt),Mt=Et(Pt,Xt,!0);if(Ut in $&&Mt in H&&$[Ut]!==H[Mt]){const oe=gt(Ut,Mt,Xt),de=ft(Ut,Mt,Q[oe].geometry);delete H[Ut],delete $[Mt],$[Et(Pt,Q[de].geometry,!0)]=de,Q[oe].geometry=null}else Ut in $?ft(Ut,Mt,Xt):Mt in H?gt(Ut,Mt,Xt):(ct(vt),H[Ut]=et-1,$[Mt]=et-1)}return Q.filter(vt=>vt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,H)=>W.sortKey-H.sortKey)}update(t,r,i,a,c){const f=Object.keys(t).length!==0;if(f&&!this.stateDependentLayers.length)return;const g=f?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,r,g,i,a,c),this.icon.programConfigurations.updatePaintArrays(t,r,g,i,a,c)}updateZOffset(){const t=(c,f,g)=>{i+=f,i>c.length&&c.resize(i);for(let y=-f;y<0;y++)c.emplace(y+i,g)},r=(c,f,g)=>{a+=f,a>c.length&&c.resize(a);for(let y=-f;y<0;y++)c.emplace(y+a,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,a=0;for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:y,numIconVertices:x}=f,E=f.zOffset,S=x>0;if((g>0||y>0)&&(t(this.text.zOffsetVertexArray,g,E),t(this.text.zOffsetVertexArray,y,E)),S){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:A}=f;M>=0&&r(this.icon.zOffsetVertexArray,x,E),A>=0&&r(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Mb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const i=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:a,y:c}of r)this.lineVertexArray.emplaceBack(a,c);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,r,i,a,c,f,g,y,x,E,S,M,A,L,R,N){const F=t.indexArray,W=t.layoutVertexArray,H=t.globeExtVertexArray,$=t.segments.prepareSegment(4*r.length,W,F,this.canOverlap?f.sortKey:void 0),Q=this.glyphOffsetArray.length,et=$.vertexLength,ct=this.allowVerticalPlacement&&g===ls.vertical?Math.PI/2:0,ft=f.text&&f.text.sections;for(let Et=0;Et<r.length;Et++){const{tl:vt,tr:Rt,bl:Xt,br:Pt,texPrimary:Ut,texSecondary:Mt,pixelOffsetTL:oe,pixelOffsetBR:de,minFontScaleX:qt,minFontScaleY:De,glyphOffset:_e,isSDF:ne,sectionIndex:Re}=r[Et],Ie=$.vertexLength,Me=_e[1];if(xg(W,x.x,x.y,vt.x,Me+vt.y,Ut.x,Ut.y,i,ne,oe.x,oe.y,qt,De),xg(W,x.x,x.y,Rt.x,Me+Rt.y,Ut.x+Ut.w,Ut.y,i,ne,de.x,oe.y,qt,De),xg(W,x.x,x.y,Xt.x,Me+Xt.y,Ut.x,Ut.y+Ut.h,i,ne,oe.x,de.y,qt,De),xg(W,x.x,x.y,Pt.x,Me+Pt.y,Ut.x+Ut.w,Ut.y+Ut.h,i,ne,de.x,de.y,qt,De),y){const{x:Kt,y:Ue,z:hr}=y.anchor,[We,sr,br]=y.up;wg(H,Kt,Ue,hr,We,sr,br),wg(H,Kt,Ue,hr,We,sr,br),wg(H,Kt,Ue,hr,We,sr,br),wg(H,Kt,Ue,hr,We,sr,br),Eg(t.dynamicLayoutVertexArray,Kt,Ue,hr,ct)}else Eg(t.dynamicLayoutVertexArray,x.x,x.y,x.z,ct);if(N){const Kt=Mt||Ut;bg(t.iconTransitioningVertexArray,Kt.x,Kt.y),bg(t.iconTransitioningVertexArray,Kt.x+Kt.w,Kt.y),bg(t.iconTransitioningVertexArray,Kt.x,Kt.y+Kt.h),bg(t.iconTransitioningVertexArray,Kt.x+Kt.w,Kt.y+Kt.h)}F.emplaceBack(Ie,Ie+1,Ie+2),F.emplaceBack(Ie+1,Ie+2,Ie+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_e[0]),Et!==r.length-1&&Re===r[Et+1].sectionIndex||t.programConfigurations.populatePaintArrays(W.length,f,f.index,{},A,L,R,ft&&ft[Re])}const gt=y?y.anchor:x;t.placedSymbolArray.emplaceBack(gt.x,gt.y,gt.z,x.x,x.y,Q,this.glyphOffsetArray.length-Q,et,E,S,x.segment,i?i[0]:0,i?i[1]:0,a[0],a[1],g,0,!1,0,M,0)}_commitLayoutVertex(t,r,i,a,c,f,g){t.emplaceBack(r,i,a,c,f,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(t,r,i,a,c,f,g){const y=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),x=y.vertexLength,E=g.tileAnchorX,S=g.tileAnchorY;for(let A=0;A<4;A++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,r,t.padding,g.zOffset),this._commitLayoutVertex(i.layoutVertexArray,a,c,f,E,S,new At(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,a,c,f,E,S,new At(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,a,c,f,E,S,new At(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,a,c,f,E,S,new At(t.x1,t.y2)),y.vertexLength+=4;const M=i.indexArray;M.emplaceBack(x,x+1),M.emplaceBack(x+1,x+2),M.emplaceBack(x+2,x+3),M.emplaceBack(x+3,x),y.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,i,a,c,f){for(let g=a;g<c;g++){const y=i.get(g),x=this.getSymbolInstanceTextSize(t,f,r,g);this._addCollisionDebugVertices(y,x,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(t,r,i,a,c,f){for(let g=a;g<c;g++){const y=i.get(g),x=this.getSymbolInstanceIconSize(t,r,f.placedIconSymbolIndex);this._addCollisionDebugVertices(y,x,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,f)}}generateCollisionDebugBuffers(t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new uv(zo,Q1.members,Hi),this.iconCollisionBox=new uv(zo,Q1.members,Hi);const i=tp(this.iconSizeData,t),a=tp(this.textSizeData,t);for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(a,t,r,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(a,t,r,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(i,t,r,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(i,t,r,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(t,r,i,a){const c=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:a),f=hg(this.textSizeData,t,c)/Si;return this.tilePixelRatio*f}getSymbolInstanceIconSize(t,r,i){const a=this.icon.placedSymbolArray.get(i),c=hg(this.iconSizeData,t,a);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(t,r,i,a){t.emplaceBack(r,-i,-i,a),t.emplaceBack(r,i,-i,a),t.emplaceBack(r,i,i,a),t.emplaceBack(r,-i,i,a)}_updateTextDebugCollisionBoxes(t,r,i,a,c,f){for(let g=a;g<c;g++){const y=i.get(g),x=this.getSymbolInstanceTextSize(t,f,r,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,y.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(t,r,i,a,c,f){for(let g=a;g<c;g++){const y=i.get(g),x=this.getSymbolInstanceIconSize(t,r,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,y.padding,f.zOffset)}}updateCollisionDebugBuffers(t,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=tp(this.iconSizeData,t),a=tp(this.textSizeData,t);for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(a,t,r,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(a,t,r,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(i,t,r,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._updateIconDebugCollisionBoxes(i,t,r,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,r,i,a,c,f,g,y,x){const E={};if(r<i){const{x1:S,y1:M,x2:A,y2:L,padding:R,projectedAnchorX:N,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$,featureIndex:Q}=t.get(r);E.textBox={x1:S,y1:M,x2:A,y2:L,padding:R,projectedAnchorX:N,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$},E.textFeatureIndex=Q}if(a<c){const{x1:S,y1:M,x2:A,y2:L,padding:R,projectedAnchorX:N,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$,featureIndex:Q}=t.get(a);E.verticalTextBox={x1:S,y1:M,x2:A,y2:L,padding:R,projectedAnchorX:N,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$},E.verticalTextFeatureIndex=Q}if(f<g){const{x1:S,y1:M,x2:A,y2:L,padding:R,projectedAnchorX:N,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$,featureIndex:Q}=t.get(f);E.iconBox={x1:S,y1:M,x2:A,y2:L,padding:R,projectedAnchorX:N,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$},E.iconFeatureIndex=Q}if(y<x){const{x1:S,y1:M,x2:A,y2:L,padding:R,projectedAnchorX:N,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$,featureIndex:Q}=t.get(y);E.verticalIconBox={x1:S,y1:M,x2:A,y2:L,padding:R,projectedAnchorX:N,projectedAnchorY:F,projectedAnchorZ:W,tileAnchorX:H,tileAnchorY:$},E.verticalIconFeatureIndex=Q}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const i=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,r){const i=t.placedSymbolArray.get(r),a=i.vertexStartIndex+4*i.numGlyphs;for(let c=i.vertexStartIndex;c<a;c+=4)t.indexArray.emplaceBack(c,c+1,c+2),t.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),i=Math.cos(t),a=[],c=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const y=this.symbolInstances.get(g);a.push(0|Math.round(r*y.tileAnchorX+i*y.tileAnchorY)),c.push(y.featureIndex)}return f.sort((g,y)=>a[g]-a[y]||c[y]-c[g]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,r){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===r?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const i=this.symbolInstances.get(r);this.featureSortOrder.push(i.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:x}=i;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&c!==a&&this.addIndicesForPlacedSymbol(this.text,c),f>=0&&f!==c&&f!==a&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}me(Ig,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ig.MAX_GLYPHS=65535,Ig.addDynamicAttributes=Eg;var id=Ig;const JT=Ee([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:KT}=JT,QT=Ee([{name:"a_packed",components:4,type:"Float32"}]),{members:tS}=QT,eS=og.types,rS=Math.cos(Math.PI/180*37.5);class Tg{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Oo,this.layoutVertexArray2=new Mr,this.indexArray=new Or,this.programConfigurations=new _u(t.layers,t.zoom),this.segments=new fn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,i,a){this.hasPattern=Xy("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:E,id:S,index:M,sourceLayerIndex:A}of t){const L=this.layers[0]._featureFilter.needGeometry,R=bu(E,L);if(!this.layers[0]._featureFilter.filter(new ut(this.zoom),R,i))continue;const N=c?c.evaluate(R,{},i):void 0,F={id:S,properties:E.properties,type:E.type,sourceLayerIndex:A,index:M,geometry:L?R.geometry:Za(E,i,a),patterns:{},sortKey:N};f.push(F)}c&&f.sort((E,S)=>E.sortKey-S.sortKey);const{lineAtlas:g,featureIndex:y}=r,x=this.addConstantDashes(g);for(const E of f){const{geometry:S,index:M,sourceLayerIndex:A}=E;if(x&&this.addFeatureDashes(E,g),this.hasPattern){const L=Wy("line",this.layers,E,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(E,S,M,i,g.positions,r.availableImages,r.brightness);y.insert(t[M].feature,S,M,A,this.index)}}addConstantDashes(t){let r=!1;for(const i of this.layers){const a=i.paint.get("line-dasharray").value,c=i.layout.get("line-cap").value;if(a.kind!=="constant"||c.kind!=="constant")r=!0;else{const f=c.value,g=a.value;if(!g)continue;t.addDash(g,f)}}return r}addFeatureDashes(t,r){const i=this.zoom;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,f=a.layout.get("line-cap").value;if(c.kind==="constant"&&f.kind==="constant")continue;let g,y;if(c.kind==="constant"){if(g=c.value,!g)continue}else g=c.evaluate({zoom:i},t);y=f.kind==="constant"?f.value:f.evaluate({zoom:i},t),r.addDash(g,y),t.patterns[a.id]=r.getKey(g,y)}}update(t,r,i,a,c){const f=Object.keys(t).length!==0;f&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,r,f?this.stateDependentLayers:this.layers,i,a,c)}addFeatures(t,r,i,a,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,i,a,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,tS)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,KT),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,i,a,c,f,g){const y=this.layers[0].layout,x=y.get("line-join").evaluate(t,{}),E=y.get("line-cap").evaluate(t,{}),S=y.get("line-miter-limit"),M=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const A of r)this.addLine(A,t,x,E,S,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,c,f,a,g)}addLine(t,r,i,a,c,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let F=0;F<t.length-1;F++)this.totalDistance+=t[F].dist(t[F+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=eS[r.type]==="Polygon";let y=t.length;for(;y>=2&&t[y-1].equals(t[y-2]);)y--;let x=0;for(;x<y-1&&t[x].equals(t[x+1]);)x++;if(y<(g?3:2))return;i==="bevel"&&(c=1.05);const E=this.overscaling<=16?15*ee/(512*this.overscaling):0,S=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let M,A,L,R,N;this.e1=this.e2=-1,g&&(M=t[y-2],N=t[x].sub(M)._unit()._perp());for(let F=x;F<y;F++){if(L=F===y-1?g?t[x+1]:void 0:t[F+1],L&&t[F].equals(L))continue;N&&(R=N),M&&(A=M),M=t[F],N=L?L.sub(M)._unit()._perp():R,R=R||N;let W=R.add(N);W.x===0&&W.y===0||W._unit();const H=R.x*N.x+R.y*N.y,$=W.x*N.x+W.y*N.y,Q=$!==0?1/$:1/0,et=2*Math.sqrt(2-2*$),ct=$<rS&&A&&L,ft=R.x*N.y-R.y*N.x>0;if(ct&&F>x){const vt=M.dist(A);if(vt>2*E){const Rt=M.sub(M.sub(A)._mult(E/vt)._round());this.updateDistance(A,Rt),this.addCurrentVertex(Rt,R,0,0,S),A=Rt}}const gt=A&&L;let Et=gt?i:g?"butt":a;if(gt&&Et==="round"&&(Q<f?Et="miter":Q<=2&&(Et="fakeround")),Et==="miter"&&Q>c&&(Et="bevel"),Et==="bevel"&&(Q>2&&(Et="flipbevel"),Q<c&&(Et="miter")),A&&this.updateDistance(A,M),Et==="miter")W._mult(Q),this.addCurrentVertex(M,W,0,0,S);else if(Et==="flipbevel"){if(Q>100)W=N.mult(-1);else{const vt=Q*R.add(N).mag()/R.sub(N).mag();W._perp()._mult(vt*(ft?-1:1))}this.addCurrentVertex(M,W,0,0,S),this.addCurrentVertex(M,W.mult(-1),0,0,S)}else if(Et==="bevel"||Et==="fakeround"){const vt=-Math.sqrt(Q*Q-1),Rt=ft?vt:0,Xt=ft?0:vt;if(A&&this.addCurrentVertex(M,R,Rt,Xt,S),Et==="fakeround"){const Pt=Math.round(180*et/Math.PI/20);for(let Ut=1;Ut<Pt;Ut++){let Mt=Ut/Pt;if(Mt!==.5){const de=Mt-.5;Mt+=Mt*de*(Mt-1)*((1.0904+H*(H*(3.55645-1.43519*H)-3.2452))*de*de+(.848013+H*(.215638*H-1.06021)))}const oe=N.sub(R)._mult(Mt)._add(R)._unit()._mult(ft?-1:1);this.addHalfVertex(M,oe.x,oe.y,!1,ft,0,S)}}L&&this.addCurrentVertex(M,N,-Rt,-Xt,S)}else if(Et==="butt")this.addCurrentVertex(M,W,0,0,S);else if(Et==="square"){const vt=A?1:-1;A||this.addCurrentVertex(M,W,vt,vt,S),this.addCurrentVertex(M,W,0,0,S),A&&this.addCurrentVertex(M,W,vt,vt,S)}else Et==="round"&&(A&&(this.addCurrentVertex(M,R,0,0,S),this.addCurrentVertex(M,R,1,1,S,!0)),L&&(this.addCurrentVertex(M,N,-1,-1,S,!0),this.addCurrentVertex(M,N,0,0,S)));if(ct&&F<y-1){const vt=M.dist(L);if(vt>2*E){const Rt=M.add(L.sub(M)._mult(E/vt)._round());this.updateDistance(M,Rt),this.addCurrentVertex(Rt,N,0,0,S),M=Rt}}}}addCurrentVertex(t,r,i,a,c,f=!1){const g=r.y*a-r.x,y=-r.y-r.x*a;this.addHalfVertex(t,r.x+r.y*i,r.y-r.x*i,f,!1,i,c),this.addHalfVertex(t,g,y,f,!0,-a,c)}addHalfVertex({x:t,y:r},i,a,c,f,g,y){this.layoutVertexArray.emplaceBack((t<<1)+(c?1:0),(r<<1)+(f?1:0),Math.round(63*i)+128,Math.round(63*a)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),y.primitiveLength++),f?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}me(Tg,"LineBucket",{omit:["layers","patternFeatures"]});class Vl{constructor(t,r,i,a){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(r,a)}update(t,r,i){const{width:a,height:c}=t,{context:f}=this,{gl:g}=f;if(g.bindTexture(g.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!r||r.premultiply!==!1)),i||this.size&&this.size[0]===a&&this.size[1]===c){const{x:y,y:x}=i||{x:0,y:0};if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap)g.texSubImage2D(g.TEXTURE_2D,0,y,x,g.RGBA,g.UNSIGNED_BYTE,t);else{let E=this.format,S=g.UNSIGNED_BYTE;this.format===g.R32F&&(E=g.RED,S=g.FLOAT),g.texSubImage2D(g.TEXTURE_2D,0,y,x,a,c,E,S,t.data)}}else if(this.size=[a,c],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap){let y=this.format;this.format===g.R8&&(y=g.RED),g.texImage2D(g.TEXTURE_2D,0,this.format,y,g.UNSIGNED_BYTE,t)}else{let y=this.format,x=this.format,E=g.UNSIGNED_BYTE;this.format===g.DEPTH_COMPONENT&&(y=g.DEPTH_COMPONENT16,E=g.UNSIGNED_SHORT),this.format===g.R8&&(x=g.RED),this.format===g.R32F&&(E=g.FLOAT,x=g.RED),g.texImage2D(g.TEXTURE_2D,0,y,a,c,0,x,E,t.data)}this.useMipmap=!!(r&&r.useMipmap),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(t,r,i=!1){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),t!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!i?t===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),r!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(t,r,i,a){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),this.magFilter=r),t!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?t===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),i!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),this.wrapS=i),a!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Sg{constructor(t,r){this.context=t,this.texture=r}bind(t,r){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrapS=r)}}const As=32,Xa=33,Cu=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,r=0,i=0,a=0,c=0,f=0,g=0;for(1&t?a=c=f=As:r=i=g=As;(t>>=1)>1;){const x=r+a>>1,E=i+c>>1;1&t?(a=r,c=i,r=f,i=g):(r=a,i=c,a=f,c=g),f=x,g=E}const y=4*e;Cu[y+0]=r,Cu[y+1]=i,Cu[y+2]=a,Cu[y+3]=c}const Wa=new Uint16Array(2178),Mu=new Uint8Array(1089),Cg=new Uint16Array(1089);function Pb(e){return e===0?-.03125:e===32?.03125:0}var Mg=Ee([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Lb={type:2,extent:ee,loadGeometry:()=>[[new At(0,0),new At(ee+1,0),new At(ee+1,ee+1),new At(0,ee+1),new At(0,0)]]};class cv{constructor(t,r,i,a,c){this.tileID=t,this.uid=go(),this.uses=0,this.tileSize=r,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,a&&a.style&&(this._lastUpdatedBrightness=a.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<ji.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Tu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,i){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(a,c){const f={};if(!c)return f;for(const g of a){const y=g.layerIds.map(x=>c.getLayer(x)).filter(Boolean);if(y.length!==0){g.layers=y,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(x=>y.filter(E=>E.id===x)[0]));for(const x of y)f[x.fqid]=g}}return f}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const c=this.buckets[a];if(c instanceof id){if(this.hasSymbolBuckets=!0,!i)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const c=this.buckets[a];if(c instanceof id&&c.hasRTLText){this.hasRTLText=!0,ht.isLoading()||ht.isLoaded()||K()!=="deferred"||lt();break}}this.queryPadding=0;for(const a in this.buckets){const c=this.buckets[a],f=r.style.getOwnLayer(a);if(!f)continue;const g=f.queryRadius(c);this.queryPadding=Math.max(this.queryPadding,g)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new ty}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const a in this.buckets){const c=this.buckets[a];c.uploadPending()&&c.upload(t)}const r=t.gl,i=this.imageAtlas;if(i&&!i.uploaded){const a=!!Object.keys(i.patternPositions).length;this.imageAtlasTexture=new Vl(t,i.image,r.RGBA,{useMipmap:a}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vl(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Vl(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,i),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const a=r.style.getBrightness();(this._lastUpdatedBrightness||a)&&(this._lastUpdatedBrightness&&a&&Math.abs(this._lastUpdatedBrightness-a)<.001||(this._lastUpdatedBrightness=a,this.updateBuckets(void 0,r)))}queryRenderedFeatures(t,r,i,a,c,f,g,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:g,transform:f,params:c,tileTransform:this.tileTransform},t,r,i):{}}querySourceFeatures(t,r){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const a=i.loadVTLayers(),c=r?r.sourceLayer:"",f=a._geojsonTileLayer||a[c];if(!f)return;const g=Fh(r&&r.filter),{z:y,x,y:E}=this.tileID.canonical,S={z:y,x,y:E};for(let M=0;M<f.length;M++){const A=f.feature(M);if(g.needGeometry){const N=bu(A,!0);if(!g.filter(new ut(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!g.filter(new ut(this.tileID.overscaledZ),A))continue;const L=i.getId(A,c),R=new q1(A,y,x,E,L);R.tile=S,t.push(R)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const i=Zt(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const i=Date.now();let a=!1;if(this.expirationTime>i)a=!1;else if(r)if(this.expirationTime<r)a=!0;else{const c=this.expirationTime-r;c?this.expirationTime=i+Math.max(c,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0&&r&&this.updateBuckets(t,r)}updateBuckets(t,r){if(!this.latestFeatureIndex)return;const i=this.latestFeatureIndex.loadVTLayers(),a=r.style.listImages(),c=r.style.getBrightness();for(const f in this.buckets){if(!r.style.hasLayer(f))continue;const g=this.buckets[f],y=g.layers[0].sourceLayer||"_geojsonTileLayer",x=i[y];let E={};if(t&&(E=t[y],!x||!E||Object.keys(E).length===0))continue;if(g.update(E,x,a,this.imageAtlas&&this.imageAtlas.patternPositions||{},c),g instanceof Tg||g instanceof ng){const M=r.style.getOwnSourceCache(g.layers[0].source);r._terrain&&r._terrain.enabled&&M&&g.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(M.id,this.tileID)}const S=r&&r.style&&r.style.getOwnLayer(f);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ji.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ji.now()+t}setTexture(t,r){const i=r.context,a=i.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof Vl?this.texture.update(t,{useMipmap:!0}):(this.texture=new Vl(i,t,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(t,r){const i={};for(const a of r)i[a]=!0;this.dependencies[t]=i}hasDependency(t,r){for(const i of t){const a=this.dependencies[i];if(a){for(const c of r)if(a[c])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const i=Za(Lb,this.tileID.canonical,this.tileTransform)[0],a=new Xe,c=new Nf;for(let f=0;f<i.length;f++){const{x:g,y}=i[f];a.emplaceBack(g,y),c.emplaceBack(f)}c.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(c),this._tileDebugBuffer=t.createVertexBuffer(a,Uf.members),this._tileDebugSegments=fn.simpleSegment(0,0,a.length,c.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const i=Za(Lb,this.tileID.canonical,this.tileTransform)[0];let a,c;if(this.isRaster){const f=function(g,y){const x=Tu(g,y),E=Math.pow(2,g.z);for(let N=0;N<Xa;N++)for(let F=0;F<Xa;F++){const W=No((g.x+(F+Pb(F))/As)/E),H=Ti((g.y+(N+Pb(N))/As)/E),$=y.project(W,H),Q=N*Xa+F;Wa[2*Q+0]=Math.round(($.x*x.scale-x.x)*ee),Wa[2*Q+1]=Math.round(($.y*x.scale-x.y)*ee)}Mu.fill(0),Cg.fill(0);for(let N=2045;N>=0;N--){const F=4*N,W=Cu[F+0],H=Cu[F+1],$=Cu[F+2],Q=Cu[F+3],et=W+$>>1,ct=H+Q>>1,ft=et+ct-H,gt=ct+W-et,Et=H*Xa+W,vt=Q*Xa+$,Rt=ct*Xa+et,Xt=Math.hypot((Wa[2*Et+0]+Wa[2*vt+0])/2-Wa[2*Rt+0],(Wa[2*Et+1]+Wa[2*vt+1])/2-Wa[2*Rt+1])>=16;Mu[Rt]=Mu[Rt]||(Xt?1:0),N<1022&&(Mu[Rt]=Mu[Rt]||Mu[(H+gt>>1)*Xa+(W+ft>>1)]||Mu[(Q+gt>>1)*Xa+($+ft>>1)])}const S=new Dr,M=new Or;let A=0;function L(N,F){const W=F*Xa+N;return Cg[W]===0&&(S.emplaceBack(Wa[2*W+0],Wa[2*W+1],N*ee/As,F*ee/As),Cg[W]=++A),Cg[W]-1}function R(N,F,W,H,$,Q){const et=N+W>>1,ct=F+H>>1;if(Math.abs(N-$)+Math.abs(F-Q)>1&&Mu[ct*Xa+et])R($,Q,N,F,et,ct),R(W,H,$,Q,et,ct);else{const ft=L(N,F),gt=L(W,H),Et=L($,Q);M.emplaceBack(ft,gt,Et)}}return R(0,0,As,As,As,0),R(As,As,0,0,0,As),{vertices:S,indices:M}}(this.tileID.canonical,r);a=f.vertices,c=f.indices}else{a=new Dr,c=new Or;for(const{x:g,y}of i)a.emplaceBack(g,y,0,0);const f=rg(a.int16,void 0,4);for(let g=0;g<f.length;g+=3)c.emplaceBack(f[g],f[g+1],f[g+2])}this._tileBoundsBuffer=t.createVertexBuffer(a,Mg.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(c),this._tileBoundsSegments=fn.simpleSegment(0,0,a.length,c.length)}_makeGlobeTileDebugBuffers(t,r){const i=r.projection;if(!i||i.name!=="globe"||r.freezeTileCoverage)return;const a=this.tileID.canonical,c=Zf(i1(a,r)),f=Nl(r.zoom);let g;f>0&&(g=s.m.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,a,r,c,g,f),this._makeGlobeTileDebugTextBuffer(t,a,r,c,g,f)}_globePoint(t,r,i,a,c,f,g){let y=qf(t,r,i);if(f){const x=1<<i.z,E=ja(a.center.lng),S=qa(a.center.lat),M=(i.x+.5)/x-E;let A=0;M>.5?A=-1:M<-.5&&(A=1);let L=(t/ee+i.x)/x+A,R=(r/ee+i.y)/x;L=(L-E)*a._pixelsPerMercatorPixel+E,R=(R-S)*a._pixelsPerMercatorPixel+S;const N=[L*a.worldSize,R*a.worldSize,0];s.v.transformMat4(N,N,f),y=zl(y,N,g)}return s.v.transformMat4(y,y,c)}_makeGlobeTileDebugBorderBuffer(t,r,i,a,c,f){const g=new Xe,y=new Nf,x=new Zr,E=(M,A,L,R,N)=>{const F=(L-M)/(N-1),W=(R-A)/(N-1),H=g.length;for(let $=0;$<N;$++){const Q=M+$*F,et=A+$*W;g.emplaceBack(Q,et);const ct=this._globePoint(Q,et,r,i,a,c,f);x.emplaceBack(ct[0],ct[1],ct[2]),y.emplaceBack(H+$)}},S=ee;E(0,0,S,0,16),E(S,0,S,S,16),E(S,S,0,S,16),E(0,S,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(g,Uf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(x,$x.members),this._tileDebugSegments=fn.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugTextBuffer(t,r,i,a,c,f){const g=ee/4,y=new Xe,x=new Or,E=new Zr,S=25;x.reserve(32),y.reserve(S),E.reserve(S);const M=(A,L)=>S*A+L;for(let A=0;A<S;A++){const L=A*g;for(let R=0;R<S;R++){const N=R*g;y.emplaceBack(N,L);const F=this._globePoint(N,L,r,i,a,c,f);E.emplaceBack(F[0],F[1],F[2])}}for(let A=0;A<4;A++)for(let L=0;L<4;L++){const R=M(A,L),N=M(A,L+1),F=M(A+1,L),W=M(A+1,L+1);x.emplaceBack(R,N,F),x.emplaceBack(F,N,W)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(x),this._tileDebugTextBuffer=t.createVertexBuffer(y,Uf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(E,$x.members),this._tileDebugTextSegments=fn.simpleSegment(0,0,S,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof Vl&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class nS{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,i){const a=t.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const c={value:r,timeout:void 0};if(i!==void 0&&(c.timeout=setTimeout(()=>{this.remove(t,c)},i)),this.data[a].push(c),this.order.push(a),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const i=t.wrapped().key,a=r===void 0?0:this.data[i].indexOf(r),c=this.data[i][a];return this.data[i].splice(a,1),c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(c.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const i in this.data)for(const a of this.data[i])t(a.value)||r.push(a);for(const i of r)this.remove(i.value.tileID,i)}}class Ac{constructor(t,r,i,a){this.id=Ac.uniqueIdxCounter,Ac.uniqueIdxCounter++,this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!i,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||a||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Ac.uniqueIdxCounter,Ac.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ac.uniqueIdxCounter=0;class sp{constructor(t,r,i){this.func=t,this.mask=r,this.range=i}}sp.ReadOnly=!1,sp.ReadWrite=!0,sp.disabled=new sp(519,sp.ReadOnly,[0,1]);const hv=7680;class pv{constructor(t,r,i,a,c,f){this.test=t,this.ref=r,this.mask=i,this.fail=a,this.depthFail=c,this.pass=f}}pv.disabled=new pv({func:519,mask:0},0,0,hv,hv,hv);class Ps{constructor(t,r,i,a){this.blendFunction=t,this.blendColor=r,this.mask=i,this.blendEquation=a}}Ps.Replace=[1,0,1,0],Ps.disabled=new Ps(Ps.Replace,rn.transparent,[!1,!1,!1,!1]),Ps.unblended=new Ps(Ps.Replace,rn.transparent,[!0,!0,!0,!0]),Ps.alphaBlended=new Ps([1,771,1,771],rn.transparent,[!0,!0,!0,!0]),Ps.multiply=new Ps([774,0,774,0],rn.transparent,[!0,!0,!0,!0]);const fv=1029,dv=2305;class ua{constructor(t,r,i){this.enable=t,this.mode=r,this.frontFace=i}}ua.disabled=new ua(!1,fv,dv),ua.backCCW=new ua(!0,fv,dv),ua.backCW=new ua(!0,fv,2304),ua.frontCW=new ua(!0,1028,2304),ua.frontCCW=new ua(!0,1028,dv);class Pc extends xs{constructor(t,r,i){super(),this.id=t,this._onlySymbols=i,r.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new nS(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new aT,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="errored"&&(r.state!=="loaded"||!r.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const i=this._tiles[r];i.upload(t),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Ui(this._tiles).map(t=>t.tileID).sort(Db).map(t=>t.key)}getRenderableIds(t,r){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,t,r)&&i.push(this._tiles[a]);return t?i.sort((a,c)=>{const f=a.tileID,g=c.tileID,y=new At(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),x=new At(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||x.y-y.y||x.x-y.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(Db).map(a=>a.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(i||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const i=this._tiles[t];i&&(i.state!=="loading"&&(i.state=r),this._loadTile(i,this._tileLoaded.bind(this,i,t,r)))}_tileLoaded(t,r,i,a){if(a)if(t.state="errored",a.status!==404)this._source.fire(new fl(a,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new Yo("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=ji.now(),i==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Yo("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let a=0;a<r.length;a++){const c=r[a];if(t.neighboringTiles&&t.neighboringTiles[c]){const f=this.getTileByID(c);i(t,f),i(f,t)}}function i(a,c){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let f=c.tileID.canonical.x-a.tileID.canonical.x;const g=c.tileID.canonical.y-a.tileID.canonical.y,y=Math.pow(2,a.tileID.canonical.z),x=c.tileID.key;f===0&&g===0||Math.abs(g)>1||(Math.abs(f)>1&&(Math.abs(f+y)===1?f+=y:Math.abs(f-y)===1&&(f-=y)),c.dem&&a.dem&&(a.dem.backfillBorder(c.dem,f,g),a.neighboringTiles&&a.neighboringTiles[x]&&(a.neighboringTiles[x].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,i,a){for(const c in this._tiles){let f=this._tiles[c];if(a[c]||!f.hasData()||f.tileID.overscaledZ<=r||f.tileID.overscaledZ>i)continue;let g=f.tileID;for(;f&&f.tileID.overscaledZ>r+1;){const x=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[x.key],f&&f.hasData()&&(g=x)}let y=g;for(;y.overscaledZ>r;)if(y=y.scaledTo(y.overscaledZ-1),t[y.key]){a[g.key]=g;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=r?i:null}for(let i=t.overscaledZ-1;i>=r;i--){const a=t.scaledTo(i),c=this._getLoadedTile(a);if(c)return c}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const i=Math.ceil(t.width/r)+1,a=Math.ceil(t.height/r)+1,c=Math.floor(i*a*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,c):c,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const i={};for(const a in this._tiles){const c=this._tiles[a];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+r),i[c.tileID.key]=c}this._tiles=i;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(t,r,i,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let c;if(this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new fi(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(c=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(y=>this._source.hasTile(y)))):c=[],c.length>0&&this.castsShadows&&a&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!mv(this._source.type)){const y=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),x=Math.min(y,this._source.maxzoom),E=t.extendTileCoverForShadows(c,a,x);for(const S of E)this._shadowCasterTiles[S.key]=!0,c.push(S)}const f=this._updateRetainedTiles(c);if(mv(this._source.type)&&c.length!==0){const y={},x={},E=Object.keys(f);for(const M of E){const A=f[M],L=this._tiles[M];if(!L||L.fadeEndTime&&L.fadeEndTime<=ji.now())continue;const R=this.findLoadedParent(A,Math.max(A.overscaledZ-Pc.maxOverzooming,this._source.minzoom));R&&(this._addTile(R.tileID),y[R.tileID.key]=R.tileID),x[M]=A}const S=c[c.length-1].overscaledZ;for(const M in this._tiles){const A=this._tiles[M];if(f[M]||!A.hasData())continue;let L=A.tileID;for(;L.overscaledZ>S;){L=L.scaledTo(L.overscaledZ-1);const R=this._tiles[L.key];if(R&&R.hasData()&&x[L.key]){f[M]=A.tileID;break}}}for(const M in y)f[M]||(this._coveredTiles[M]=!0,f[M]=y[M])}for(const y in f)this._tiles[y].clearFadeHold();const g=function(y,x){const E=[];for(const S in y)S in x||E.push(S);return E}(this._tiles,f);for(const y of g){const x=this._tiles[y];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const i={},a=t.reduce((x,E)=>Math.min(x,E.overscaledZ),1/0),c=t[0].overscaledZ,f=Math.max(c-Pc.maxOverzooming,this._source.minzoom),g=Math.max(c+Pc.maxUnderzooming,this._source.minzoom),y={};for(const x of t){const E=this._addTile(x);r[x.key]=x,E.hasData()||a<this._source.maxzoom&&(y[x.key]=x)}this._retainLoadedChildren(y,a,g,r);for(const x of t){let E=this._tiles[x.key];if(E.hasData())continue;if(x.canonical.z>=this._source.maxzoom){const M=x.children(this._source.maxzoom)[0],A=this.getTile(M);if(A&&A.hasData()){r[M.key]=M;continue}}else{const M=x.children(this._source.maxzoom);if(r[M[0].key]&&r[M[1].key]&&r[M[2].key]&&r[M[3].key])continue}let S=E.wasRequested();for(let M=x.overscaledZ-1;M>=f;--M){const A=x.scaledTo(M);if(i[A.key]||(i[A.key]=!0,E=this.getTile(A),!E&&S&&(E=this._addTile(A)),E&&(r[A.key]=A,S=E.wasRequested(),E.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let i,a=this._tiles[t].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){i=this._loadedParentTiles[a.key];break}r.push(a.key);const c=a.scaledTo(a.overscaledZ-1);if(i=this._getLoadedTile(c),i)break;a=c}for(const c of r)this._loadedParentTiles[c]=i}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const i=!!r;if(!i){const a=this.map?this.map.painter:null;r=new cv(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,i||this._source.fire(new Yo("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=r.getExpiryTimeout();i&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},i))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,i){const a=[],c=this.transform;if(!c)return a;const f=c.projection.name==="globe",g=ja(c.center.lng);for(const y in this._tiles){const x=this._tiles[y];if(i&&x.clearQueryDebugViz(),x.holdingForFade())continue;let E;if(f){const S=x.tileID.canonical;if(S.z===0){const M=[Math.abs(ke(g,...od(S,-1))-g),Math.abs(ke(g,...od(S,1))-g)];E=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(ke(g,...od(S,-1))-g),Math.abs(ke(g,...od(S,0))-g),Math.abs(ke(g,...od(S,1))-g)];E=[M.indexOf(Math.min(...M))-1]}}else E=[0];for(const S of E){const M=t.containsTile(x,c,r,S);M&&a.push(M)}}return a}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const i=this.getRenderableIds(t,r).map(c=>this._tiles[c].tileID),a=this.transform.projection.name==="globe";for(const c of i)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped()),c.expandedProjMatrix=a?this.transform.calculateProjMatrix(c.toUnwrapped(),!1,!0):c.projMatrix;return i}sortCoordinatesByDistance(t){const r=t.slice(),i=this.transform._camera.position,a=this.transform._camera.forward(),c={};for(const f of r){const g=1/(1<<f.canonical.z);c[f.key]=((f.canonical.x+.5)*g+f.wrap-i[0])*a[0]+((f.canonical.y+.5)*g-i[1])*a[1]-i[2]*a[2]}return r.sort((f,g)=>c[f.key]-c[g.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(mv(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=ji.now())return!0}return!1}setFeatureState(t,r,i){this._state.updateState(t=t||"_geojsonTileLayer",r,i)}removeFeatureState(t,r,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,i)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,i){const a=this._tiles[t];a&&a.setDependencies(r,i)}reloadTilesForDependencies(t,r){for(const i in this._tiles)this._tiles[i].hasDependency(t,r)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const g=()=>{this._sourceLoaded&&(this._source.off("data",g),this._preloadTiles(t,r))};return void this._source.on("data",g)}const i=new Map,a=Array.isArray(t)?t:[t],c=this.map.painter.terrain,f=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const g of a){const y=g.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const x of y)i.set(x.key,x);this.usedForTerrain&&g.updateElevation(!1)}Pn(Array.from(i.values()),(g,y)=>{const x=new cv(g,this._source.tileSize*g.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(x,E=>{this._source.type==="raster-dem"&&x.dem&&this._backfillDEM(x),y(E,x)})},r)}}function Db(e,t){const r=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function mv(e){return e==="raster"||e==="image"||e==="video"||e==="custom"}function od(e,t){const r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}Pc.maxOverzooming=10,Pc.maxUnderzooming=3;const iS=Ee([{name:"a_pos_3f",components:3,type:"Float32"}]),oS=Ee([{name:"a_color_3f",components:3,type:"Float32"}]),sS=Ee([{name:"a_color_4f",components:4,type:"Float32"}]),aS=Ee([{name:"a_uv_2f",components:2,type:"Float32"}]),lS=Ee([{name:"a_normal_3f",components:3,type:"Float32"}]),uS=Ee([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),cS=Ee([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function Rb(e,t){const r=Ag(e.projection,e.zoom,e.width,e.height),i=function(c,f,g,y,x){const E=new Ar(g.lng-180*Au,g.lat),S=new Ar(g.lng+180*Au,g.lat),M=c.project(E.lng,E.lat),A=c.project(S.lng,S.lat),L=-Math.atan2(A.y-M.y,A.x-M.x),R=Li.fromLngLat(g);R.y=ke(R.y,-1+Au,1-Au);const N=R.toLngLat(),F=c.project(N.lng,N.lat),W=Li.fromLngLat(N);W.x+=Au;const H=W.toLngLat(),$=c.project(H.lng,H.lat),Q=Nb($.x-F.x,$.y-F.y,L),et=Li.fromLngLat(N);et.y+=Au;const ct=et.toLngLat(),ft=c.project(ct.lng,ct.lat),gt=Nb(ft.x-F.x,ft.y-F.y,L),Et=Math.abs(Q.x)/Math.abs(gt.y),vt=s.m.identity([]);s.m.rotateZ(vt,vt,-L*(1-(x?0:y)));const Rt=s.m.identity([]);return s.m.scale(Rt,Rt,[1,1-(1-Et)*y,1]),Rt[4]=-gt.x/gt.y*y,s.m.rotateZ(Rt,Rt,L),s.m.multiply(Rt,vt,Rt),Rt}(e.projection,0,e.center,r,t),a=Ob(e);return s.m.scale(i,i,[a,a,1]),i}function Ob(e){const t=e.projection,r=Ag(e.projection,e.zoom,e.width,e.height),i=zb(t,e.center),a=zb(t,Ar.convert(t.center));return Math.pow(2,i*r+(1-r)*a)}function Ag(e,t,r,i,a=1/0){const c=e.range;if(!c)return 0;const f=Math.min(a,Math.max(r,i)),g=Math.log(f/1024)/Math.LN2;return Qn(c[0]+g,c[1]+g,t)}const Au=1/4e4;function zb(e,t){const r=ke(t.lat,-Tn,Tn),i=new Ar(t.lng-180*Au,r),a=new Ar(t.lng+180*Au,r),c=e.project(i.lng,r),f=e.project(a.lng,r),g=Li.fromLngLat(i),y=Li.fromLngLat(a),x=f.x-c.x,E=f.y-c.y,S=y.x-g.x,M=y.y-g.y,A=Math.sqrt((S*S+M*M)/(x*x+E*E));return Math.log(A)/Math.LN2}function Nb(e,t,r){const i=Math.cos(r),a=Math.sin(r);return{x:e*i-t*a,y:e*a+t*i}}function kb(e,t,r){return t*(ee/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}function Fb(e,t,r){s.m.identity(e),s.m.rotateZ(e,e,ae(t[2])),s.m.rotateX(e,e,ae(t[0])),s.m.rotateY(e,e,ae(t[1])),s.m.scale(e,e,r),s.m.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Pg(e,t,r,i,a,c,f,g){const y=[r[0]-t[0],r[1]-t[1],0],x=[i[0]-t[0],i[1]-t[1],0];if(s.v.length(y)<1e-12||s.v.length(x)<1e-12)return s.q.identity(e);const E=s.v.cross([],y,x);s.v.normalize(E,E),s.v.subtract(x,i,t),y[2]=(c-a)*g,x[2]=(f-a)*g;const S=y;return s.v.cross(S,y,x),s.v.normalize(S,S),s.q.rotationTo(e,E,S)}function Bb(e,t,r=!1){const i=Nl(t.zoom),a=function(c,f,g){const y=f.worldSize,x=[c[12],c[13],c[14]],E=Ti(x[1]/y),S=No(x[0]/y),M=s.m.identity([]),A=so(1,E)*y,L=so(1,0)*y*Sc(E,f.zoom),R=1/Ay(y);let N=L*R;if(g){const $=Ag(f.projection,f.zoom,f.width,f.height,1024);N=R*f.projection.pixelSpaceConversion(f.center.lat,y,$)}const F=Tc(E,S);s.v.add(F,F,s.v.scale([],s.v.normalize([],F),A*N*x[2]));const W=function($){const Q=[$[0],$[1],$[2]];let et=[0,1,0];const ct=s.v.cross([],et,Q);return s.v.cross(et,Q,ct),s.v.squaredLength(et)===0&&(et=[0,1,0],s.v.cross(ct,Q,et)),s.v.normalize(ct,ct),s.v.normalize(et,et),s.v.normalize(Q,Q),[ct[0],ct[1],ct[2],0,et[0],et[1],et[2],0,Q[0],Q[1],Q[2],0,$[0],$[1],$[2],1]}(F);s.m.scale(M,M,[N,N,N*A]),s.m.translate(M,M,[-x[0],-x[1],-x[2]]);const H=s.m.multiply([],f.globeMatrix,W);return s.m.multiply(H,H,M),s.m.multiply(H,H,c),H}(e,t,r);if(i>0){const c=function(f,g){const y=g.worldSize,x=so(1,0)*y*Sc(g.center.lat,g.zoom)/Ay(y),E=so(1,g.center.lat)*y,S=s.m.identity([]);return s.m.rotateY(S,S,ae(g.center.lng)),s.m.rotateX(S,S,ae(g.center.lat)),s.m.translate(S,S,[0,0,ss]),s.m.scale(S,S,[x,x,x*E]),s.m.translate(S,S,[g.point.x-.5*y,g.point.y-.5*y,0]),s.m.multiply(S,S,f),s.m.multiply(S,g.globeMatrix,S)}(e,t);return function(f,g,y){const x=(L,R,N)=>{const F=s.v.length(L),W=s.v.length(R),H=zl(L,R,N);return s.v.scale(H,H,1/s.v.length(H)*nr(F,W,N))},E=x([f[0],f[1],f[2]],[g[0],g[1],g[2]],y),S=x([f[4],f[5],f[6]],[g[4],g[5],g[6]],y),M=x([f[8],f[9],f[10]],[g[8],g[9],g[10]],y),A=zl([f[12],f[13],f[14]],[g[12],g[13],g[14]],y);return[E[0],E[1],E[2],0,S[0],S[1],S[2],0,M[0],M[1],M[2],0,A[0],A[1],A[2],1]}(a,c,i)}return a}const Lc=64,Lg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4};function sd(e,t,r=!1){e.uploaded||(e.gfxTexture=new Vl(t,e.image,r?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function hS(e,t,r){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,iS.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,lS.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,aS.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(e.colorArray.bytesPerElement===12?oS:sS).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,cS.members,!0)),e.segments=fn.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const i=e.material;i.pbrMetallicRoughness.baseColorTexture&&sd(i.pbrMetallicRoughness.baseColorTexture,t),i.pbrMetallicRoughness.metallicRoughnessTexture&&sd(i.pbrMetallicRoughness.metallicRoughnessTexture,t),i.normalTexture&&sd(i.normalTexture,t),i.occlusionTexture&&sd(i.occlusionTexture,t,r),i.emissionTexture&&sd(i.emissionTexture,t)}function gv(e,t,r){if(e.meshes)for(const i of e.meshes)hS(i,t,r);if(e.children)for(const i of e.children)gv(i,t,r)}function Dg(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Dg(t)}function Rg(e){if(e.meshes)for(const r of e.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const r of e.children)Rg(r)}class Vb{constructor(t,r){this.feature=t,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Ub{constructor(){this.instancedDataArray=new K_,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Gb{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,r,i,a){this.tileToMeter=Wm(i);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:g,index:y,sourceLayerIndex:x}of t){const E=bu(f,c);if(!this.layers[0]._featureFilter.filter(new ut(this.zoom),E,i))continue;const S={id:g,sourceLayerIndex:x,index:y,geometry:c?E.geometry:Za(f,i,a),properties:f.properties,type:f.type,patterns:{}},M=this.addFeature(S,S.geometry,E);M&&r.featureIndex.insert(f,S.geometry,y,x,this.index,this.instancesPerModel[M].instancedDataArray.length)}this.lookup=null}update(t,r,i,a){for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];for(const g in t)f.idToFeaturesIndex.hasOwnProperty(g)&&this.evaluate(f.features[f.idToFeaturesIndex[g]],t[g],f,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const i=this.instancesPerModel[r];for(const a of i.features){const c=this.layers[0],f=a.feature,g=this.canonical,y=c.paint.get("model-rotation").evaluate(f,{},g),x=c.paint.get("model-scale").evaluate(f,{},g),E=c.paint.get("model-translation").evaluate(f,{},g);s.v.exactEquals(a.rotation,y)&&s.v.exactEquals(a.scale,x)&&s.v.exactEquals(a.translation,E)||(this.evaluate(a,a.featureStates,i,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const r in this.instancesPerModel){const i=this.instancesPerModel[r];i.instancedDataArray.length<0||i.instancedDataArray.length===0||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=t.createVertexBuffer(i.instancedDataArray,uS.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];r.instancedDataArray.length!==0&&r.instancedDataBuffer&&r.instancedDataBuffer.destroy()}}addFeature(t,r,i){const a=this.layers[0],c=a.layout.get("model-id").evaluate(i,{},this.canonical);if(!c)return pn(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),c;this.instancesPerModel[c]||(this.instancesPerModel[c]=new Ub);const f=this.instancesPerModel[c],g=f.instancedDataArray,y=new Vb(i,g.length);for(const x of r)for(const E of x){if(E.x<0||E.x>=ee||E.y<0||E.y>=ee)continue;const S=(this.lookupDim-1)/ee,M=this.lookupDim*(E.y*S|0)+E.x*S|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const A=g.length;g.resize(A+1),f.instancesEvaluatedElevation.push(0),g.float32[16*A]=E.x,g.float32[16*A+1]=E.y}return y.instancedDataCount=f.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(t.id&&(f.idToFeaturesIndex[t.id]=f.features.length),f.features.push(y),this.evaluate(y,{},f,!1)),c}evaluate(t,r,i,a){const c=this.layers[0],f=t.feature,g=this.canonical,y=t.rotation=c.paint.get("model-rotation").evaluate(f,r,g),x=t.scale=c.paint.get("model-scale").evaluate(f,r,g),E=t.translation=c.paint.get("model-translation").evaluate(f,r,g),S=c.paint.get("model-color").evaluate(f,r,g);S.a=c.paint.get("model-color-mix-intensity").evaluate(f,r,g);const M=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),Fb(M,y,x);const A=Math.round(100*S.a)+S.b/1.05;for(let L=0;L<t.instancedDataCount;++L){const R=t.instancedDataOffset+L,N=16*R,F=i.instancedDataArray.float32;let W=0;a&&(W=F[N+6]-i.instancesEvaluatedElevation[R]);const H=0|F[N+1];F[N]=(0|F[N])+S.r/1.05,F[N+1]=H+S.g/1.05,F[N+2]=A,F[N+3]=1/(g.z>10?this.tileToMeter:Wm(g,H)),F[N+4]=E[0],F[N+5]=E[1],F[N+6]=E[2]+W,F[N+7]=M[0],F[N+8]=M[1],F[N+9]=M[2],F[N+10]=M[4],F[N+11]=M[5],F[N+12]=M[6],F[N+13]=M[8],F[N+14]=M[9],F[N+15]=M[10],i.instancesEvaluatedElevation[R]=E[2]}}}me(Gb,"ModelBucket",{omit:["layers"]}),me(Ub,"PerModelAttributes"),me(Vb,"ModelFeature");const pS=new Ft({visibility:new tt(bt.layout_model.visibility),"model-id":new yt(bt.layout_model["model-id"])});var fS={paint:new Ft({"model-opacity":new tt(bt.paint_model["model-opacity"]),"model-rotation":new yt(bt.paint_model["model-rotation"]),"model-scale":new yt(bt.paint_model["model-scale"]),"model-translation":new yt(bt.paint_model["model-translation"]),"model-color":new yt(bt.paint_model["model-color"]),"model-color-mix-intensity":new yt(bt.paint_model["model-color-mix-intensity"]),"model-type":new tt(bt.paint_model["model-type"]),"model-cast-shadows":new tt(bt.paint_model["model-cast-shadows"]),"model-receive-shadows":new tt(bt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new tt(bt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new yt(bt.paint_model["model-emissive-strength"]),"model-roughness":new yt(bt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new yt(bt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new tt(bt.paint_model["model-cutoff-fade-range"])}),layout:pS};const _v=new Float32Array(262144),Dc=new Uint8Array(262144);function jb(e){let t=0;if(e.meshes)for(const r of e.meshes)t=Math.max(t,r.aabb.max[2]);if(e.children)for(const r of e.children)t=Math.max(t,jb(r));return t}const qb=["","wall","door","roof","window","lamp","logo"];class Zb{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:jb(t)}}}}class Xb{constructor(t,r,i,a){this.nodes=t,this.id=r,this.modelTraits|=Lg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=Lg.HasMapboxMeshFeatures),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=a,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const i of r){const a=i.node;this.uploaded?this.updatePbrBuffer(a):gv(a,t,!0)}for(const i of r)Dg(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let r=!1;if(!t.meshes)return r;for(const i of t.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),r=!0);return r}needsReEvaluation(t,r,i){const a=t.transform.projectionOptions,c=t.style.getBrightness(),f=this.brightness!==c;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||ad(i.paint.get("model-color").value,f)||ad(i.paint.get("model-color-mix-intensity").value,f)||ad(i.paint.get("model-roughness").value,f)||ad(i.paint.get("model-emissive-strength").value,f)||ad(i.paint.get("model-height-based-emissive-strength-multiplier").value,f))&&(this.projection=a,this.brightness=c,!0)}evaluateScale(t,r){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const i=this.getNodesInfo(),a=this.id.canonical;for(const c of i){const f=c.feature;c.evaluatedScale=r.paint.get("model-scale").evaluate(f,{},a)}}evaluate(t){const r=this.getNodesInfo();for(const i of r){if(!i.node.meshes)continue;const a=i.feature,c=i.node.meshes&&i.node.meshes[0].featureData,f=i.evaluatedColor[2],g=i.evaluatedRMEA[2],y=this.id.canonical;if(i.hasTranslucentParts=!1,c){for(let x=0;x<qb.length;x++){const E=qb[x];E.length&&(a.properties.part=E);const S=t.paint.get("model-color").evaluate(a,{},y),M=t.paint.get("model-color-mix-intensity").evaluate(a,{},y);i.evaluatedColor[x]=[S.r,S.g,S.b,M],i.evaluatedRMEA[x][0]=t.paint.get("model-roughness").evaluate(a,{},y),i.evaluatedRMEA[x][2]=t.paint.get("model-emissive-strength").evaluate(a,{},y),i.evaluatedRMEA[x][3]=S.a,i.emissionHeightBasedParams[x]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},y),!i.hasTranslucentParts&&S.a<1&&(i.hasTranslucentParts=!0)}delete a.properties.part,mS(i,f!==i.evaluatedColor[2]||g!==i.evaluatedRMEA[2])}else i.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(a,{},y);i.evaluatedScale=t.paint.get("model-scale").evaluate(a,{},y),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,r,i,a){const c=t.findDEMTileFor(i);if(c&&(c.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const f=Qh.create(t,i,c);if(!f)return;this.modelTraits&Lg.HasMapboxMeshFeatures&&this.updateDEM(t,f,i,a);for(const g of this.getNodesInfo()){const y=g.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;const x=y.footprint.vertices;let E=f.getElevationAt(x[0].x,x[0].y,!0,!0);for(let S=1;S<x.length;S++)E=Math.min(E,f.getElevationAt(x[S].x,x[S].y,!0,!0));y.elevation=E}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=r}}updateDEM(t,r,i,a){let c=r._dem._modifiedForSources[a];if(c===void 0&&(r._dem._modifiedForSources[a]=[],c=r._dem._modifiedForSources[a]),c.includes(i.canonical))return;const f=r._dem.dim;c.push(i.canonical);let g=!1;for(const y of this.getNodesInfo()){const x=y.node;if(!x.footprint||!x.footprint.grid)continue;const E=x.footprint.grid,S=r.tileCoordToPixel(E.min.x,E.min.y),M=r.tileCoordToPixel(E.max.x,E.max.y),A=Math.min(Math.min(f-M.y,S.x),Math.min(S.y,f-M.x));if(A<0)continue;const L=ke(A,2,5);let R=Math.max(0,S.x-L),N=Math.max(0,S.y-L),F=Math.min(M.x+L,f-1),W=Math.min(M.y+L,f-1);for(let et=N;et<=W;++et)for(let ct=R;ct<=F;++ct)Dc[et*f+ct]=255;let H=0,$=0;for(let et=0;et<E.cellsY;++et)for(let ct=0;ct<E.cellsX;++ct){if(!E.cells[et*E.cellsX+ct])continue;const ft=r.tileCoordToPixel(E.min.x+ct/E.xScale,E.min.y+et/E.yScale),gt=r.tileCoordToPixel(E.min.x+(ct+1)/E.xScale,E.min.y+(et+1)/E.yScale);for(let Et=ft.y;Et<=Math.min(gt.y+1,f-1);++Et)for(let vt=ft.x;vt<=Math.min(gt.x+1,f-1);++vt)Dc[Et*f+vt]===255&&(Dc[Et*f+vt]=0,H+=r.getElevationAtPixel(vt,Et),$++)}const Q=H/$;R=Math.max(1,S.x-L),N=Math.max(1,S.y-L),F=Math.min(M.x+L,f-2),W=Math.min(M.y+L,f-2),g=!0;for(let et=N;et<=W;++et)for(let ct=R;ct<=F;++ct)Dc[et*f+ct]===0&&(_v[et*f+ct]=r._dem.set(ct,et,Q));for(let et=1;et<L;++et){R=Math.max(1,S.x-et),N=Math.max(1,S.y-et),F=Math.min(M.x+et,f-2),W=Math.min(M.y+et,f-2);for(let ct=N;ct<=W;++ct)for(let ft=R;ft<=F;++ft){const gt=ct*f+ft;if(Dc[gt]===255){let Et=0,vt=0,Rt=-1,Xt=-1;for(let Pt=-1;Pt<=1;++Pt)for(let Ut=-1;Ut<=1;++Ut){const Mt=(ct+Pt)*f+ft+Ut;if(Dc[Mt]>=et)continue;const oe=_v[Mt],de=Math.abs(oe);de>vt&&(Et=oe,vt=de,Rt=Ut,Xt=Pt)}if(vt>.1){const Pt=1-(et+.5*Math.abs(Rt*Xt))/L;let Ut=r._dem.get(ft,ct)+Et*Pt;const Mt=r._dem.get(ft+Rt,ct+Xt),oe=r._dem.get(ft-Rt,ct-Xt,!0);(Ut-Mt)*(Ut-oe)>0&&(Ut=(Mt+oe)/2),_v[gt]=r._dem.set(ft,ct,Ut),Dc[gt]=et}}}}}g&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=ji.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const t of this.nodes)this.nodesInfo.push(new Zb(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const t of this.nodes)Rg(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const t=this.getNodesInfo();for(const r of t)Dg(r.node),Rg(r.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const i=r.getReplacementRegionsForTile(t.toUnwrapped()),a=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const f=a[c].node;a[c].hiddenByReplacement=!!f.footprint&&!i.find(g=>g.footprint===f.footprint)}}getHeightAtTileCoord(t,r){const i=this.getNodesInfo(),a=[];for(let c=0;c<this.nodesInfo.length;c++){const f=i[c],g=f.node.meshes[0];if(t<g.aabb.min[0]||r<g.aabb.min[1]||t>g.aabb.max[0]||r>g.aabb.max[1])continue;const y=(t-g.aabb.min[0])/(g.aabb.max[0]-g.aabb.min[0])*Lc|0,x=Math.min(63,(r-g.aabb.min[1])/(g.aabb.max[1]-g.aabb.min[1])*Lc|0)*Lc+Math.min(63,y);if(!(g.heightmap[x]<0&&f.node.footprint))return f.hiddenByReplacement?void 0:{height:g.heightmap[x],maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};if(f.node.footprint.grid.query(new At(t,r),new At(t,r),a),a.length>0)return{height:void 0,maxHeight:f.feature.properties.height,hidden:f.hiddenByReplacement,verticalScale:f.evaluatedScale[2]}}}}function ad(e,t){return!e.isLightConstant&&t}function dS(e,t,r,i,a,c,f,g){let y=(61440&t|(61440&t)>>4)>>8,x=(3840&t|(3840&t)>>4)>>4,E=240&t|(240&t)>>4;r[3]>0&&(y=nr(y,255*r[0],r[3]),x=nr(x,255*r[1],r[3]),E=nr(E,255*r[2],r[3]));const S=y<<8|x,M=E<<8|Math.floor(255*i[3]),A=function(et){const ct=ke(et,0,2);return Math.min(Math.round(.5*ct*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],L=ke(a[0],0,1),R=ke(a[1],0,1),N=ke(a[2],0,1),F=ke(a[3],0,1);let W,H,$,Q;if(L!==R&&f!==c&&R!==L){const et=f-c;H=1/(et*(R-L)),$=-(c+et*L)/(et*(R-L));const ct=ke(a[4],-1,1);Q=Math.pow(10,ct),W=255*N<<8|255*F}else W=65535,H=0,$=1,Q=1;if(e.emplaceBack(S,M,A,W,H,$,Q),g){const et=g.length;g.clear();for(let ct=0;ct<et;ct++)g.emplaceBack(S,M,A,W,H,$,Q)}}function mS(e,t){const r=e.node;let i=0;for(const a of r.meshes){if(r.lights&&r.lightMeshIndex===i||!a.featureData)continue;a.featureArray=new Nm,a.featureArray.reserve(a.featureData.length);let c=t;for(const f of a.featureData){let g;const y=65535&f,x=(15&y)<8?15&y:0,E=f>>16&65535,S=e.evaluatedRMEA[x],M=e.evaluatedColor[x],A=e.emissionHeightBasedParams[x];if(c&&x===2&&r.lights&&(g=new Nm,g.resize(10*r.lights.length)),dS(a.featureArray,E,M,S,A,a.aabb.min[2],a.aabb.max[2],g),g&&c){c=!1;const L=r.meshes[r.lightMeshIndex];L.featureArray=g,L.featureArray._trim()}}a.featureArray._trim(),i++}}function Og(e,t){return e.x-t.x||e.y-t.y}function Wb(e,t){return Og(e.min,t.min)===0&&Og(e.max,t.max)===0}function Hb(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Yb(e,t,r){const i=1/ee,a=1/(1<<r.canonical.z),c=(t.x*i+r.canonical.x)*a+r.wrap,f=(t.y*i+r.canonical.y)*a;return{min:new At((e.x*i+r.canonical.x)*a+r.wrap,(e.y*i+r.canonical.y)*a),max:new At(c,f)}}function gS(e,t,r){const i=1<<r.canonical.z,a=((t.x-r.wrap)*i-r.canonical.x)*ee,c=(t.y*i-r.canonical.y)*ee;return{min:new At(((e.x-r.wrap)*i-r.canonical.x)*ee,(e.y*i-r.canonical.y)*ee),max:new At(a,c)}}function $b(e,t,r,i,a,c,f){const g=e.indices,y=e.vertices,x=[];for(let E=i;E<i+a;E+=3){const S=t[r[E+0]+c],M=t[r[E+1]+c],A=t[r[E+2]+c],L=Math.min(S.x,M.x,A.x),R=Math.max(S.x,M.x,A.x),N=Math.min(S.y,M.y,A.y),F=Math.max(S.y,M.y,A.y);x.length=0,e.grid.query(new At(L,N),new At(R,F),x);for(let W=0;W<x.length;W++){const H=x[W];if(By(y[g[3*H+0]],y[g[3*H+1]],y[g[3*H+2]],S,M,A,f))return!0}}return!1}function Jb(e,t,r,i){if(!e||!r)return!1;let a=e.vertices;if(!t.canonical.equals(i.canonical)||t.wrap!==i.wrap){if(r.vertices.length<e.vertices.length)return Jb(r,i,e,t);const c=t.canonical,f=i.canonical,g=Math.pow(2,f.z-c.z);a=e.vertices.map(y=>new At(y.x*c.x*ee*g-f.x*ee,y.y*c.y*ee*g-f.y*ee))}return $b(r,a,e.indices,0,e.indices.length,0,0)}me(Xb,"Tiled3dModelBucket",{omit:["layers"]}),me(Zb,"Tiled3dModelFeature");const _S=og.types,yS=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],vS=["fill-extrusion-flood-light-ground-radius"],xS=Math.pow(2,13),bS=Math.pow(2,15)-1,Kb=new At(0,1),Pu=2147483648;function ld(e,t,r,i,a,c,f,g){e.emplaceBack((t<<1)+f,(r<<1)+c,(Math.floor(i*xS)<<1)+a,Math.round(g))}function zg(e,t,r,i,a,c){e.emplaceBack(t.x,t.y,(r.x<<1)+i,(r.y<<1)+a,c)}function ud(e,t,r){e.emplaceBack(t.x,t.y,t.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Qb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class tw{constructor(){this.centroidXY=new At(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new At(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new At(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new At(this.max.x-this.min.x,this.max.y-this.min.y)}}class ew{constructor(){this.acc=new At(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,r){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=r.x,t.min.y=t.max.y=r.y)}appendEdge(t,r,i){this.accCount++,this.acc._add(r);let a=!!this.borders;r.x<t.min.x?(t.min.x=r.x,a=!0):r.x>t.max.x&&(t.max.x=r.x,a=!0),r.y<t.min.y?(t.min.y=r.y,a=!0):r.y>t.max.y&&(t.max.y=r.y,a=!0),((r.x===0||r.x===ee)&&r.x===i.x)!=((r.y===0||r.y===ee)&&r.y===i.y)&&this.processBorderOverlap(r,i),a&&this.checkBorderIntersection(r,i)}checkBorderIntersection(t,r){r.x<0!=t.x<0&&this.addBorderIntersection(0,nr(r.y,t.y,(0-r.x)/(t.x-r.x))),r.x>ee!=t.x>ee&&this.addBorderIntersection(1,nr(r.y,t.y,(ee-r.x)/(t.x-r.x))),r.y<0!=t.y<0&&this.addBorderIntersection(2,nr(r.x,t.x,(0-r.y)/(t.y-r.y))),r.y>ee!=t.y>ee&&this.addBorderIntersection(3,nr(r.x,t.x,(ee-r.y)/(t.y-r.y)))}addBorderIntersection(t,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];r<i[0]&&(i[0]=r),r>i[1]&&(i[1]=r)}processBorderOverlap(t,r){if(t.x===r.x){if(t.y===r.y)return;const i=t.x===0?0:1;this.addBorderIntersection(i,r.y),this.addBorderIntersection(i,t.y)}else{const i=t.y===0?2:3;this.addBorderIntersection(i,r.x),this.addBorderIntersection(i,t.x)}}centroid(){return this.accCount===0?new At(0,0):new At(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,r)=>t+ +(r[0]!==Number.MAX_VALUE),0):0}}function rw(e,t){const r=e.add(t)._unit(),i=ke(e.x*r.x+e.y*r.y,-1,1);var a,c,f;return a=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(a)))/4*bS*((c=e).x*(f=t).y-c.y*f.x<0?-1:1)}const wS=[e=>e.x<0,e=>e.x>ee,e=>e.y<0,e=>e.y>ee];function ES(e,t,r,i){const a=[4];if(i===0)return a;r._mult(i);const c=e.sub(r),f=t.sub(r),g=[e,t,c,f];for(let y=0;y<4;y++)for(const x of g)if(wS[y](x)){a.push(y);break}return a}class nw{constructor(t){this.vertexArray=new Wi,this.indexArray=new Or,this.programConfigurations=new _u(t.layers,t.zoom,r=>vS.includes(r)),this._segments=new fn,this.hiddenByLandmarkVertexArray=new Q_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new fn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,r,i,a=!1){const c=t.length;if(c>2){let f=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let y;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const x=t[0],E=t[1];y=rw(x.sub(t[c-1])._perp()._unit(),E.sub(x)._perp()._unit())}for(let x=0;x<c;x++){const E=x===c-1?0:x+1,S=t[x],M=t[E],A=t[E===c-1?0:E+1],L=M.sub(S)._perp()._unit(),R=rw(L,A.sub(M)._perp()._unit()),N=y,F=R;if(yv(S,M,r)||a&&sw(S,r)&&sw(M,r)){y=R;continue}const W=g.vertexLength;zg(this.vertexArray,S,M,1,1,N),zg(this.vertexArray,S,M,1,0,N),zg(this.vertexArray,S,M,0,1,F),zg(this.vertexArray,S,M,0,0,F),g.vertexLength+=4;const H=ES(S,M,L,i);for(const $ of H)this._segmentToGroundQuads[f].push({id:W,region:$}),this._segmentToRegionTriCounts[f][$]+=2,g.primitiveLength+=2;y=R}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),r=t.length;for(let i=0;i<r;i++)this._segmentToGroundQuads[i].sort((a,c)=>a.region-c.region);for(let i=0;i<r;i++){const a=this._segmentToGroundQuads[i],c=t[i],f=this._segmentToRegionTriCounts[i];f.reduce((y,x)=>y+x,0);let g=0;for(let y=0;y<=4;y++){const x=f[y];if(x!==0){let E=this.regionSegments[y];E||(E=this.regionSegments[y]=new fn);const S={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+g,vertexLength:c.vertexLength,primitiveLength:x};E.get().push(S)}g+=x}for(let y=0;y<a.length;y++){const x=a[y].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,r,i,a,c,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,r,i,a,c,f)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,FI.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,r,i,a,c,f){this.hasData()&&this.programConfigurations.updatePaintArrays(t,r,i,a,c,f)}updateHiddenByLandmark(t){if(!this.hasData())return;const r=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const i=t.flags&Pu?1:0;for(let a=t.groundVertexArrayOffset;a<r;++a)this.hiddenByLandmarkVertexArray.emplace(a,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,VI.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const r=this.regionSegments[t];r&&r.destroy()}}}}class cd{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Or,this.footprintVertices=new Xe,this.footprintSegments=[],this.layoutVertexArray=new Dr,this.centroidVertexArray=new M0,this.indexArray=new Or,this.programConfigurations=new _u(t.layers,t.zoom,r=>yS.includes(r)),this.segments=new fn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new nw(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,r,i,a){this.features=[],this.hasPattern=Xy("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Wm(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:f,index:g,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,E=bu(c,x);if(!this.layers[0]._featureFilter.filter(new ut(this.zoom),E,i))continue;const S={id:f,sourceLayerIndex:y,index:g,geometry:x?E.geometry:Za(c,i,a),properties:c.properties,type:c.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(Wy("fill-extrusion",this.layers,S,this.zoom,r)):this.addFeature(S,S.geometry,g,i,{},r.availableImages,a,r.brightness),r.featureIndex.insert(c,S.geometry,g,y,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,r,i,a,c,f){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,r,i,a,c,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,r,i,a,c){const f=Object.keys(t).length!==0;if(f&&!this.stateDependentLayers.length)return;const g=f?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,r,g,i,a,c),this.groundEffect.update(t,r,g,i,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,GI),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,UI.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,BI.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,i,a,c,f,g,y){const x=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,E=[new At(0,0),new At(ee,ee)],S=g.projection,M=S.name==="globe",A=_S[t.type]==="Polygon",L=new ew;L.centroidDataIndex=this.centroidData.length;const R=new tw,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},a)<=0,F=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},a);R.height=F,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new nn);const W=Zy(r,500);for(let ft=W.length-1;ft>=0;ft--){const gt=W[ft];(gt.length===0||(H=gt[0]).every(Et=>Et.x<=0)||H.every(Et=>Et.x>=ee)||H.every(Et=>Et.y<=0)||H.every(Et=>Et.y>=ee))&&W.splice(ft,1)}var H;let $;if(M)$=cw(W,E,a);else{$=[];for(const ft of W)$.push({polygon:ft,bounds:E})}const Q=A?this.edgeRadius:0,et=Q>0&&this.zoom<17,ct=(ft,gt)=>{if(ft.length===0)return!1;const Et=ft[ft.length-1];return gt.x===Et.x&&gt.y===Et.y};for(const{polygon:ft,bounds:gt}of $){let Et=0,vt=0;for(const Ut of ft)A&&!Ut[0].equals(Ut[Ut.length-1])&&Ut.push(Ut[0]),vt+=A?Ut.length-1:Ut.length;const Rt=this.segments.prepareSegment((A?5:4)*vt,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const Xt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Pt=new Qb;if(Pt.vertexOffset=this.footprintVertices.length,Pt.indexOffset=3*this.footprintIndices.length,Pt.ringIndices=[],A){const Ut=[],Mt=[];Et=Rt.vertexLength;for(let de=0;de<ft.length;de++){const qt=ft[de];qt.length&&de!==0&&Mt.push(Ut.length/2);const De=[];let _e,ne;_e=qt[1].sub(qt[0])._perp()._unit(),Pt.ringIndices.push(qt.length-1);for(let Re=1;Re<qt.length;Re++){const Ie=qt[Re],Me=qt[Re===qt.length-1?1:Re+1],Kt=Ie.clone();if(Q){ne=Me.sub(Ie)._perp()._unit();const Ue=_e.add(ne)._unit(),hr=Q*Math.min(4,1/(_e.x*Ue.x+_e.y*Ue.y));Kt.x+=hr*Ue.x,Kt.y+=hr*Ue.y,Kt.x=Math.round(Kt.x),Kt.y=Math.round(Kt.y),_e=ne}!N||Q!==0&&!et||ct(De,Kt)||De.push(Kt),ld(this.layoutVertexArray,Kt.x,Kt.y,0,0,1,1,0),Rt.vertexLength++,this.footprintVertices.emplaceBack(Ie.x,Ie.y),Ut.push(Ie.x,Ie.y),M&&ud(this.layoutVertexExtArray,S.projectTilePoint(Kt.x,Kt.y,a),S.upVector(a,Kt.x,Kt.y))}N&&(Q===0||et)&&(De.length!==0&&ct(De,De[0])&&De.pop(),this.groundEffect.addData(De,gt,x))}const oe=rg(Ut,Mt);for(let de=0;de<oe.length;de+=3)this.footprintIndices.emplaceBack(Pt.vertexOffset+oe[de+0],Pt.vertexOffset+oe[de+1],Pt.vertexOffset+oe[de+2]),this.indexArray.emplaceBack(Et+oe[de],Et+oe[de+2],Et+oe[de+1]),Rt.primitiveLength++;Pt.indexCount+=oe.length,Pt.vertexCount+=this.footprintVertices.length-Pt.vertexOffset}for(let Ut=0;Ut<ft.length;Ut++){const Mt=ft[Ut];L.startRing(R,Mt[0]);let oe=Mt.length>4&&aw(Mt[Mt.length-2],Mt[0],Mt[1]),de=Q?IS(Mt[Mt.length-2],Mt[0],Mt[1],Q):0;const qt=[];let De,_e,ne;_e=Mt[1].sub(Mt[0])._perp()._unit();let Re=!0;for(let Ie=1,Me=0;Ie<Mt.length;Ie++){let Kt=Mt[Ie-1],Ue=Mt[Ie];const hr=Mt[Ie===Mt.length-1?1:Ie+1];if(L.appendEdge(R,Ue,Kt),yv(Ue,Kt,gt)){Q&&(_e=hr.sub(Ue)._perp()._unit(),Re=!Re);continue}const We=Ue.sub(Kt)._perp(),sr=We.x/(Math.abs(We.x)+Math.abs(We.y)),br=We.y>0?1:0,Xr=Kt.dist(Ue);if(Me+Xr>32768&&(Me=0),Q){ne=hr.sub(Ue)._perp()._unit();let Pr=ow(Kt,Ue,hr,iw(_e,ne),Q);isNaN(Pr)&&(Pr=0);const Rr=Ue.sub(Kt)._unit();Kt=Kt.add(Rr.mult(de))._round(),Ue=Ue.add(Rr.mult(-Pr))._round(),de=Pr,_e=ne,N&&this.zoom>=17&&(ct(qt,Kt)||qt.push(Kt),ct(qt,Ue)||qt.push(Ue))}const Qe=Rt.vertexLength,sn=Mt.length>4&&aw(Kt,Ue,hr);let Wr=lw(Me,oe,Re);if(ld(this.layoutVertexArray,Kt.x,Kt.y,sr,br,0,0,Wr),ld(this.layoutVertexArray,Kt.x,Kt.y,sr,br,0,1,Wr),Me+=Xr,Wr=lw(Me,sn,!Re),oe=sn,ld(this.layoutVertexArray,Ue.x,Ue.y,sr,br,0,0,Wr),ld(this.layoutVertexArray,Ue.x,Ue.y,sr,br,0,1,Wr),Rt.vertexLength+=4,this.indexArray.emplaceBack(Qe+0,Qe+1,Qe+2),this.indexArray.emplaceBack(Qe+1,Qe+3,Qe+2),Rt.primitiveLength+=2,Q){const Pr=Et+(Ie===1?Mt.length-2:Ie-2),Rr=Ie===1?Et:Pr+1;if(this.indexArray.emplaceBack(Qe+1,Pr,Qe+3),this.indexArray.emplaceBack(Pr,Rr,Qe+3),Rt.primitiveLength+=2,De===void 0&&(De=Qe),!yv(hr,Mt[Ie],gt)){const wr=Ie===Mt.length-1?De:Rt.vertexLength;this.indexArray.emplaceBack(Qe+2,Qe+3,wr),this.indexArray.emplaceBack(Qe+3,wr+1,wr),this.indexArray.emplaceBack(Qe+3,Rr,wr+1),Rt.primitiveLength+=3}Re=!Re}if(M){const Pr=this.layoutVertexExtArray,Rr=S.projectTilePoint(Kt.x,Kt.y,a),wr=S.projectTilePoint(Ue.x,Ue.y,a),yn=S.upVector(a,Kt.x,Kt.y),an=S.upVector(a,Ue.x,Ue.y);ud(Pr,Rr,yn),ud(Pr,Rr,yn),ud(Pr,wr,an),ud(Pr,wr,an)}}A&&(Et+=Mt.length-1),N&&Q&&this.zoom>=17&&(qt.length!==0&&ct(qt,qt[0])&&qt.pop(),this.groundEffect.addData(qt,gt,x,Q>0))}this.footprintSegments.push(Pt),Xt.triangleCount=this.indexArray.length-Xt.triangleArrayOffset,this.polygonSegments.push(Xt),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=L.borders?Kb:this.encodeCentroid(L,R),this.centroidData.push(R),L.borders){this.featuresOnBorder.push(L);const ft=this.featuresOnBorder.length-1;for(let gt=0;gt<L.borders.length;gt++)L.borders[gt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[gt].push(ft)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,c,f,a,y),this.groundEffect.addPaintPropertiesData(t,i,c,f,a,y),this.maxHeight=Math.max(this.maxHeight,F)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((r,i)=>this.featuresOnBorder[r].borders[t][0]-this.featuresOnBorder[i].borders[t][0])}splitToSubtiles(){const t=[];for(let g=0;g<this.centroidData.length;g++){const y=this.centroidData[g],x=+(y.min.y+y.max.y>ee),E=2*x+(+(y.min.x+y.max.x>ee)^x);for(let S=0;S<y.polygonSegLen;S++){const M=y.polygonSegIdx+S;t.push({centroidIdx:g,subtile:E,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const r=new Or;t.sort((g,y)=>g.triangleSegmentIdx===y.triangleSegmentIdx?g.subtile-y.subtile:g.triangleSegmentIdx-y.triangleSegmentIdx);let i=0,a=0,c=0;for(const g of t){if(g.triangleSegmentIdx!==i)break;c++}const f=t.length;for(;a!==t.length;){i=t[a].triangleSegmentIdx;let g=0,y=a,x=a;for(let E=y;E<c&&t[E].subtile===g;E++)x++;for(;y!==c;){const E=t[y];g=E.subtile;const S=this.centroidData[E.centroidIdx].min.clone(),M=this.centroidData[E.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let L=y;L<x;L++){const R=t[L],N=this.polygonSegments[R.polygonSegmentIdx],F=this.centroidData[R.centroidIdx].min,W=this.centroidData[R.centroidIdx].max,H=this.indexArray.uint16;for(let $=N.triangleArrayOffset;$<N.triangleArrayOffset+N.triangleCount;$++)r.emplaceBack(H[3*$],H[3*$+1],H[3*$+2]);A.primitiveLength+=N.triangleCount,S.x=Math.min(S.x,F.x),S.y=Math.min(S.y,F.y),M.x=Math.max(M.x,W.x),M.y=Math.max(M.y,W.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:S,max:M}),y=x;for(let L=y;L<c&&t[L].subtile===t[y].subtile;L++)x++}a=c;for(let E=a;E<f&&t[E].triangleSegmentIdx===t[a].triangleSegmentIdx;E++)c++}r._trim(),this.indexArray=r}getVisibleSegments(t,r,i){let a=0,c=0;const f=1<<t.canonical.z;if(r){const R=r.getMinMaxForTile(t);R&&(a=R.min,c=R.max)}c+=this.maxHeight;const g=t.toUnwrapped();let y;const x=[g.canonical.x/f+g.wrap,g.canonical.y/f],E=[(g.canonical.x+1)/f+g.wrap,(g.canonical.y+1)/f],S=new fn,M=(R,N,F)=>[R[0]*(1-F[0])+N[0]*F[0],R[1]*(1-F[1])+N[1]*F[1]],A=[],L=[];for(const R of this.triangleSubSegments){A[0]=R.min.x/ee,A[1]=R.min.y/ee,L[0]=R.max.x/ee,L[1]=R.max.y/ee;const N=M(x,E,A),F=M(x,E,L);if(new On([N[0],N[1],a],[F[0],F[1],c]).intersectsPrecise(i)===0){y&&(S.segments.push(y),y=void 0);continue}const W=R.segment;y&&y.vertexOffset!==W.vertexOffset&&(S.segments.push(y),y=void 0),y?(y.vertexLength+=W.vertexLength,y.primitiveLength+=W.primitiveLength):y={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&S.segments.push(y),S}encodeCentroid(t,r){const i=t.centroid(),a=r.span(),c=Math.min(7,Math.round(a.x*this.tileToMeter/10)),f=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new At(ke(i.x,1,ee-1)<<3|c,ke(i.y,1,ee-1)<<3|f)}encodeBorderCentroid(t){if(!t.borders)return new At(0,0);const r=t.borders,i=Number.MAX_VALUE;if(r[0][0]!==i||r[1][0]!==i){const a=r[0][0]!==i?0:1;return new At(6|(r[0][0]!==i?0:65528),((r[a][0]+r[a][1])/2|0)<<3|6)}{const a=r[2][0]!==i?2:3;return new At(((r[a][0]+r[a][1])/2|0)<<3|6,6|(r[2][0]!==i?0:65528))}}showCentroid(t){const r=this.centroidData[t.centroidDataIndex];r.flags&=Pu,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const r=t.vertexArrayOffset,i=t.vertexCount+t.vertexArrayOffset,a=t.flags&Pu?Kb:t.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==a.y||c!==a.x){for(let f=r;f<i;++f)this.centroidVertexArray.emplace(f,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const i=r.getReplacementRegionsForTile(t.toUnwrapped());if(function(c,f){if(c.length!==f.length)return!1;for(let g=0;g<c.length;g++)if(c[g].sourceId!==f[g].sourceId||!Wb(c[g],f[g]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const c of this.centroidData)c.flags&=2147483647;const a=[];for(const c of this.activeReplacements){const f=Math.pow(2,c.footprintTileId.canonical.z-t.canonical.z);for(const g of this.centroidData)if(!(g.flags&Pu||c.min.x>g.max.x||g.min.x>c.max.x||c.min.y>g.max.y||g.min.y>c.max.y))for(let y=0;y<g.footprintSegLen;y++){const x=this.footprintSegments[g.footprintSegIdx+y];if(a.length=0,TS(this.footprintVertices,x.vertexOffset,x.vertexCount,c.footprintTileId.canonical,t.canonical,a),$b(c.footprint,a,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-f)){g.flags|=Pu;break}}}for(const c of this.centroidData)this.writeCentroidToBuffer(c);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,r,i){let a=!1;for(let c=0;c<i.footprintSegLen;c++){const f=this.footprintSegments[i.footprintSegIdx+c];let g=0;for(const y of f.ringIndices){for(let x=g,E=y+g-1;x<y+g;E=x++){const S=this.footprintVertices.int16[2*(x+f.vertexOffset)+0],M=this.footprintVertices.int16[2*(x+f.vertexOffset)+1],A=this.footprintVertices.int16[2*(E+f.vertexOffset)+1];M>r!=A>r&&t<(this.footprintVertices.int16[2*(E+f.vertexOffset)+0]-S)*(r-M)/(A-M)+S&&(a=!a)}g=y}}return a}getHeightAtTileCoord(t,r){let i=Number.NEGATIVE_INFINITY,a=!0;const c=4*(t+ee)*ee+(r+ee);if(this.partLookup.hasOwnProperty(c)){const f=this.partLookup[c];return f?{height:f.height,hidden:!!(f.flags&Pu)}:void 0}for(const f of this.centroidData)t>f.max.x||f.min.x>t||r>f.max.y||f.min.y>r||this.footprintContainsPoint(t,r,f)&&f&&f.height>i&&(i=f.height,this.partLookup[c]=f,a=!!(f.flags&Pu));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:a};this.partLookup[c]=void 0}}function iw(e,t){const r=e.add(t)._unit();return e.x*r.x+e.y*r.y}function IS(e,t,r,i){const a=t.sub(e)._perp()._unit(),c=r.sub(t)._perp()._unit();return ow(e,t,r,iw(a,c),i)}function ow(e,t,r,i,a){const c=Math.sqrt(1-i*i);return Math.min(e.dist(t)/3,t.dist(r)/3,a*c/i)}function yv(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function sw(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function aw(e,t,r){if(e.x<0||e.x>=ee||t.x<0||t.x>=ee||r.x<0||r.x>=ee)return!1;const i=r.sub(t),a=i.perp(),c=e.sub(t);return(i.x*c.x+i.y*c.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(c.x*c.x+c.y*c.y))>-.866&&a.x*c.x+a.y*c.y<0}function lw(e,t,r){const i=t?2|e:-3&e;return r?1|i:-2&i}function uw(){const e=Math.PI/32,t=Math.tan(e),r=Xf;return r*Math.sqrt(1+2*t*t)-r}function cw(e,t,r){const i=1<<r.z,a=No(r.x/i),c=No((r.x+1)/i),f=Ti(r.y/i),g=Ti((r.y+1)/i);return function(y,x,E,S,M=0,A){const L=[];if(!y.length||!E||!S)return L;const R=(et,ct)=>{for(const ft of et)L.push({polygon:ft,bounds:ct})},N=Math.ceil(Math.log2(E)),F=Math.ceil(Math.log2(S)),W=N-F,H=[];for(let et=0;et<Math.abs(W);et++)H.push(W>0?0:1);for(let et=0;et<Math.min(N,F);et++)H.push(0),H.push(1);let $=y;if($=sg($,x[0].y-M,x[1].y+M,1),$=sg($,x[0].x-M,x[1].x+M,0),!$.length)return L;const Q=[];for(H.length?Q.push({polygons:$,bounds:x,depth:0}):R($,x);Q.length;){const et=Q.pop(),ct=et.depth,ft=H[ct],gt=et.bounds[0],Et=et.bounds[1],vt=ft===0?gt.x:gt.y,Rt=ft===0?Et.x:Et.y,Xt=A?A(ft,vt,Rt):.5*(vt+Rt),Pt=sg(et.polygons,vt-M,Xt+M,ft),Ut=sg(et.polygons,Xt-M,Rt+M,ft);if(Pt.length){const Mt=[gt,new At(ft===0?Xt:Et.x,ft===1?Xt:Et.y)];H.length>ct+1?Q.push({polygons:Pt,bounds:Mt,depth:ct+1}):R(Pt,Mt)}if(Ut.length){const Mt=[new At(ft===0?Xt:gt.x,ft===1?Xt:gt.y),Et];H.length>ct+1?Q.push({polygons:Ut,bounds:Mt,depth:ct+1}):R(Ut,Mt)}}return L}(e,t,Math.ceil((c-a)/11.25),Math.ceil((f-g)/11.25),1,(y,x,E)=>{if(y===0)return .5*(x+E);{const S=Ti((r.y+x/ee)/i);return(qa(.5*(Ti((r.y+E/ee)/i)+S))*i-r.y)*ee}})}function TS(e,t,r,i,a,c){const f=Math.pow(2,i.z-a.z);for(let g=0;g<r;g++){let y=e.int16[2*(g+t)+0],x=e.int16[2*(g+t)+1];y=(y+a.x*ee)*f-i.x*ee,x=(x+a.y*ee)*f-i.y*ee,c.push(new At(y,x))}}me(cd,"FillExtrusionBucket",{omit:["layers","features"]}),me(tw,"PartData"),me(Qb,"FootprintSegment"),me(ew,"BorderCentroidData"),me(nw,"GroundEffect");const SS=new Ft({visibility:new tt(bt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new tt(bt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var CS={paint:new Ft({"fill-extrusion-opacity":new tt(bt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yt(bt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(bt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(bt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yt(bt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yt(bt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yt(bt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tt(bt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new tt(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new tt(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new tt(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new tt(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new tt(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new tt(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new tt(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new yt(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new yt(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new tt(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new tt(bt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new tt(bt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new tt(bt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new tt(bt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:SS};class ap extends At{constructor(t,r,i){super(t,r),this.z=i}}function hd(e,t){return e.x*t.x+e.y*t.y}function hw(e,t){if(e.length===1){let r=0;const i=t[r++];let a;for(;!a||i.equals(a);)if(a=t[r++],!a)return 1/0;for(;r<t.length;r++){const c=t[r],f=e[0],g=a.sub(i),y=c.sub(i),x=f.sub(i),E=hd(g,g),S=hd(g,y),M=hd(y,y),A=hd(x,g),L=hd(x,y),R=E*M-S*S,N=(M*A-S*L)/R,F=(E*L-S*A)/R,W=i.z*(1-N-F)+a.z*N+c.z*F;if(isFinite(W))return W}return 1/0}{let r=1/0;for(const i of t)r=Math.min(r,i.z);return r}}function pw(e,t,r,i,a,c,f,g){const y=f*a.getElevationAt(e,t,!0,!0),x=c[0]!==0,E=x?c[1]===0?f*(c[0]/7-450):f*function(S,M,A){const L=Math.floor(M[0]/8),R=Math.floor(M[1]/8),N=10*(M[0]-8*L),F=10*(M[1]-8*R),W=S.getElevationAt(L,R,!0,!0),H=S.getMeterToDEM(A),$=Math.floor(.5*(N*H-1)),Q=Math.floor(.5*(F*H-1)),et=S.tileCoordToPixel(L,R),ct=2*$+1,ft=2*Q+1,gt=function(Ut,Mt,oe,de,qt){return[Ut.getElevationAtPixel(Mt,oe,!0),Ut.getElevationAtPixel(Mt+qt,oe,!0),Ut.getElevationAtPixel(Mt,oe+qt,!0),Ut.getElevationAtPixel(Mt+de,oe+qt,!0)]}(S,et.x-$,et.y-Q,ct,ft),Et=Math.abs(gt[0]-gt[1]),vt=Math.abs(gt[2]-gt[3]),Rt=Math.abs(gt[0]-gt[2])+Math.abs(gt[1]-gt[3]),Xt=Math.min(.25,.5*H*(Et+vt)/ct),Pt=Math.min(.25,.5*H*Rt/ft);return W+Math.max(Xt*N,Pt*F)}(a,c,g):y;return{base:y+(r===0)?-1:r,top:x?Math.max(E+i,y+r+2):y+i}}const MS=new Ft({"line-cap":new yt(bt.layout_line["line-cap"]),"line-join":new yt(bt.layout_line["line-join"]),"line-miter-limit":new tt(bt.layout_line["line-miter-limit"]),"line-round-limit":new tt(bt.layout_line["line-round-limit"]),"line-sort-key":new yt(bt.layout_line["line-sort-key"]),visibility:new tt(bt.layout_line.visibility)});var fw={paint:new Ft({"line-opacity":new yt(bt.paint_line["line-opacity"]),"line-color":new yt(bt.paint_line["line-color"]),"line-translate":new tt(bt.paint_line["line-translate"]),"line-translate-anchor":new tt(bt.paint_line["line-translate-anchor"]),"line-width":new yt(bt.paint_line["line-width"]),"line-gap-width":new yt(bt.paint_line["line-gap-width"]),"line-offset":new yt(bt.paint_line["line-offset"]),"line-blur":new yt(bt.paint_line["line-blur"]),"line-dasharray":new yt(bt.paint_line["line-dasharray"]),"line-pattern":new yt(bt.paint_line["line-pattern"]),"line-gradient":new Gt(bt.paint_line["line-gradient"]),"line-trim-offset":new tt(bt.paint_line["line-trim-offset"]),"line-emissive-strength":new tt(bt.paint_line["line-emissive-strength"]),"line-border-width":new yt(bt.paint_line["line-border-width"]),"line-border-color":new yt(bt.paint_line["line-border-color"])}),layout:MS};function dw(e,t){return 1/kb(e,1,t.tileZoom)}function mw(e,t,r,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const gw=e=>{const t=[];_w(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=e.paint.get("line-trim-offset");return r[0]===0&&r[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),e.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER"),t};function _w(e){const t=e.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const yw=new class extends yt{possiblyEvaluate(e,t){return t=new ut(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,i){return t=Qr({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,i)}}(fw.paint.properties["line-width"].specification);function vw(e,t){return t>0?t+2*e:e}yw.useIntegerZoom=!0;const AS=new Ft({visibility:new tt(bt.layout_background.visibility)});var PS={paint:new Ft({"background-color":new tt(bt.paint_background["background-color"]),"background-pattern":new tt(bt.paint_background["background-pattern"]),"background-opacity":new tt(bt.paint_background["background-opacity"]),"background-emissive-strength":new tt(bt.paint_background["background-emissive-strength"])}),layout:AS};const LS=new Ft({visibility:new tt(bt.layout_raster.visibility)});var DS={paint:new Ft({"raster-opacity":new tt(bt.paint_raster["raster-opacity"]),"raster-color":new Gt(bt.paint_raster["raster-color"]),"raster-color-mix":new tt(bt.paint_raster["raster-color-mix"]),"raster-color-range":new tt(bt.paint_raster["raster-color-range"]),"raster-hue-rotate":new tt(bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(bt.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(bt.paint_raster["raster-saturation"]),"raster-contrast":new tt(bt.paint_raster["raster-contrast"]),"raster-resampling":new tt(bt.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(bt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new tt(bt.paint_raster["raster-emissive-strength"]),"raster-array-band":new tt(bt.paint_raster["raster-array-band"]),"raster-elevation":new tt(bt.paint_raster["raster-elevation"])}),layout:LS};function Ng(e,t,r,i,a,c,f,g){const y=[e,t,1,r,i,1,a,c,1],x=[f,g,1],E=s.bx.adjoint([],y),[S,M,A]=s.v.transformMat3(x,x,E);return s.bx.multiply(y,y,[S,0,0,0,M,0,0,0,A])}function xw(e,t,r,i,a,c,f,g){const y=function(x,E,S,M,A,L,R,N){const F=Ng(0,0,1,0,1,1,0,1),W=Ng(x,E,S,M,A,L,R,N),H=s.bx.adjoint([],F);return s.bx.multiply(W,W,H)}(e,t,r,i,a,c,f,g);return[y[2]/y[8]/ee,y[5]/y[8]/ee]}function kg(e){return[e[0],Math.min(Math.max(e[1],-Tn),Tn)]}class bw extends xs{constructor(t,r,i,a){super(),this.id=t,this.dispatcher=i,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=r,this._dirty=!1}load(t,r){if(this._loaded=r||!1,this.fire(new Yo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=kt(this.map._requestManager.transformRequest(this.url,ui.Image),(i,a)=>{this._imageRequest=null,this._loaded=!0,i?this.fire(new fl(i)):a&&(this.image=a instanceof HTMLImageElement?ji.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Sg(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Yo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Sg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=t[0][1],i=t[0][1];for(const c of t)c[1]>i&&(i=c[1]),c[1]<r&&(r=c[1]);const a=(i+r)/2;if(a>Tn?this.onNorthPole=!0:a<-Tn&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=t.map(Li.fromLngLat);this.tileID=function(f){let g=1/0,y=1/0,x=-1/0,E=-1/0;for(const R of f)g=Math.min(g,R.x),y=Math.min(y,R.y),x=Math.max(x,R.x),E=Math.max(E,R.y);const S=Math.max(x-g,E-y),M=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),A=Math.pow(2,M);let L=Math.floor((g+x)/2*A);return L>1&&(L-=1),new Ic(M,L,Math.floor((y+E)/2*A))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Yo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const N in this.tiles){const F=this.tiles[N];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Tu(new Ic(0,0,0),this.map.transform.projection),i=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const F=N[1].x-N[0].x,W=N[1].y-N[0].y,H=N[2].x-N[1].x,$=N[2].y-N[1].y,Q=N[3].x-N[2].x,et=N[3].y-N[2].y,ct=N[0].x-N[3].x,ft=N[0].y-N[3].y,gt=F*$-H*W,Et=H*et-Q*$,vt=Q*ft-ct*et,Rt=ct*W-F*ft;return gt>0&&Et>0&&vt>0&&Rt>0||gt<0&&Et<0&&vt<0&&Rt<0}(i))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=Tu(this.tileID,this.map.transform.projection),[c,f,g,y]=this.coordinates.map(N=>{const F=a.projection.project(N[0],N[1]);return Eb(a,F)._round()});this.perspectiveTransform=xw(c.x,c.y,f.x,f.y,g.x,g.y,y.x,y.y);const x=this._boundsArray=new Dr;x.emplaceBack(c.x,c.y,0,0),x.emplaceBack(f.x,f.y,ee,0),x.emplaceBack(y.x,y.y,0,ee),x.emplaceBack(g.x,g.y,ee,ee),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(x,Mg.members),this.boundsSegments=fn.simpleSegment(0,0,4,2);const E=[],S=function(N){return[kg(N[0]),kg(N[1]),kg(N[2]),kg(N[3])]}(this.coordinates),[M,A,L,R]=function(N){let F=N[0][0],W=F,H=N[0][1],$=H;for(let Q=1;Q<N.length;Q++)N[Q][0]<F?F=N[Q][0]:N[Q][0]>W&&(W=N[Q][0]),N[Q][1]<H?H=N[Q][1]:N[Q][1]>$&&($=N[Q][1]);return[F,H,W-F,$-H]}(S);{const N=new Dr,[F,W,H,$]=function(Mt){let oe=Mt[0].x,de=oe,qt=Mt[0].y,De=qt;for(let _e=1;_e<Mt.length;_e++)Mt[_e].x<oe?oe=Mt[_e].x:Mt[_e].x>de&&(de=Mt[_e].x),Mt[_e].y<qt?qt=Mt[_e].y:Mt[_e].y>De&&(De=Mt[_e].y);return[oe,qt,de-oe,De-qt]}(i),Q=Mt=>[(Mt.x-F)/H,(Mt.y-W)/$],[et,ct,ft,gt]=i.map(Q),Et=function(Mt,oe,de,qt,De,_e,ne,Re){const Ie=Ng(0,0,1,0,1,1,0,1),Me=Ng(Mt,oe,de,qt,De,_e,ne,Re),Kt=s.bx.adjoint([],Me);return s.bx.multiply(Ie,Ie,Kt)}(et[0],et[1],ct[0],ct[1],ft[0],ft[1],gt[0],gt[1]);this.elevatedGlobePerspectiveTransform=xw(et[0],et[1],ct[0],ct[1],ft[0],ft[1],gt[0],gt[1]);const vt=(Mt,oe)=>{E.push(Mt.lng);const de=Math.round((Mt.lng-M)/L*ee),qt=Math.round((Mt.lat-A)/R*ee),De=Q(oe),_e=s.v.transformMat3([],[De[0],De[1],1],Et),ne=Math.round(_e[0]/_e[2]*ee),Re=Math.round(_e[1]/_e[2]*ee);N.emplaceBack(de,qt,ne,Re)},Rt=i[3].x-i[0].x,Xt=i[3].y-i[0].y,Pt=i[2].x-i[1].x,Ut=i[2].y-i[1].y;for(let Mt=0;Mt<65;Mt++){const oe=Mt/64,de=[i[0].x+oe*Rt,i[0].y+oe*Xt],qt=[i[1].x+oe*Pt,i[1].y+oe*Ut],De=qt[0]-de[0],_e=qt[1]-de[1];for(let ne=0;ne<65;ne++){const Re=ne/64,Ie={x:de[0]+De*Re,y:de[1]+_e*Re,z:0};vt(r.projection.unproject(Ie.x,Ie.y),Ie)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(N,Mg.members)}{this.maxLongitudeTriangleSize=0;let N=[],F=new Or;const W=(H,$,Q)=>{F.emplaceBack(H,$,Q);const et=E[H],ct=E[$],ft=E[Q],gt=Math.min(Math.min(et,ct),ft),Et=Math.max(Math.max(et,ct),ft)-gt;Et>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Et),N.push(gt+Et/2)};for(let H=0;H<64;H++)for(let $=0;$<64;$++){const Q=65*H+$,et=Q+1,ct=Q+65,ft=ct+1;W(Q,ct,et),W(et,ct,ft)}[N,F]=function(H,$){const Q=Array.from({length:H.length},(ft,gt)=>gt);Q.sort((ft,gt)=>H[ft]-H[gt]);const et=[],ct=new Or;for(let ft=0;ft<Q.length;ft++){const gt=Q[ft];et.push(H[gt]);const Et=3*gt,vt=Et+1;ct.emplaceBack($.uint16[Et],$.uint16[vt],$.uint16[vt+1])}return[et,ct]}(N,F),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(F)}this.elevatedGlobeSegments=fn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,L/ee,0,R/ee,0,0,A,M,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const r=this.map.painter.context,i=r.gl;!this._dirty||this.texture instanceof Sg||(this.texture?this.texture.update(this.image):(this.texture=new Vl(r,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(r)}loadTile(t,r){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},r(null)):(t.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const i=this.elevatedGlobeTrianglesCenterLongitudes;let a=((E,S)=>E+360*Math.round((S-E)/360))(t+180,i[0]);const c=new fn,f=(E,S)=>{c.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:r.segments[0].vertexLength,primitiveLength:S,sortKey:void 0,vaos:{}})},g=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-a)<=g){const E=ze(i,0,i.length,a+g);return E===i.length||f(E,Ht(i,E+1,i.length,a+360-g)-E),c}a<i[0]&&(a+=360);const y=Ht(i,0,i.length,a-g);if(y===i.length)return f(0,i.length),c;f(0,y-0);const x=ze(i,y+1,i.length,a+g);return x!==i.length&&f(x,i.length-x),c}}class RS extends fe{constructor(t,r){super(t,{},r),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const OS=new Ft({visibility:new tt(bt.layout_sky.visibility)});var zS={paint:new Ft({"sky-type":new tt(bt.paint_sky["sky-type"]),"sky-atmosphere-sun":new tt(bt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new tt(bt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new tt(bt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new tt(bt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Gt(bt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new tt(bt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new tt(bt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new tt(bt.paint_sky["sky-opacity"])}),layout:OS};function vv(e,t,r){const i=[0,0,1],a=s.q.identity([]);return s.q.rotateY(a,a,r?-ae(e)+Math.PI:ae(e)),s.q.rotateX(a,a,-ae(t)),s.v.transformQuat(i,i,a),s.v.normalize(i,i)}var NS={paint:new Ft({})};const kS={circle:class extends fe{constructor(e,t,r){super(e,dI,t,r)}createBucket(e){return new Ny(e)}queryRadius(e){const t=e;return Hh("circle-radius",this,t)+Hh("circle-stroke-width",this,t)+$m(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,i,a,c,f,g){const y=E1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,e.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return T1(e,i,c,f,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const r=I1(this);return{config:new bc(this,t),defines:r,overrideFog:!1}}},heatmap:class extends fe{createBucket(e){return new C1(e)}constructor(e,t,r){super(e,xI,t,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Jm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Hh("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,i,a,c,f,g){const y=this.paint.get("heatmap-radius").evaluate(t,r);return T1(e,i,c,f,g,!0,!0,new At(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return e==="heatmap"?{config:new bc(this,t),overrideFog:!1}:{}}},hillshade:class extends fe{constructor(e,t,r){super(e,wI,t,r)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends fe{constructor(e,t,r){super(e,NI,t,r)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(e,t){return{config:new bc(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ng(e)}queryRadius(){return $m(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,i,a,c){return!e.queryGeometry.isAboveHorizon&&y1(w1(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends fe{constructor(e,t,r){super(e,CS,t,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new cd(e)}queryRadius(){return $m(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,r,i,a,c,f,g,y){const x=E1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,e.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(t,r),S=this.paint.get("fill-extrusion-base").evaluate(t,r),M=[0,0],A=g&&c.elevation,L=c.elevation?c.elevation.exaggeration():1,R=e.tile.getBucket(this);if(A&&R instanceof cd){const $=R.centroidVertexArray,Q=y+1;Q<$.length&&(M[0]=$.geta_centroid_pos0(Q),M[1]=$.geta_centroid_pos1(Q))}if(M[0]===0&&M[1]===1)return!1;c.projection.name==="globe"&&(i=cw([i],[new At(0,0),new At(ee,ee)],e.tileID.canonical).map($=>$.polygon).flat());const N=A?g:null,[F,W]=function($,Q,et,ct,ft,gt,Et,vt,Rt,Xt,Pt){return $.projection.name==="globe"?function(Ut,Mt,oe,de,qt,De,_e,ne,Re,Ie,Me){const Kt=[],Ue=[],hr=Ut.projection.upVectorScale(Me,Ut.center.lat,Ut.worldSize).metersToTile,We=[0,0,0,1],sr=[0,0,0,1],br=(Qe,sn,Wr,Pr)=>{Qe[0]=sn,Qe[1]=Wr,Qe[2]=Pr,Qe[3]=1},Xr=uw();oe>0&&(oe+=Xr),de+=Xr;for(const Qe of Mt){const sn=[],Wr=[];for(const Pr of Qe){const Rr=Pr.x+qt.x,wr=Pr.y+qt.y,yn=Ut.projection.projectTilePoint(Rr,wr,Me),an=Ut.projection.upVector(Me,Pr.x,Pr.y);let Sn=oe,oi=de;if(_e){const ao=pw(Rr,wr,oe,de,_e,ne,Re,Ie);Sn+=ao.base,oi+=ao.top}oe!==0?br(We,yn.x+an[0]*hr*Sn,yn.y+an[1]*hr*Sn,yn.z+an[2]*hr*Sn):br(We,yn.x,yn.y,yn.z),br(sr,yn.x+an[0]*hr*oi,yn.y+an[1]*hr*oi,yn.z+an[2]*hr*oi),s.v.transformMat4(We,We,De),s.v.transformMat4(sr,sr,De),sn.push(new ap(We[0],We[1],We[2])),Wr.push(new ap(sr[0],sr[1],sr[2]))}Kt.push(sn),Ue.push(Wr)}return[Kt,Ue]}($,Q,et,ct,ft,gt,Et,vt,Rt,Xt,Pt):Et?function(Ut,Mt,oe,de,qt,De,_e,ne,Re){const Ie=[],Me=[],Kt=[0,0,0,1];for(const Ue of Ut){const hr=[],We=[];for(const sr of Ue){const br=sr.x+de.x,Xr=sr.y+de.y,Qe=pw(br,Xr,Mt,oe,De,_e,ne,Re);Kt[0]=br,Kt[1]=Xr,Kt[2]=Qe.base,Kt[3]=1,s.e.transformMat4(Kt,Kt,qt),Kt[3]=Math.max(Kt[3],1e-5);const sn=new ap(Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]);Kt[0]=br,Kt[1]=Xr,Kt[2]=Qe.top,Kt[3]=1,s.e.transformMat4(Kt,Kt,qt),Kt[3]=Math.max(Kt[3],1e-5);const Wr=new ap(Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]);hr.push(sn),We.push(Wr)}Ie.push(hr),Me.push(We)}return[Ie,Me]}(Q,et,ct,ft,gt,Et,vt,Rt,Xt):function(Ut,Mt,oe,de,qt){const De=[],_e=[],ne=qt[8]*Mt,Re=qt[9]*Mt,Ie=qt[10]*Mt,Me=qt[11]*Mt,Kt=qt[8]*oe,Ue=qt[9]*oe,hr=qt[10]*oe,We=qt[11]*oe;for(const sr of Ut){const br=[],Xr=[];for(const Qe of sr){const sn=Qe.x+de.x,Wr=Qe.y+de.y,Pr=qt[0]*sn+qt[4]*Wr+qt[12],Rr=qt[1]*sn+qt[5]*Wr+qt[13],wr=qt[2]*sn+qt[6]*Wr+qt[14],yn=qt[3]*sn+qt[7]*Wr+qt[15],an=Pr+ne,Sn=Rr+Re,oi=wr+Ie,ao=Math.max(yn+Me,1e-5),zn=Pr+Kt,wn=Rr+Ue,Yi=wr+hr,$i=Math.max(yn+We,1e-5);br.push(new ap(an/ao,Sn/ao,oi/ao)),Xr.push(new ap(zn/$i,wn/$i,Yi/$i))}De.push(br),_e.push(Xr)}return[De,_e]}(Q,et,ct,ft,gt)}(c,i,S,E,x,f,N,M,L,c.center.lat,e.tileID.canonical),H=e.queryGeometry;return function($,Q,et){let ct=1/0;y1(et,Q)&&(ct=hw(et,Q[0]));for(let ft=0;ft<Q.length;ft++){const gt=Q[ft],Et=$[ft];for(let vt=0;vt<gt.length-1;vt++){const Rt=gt[vt],Xt=[Rt,gt[vt+1],Et[vt+1],Et[vt],Rt];_1(et,Xt)&&(ct=Math.min(ct,hw(et,Xt)))}}return ct!==1/0&&ct}(F,W,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends fe{constructor(e,t,r){super(e,fw,t,r),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof hf,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=yw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Tg(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const r=gw(this);return{config:new bc(this,t),defines:r,overrideFog:!1}}queryRadius(e){const t=e,r=vw(Hh("line-width",this,t),Hh("line-gap-width",this,t)),i=Hh("line-offset",this,t);return r/2+Math.abs(i)+$m(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,i,a,c){if(e.queryGeometry.isAboveHorizon)return!1;const f=w1(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,e.pixelToTileUnitsFactor),g=e.pixelToTileUnitsFactor/2*vw(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),y=this.paint.get("line-offset").evaluate(t,r);return y&&(i=function(x,E){const S=[],M=new At(0,0);for(let A=0;A<x.length;A++){const L=x[A],R=[];for(let N=0;N<L.length;N++){const F=L[N],W=L[N+1],H=N===0?M:F.sub(L[N-1])._unit()._perp(),$=N===L.length-1?M:W.sub(F)._unit()._perp(),Q=H._add($)._unit();Q._mult(1/(Q.x*$.x+Q.y*$.y)),R.push(Q._mult(E)._add(F))}S.push(R)}return S}(i,y*e.pixelToTileUnitsFactor)),function(x,E,S){for(let M=0;M<E.length;M++){const A=E[M];if(x.length>=3){for(let L=0;L<A.length;L++)if(Cc(x,A[L]))return!0}if(cI(x,A,S))return!0}return!1}(f,i,g)}isTileClipped(){return!0}},symbol:vg,background:class extends fe{constructor(e,t,r){super(e,PS,t,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends fe{constructor(e,t,r){super(e,DS,t,r),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof bw)||!e._source.onNorthPole&&!e._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,r]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Jm({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:r}],resolution:256}),this.colorRampTexture=null}},sky:class extends fe{constructor(e,t,r){super(e,zS,t,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Jm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){const i=this.paint.get("sky-atmosphere-sun"),a=!i,c=e.style.light,f=c.properties.get("position");return a&&c.properties.get("anchor")==="viewport"&&pn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?vv(f.azimuthal,90-f.polar,t):vv(i[0],90-i[1],t)}const r=this.paint.get("sky-gradient-center");return vv(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}},slot:class extends fe{constructor(e,t,r){super(e,NS,t)}},model:class extends fe{constructor(e,t,r){super(e,fS,t,r)}createBucket(e){return new Gb(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||e!=="model-color"&&e!=="model-color-mix-intensity"&&e!=="model-rotation"&&e!=="model-scale"&&e!=="model-translation"&&e!=="model-emissive-strength")}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof dc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};class FS{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class BS{constructor(){this.tasks={},this.taskQueue=[],eu(["process"],this),this.invoker=new FS(this.process),this.nextId=0}add(t,r){const i=this.nextId++,a=function({type:c,isSymbolTile:f,zoom:g}){return g=g||0,c==="message"?0:c!=="maybePrepare"||f?c!=="parseTile"||f?c==="parseTile"&&f?300-g:c==="maybePrepare"&&f?400-g:500:200-g:100-g}(r);if(a===0){_t();try{t()}finally{}return null}return this.tasks[i]={fn:t,metadata:r,priority:a,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){_t();try{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let t=null,r=1/0;for(let a=0;a<this.taskQueue.length;a++){const c=this.tasks[this.taskQueue[a]];c.priority<r&&(r=c.priority,t=a)}if(t===null)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}class ww{constructor(t,r,i){this.target=t,this.parent=r,this.mapId=i,this.callbacks={},this.cancelCallbacks={},eu(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new BS}send(t,r,i,a,c=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[g]=i);const y=new Set;return this.target.postMessage({id:g,type:t,hasCallback:!!i,targetMapId:a,mustQueue:c,sourceMapId:this.mapId,data:l(r,y)},y),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(t){const r=t.data,i=r.id;if(i&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(r.mustQueue||_t()){const a=this.callbacks[i],c=this.scheduler.add(()=>this.processTask(i,r),a&&a.metadata||{type:"message"});c&&(this.cancelCallbacks[i]=c)}else this.processTask(i,r)}processTask(t,r){if(delete this.cancelCallbacks[t],r.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(r.error?i(_(r.error)):i(null,_(r.data)))}else{const i=new Set,a=r.hasCallback?(f,g)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?l(f):null,data:l(g,i)},i)}:f=>{},c=_(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,c,a);else if(this.parent.getWorkerSource){const f=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,f[0],c.source,c.scope)[f[1]](c,a)}else a(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class pd{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=go();const i=this.workerPool.acquire(this.id);for(let a=0;a<i.length;a++){const c=new pd.Actor(i[a],r,this.id);c.name=`Worker ${a}`,this.actors.push(c)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,r,i){Pn(this.actors,(a,c)=>{a.send(t,r,c)},i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}pd.Actor=ww;class Ew{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.image=new kl({width:t,height:r}),this.positions={},this.uploaded=!1}getDash(t,r){const i=this.getKey(t,r);return this.positions[i]}trim(){const t=this.width,r=this.height=cl(this.nextRow);this.image.resize({width:t,height:r})}getKey(t,r){return t.join(",")+r}getDashRanges(t,r,i){const a=[];let c=t.length%2==1?-t[t.length-1]*i:0,f=t[0]*i,g=!0;a.push({left:c,right:f,isDash:g,zeroLength:t[0]===0});let y=t[0];for(let x=1;x<t.length;x++){g=!g;const E=t[x];c=y*i,y+=E,f=y*i,a.push({left:c,right:f,isDash:g,zeroLength:E===0})}return a}addRoundDash(t,r,i){const a=r/2;for(let c=-i;c<=i;c++){const f=this.width*(this.nextRow+i+c);let g=0,y=t[g];for(let x=0;x<this.width;x++){x/y.right>1&&(y=t[++g]);const E=Math.abs(x-y.left),S=Math.abs(x-y.right),M=Math.min(E,S);let A;const L=c/i*(a+1);if(y.isDash){const R=a-Math.abs(L);A=Math.sqrt(M*M+R*R)}else A=a-Math.sqrt(M*M+L*L);this.image.data[f+x]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(t,r){for(let y=t.length-1;y>=0;--y){const x=t[y],E=t[y+1];x.zeroLength?t.splice(y,1):E&&E.isDash===x.isDash&&(E.left=x.left,t.splice(y,1))}const i=t[0],a=t[t.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);const c=this.width*this.nextRow;let f=0,g=t[f];for(let y=0;y<this.width;y++){y/g.right>1&&(g=t[++f]);const x=Math.abs(y-g.left),E=Math.abs(y-g.right),S=Math.min(x,E);this.image.data[c+y]=Math.max(0,Math.min(255,(g.isDash?S:-S)+r+128))}}addDash(t,r){const i=this.getKey(t,r);if(this.positions[i])return this.positions[i];const a=r==="round",c=a?7:0,f=2*c+1;if(this.nextRow+f>this.height)return pn("LineAtlas out of space"),null;t.length===0&&t.push(1);let g=0;for(let E=0;E<t.length;E++)t[E]<0&&(pn("Negative value is found in line dasharray, replacing values with 0"),t[E]=0),g+=t[E];if(g!==0){const E=this.width/g,S=this.getDashRanges(t,this.width,E);a?this.addRoundDash(S,E,c):this.addRegularDash(S,r==="square"?.5*E:0)}const y=this.nextRow+c;this.nextRow+=f;const x={tl:[y,c],br:[g,0]};return this.positions[i]=x,x}}me(Ew,"LineAtlas");const Iw=1*la;class Tw{constructor(t){const r={},i=[];for(const g in t){const y=t[g],x=r[g]={};for(const E in y.glyphs){const S=y.glyphs[+E];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const M=S.metrics.localGlyph?Iw:1,A={x:0,y:0,w:S.bitmap.width+2*M,h:S.bitmap.height+2*M};i.push(A),x[E]=A}}const{w:a,h:c}=ev(i),f=new kl({width:a||1,height:c||1});for(const g in t){const y=t[g];for(const x in y.glyphs){const E=y.glyphs[+x];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const S=r[g][x],M=E.metrics.localGlyph?Iw:1;kl.copy(E.bitmap,f,{x:0,y:0},{x:S.x+M,y:S.y+M},E.bitmap)}}this.image=f,this.positions=r}}me(Tw,"GlyphAtlas");class VS{constructor(t){this.tileID=new fi(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Tu(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,r,i,a,c){this.status="parsing",this.data=t,this.collisionBoxArray=new ty;const f=new F1(Object.keys(t.layers).sort()),g=new $y(this.tileID,this.promoteId);g.bucketLayerIDs=[];const y={},x=new Ew(256,256),E={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:x,availableImages:i,brightness:this.brightness},S=r.familiesBySource[this.source];for(const W in S){const H=t.layers[W];if(!H)continue;let $=!1,Q=!1,et=!1;for(const gt of S[W])gt[0].type==="symbol"?$=!0:Q=!0,gt[0].is3D()&&gt[0].type!=="model"&&(et=!0);if(this.extraShadowCaster&&!et||this.isSymbolTile===!0&&!$||this.isSymbolTile===!1&&!Q)continue;H.version===1&&pn(`Vector tile source "${this.source}" layer "${W}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ct=f.encode(W),ft=[];for(let gt=0;gt<H.length;gt++){const Et=H.feature(gt),vt=g.getId(Et,W);ft.push({feature:Et,id:vt,index:gt,sourceLayerIndex:ct})}for(const gt of S[W]){const Et=gt[0];(!this.extraShadowCaster||Et.is3D()&&Et.type!=="model")&&(this.isSymbolTile!==void 0&&Et.type==="symbol"!==this.isSymbolTile||Et.minzoom&&this.zoom<Math.floor(Et.minzoom)||Et.maxzoom&&this.zoom>=Et.maxzoom||Et.visibility!=="none"&&(xv(gt,this.zoom,E.brightness,i),(y[Et.id]=Et.createBucket({index:g.bucketLayerIDs.length,layers:gt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ct,sourceID:this.source,projection:this.projection.spec})).populate(ft,E,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(gt.map(vt=>vt.id))))}}let M,A,L,R;x.trim();const N={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},F=()=>{if(M)return this.status="done",c(M);if(this.extraShadowCaster)this.status="done",c(null,{buckets:Ui(y).filter(W=>!W.isEmpty()),featureIndex:g,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:E.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(A&&L&&R){const W=new Tw(A),H=new db(L,R);for(const $ in y){const Q=y[$];Q instanceof id?(xv(Q.layers,this.zoom,E.brightness,i),NT(Q,A,W.positions,L,H.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Q.hasPattern&&(Q instanceof Tg||Q instanceof ng||Q instanceof cd)&&(xv(Q.layers,this.zoom,E.brightness,i),Q.addFeatures(E,this.tileID.canonical,H.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",c(null,{buckets:Ui(y).filter($=>!$.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:W.image,lineAtlas:x,imageAtlas:H,brightness:E.brightness})}};if(!this.extraShadowCaster){const W=Hu(E.glyphDependencies,Q=>Object.keys(Q).map(Number));Object.keys(W).length?a.send("getGlyphs",{uid:this.uid,stacks:W,scope:this.scope},(Q,et)=>{M||(M=Q,A=et,F())},void 0,!1,N):A={};const H=Object.keys(E.iconDependencies);H.length?a.send("getImages",{icons:H,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Q,et)=>{M||(M=Q,L=et,F())},void 0,!1,N):L={};const $=Object.keys(E.patternDependencies);$.length?a.send("getImages",{icons:$,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Q,et)=>{M||(M=Q,R=et,F())},void 0,!1,N):R={}}F()}}function xv(e,t,r,i){const a=new ut(t,{brightness:r});for(const c of e)c.recalculate(a,i)}class Sw{constructor(t){this.entries={},this.scheduler=t}request(t,r,i,a){const c=this.entries[t]=this.entries[t]||{callbacks:[]};if(c.result){const[f,g]=c.result;return this.scheduler?this.scheduler.add(()=>{a(f,g)},r):a(f,g),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=i((f,g)=>{c.result=[f,g];for(const y of c.callbacks)this.scheduler?this.scheduler.add(()=>{y(f,g)},r):y(f,g);setTimeout(()=>delete this.entries[t],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(f=>f!==a),c.callbacks.length||(c.cancel(),delete this.entries[t]))}}}function Cw(e,t,r){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},a=>{const c=ci(e.request,(f,g,y,x)=>{f?a(f):g&&a(null,{vectorTile:r?void 0:new Hy(new ug(g)),rawData:g,cacheControl:y,expires:x})});return()=>{c.cancel(),a()}},t)}var fd={workerUrl:"",workerClass:null,workerParams:void 0};function US(){return fd.workerClass!=null?new fd.workerClass:new self.Worker(fd.workerUrl,fd.workerParams)}const bv="mapboxgl_preloaded_worker_pool";class dd{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<dd.workerCount;)this.workers.push(new US);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[bv]}numActive(){return Object.keys(this.active).length}}let md;function wv(){return md||(md=new dd),md}dd.workerCount=2;let Fg,Ev,ca,Iv=null;function Mw(){return _t()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Ev||G.DRACO_URL}const Tv=5123,Sv=5126,Cv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[Tv]:Uint16Array,5125:Uint32Array,[Sv]:Float32Array},GS={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[Tv]:"DT_UINT16",5125:"DT_UINT32",[Sv]:"DT_FLOAT32"},Mv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Aw(e,t,r){const i=r.json.bufferViews.length,a=r.buffers.length;t.bufferView=i,r.json.bufferViews[i]={buffer:a,byteLength:e.byteLength},r.buffers[a]=e}const Av="KHR_draco_mesh_compression";function jS(e,t){const r=e.extensions&&e.extensions[Av];if(!r)return;const i=new ca.Decoder,a=Rw(t,r.bufferView),c=new ca.Mesh;if(!i.DecodeArrayToMesh(a,a.byteLength,c))throw new Error("Failed to decode Draco mesh");const f=t.json.accessors[e.indices],g=Cv[f.componentType],y=f.count*g.BYTES_PER_ELEMENT,x=ca._malloc(y);g===Uint16Array?i.GetTrianglesUInt16Array(c,y,x):i.GetTrianglesUInt32Array(c,y,x),Aw(ca.memory.buffer.slice(x,x+y),f,t),ca._free(x);for(const E of Object.keys(r.attributes)){const S=i.GetAttributeByUniqueId(c,r.attributes[E]),M=t.json.accessors[e.attributes[E]],A=GS[M.componentType],L=M.count*Mv[M.type]*Cv[M.componentType].BYTES_PER_ELEMENT,R=ca._malloc(L);i.GetAttributeDataArrayForAllPoints(c,S,ca[A],L,R),Aw(ca.memory.buffer.slice(R,R+L),M,t),ca._free(R)}i.destroy(),c.destroy(),delete e.extensions[Av]}const Pw=1179937895,Lw=new TextDecoder("utf8");function Dw(e,t){return new URL(e,t).href}function qS(e,t,r,i){return fetch(Dw(e.uri,i)).then(a=>a.arrayBuffer()).then(a=>{t.buffers[r]=a})}function Rw(e,t){const r=e.json.bufferViews[t];return new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function ZS(e,t,r,i){if(e.uri){const a=Dw(e.uri,i);return fetch(a).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{t.images[r]=c})}if(e.bufferView!==void 0){const a=Rw(t,e.bufferView),c=new Blob([a],{type:e.mimeType});return createImageBitmap(c).then(f=>{t.images[r]=f})}}function Ow(e,t=0,r){const i={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===Pw){const x=new Uint32Array(e,t);let E=2;const S=(x[E++]>>2)-3,M=x[E++]>>2;if(E++,i.json=JSON.parse(Lw.decode(x.subarray(E,E+M))),E+=M,E<S){const A=x[E++];E++;const L=t+(E<<2);i.buffers[0]=e.slice(L,L+A)}}else i.json=JSON.parse(Lw.decode(new Uint8Array(e,t)));const{buffers:a,images:c,meshes:f,extensionsUsed:g}=i.json;let y=Promise.resolve();if(a){const x=[];for(let E=0;E<a.length;E++){const S=a[E];S.uri?x.push(qS(S,i,E,r)):i.buffers[E]||(i.buffers[E]=null)}y=Promise.all(x)}return y.then(()=>{const x=[],E=g&&g.includes(Av);if(E&&x.push(function(){if(!ca)return Fg||(Fg=function(S){let M,A=null;function L(){M=new Uint8Array(A.buffer)}function R(){throw new Error("Unexpected Draco error.")}const N={a:{a:R,d:function(F,W,H){return M.copyWithin(F,W,W+H)},c:function(F){const W=M.length,H=Math.max(F>>>0,Math.ceil(1.2*W)),$=Math.ceil((H-W)/65536);try{return A.grow($),L(),!0}catch{return!1}},b:R}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(S,N):S.then(F=>F.arrayBuffer()).then(F=>WebAssembly.instantiate(F,N))).then(F=>{const{Rb:W,Qb:H,P:$,T:Q,X:et,Ja:ct,La:ft,Qa:gt,Va:Et,Wa:vt,eb:Rt,jb:Xt,f:Pt,e:Ut,yb:Mt,zb:oe,Ab:de,Bb:qt,Db:De,Gb:_e}=F.instance.exports;A=Ut;const ne=(()=>{let Re=0,Ie=0,Me=0,Kt=0;return Ue=>{Me&&(W(Kt),W(Re),Ie+=Me,Me=Re=0),Re||(Ie+=128,Re=H(Ie));const hr=Ue.length+7&-8;let We=Re;hr>=Ie&&(Me=hr,We=Kt=H(hr));for(let sr=0;sr<Ue.length;sr++)M[We+sr]=Ue[sr];return We}})();return L(),Pt(),{memory:Ut,_free:W,_malloc:H,Mesh:class{constructor(){this.ptr=$()}destroy(){Q(this.ptr)}},Decoder:class{constructor(){this.ptr=ct()}destroy(){Xt(this.ptr)}DecodeArrayToMesh(Re,Ie,Me){const Kt=ne(Re),Ue=ft(this.ptr,Kt,Ie,Me.ptr);return!!et(Ue)}GetAttributeByUniqueId(Re,Ie){return{ptr:gt(this.ptr,Re.ptr,Ie)}}GetTrianglesUInt16Array(Re,Ie,Me){Et(this.ptr,Re.ptr,Ie,Me)}GetTrianglesUInt32Array(Re,Ie,Me){vt(this.ptr,Re.ptr,Ie,Me)}GetAttributeDataArrayForAllPoints(Re,Ie,Me,Kt,Ue){Rt(this.ptr,Re.ptr,Ie.ptr,Me,Kt,Ue)}},DT_INT8:Mt(),DT_UINT8:oe(),DT_INT16:de(),DT_UINT16:qt(),DT_UINT32:De(),DT_FLOAT32:_e()}})}(fetch(Mw())),Fg.then(S=>{ca=S,Fg=void 0}))}()),c)for(let S=0;S<c.length;S++)x.push(ZS(c[S],i,S,r));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(E&&f)for(const{primitives:S}of f)for(const M of S)jS(M,i);return i})})}class zw{constructor(t,r,i){if(this.triangleCount=r.length/3,this.min=new At(0,0),this.max=new At(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0||i===0)return;const a=t.map(E=>E.x),c=t.map(E=>E.y);this.min=new At(Math.min(...a),Math.min(...c)),this.max=new At(Math.max(...a),Math.max(...c));const f=this.max.sub(this.min);f.x=Math.max(f.x,1),f.y=Math.max(f.y,1);const g=Math.max(f.x,f.y)/i;this.cellsX=Math.max(1,Math.ceil(f.x/g)),this.cellsY=Math.max(1,Math.ceil(f.y/g)),this.xScale=1/g,this.yScale=1/g;const y=[];for(let E=0;E<this.triangleCount;E++){const S=t[r[3*E+0]].sub(this.min),M=t[r[3*E+1]].sub(this.min),A=t[r[3*E+2]].sub(this.min),L=Lu(Math.floor(Math.min(S.x,M.x,A.x)),this.xScale,this.cellsX),R=Lu(Math.floor(Math.max(S.x,M.x,A.x)),this.xScale,this.cellsX),N=Lu(Math.floor(Math.min(S.y,M.y,A.y)),this.yScale,this.cellsY),F=Lu(Math.floor(Math.max(S.y,M.y,A.y)),this.yScale,this.cellsY),W=new At(0,0),H=new At(0,0),$=new At(0,0),Q=new At(0,0);for(let et=N;et<=F;++et){W.y=H.y=et*g,$.y=Q.y=(et+1)*g;for(let ct=L;ct<=R;++ct)W.x=$.x=ct*g,H.x=Q.x=(ct+1)*g,(By(S,M,A,W,H,Q)||By(S,M,A,W,Q,$))&&y.push({cellIdx:et*this.cellsX+ct,triIdx:E})}}if(y.length===0)return;y.sort((E,S)=>E.cellIdx-S.cellIdx||E.triIdx-S.triIdx);let x=0;for(;x<y.length;){const E=y[x].cellIdx,S={start:this.payload.length,len:0};for(;x<y.length&&y[x].cellIdx===E;)++S.len,this.payload.push(y[x++].triIdx);this.cells[E]=S}}query(t,r,i){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>r.x||t.y>this.max.y||this.min.y>r.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let y=0;y<this.lookup.length;y++)this.lookup[y]=0;const a=Lu(t.x-this.min.x,this.xScale,this.cellsX),c=Lu(r.x-this.min.x,this.xScale,this.cellsX),f=Lu(t.y-this.min.y,this.yScale,this.cellsY),g=Lu(r.y-this.min.y,this.yScale,this.cellsY);for(let y=f;y<=g;y++)for(let x=a;x<=c;x++){const E=this.cells[y*this.cellsX+x];if(E)for(let S=0;S<E.len;S++){const M=this.payload[E.start+S],A=Math.floor(M/8),L=1<<M%8;if(!(this.lookup[A]&L)&&(this.lookup[A]|=L,i.push(M),i.length===this.triangleCount))return}}}}function Lu(e,t,r){return Math.max(0,Math.min(r-1,Math.floor(e*t)))}function Rc(e,t){const r=e.json.bufferViews[t.bufferView];return new Cv[t.componentType](e.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*Mv[t.type])}function XS(e,t,r){const i=e.indices,a=e.attributes,c={};c.indexArray=new Or;const f=t.json.accessors[i],g=f.count/3;c.indexArray.reserve(g);const y=Rc(t,f);for(let M=0;M<g;M++)c.indexArray.emplaceBack(y[3*M],y[3*M+1],y[3*M+2]);c.indexArray._trim(),c.vertexArray=new vc;const x=t.json.accessors[a.POSITION];c.vertexArray.reserve(x.count);const E=Rc(t,x);for(let M=0;M<x.count;M++)c.vertexArray.emplaceBack(E[3*M],E[3*M+1],E[3*M+2]);if(c.vertexArray._trim(),c.aabb=new On(x.min,x.max),c.centroid=function(M,A){const L=[0,0,0],R=M.length;if(R>0){for(let N=0;N<R;N++){const F=3*M[N];L[0]+=A[F],L[1]+=A[F+1],L[2]+=A[F+2]}L[0]/=R,L[1]/=R,L[2]/=R}return L}(y,E),a.COLOR_0!==void 0){const M=t.json.accessors[a.COLOR_0],A=Mv[M.type];if(M.componentType===Sv){c.colorArray=A===3?new vc:new Mr,c.colorArray.reserve(M.count);const L=Rc(t,M);if(A===3)for(let R=0;R<M.count;R++)c.colorArray.emplaceBack(L[3*R],L[3*R+1],L[3*R+2]);else for(let R=0;R<M.count;R++)c.colorArray.emplaceBack(L[4*R],L[4*R+1],L[4*R+2],L[4*R+3]);c.colorArray._trim()}else if(M.componentType===Tv&&A===4){c.colorArray=new Mr,c.colorArray.resize(M.count);const L=Rc(t,M),R=1/65535,N=c.colorArray.float32;for(let F=0;F<4*L.length;++F)N[F]=L[F]*R}else pn(`glTF color buffer parsing for accessor ${JSON.stringify(M)} is not supported`)}if(a.NORMAL!==void 0){c.normalArray=new vc;const M=t.json.accessors[a.NORMAL];c.normalArray.reserve(M.count);const A=Rc(t,M);for(let L=0;L<M.count;L++)c.normalArray.emplaceBack(A[3*L],A[3*L+1],A[3*L+2]);c.normalArray._trim()}if(a.TEXCOORD_0!==void 0&&r.length>0){c.texcoordArray=new kf;const M=t.json.accessors[a.TEXCOORD_0];c.texcoordArray.reserve(M.count);const A=Rc(t,M);for(let L=0;L<M.count;L++)c.texcoordArray.emplaceBack(A[2*L],A[2*L+1]);c.texcoordArray._trim()}const S=e.material;return c.material=function(M,A){const{emissiveFactor:L=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:N=.5,normalTexture:F,occlusionTexture:W,emissiveTexture:H,doubleSided:$}=M,{baseColorFactor:Q=[1,1,1,1],metallicFactor:et=1,roughnessFactor:ct=1,baseColorTexture:ft,metallicRoughnessTexture:gt}=M.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new rn(...Q),metallicFactor:et,roughnessFactor:ct,baseColorTexture:ft?A[ft.index]:void 0,metallicRoughnessTexture:gt?A[gt.index]:void 0},doubleSided:$,emissiveFactor:L,alphaMode:R,alphaCutoff:N,normalTexture:F?A[F.index]:void 0,occlusionTexture:W?A[W.index]:void 0,emissionTexture:H?A[H.index]:void 0,defined:M.defined===void 0}}(S!==void 0?t.json.materials[S]:{defined:!1},r),a._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(Rc(t,t.json.accessors[a._FEATURE_RGBA4444]).buffer)),c}function Nw(e,t,r){const{matrix:i,rotation:a,translation:c,scale:f,mesh:g,extras:y,children:x}=e,E={};if(E.matrix=i||s.m.fromRotationTranslationScale([],a||[0,0,0,1],c||[0,0,0],f||[1,1,1]),g!==void 0){E.meshes=r[g];const S=E.anchor=[0,0];for(const M of E.meshes){const{min:A,max:L}=M.aabb;S[0]+=A[0]+L[0],S[1]+=A[1]+L[1]}S[0]=Math.floor(S[0]/E.meshes.length/2),S[1]=Math.floor(S[1]/E.meshes.length/2)}if(y&&(y.id&&(E.id=y.id),y.lights&&(E.lights=function(S){if(!S.length)return[];const M=function(F){const W=atob(F),H=new Uint8Array(W.length);for(let $=0;$<W.length;$++)H[$]=W.codePointAt($);return H}(S),A=[],L=M.length/24,R=new Uint16Array(M.buffer),N=new Float32Array(M.buffer);for(let F=0;F<L;F++){const W=R[2*F*6]/30,H=R[2*F*6+1]/30,$=R[2*F*6+10]/100,Q=N[6*F+1],et=N[6*F+2],ct=N[6*F+3],ft=N[6*F+4],gt=ct-Q,Et=ft-et,vt=Math.hypot(gt,Et);A.push({pos:[Q+.5*gt,et+.5*Et,H],normal:[Et/vt,-gt/vt,0],width:vt,height:W,depth:$,points:[Q,et,ct,ft]})}return A}(y.lights))),x){const S=[];for(const M of x)S.push(Nw(t.json.nodes[M],t,r));E.children=S}return E}function WS(e){if(e.vertices.length===0||e.indices.length===0)return null;const[t,r]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let f=1;f<e.vertices.length;++f){const g=e.vertices[f];t.x=Math.min(t.x,g.x),t.y=Math.min(t.y,g.y),r.x=Math.max(r.x,g.x),r.y=Math.max(r.y,g.y)}const i=Math.ceil(Math.max(r.x-t.x,r.y-t.y)/256),a=Math.max(8,i),c=new zw(e.vertices,e.indices,a);return{vertices:e.vertices,indices:e.indices,grid:c,min:t,max:r}}function HS(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const r=t[0];if(!r||!Array.isArray(r)||r.length===0)return null;const i=[];for(const f of r){if(!Array.isArray(f)||f.length!==2)continue;const g=f[0],y=f[1];typeof g=="number"&&typeof y=="number"&&i.push(new At(g,y))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let a=0;for(let f=0;f<i.length;f++){const g=i[f],y=i[(f+1)%i.length],x=i[(f+2)%i.length];a+=(g.x-y.x)*(x.y-y.y)-(x.x-y.x)*(g.y-y.y)}a>0&&i.reverse();const c=rg(i.flatMap(f=>[f.x,f.y]),[]);return c.length===0?null:{vertices:i,indices:c}}function YS(e){const t=[],r=[];let i=0;for(const a of e){i=t.length;const c=a.vertexArray.float32,f=a.indexArray.uint16;for(let g=0;g<a.vertexArray.length;g++)t.push(new At(c[3*g+0],c[3*g+1]));for(let g=0;g<3*a.indexArray.length;g++)r.push(f[g]+i)}if(r.length%3!=0)return null;for(let a=0;a<r.length;a+=3){const c=t[r[a+0]],f=t[r[a+1]],g=t[r[a+2]];(c.x-f.x)*(g.y-f.y)-(g.x-f.x)*(c.y-f.y)>0&&([r[a+1],r[a+2]]=[r[a+2],r[a+1]])}return{vertices:t,indices:r}}function kw(e){const t=function(y,x){const E=[],S=WebGL2RenderingContext;if(y.json.textures)for(const M of y.json.textures){const A={magFilter:S.LINEAR,minFilter:S.NEAREST,wrapS:S.REPEAT,wrapT:S.REPEAT};M.sampler!==void 0&&Object.assign(A,y.json.samplers[M.sampler]),E.push({image:x[M.source],sampler:A,uploaded:!1})}return E}(e,e.images),r=function(y,x){const E=[];for(const S of y.json.meshes){const M=[];for(const A of S.primitives)M.push(XS(A,y,x));E.push(M)}return E}(e,t),{scenes:i,scene:a,nodes:c}=e.json,f=i?i[a||0].nodes:c,g=[];for(const y of f)g.push(Nw(c[y],e,r));return function(y,x,E){const S={},M=new Set;for(let A=0;A<y.length;A++){const L=E[x[A]];if(!L.extras)continue;const R=L.extras["mapbox:footprint:version"],N=L.extras["mapbox:footprint:id"];(R||N)&&M.add(A),R==="1.0.0"&&N&&(S[N]=A)}for(let A=0;A<y.length;A++){if(M.has(A))continue;const L=y[A],R=E[x[A]];if(!R.extras)continue;let N=null;L.id in S&&(N=YS(y[S[L.id]].meshes)),N||(N=HS(R)),N&&(L.footprint=WS(N))}if(M.size>0){const A=Array.from(M.values()).sort((L,R)=>L-R);for(let L=A.length-1;L>=0;L--)y.splice(A[L],1)}}(g,f,e.json.nodes),g}function $S(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,r=e.aabb.min[0]-1,i=e.aabb.min[1]-1,a=Lc/(e.aabb.max[0]-r+2),c=Lc/(e.aabb.max[1]-i+2);for(let f=0;f<t.length;f+=3){const g=t[f+2],y=(t[f+0]-r)*a|0,x=(t[f+1]-i)*c|0;g>e.heightmap[x*Lc+y]&&(e.heightmap[x*Lc+y]=g)}}function JS(e,t){const r={};r.indexArray=new Or,r.indexArray.reserve(4*e.length),r.vertexArray=new vc,r.vertexArray.reserve(10*e.length),r.colorArray=new Mr,r.vertexArray.reserve(10*e.length);let i=0;for(const f of e){const g=Math.min(10,Math.max(4,1.3*f.height))*t,y=[-f.normal[1],f.normal[0],0],x=Math.min(.29,.1*f.width/f.depth),E=f.width-2*f.depth*t*(x+.01),S=s.v.scaleAndAdd([],f.pos,y,E/2),M=s.v.scaleAndAdd([],f.pos,y,-E/2),A=[S[0],S[1],S[2]+f.height],L=[M[0],M[1],M[2]+f.height],R=s.v.scaleAndAdd([],f.normal,y,x);s.v.scale(R,R,g);const N=s.v.scaleAndAdd([],f.normal,y,-x);s.v.scale(N,N,g),s.v.add(R,S,R),s.v.add(N,M,N),S[2]+=.1,M[2]+=.1,r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(N[0],N[1],N[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(N[0],N[1],N[2]);const F=E/g/2;r.colorArray.emplaceBack(-F-x,-1,F,.8),r.colorArray.emplaceBack(F+x,-1,F,.8),r.colorArray.emplaceBack(-F,0,F,1.3),r.colorArray.emplaceBack(F,0,F,1.3),r.colorArray.emplaceBack(F+x,-.8,F,.7),r.colorArray.emplaceBack(F+x,-.8,F,.7),r.colorArray.emplaceBack(0,0,F,1.3),r.colorArray.emplaceBack(0,0,F,1.3),r.colorArray.emplaceBack(F+x,-1.2,F,.8),r.colorArray.emplaceBack(F+x,-1.2,F,.8),r.indexArray.emplaceBack(6+i,4+i,8+i),r.indexArray.emplaceBack(7+i,9+i,5+i),r.indexArray.emplaceBack(0+i,1+i,2+i),r.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}const a={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=rn.white,a.pbrMetallicRoughness=c,r.material=a,r.aabb=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}me(zw,"TriangleGridIndex");const Fw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Pv{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,i]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=i>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const c=Fw[15&i];if(!c)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(t,2,1),[g]=new Uint32Array(t,4,1);return new Pv(g,f,c,t)}constructor(t,r=64,i=Float64Array,a){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const c=Fw.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,g=t*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-g%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+g+y,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+g+y),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+g+y,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=r,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Lv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:g}=this,y=[0,c.length-1,0],x=[];for(;y.length;){const E=y.pop()||0,S=y.pop()||0,M=y.pop()||0;if(S-M<=g){for(let N=M;N<=S;N++){const F=f[2*N],W=f[2*N+1];F>=t&&F<=i&&W>=r&&W<=a&&x.push(c[N])}continue}const A=M+S>>1,L=f[2*A],R=f[2*A+1];L>=t&&L<=i&&R>=r&&R<=a&&x.push(c[A]),(E===0?t<=L:r<=R)&&(y.push(M),y.push(A-1),y.push(1-E)),(E===0?i>=L:a>=R)&&(y.push(A+1),y.push(S),y.push(1-E))}return x}within(t,r,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:c,nodeSize:f}=this,g=[0,a.length-1,0],y=[],x=i*i;for(;g.length;){const E=g.pop()||0,S=g.pop()||0,M=g.pop()||0;if(S-M<=f){for(let N=M;N<=S;N++)Vw(c[2*N],c[2*N+1],t,r)<=x&&y.push(a[N]);continue}const A=M+S>>1,L=c[2*A],R=c[2*A+1];Vw(L,R,t,r)<=x&&y.push(a[A]),(E===0?t-i<=L:r-i<=R)&&(g.push(M),g.push(A-1),g.push(1-E)),(E===0?t+i>=L:r+i>=R)&&(g.push(A+1),g.push(S),g.push(1-E))}return y}}function Lv(e,t,r,i,a,c){if(a-i<=r)return;const f=i+a>>1;Bw(e,t,f,i,a,c),Lv(e,t,r,i,f-1,1-c),Lv(e,t,r,f+1,a,1-c)}function Bw(e,t,r,i,a,c){for(;a>i;){if(a-i>600){const x=a-i+1,E=r-i+1,S=Math.log(x),M=.5*Math.exp(2*S/3),A=.5*Math.sqrt(S*M*(x-M)/x)*(E-x/2<0?-1:1);Bw(e,t,r,Math.max(i,Math.floor(r-E*M/x+A)),Math.min(a,Math.floor(r+(x-E)*M/x+A)),c)}const f=t[2*r+c];let g=i,y=a;for(gd(e,t,i,r),t[2*a+c]>f&&gd(e,t,i,a);g<y;){for(gd(e,t,g,y),g++,y--;t[2*g+c]<f;)g++;for(;t[2*y+c]>f;)y--}t[2*i+c]===f?gd(e,t,i,y):(y++,gd(e,t,y,a)),y<=r&&(i=y+1),r<=y&&(a=y-1)}}function gd(e,t,r,i){Dv(e,r,i),Dv(t,2*r,2*i),Dv(t,2*r+1,2*i+1)}function Dv(e,t,r){const i=e[t];e[t]=e[r],e[r]=i}function Vw(e,t,r,i){const a=e-r,c=t-i;return a*a+c*c}s.$=45,s.A=Tn,s.B=function(e){const t=s.m.identity(new Float64Array(16));s.m.multiply(t,e.pixelMatrix,e.globeMatrix);const r=[0,Cs,0],i=[0,Ms,0];return s.v.transformMat4(r,r,t),s.v.transformMat4(i,i,t),[r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!Py(e,new Ar(e.center.lat,90)),i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!Py(e,new Ar(e.center.lat,-90))]},s.C=rn,s.D=yu,s.E=ja,s.F=Ey,s.G=r1,s.H=qa,s.I=Ac,s.J=ee,s.K=function(e,t){const{scale:r}=e.tileTransform,i=r*ee/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return s.h.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[i,i])},s.L=Ar,s.M=Li,s.N=Ag,s.O=fi,s.P=At,s.Q=Rb,s.R=by,s.S=function(e){const t=Rb(e,!0);return s.h.invert([],[t[0],t[1],t[4],t[5]])},s.T=wy,s.U=Kx,s.V=function(e){const{x:t,y:r}=e.point,{lng:i,lat:a}=e._center;return u1(t,r,e.worldSize,i,a)},s.W=ls,s.X=pn,s.Y=Tr,s.Z=Iy,s._=function(e){const t=Math.round((e+45+360)%360/90)%4;return Oe[t]},s.a=Ps,s.a$=Bm,s.a0=Dy,s.a1=function(e,t){return $s(Qr(e,{type:"json"}),t)},s.a2=ui,s.a3=kt,s.a4=ji,s.a5=as,s.a6=xs,s.a7=fl,s.a8=Yo,s.a9=Vl,s.aA=Cc,s.aB=m1,s.aC=ss,s.aD=Sw,s.aE=ce,s.aF=Cw,s.aG=function(e){ei++,ei>Ur&&(e.getActor().send("enforceCacheSizeLimit",Ve),ei=0)},s.aH=xn,s.aI=Zd,s.aJ=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},s.aK=bw,s.aL=function(e,t){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let i=0;i<e.length;i++){const a=document.createElement("source");Js(e[i])||(r.crossOrigin="Anonymous"),a.src=e[i],r.appendChild(a)}return{cancel:()=>{}}},s.aM=xe,s.aN=Sg,s.aO=function(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>Ow(t,0,e))},s.aP=kw,s.aQ=class{constructor(e,t,r,i){this.id=e,this.position=t!=null?new Ar(t[0],t[1]):new Ar(0,0),this.orientation=r??[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(s.m.multiply(e.matrix,t,e.matrix),e.meshes)for(const r of e.meshes){const i=On.applyTransform(r.aabb,e.matrix);this.aabb.encapsulate(i)}if(e.children)for(const r of e.children)this._applyTransformations(r,e.matrix)}computeBoundsAndApplyParent(){const e=s.m.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}_positionModelOnTerrain(e,t){const r=e.elevation;if(!r)return 0;const i=On.projectAabbCorners(this.aabb,this.matrix),a=so(1,this.position.lat)*e.worldSize,c=function(N,F){const W=[0,0,1],H=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const $ of H){const Q=N[$.corners[0]],et=N[$.corners[1]],ct=N[$.corners[2]],ft=[et[0]-Q[0],et[1]-Q[1],F*(et[2]-Q[2])],gt=s.v.cross(ft,ft,[ct[0]-Q[0],ct[1]-Q[1],F*(ct[2]-Q[2])]);s.v.normalize(gt,gt),$.dotProductWithUp=s.v.dot(gt,W)}return H.sort(($,Q)=>$.dotProductWithUp-Q.dotProductWithUp),H[0].corners}(i,a),f=i[c[0]],g=i[c[1]],y=i[c[2]],x=i[c[3]],E=r.getAtPointOrZero(new Li(f[0]/e.worldSize,f[1]/e.worldSize),0),S=r.getAtPointOrZero(new Li(g[0]/e.worldSize,g[1]/e.worldSize),0),M=r.getAtPointOrZero(new Li(y[0]/e.worldSize,y[1]/e.worldSize),0),A=r.getAtPointOrZero(new Li(x[0]/e.worldSize,x[1]/e.worldSize),0),L=(E+A)/2,R=(S+M)/2;return L>R?S<M?Pg(t,g,x,f,S,A,E,a):Pg(t,y,f,x,M,E,A,a):E<A?Pg(t,f,g,y,E,S,M,a):Pg(t,x,y,g,A,M,S,a),Math.max(L,R)}computeModelMatrix(e,t,r,i,a,c,f=!1){const g=e.transform,y=g.zoom,x=g.project(this.position),E=Sc(this.position.lat,y),S=1/E;s.m.identity(this.matrix),s.m.translate(this.matrix,this.matrix,[x.x+i[0]*S,x.y+i[1]*S,i[2]]);let M=1,A=1;const L=g.worldSize;if(f){if(g.projection.name==="mercator"){let W=0;g.elevation&&(W=g.elevation.getAtPointOrZero(new Li(x.x/L,x.y/L),0));const H=s.e.transformMat4([],[x.x,x.y,W,1],g.projMatrix)[3]/g.cameraToCenterDistance;M=H,A=H*Sc(g.center.lat,y)}else if(g.projection.name==="globe"){const W=Bb(this.matrix,g),H=s.m.multiply([],g.projMatrix,W),$=[0,0,0,1];s.e.transformMat4($,$,H);const Q=$[3]/g.cameraToCenterDistance,et=Nl(y),ct=g.projection.pixelsPerMeter(this.position.lat,L)*Sc(this.position.lat,y),ft=g.projection.pixelsPerMeter(g.center.lat,L)*Sc(g.center.lat,y);M=Q/nr(ct,f1(g.center.lat),et),A=Q*E/ct,M*=ft,A*=ft}}else M=S;s.m.scale(this.matrix,this.matrix,[M,M,A]);const R=[...this.matrix],N=this.orientation,F=[];if(Fb(F,[N[0]+t[0],N[1]+t[1],N[2]+t[2]],r),s.m.multiply(this.matrix,R,F),a&&g.elevation){let W=0;const H=[];if(c&&g.elevation){W=this._positionModelOnTerrain(g,H);const $=s.m.fromQuat([],H),Q=s.m.multiply([],$,F);s.m.multiply(this.matrix,R,Q)}else W=g.elevation.getAtPointOrZero(new Li(x.x/L,x.y/L),0);W!==0&&(this.matrix[14]+=W)}}upload(e){if(!this.uploaded){for(const t of this.nodes)gv(t,e);for(const t of this.nodes)Dg(t);this.uploaded=!0}}destroy(){for(const e of this.nodes)Rg(e)}},s.aR=eu,s.aS=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.aT=fb,s.aU=_1,s.aV=Si,s.aW=vb,s.aX=ov,s.aY=tv,s.aZ=Pv,s.a_=Bf,s.aa=ev,s.ab=rv,s.ac=Ft,s.ad=tt,s.ae=bt,s.af=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return at(e.expression.evaluate(t))}interpolate(e,t,r){return{x:nr(e.x,t.x,r),y:nr(e.y,t.y,r),z:nr(e.z,t.z,r),azimuthal:nr(e.azimuthal,t.azimuthal,r),polar:nr(e.polar,t.polar,r)}}},s.ag=wt,s.ah=e=>es(Lf(e)),s.ai=zm,s.aj=zf,s.ak=Qr,s.al=ut,s.am=dc,s.an=Qn,s.ao=Nl,s.ap=e=>es(Of(e)),s.aq=Ch,s.ar=zt,s.as=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([r,i]){const a=at([1,r,i]);return{x:a.x,y:a.y,z:a.z}}(e.expression.evaluate(t))}interpolate(e,t,r){return{x:nr(e.x,t.x,r),y:nr(e.y,t.y,r),z:nr(e.z,t.z,r)}}},s.at=function(e,t,r=0,i=!0){const a=new At(r,r),c=e.sub(a),f=t.add(a),g=[c,new At(f.x,c.y),f,new At(c.x,f.y)];return i&&g.push(c.clone()),g},s.au=function(e,t){const r=[];for(let i=0;i<e.length;i++){const a=ti(i-1,-1,e.length-1),c=ti(i+1,-1,e.length-1),f=e[i],g=e[c],y=e[a].sub(f).unit(),x=g.sub(f).unit(),E=x.angleWithSep(y.x,y.y),S=y.add(x).unit().mult(-1*t/Math.sin(E/2));r.push(f.add(S))}return r},s.av=Eb,s.aw=b1,s.ax=function(e,t,r=0){return s.v.fromValues(((t.x-r)*e.scale-e.x)*ee,(t.y*e.scale-e.y)*ee,p1(t.z,t.y))},s.ay=kb,s.az=function(e){let t=1/0,r=1/0,i=-1/0,a=-1/0;for(const c of e)t=Math.min(t,c.x),r=Math.min(r,c.y),i=Math.max(i,c.x),a=Math.max(a,c.y);return{min:new At(t,r),max:new At(i,a)}},s.b=so,s.b$=0,s.b0=xc,s.b1=z0,s.b2=oo,s.b3=function(e,t,r){const i=Math.sqrt(e*e+t*t+r*r),a=i>0?Math.acos(r/i)*Vr:0;let c=e!==0||t!==0?Math.atan2(-t,-e)*Vr+90:0;return c<0&&(c+=360),[i,c,a]},s.b4=sp,s.b5=ua,s.b6=pv,s.b7=ny,s.b8=class extends Al{constructor(e){super(e),this.current=S2}set(e,t,r){if(this.fetchUniformLocation(e,t)){for(let i=0;i<9;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.b9=O0,s.bA=function(e,t){const r=[0,0,0],i=Zf(Ga(t.canonical));return s.v.transformMat4(r,r,i),s.v.transformMat4(r,r,e),r},s.bB=e=>({u_camera_to_center_distance:new oo(e),u_extrude_scale:new iy(e),u_device_pixel_ratio:new oo(e),u_matrix:new Bf(e),u_inv_rot_matrix:new Bf(e),u_merc_center:new xc(e),u_tile_id:new ny(e),u_zoom_transition:new oo(e),u_up_dir:new ny(e),u_emissive_strength:new oo(e)}),s.bC=e=>({u_matrix:new Bf(e),u_pixels_to_tile_units:new iy(e),u_device_pixel_ratio:new oo(e),u_units_to_pixels:new xc(e),u_dash_image:new Bm(e),u_gradient_image:new Bm(e),u_image_height:new oo(e),u_texsize:new xc(e),u_tile_units_to_pixels:new oo(e),u_alpha_discard_threshold:new oo(e),u_trim_offset:new xc(e),u_emissive_strength:new oo(e)}),s.bD=e=>({u_matrix:new Bf(e),u_texsize:new xc(e),u_pixels_to_tile_units:new iy(e),u_device_pixel_ratio:new oo(e),u_image:new Bm(e),u_units_to_pixels:new xc(e),u_tile_units_to_pixels:new oo(e),u_alpha_discard_threshold:new oo(e)}),s.bE=ra,s.bF=vT,s.bG=xT,s.bH=I1,s.bI=(e,t,r,i,a,c)=>{const f=e.transform,g=f.projection.name==="globe";let y;if(c.paint.get("circle-pitch-alignment")==="map")if(g){const E=l1(f.zoom,t.canonical)*f._pixelsPerMercatorPixel;y=Float32Array.from([E,0,0,E])}else y=f.calculatePixelsToTileUnitsMatrix(r);else y=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const x={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(f.projection),u_matrix:e.translatePosMatrix(t.projMatrix,r,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ji.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:mI,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(g){x.u_inv_rot_matrix=i,x.u_merc_center=a,x.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],x.u_zoom_transition=Nl(f.zoom);const E=a[0]*ee,S=a[1]*ee;x.u_up_dir=f.projection.upVector(new Ic(0,0,0),E,S)}return x},s.bJ=gw,s.bK=(e,t,r,i,a)=>{const c=e.transform;return{u_matrix:mw(e,t,r,i),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:c.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:dw(t,c),u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}},s.bL=(e,t,r,i,a,c,f)=>{const g=e.transform,y=g.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:mw(e,t,r,i),u_pixels_to_tile_units:y,u_device_pixel_ratio:c,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:_w(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:dw(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:f,u_emissive_strength:r.paint.get("line-emissive-strength")}},s.bM=cl,s.bN=Jm,s.bO=uw,s.bP=Q2,s.bQ=cd,s.bR=Pu,s.bS=450,s.bT=7,s.bU=i1,s.bV=My,s.bW=Ee,s.bX=vc,s.bY=yc,s.bZ=1,s.b_=771,s.ba=vr,s.bb=function(e,t,r){const i=Nl(r.zoom),a=e.style.map._antialias,c=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return i===0&&!a&&!c},s.bc=function(e){const t=e.pixelsPerMeter,r=t/so(1,e.center.lat),i=s.m.identity(new Float64Array(16));return s.m.translate(i,i,[e.point.x,e.point.y,0]),s.m.scale(i,i,[r,r,t]),Float32Array.from(i)},s.bd=$o,s.be=Zm,s.bf=function(e){const t=Tn-5;e=ke(e,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(ae(e))),3);return Math.round(r*(Ty.length-1))},s.bg=function(e,t,r,i){const a=t.getNorth(),c=t.getSouth(),f=t.getWest(),g=t.getEast(),y=1<<e.z,x=g-f,E=a-c,S=x/Zh,M=-E/Ty[r],A=[0,S,0,M,0,0,a,f,0];if(e.z>0){const L=180/i;s.bx.multiply(A,A,[L/x+1,0,0,0,L/E+1,0,-.5*L/S,.5*L/M,1])}return A[2]=y,A[5]=e.x,A[8]=e.y,A},s.bh=Zf,s.bi=Ga,s.bj=function(e,t,r){const i=s.m.identity(new Float64Array(16)),a=(t/(1<<e)-.5)*Math.PI*2;return s.m.rotateY(i,r.globeMatrix,a),Float32Array.from(i)},s.bk=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const r=t.getSource().maxzoom,i=1<<r,a=Math.floor(e.x),c=Math.floor((e.x-a)*i),f=Math.floor(e.y*i),g=this.findDEMTileFor(new fi(r,a,r,c,f));return!(!g||!g.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,r=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const i=this._source();if(!i||e.y<0||e.y>1)return t;const a=i.getSource().maxzoom,c=1<<a,f=Math.floor(e.x),g=e.x-f,y=new fi(a,f,a,Math.floor(g*c),Math.floor(e.y*c)),x=this.findDEMTileFor(y);if(!x||!x.dem)return t;const E=x.dem,S=1<<x.tileID.canonical.z,M=(g*S-x.tileID.canonical.x)*E.dim,A=(e.y*S-x.tileID.canonical.y)*E.dim,L=Math.floor(M),R=Math.floor(A);return(r?this.exaggeration():1)*nr(nr(E.get(L,R),E.get(L,R+1),A-R),nr(E.get(L+1,R),E.get(L+1,R+1),A-R),M-L)}getAtTileOffset(e,t,r){const i=1<<e.canonical.z;return this.getAtPointOrZero(new Li(e.wrap+(e.canonical.x+t/ee)/i,(e.canonical.y+r/ee)/i))}getAtTileOffsetFunc(e,t,r,i){return a=>{const c=this.getAtTileOffset(e,a.x,a.y),f=i.upVector(e.canonical,a.x,a.y),g=i.upVectorScale(e.canonical,t,r).metersToTile;return s.v.scale(f,f,c*g),f}}getForTilePoints(e,t,r,i){if(this.isUsingMockSource())return!1;const a=Qh.create(this,e,i);return!!a&&(t.forEach(c=>{c[2]=this.exaggeration()*a.getElevationAt(c[0],c[1],r)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const r=t.dem.tree,i=t.tileID,a=1<<e.canonical.z-i.canonical.z;let c=e.canonical.x/a-i.canonical.x,f=e.canonical.y/a-i.canonical.y,g=0;for(let y=0;y<e.canonical.z-i.canonical.z&&!r.leaves[g];y++){c*=2,f*=2;const x=2*Math.floor(f)+Math.floor(c);g=r.childOffsets[g]+x,c%=1,f%=1}return{min:this.exaggeration()*r.minimums[g],max:this.exaggeration()*r.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(e.length===0)return null;let t=!1,r=Number.MAX_VALUE,i=Number.MIN_VALUE;for(const a of e){const c=this.getMinMaxForTile(a.tileID);c&&(r=Math.min(r,c.min),i=Math.max(i,c.max),t=!0)}return t?{min:r,max:i}:null}},s.bl=Uf,s.bm=fn,s.bn=qm,s.bo=Xe,s.bp=Or,s.bq=Pc,s.br=pd,s.bs=wv,s.bt=cv,s.bu=P1,s.bv=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},s.bw=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},s.by=l1,s.bz=256,s.c=ke,s.c$=O,s.c0=$_,s.c1=function(e,t,r,i,a){return ke((e-t)/(r-t)*(a-i)+i,i,a)},s.c2=lc,s.c3=On,s.c4=Sc,s.c5=Bb,s.c6=[1,1,1],s.c7=Qh,s.c8=Lg,s.c9=Hi,s.cA=ih,s.cB=e=>es(Rf(e)),s.cC=Y,s.cD=$s,s.cE=$r,s.cF=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.cG=Vn,s.cH=d1,s.cI=Tc,s.cJ=function([e,t,r]){const i=Math.hypot(e,t,r),a=Math.atan2(e,r),c=.5*Math.PI-Math.acos(-t/i);return new Ar(Tr(a),Tr(c))},s.cK=No,s.cL=Xf,s.cM=G,s.cN=Py,s.cO=c1,s.cP=function(e){const t=[0,0,0],r=s.m.identity(new Float64Array(16));return s.m.multiply(r,e.pixelMatrix,e.globeMatrix),s.v.transformMat4(t,t,r),new At(t[0],t[1])},s.cQ=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(r){if(jt==null){const i=r.navigator?r.navigator.userAgent:null;jt=!!r.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return jt}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.cR=go,s.cS=class{constructor(e,t,r){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const e=function(){let t="";for(let r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",he,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Jt(e))return e;const r=Qt(e);return r.params.push(`sdk=js-${O}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Jt(e))return e;const r=Qt(e);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeModelURL(e,t){if(!Jt(e))return e;const r=Qt(e);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeSourceURL(e,t,r,i){if(!Jt(e))return e;const a=Qt(e);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),r&&a.params.push(`language=${r}`),i&&a.params.push(`worldview=${i}`),this._makeAPIURL(a,this._customAccessToken||t)}normalizeSpriteURL(e,t,r,i){const a=Qt(e);return Jt(e)?(a.path=`/styles/v1${a.path}/sprite${t}${r}`,this._makeAPIURL(a,this._customAccessToken||i)):(a.path+=`${t}${r}`,He(a))}normalizeTileURL(e,t,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Jt(e))return e;const i=Qt(e);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||r&&i.authority!=="raster"&&r===512?"@2x":""}${it.supported?".webp":"$1"}`),i.authority==="raster"?i.path=`/${G.RASTER_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${G.TILE_URL_VERSION}${i.path}`);const a=this._customAccessToken||function(c){for(const f of c){const g=f.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(i.params)||G.ACCESS_TOKEN;return G.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,a)}canonicalizeTileURL(e,t){const r=Qt(e);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return e;let i="mapbox://";r.path.match(/^\/raster\/v1\//)?i+=`raster/${r.path.replace(`/${G.RASTER_URL_PREFIX}/`,"")}`:i+=`tiles/${r.path.replace(`/${G.TILE_URL_VERSION}/`,"")}`;let a=r.params;return t&&(a=a.filter(c=>!c.match(/^access_token=/))),a.length&&(i+=`?${a.join("&")}`),i}canonicalizeTileset(e,t){const r=!!t&&Jt(t),i=[];for(const a of e.tiles||[])te(a)?i.push(this.canonicalizeTileURL(a,r)):i.push(a);return i}_makeAPIURL(e,t){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=Qt(G.API_URL);if(e.protocol=i.protocol,e.authority=i.authority,e.protocol==="http"){const a=e.params.indexOf("secure");a>=0&&e.params.splice(a,1)}if(i.path!=="/"&&(e.path=`${i.path}${e.path}`),!G.REQUIRE_ACCESS_TOKEN)return He(e);if(t=t||G.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return e.params=e.params.filter(a=>a.indexOf("access_token")===-1),e.params.push(`access_token=${t||""}`),He(e)}},s.cT=function(e,t){t?ro.add(e):ro.delete(e)},s.cU=it,s.cV=Ao,s.cW=wi,s.cX=Yt,s.cY=bi,s.cZ=function(e){ro.delete(e)},s.c_=Pn,s.ca=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=Yb(new At(0,0),new At(ee,ee),e),r=[];for(const i of this._activeRegions){if(i.hiddenByOverlap||!Hb(t,i))continue;const a=gS(i.min,i.max,e);r.push({min:a.min,max:a.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId})}return r}setSources(e){this._setSources(e.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const r=[];for(const i of t.cache.getVisibleCoordinates()){const a=t.cache.getTile(i).buckets[t.layer];if(a)for(const c of a.getNodesInfo()){const f=c.node;f.footprint&&r.push({footprint:f.footprint,id:i.toUnwrapped()})}}return r}})))}_addSource(e){const t=e.getFootprints();if(t.length!==0){for(const r of t){if(!r.footprint)continue;const i=Yb(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:i.min,max:i.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((t,r)=>t.priority-r.priority||Og(t.min,r.min)||Og(t.max,r.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,r=0;for(;!e&&t!==this._activeRegions.length;){const i=this._activeRegions[t],a=this._prevRegions[r];e=i.priority!==a.priority||!Wb(i,a),++t,++r}}if(e){++this._updateTime;const t=r=>{const i=this._activeRegions;if(r>=i.length)return r;const a=i[r].priority;for(;r<i.length&&i[r].priority===a;)++r;return r};if(this._sourceIds.length>1){let r=0,i=t(r);for(;r!==i;){let a=r;const c=r;for(;a!==i;){const f=this._activeRegions[a];f.hiddenByOverlap=!1;for(let g=0;g<c;g++){const y=this._activeRegions[g];if(!y.hiddenByOverlap&&Hb(f,y)&&(f.hiddenByOverlap=Jb(f.footprint,f.tileId,y.footprint,y.tileId),f.hiddenByOverlap))break}++a}r=i,i=t(r)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},s.cb=Dr,s.cc=Mg,s.cd=Nf,s.ce=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const r=new Xe,i=new Or,a=[],c=e+1+2,f=t[0]+1,g=t[0]+1+(1+t.length),y=(x,E,S)=>{let M=x===c-1?x-2:x===0?x:x-1;return M+=S?24575:0,[M,E]};for(let x=0;x<c;++x)r.emplaceBack(...y(x,0,!0));for(let x=0;x<f;++x)for(let E=0;E<c;++E)r.emplaceBack(...y(E,x,(E===0||E===c-1)&&!0));for(let x=0;x<t.length;++x){const E=t[x];for(let S=0;S<c;++S)r.emplaceBack(...y(S,E,!0))}for(let x=0;x<t.length;++x){const E=i.length,S=t[x]+1+2,M=new Or;for(let R=0;R<S-1;R++){const N=R===S-2,F=N?c*(g-t.length+x-R):c;for(let W=0;W<c-1;W++){const H=R*c+W;R===0||N||W===0||W===c-2?(M.emplaceBack(H+1,H,H+F),M.emplaceBack(H+F,H+F+1,H+1)):(i.emplaceBack(H+1,H,H+F),i.emplaceBack(H+F,H+F+1,H+1))}}const A=fn.simpleSegment(0,E,r.length,i.length-E);for(let R=0;R<M.uint16.length;R+=3)i.emplaceBack(M.uint16[R],M.uint16[R+1],M.uint16[R+2]);const L=fn.simpleSegment(0,E,r.length,i.length-E);a.push({withoutSkirts:A,withSkirts:L})}return{vertices:r,indices:i,segments:a}}_createGrid(e){const t=this._fillGridMeshWithLods(Zh,Ty);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Uf.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Or;for(let f=0;f<=Zh;f++)t.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const r=new yc,i=new yc,a=new yc,c=new yc;this._poleSegments=[];for(let f=0,g=0;f<Iy;f++){const y=360/(1<<f);r.emplaceBack(0,-ss,0,.5,0),i.emplaceBack(0,-ss,0,.5,1),a.emplaceBack(0,-ss,0,.5,.5),c.emplaceBack(0,-ss,0,.5,.5);for(let x=0;x<=Zh;x++){let E=x/Zh,S=0;const M=nr(0,y,E),[A,L,R]=Xh(nI,iI,M,ss);r.emplaceBack(A,L,R,E,S),i.emplaceBack(A,L,R,E,1-S);const N=ae(M);E=.5+.5*Math.sin(N),S=.5+.5*Math.cos(N),a.emplaceBack(A,L,R,E,S),c.emplaceBack(A,L,R,E,1-S)}this._poleSegments.push(fn.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,jm,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(i,jm,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(a,jm,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(c,jm,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},s.cf=function(e){return ro.has(e)},s.cg=Wm,s.ch=at,s.ci=function(e){return e({pluginStatus:j,pluginURL:J}),Y.on("pluginStateChange",e),e},s.cj=rp,s.ck=nv,s.cl=Gi,s.cm=nt,s.cn=Jt,s.co=Ho,s.cp=function(e,t,r){return e.type==="custom"?new RS(e,t):new kS[e.type](e,t,r)},s.cq=function(e){const t=e.indexOf(ge);return t>=0?e.slice(0,t):e},s.cr=e=>es(Rm(e)),s.cs=e=>es(Lm(e)),s.ct=e=>es(Df(e)),s.cu=function(e){return e.indexOf(ge)>=0},s.cv=function(e){const t=e.indexOf(ge);return t>=0?e.slice(t+1):""},s.cw=pc,s.cx=function(e){const t=[],r=e.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),e.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},s.cy=e=>es(Pm(e)),s.cz=e=>es(Pf(e)),s.d=ae,s.d0=function(e,t){Ve=e,Ur=t},s.d1=function(e,t,r=!1){if(j===U||j===q||j===X)throw new Error("setRTLTextPlugin cannot be called multiple times.");J=ji.resolveURL(e),j=U,Z=t,st(),r||lt()},s.d2=K,s.d3=function(){wv().acquire(bv)},s.d4=function(){const e=md;e&&(e.isPreloaded()&&e.numActive()===1?(e.release(bv),md=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.d5=dd,s.d6=function(e){const t=Jr();if(!t)return;const r=t.delete(Fe);e&&r.catch(e).then(()=>e())},s.d7=fd,s.d8=Mw,s.d9=function(e){Ev=ji.resolveURL(e),Iv||(Iv=new pd(wv(),new xs)),Iv.broadcast("setDracoUrl",Ev)},s.da=Ui,s.db=cg,s.dc=ue,s.dd=og,s.de=ig,s.df=rr,s.dg=B1,s.dh=class extends xs{constructor(e,t,r,i,a,c){super(),this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=a||Cw,this.loading={},this.loaded={},this.deduped=new Sw(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler,this.brightness=c}loadTile(e,t){const r=e.uid,i=e&&e.request,a=i&&i.collectResourceTiming,c=this.loading[r]=new VS(e);c.abort=this.loadVectorData(e,(f,g)=>{const y=!this.loading[r];if(delete this.loading[r],y||f||!g)return c.status="done",y||(this.loaded[r]=c),t(f);const x=g.rawData,E={};g.expires&&(E.expires=g.expires),g.cacheControl&&(E.cacheControl=g.cacheControl),c.vectorTile=g.vectorTile||new Hy(new ug(x));const S=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,A)=>{if(M||!A)return t(M);const L={};if(a){const R=kp(i);R.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(R)))}t(null,Qr({rawTileData:x.slice(0)},A,E,L))})};this.isSpriteLoaded?S():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(S,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):S()}),this.loaded=this.loaded||{},this.loaded[r]=c})}reloadTile(e,t){const r=this.loaded,i=e.uid,a=this;if(r&&r[i]){const c=r[i];c.showCollisionBoxes=e.showCollisionBoxes,c.projection=e.projection,c.brightness=e.brightness,c.tileTransform=Tu(e.tileID.canonical,e.projection),c.extraShadowCaster=e.extraShadowCaster;const f=(g,y)=>{const x=c.reloadCallback;x&&(delete c.reloadCallback,c.parse(c.vectorTile,a.layerIndex,this.availableImages,a.actor,x)),t(g,y)};c.status==="parsing"?c.reloadCallback=f:c.status==="done"&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}else t(null,void 0)}abortTile(e,t){const r=e.uid,i=this.loading[r];i&&(i.abort&&i.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,i=e.uid;r&&r[i]&&delete r[i],t()}},s.di=kp,s.dj=ci,s.dk=$y,s.dl=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==Pw){const r=new Uint32Array(e,0,7),[,,i,a,c,f]=r;t=r.byteLength+a+c+f+c,(i!==e.byteLength||t>=e.byteLength)&&pn("Invalid b3dm header information.")}return Ow(e,t)},s.dm=function(e,t){const r=kw(e);for(const i of r){for(const a of i.meshes)$S(a);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(JS(i.lights,t)))}return r},s.dn=Xb,s.dp=ww,s.dq=ht,s.dr=function(e){en(),tn&&tn.then(t=>{t.keys().then(r=>{for(let i=0;i<r.length-e;i++)t.delete(r[i])})})},s.f=function(e,t){const{x:r,y:i}=e.point,a=u1(r,i,e.worldSize/e._pixelsPerMercatorPixel,0,0);return s.m.multiply(a,a,My(Ga(t)))},s.g=Te,s.i=tp,s.j=hg,s.k=Eg,s.l=Ti,s.n=nr,s.o=Mb,s.p=function(e,t){const r={};for(let i=0;i<t.length;i++){const a=t[i];a in e&&(r[a]=e[a])}return r},s.r=Ob,s.s=function(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},s.t=Ic,s.u=function(e,t,r,i,a){const c=5*t+2;e.float32[c+0]=r,e.float32[c+1]=i,e.float32[c+2]=a},s.w=ti,s.x=s1,s.y=function(e,t,r,i,a,c,f,g,y){if(y.name==="globe")return s1(e,t,new Ic(r,i,a),!1);const x=Tu({z:r,x:i,y:a},y);return new On([(c+x.x/x.scale)*t,t*(x.y/x.scale),f],[(c+x.x2/x.scale)*t,t*(x.y2/x.scale),g])},s.z=function(e,t,r){let i=0;for(let a=0;a<2;++a){const c=r?r[a]:0;e[a]>c&&(i+=(e[a]-c)*(e[a]-c)),t[a]<c&&(i+=(c-t[a])*(c-t[a]))}return i}}),b(["./shared"],function(s){function O($t){if(typeof $t=="number"||typeof $t=="boolean"||typeof $t=="string"||$t==null)return JSON.stringify($t);if(Array.isArray($t)){let at="[";for(const _t of $t)at+=`${O(_t)},`;return`${at}]`}let rt="{";for(const at of Object.keys($t).sort())rt+=`${at}:${O($t[at])},`;return`${rt}}`}function V($t){let rt="";for(const at of s.aS)rt+=`/${O($t[at])}`;return rt}class G{constructor(rt){this.keyCache={},this._layers={},this._layerConfigs={},rt&&this.replace(rt)}replace(rt,at){this._layerConfigs={},this._layers={},this.update(rt,[],at)}update(rt,at,_t){this._options=_t;for(const jt of rt)this._layerConfigs[jt.id]=jt,(this._layers[jt.id]=s.cp(jt,this.scope,this._options)).compileFilter(),this.keyCache[jt.id]&&delete this.keyCache[jt.id];for(const jt of at)delete this.keyCache[jt],delete this._layerConfigs[jt],delete this._layers[jt];this.familiesBySource={};const Zt=function(jt,ye){const Te={};for(let ze=0;ze<jt.length;ze++){const Fe=ye&&ye[jt[ze].id]||V(jt[ze]);ye&&(ye[jt[ze].id]=Fe);let Ve=Te[Fe];Ve||(Ve=Te[Fe]=[]),Ve.push(jt[ze])}const Ht=[];for(const ze in Te)Ht.push(Te[ze]);return Ht}(s.da(this._layerConfigs),this.keyCache);for(const jt of Zt){const ye=jt.map(Ur=>this._layers[Ur.id]),Te=ye[0];if(Te.visibility==="none")continue;const Ht=Te.source||"";let ze=this.familiesBySource[Ht];ze||(ze=this.familiesBySource[Ht]={});const Fe=Te.sourceLayer||"_geojsonTileLayer";let Ve=ze[Fe];Ve||(Ve=ze[Fe]=[]),Ve.push(ye)}}}class it{loadTile(rt,at){const{uid:_t,encoding:Zt,rawImageData:jt,padding:ye}=rt,Te=ImageBitmap&&jt instanceof ImageBitmap?this.getImageData(jt,ye):jt;at(null,new s.db(_t,Te,Zt,ye<1))}getImageData(rt,at){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(rt.width,rt.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=rt.width,this.offscreenCanvas.height=rt.height,this.offscreenCanvasContext.drawImage(rt,0,0,rt.width,rt.height);const _t=this.offscreenCanvasContext.getImageData(-at,-at,rt.width+2*at,rt.height+2*at);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),_t}}function ot($t,rt){if($t.length!==0){dt($t[0],rt);for(var at=1;at<$t.length;at++)dt($t[at],!rt)}}function dt($t,rt){for(var at=0,_t=0,Zt=0,jt=$t.length,ye=jt-1;Zt<jt;ye=Zt++){var Te=($t[Zt][0]-$t[ye][0])*($t[ye][1]+$t[Zt][1]),Ht=at+Te;_t+=Math.abs(at)>=Math.abs(Te)?at-Ht+Te:Te-Ht+at,at=Ht}at+_t>=0!=!!rt&&$t.reverse()}var xt=s.dc(function $t(rt,at){var _t,Zt=rt&&rt.type;if(Zt==="FeatureCollection")for(_t=0;_t<rt.features.length;_t++)$t(rt.features[_t],at);else if(Zt==="GeometryCollection")for(_t=0;_t<rt.geometries.length;_t++)$t(rt.geometries[_t],at);else if(Zt==="Feature")$t(rt.geometry,at);else if(Zt==="Polygon")ot(rt.coordinates,at);else if(Zt==="MultiPolygon")for(_t=0;_t<rt.coordinates.length;_t++)ot(rt.coordinates[_t],at);return rt});const Wt=s.dd.prototype.toGeoJSON;var Vt={exports:{}},ie=s.df,he=s.de.VectorTileFeature,ue=Ne;function Ne($t,rt){this.options=rt||{},this.features=$t,this.length=$t.length}function je($t,rt){this.id=typeof $t.id=="number"?$t.id:void 0,this.type=$t.type,this.rawGeometry=$t.type===1?[$t.geometry]:$t.geometry,this.properties=$t.tags,this.extent=rt||4096}Ne.prototype.feature=function($t){return new je(this.features[$t],this.options.extent)},je.prototype.loadGeometry=function(){var $t=this.rawGeometry;this.geometry=[];for(var rt=0;rt<$t.length;rt++){for(var at=$t[rt],_t=[],Zt=0;Zt<at.length;Zt++)_t.push(new ie(at[Zt][0],at[Zt][1]));this.geometry.push(_t)}return this.geometry},je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $t=this.geometry,rt=1/0,at=-1/0,_t=1/0,Zt=-1/0,jt=0;jt<$t.length;jt++)for(var ye=$t[jt],Te=0;Te<ye.length;Te++){var Ht=ye[Te];rt=Math.min(rt,Ht.x),at=Math.max(at,Ht.x),_t=Math.min(_t,Ht.y),Zt=Math.max(Zt,Ht.y)}return[rt,_t,at,Zt]},je.prototype.toGeoJSON=he.prototype.toGeoJSON;var qe=s.dg,rr=ue;function tr($t){var rt=new qe;return function(at,_t){for(var Zt in at.layers)_t.writeMessage(3,At,at.layers[Zt])}($t,rt),rt.finish()}function At($t,rt){var at;rt.writeVarintField(15,$t.version||1),rt.writeStringField(1,$t.name||""),rt.writeVarintField(5,$t.extent||4096);var _t={keys:[],values:[],keycache:{},valuecache:{}};for(at=0;at<$t.length;at++)_t.feature=$t.feature(at),rt.writeMessage(2,hn,_t);var Zt=_t.keys;for(at=0;at<Zt.length;at++)rt.writeStringField(3,Zt[at]);var jt=_t.values;for(at=0;at<jt.length;at++)rt.writeMessage(4,vr,jt[at])}function hn($t,rt){var at=$t.feature;at.id!==void 0&&rt.writeVarintField(1,at.id),rt.writeMessage(2,Vr,$t),rt.writeVarintField(3,at.type),rt.writeMessage(4,Oe,at)}function Vr($t,rt){var at=$t.feature,_t=$t.keys,Zt=$t.values,jt=$t.keycache,ye=$t.valuecache;for(var Te in at.properties){var Ht=at.properties[Te],ze=jt[Te];if(Ht!==null){ze===void 0&&(_t.push(Te),jt[Te]=ze=_t.length-1),rt.writeVarint(ze);var Fe=typeof Ht;Fe!=="string"&&Fe!=="boolean"&&Fe!=="number"&&(Ht=JSON.stringify(Ht));var Ve=Fe+":"+Ht,Ur=ye[Ve];Ur===void 0&&(Zt.push(Ht),ye[Ve]=Ur=Zt.length-1),rt.writeVarint(Ur)}}}function ae($t,rt){return(rt<<3)+(7&$t)}function Tr($t){return $t<<1^$t>>31}function Oe($t,rt){for(var at=$t.loadGeometry(),_t=$t.type,Zt=0,jt=0,ye=at.length,Te=0;Te<ye;Te++){var Ht=at[Te],ze=1;_t===1&&(ze=Ht.length),rt.writeVarint(ae(1,ze));for(var Fe=_t===3?Ht.length-1:Ht.length,Ve=0;Ve<Fe;Ve++){Ve===1&&_t!==1&&rt.writeVarint(ae(2,Fe-1));var Ur=Ht[Ve].x-Zt,tn=Ht[Ve].y-jt;rt.writeVarint(Tr(Ur)),rt.writeVarint(Tr(tn)),Zt+=Ur,jt+=tn}_t===3&&rt.writeVarint(ae(7,1))}}function vr($t,rt){var at=typeof $t;at==="string"?rt.writeStringField(1,$t):at==="boolean"?rt.writeBooleanField(7,$t):at==="number"&&($t%1!=0?rt.writeDoubleField(3,$t):$t<0?rt.writeSVarintField(6,$t):rt.writeVarintField(5,$t))}Vt.exports=tr,Vt.exports.fromVectorTileJs=tr,Vt.exports.fromGeojsonVt=function($t,rt){rt=rt||{};var at={};for(var _t in $t)at[_t]=new rr($t[_t].features,rt),at[_t].name=_t,at[_t].version=rt.version,at[_t].extent=rt.extent;return tr({layers:at})},Vt.exports.GeoJSONWrapper=rr;var $r=s.dc(Vt.exports);const Vn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$t=>$t},ke=Math.fround||(Qn=new Float32Array(1),$t=>(Qn[0]=+$t,Qn[0]));var Qn;const ti=3,Pn=5,Ui=6;class Qr{constructor(rt){this.options=Object.assign(Object.create(Vn),rt),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(rt){const{log:at,minZoom:_t,maxZoom:Zt}=this.options;at&&console.time("total time");const jt=`prepare ${rt.length} points`;at&&console.time(jt),this.points=rt;const ye=[];for(let Ht=0;Ht<rt.length;Ht++){const ze=rt[Ht];if(!ze.geometry)continue;const[Fe,Ve]=ze.geometry.coordinates,Ur=ke(ul(Fe)),tn=ke(cl(Ve));ye.push(Ur,tn,1/0,Ht,-1,1),this.options.reduce&&ye.push(0)}let Te=this.trees[Zt+1]=this._createTree(ye);at&&console.timeEnd(jt);for(let Ht=Zt;Ht>=_t;Ht--){const ze=+Date.now();Te=this.trees[Ht]=this._createTree(this._cluster(Te,Ht)),at&&console.log("z%d: %d clusters in %dms",Ht,Te.numItems,+Date.now()-ze)}return at&&console.timeEnd("total time"),this}getClusters(rt,at){let _t=((rt[0]+180)%360+360)%360-180;const Zt=Math.max(-90,Math.min(90,rt[1]));let jt=rt[2]===180?180:((rt[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,rt[3]));if(rt[2]-rt[0]>=360)_t=-180,jt=180;else if(_t>jt){const Ve=this.getClusters([_t,Zt,180,ye],at),Ur=this.getClusters([-180,Zt,jt,ye],at);return Ve.concat(Ur)}const Te=this.trees[this._limitZoom(at)],Ht=Te.range(ul(_t),cl(ye),ul(jt),cl(Zt)),ze=Te.data,Fe=[];for(const Ve of Ht){const Ur=this.stride*Ve;Fe.push(ze[Ur+Pn]>1?Ys(ze,Ur,this.clusterProps):this.points[ze[Ur+ti]])}return Fe}getChildren(rt){const at=this._getOriginId(rt),_t=this._getOriginZoom(rt),Zt="No cluster with the specified id.",jt=this.trees[_t];if(!jt)throw new Error(Zt);const ye=jt.data;if(at*this.stride>=ye.length)throw new Error(Zt);const Te=this.options.radius/(this.options.extent*Math.pow(2,_t-1)),Ht=jt.within(ye[at*this.stride],ye[at*this.stride+1],Te),ze=[];for(const Fe of Ht){const Ve=Fe*this.stride;ye[Ve+4]===rt&&ze.push(ye[Ve+Pn]>1?Ys(ye,Ve,this.clusterProps):this.points[ye[Ve+ti]])}if(ze.length===0)throw new Error(Zt);return ze}getLeaves(rt,at,_t){const Zt=[];return this._appendLeaves(Zt,rt,at=at||10,_t=_t||0,0),Zt}getTile(rt,at,_t){const Zt=this.trees[this._limitZoom(rt)],jt=Math.pow(2,rt),{extent:ye,radius:Te}=this.options,Ht=Te/ye,ze=(_t-Ht)/jt,Fe=(_t+1+Ht)/jt,Ve={features:[]};return this._addTileFeatures(Zt.range((at-Ht)/jt,ze,(at+1+Ht)/jt,Fe),Zt.data,at,_t,jt,Ve),at===0&&this._addTileFeatures(Zt.range(1-Ht/jt,ze,1,Fe),Zt.data,jt,_t,jt,Ve),at===jt-1&&this._addTileFeatures(Zt.range(0,ze,Ht/jt,Fe),Zt.data,-1,_t,jt,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(rt){let at=this._getOriginZoom(rt)-1;for(;at<=this.options.maxZoom;){const _t=this.getChildren(rt);if(at++,_t.length!==1)break;rt=_t[0].properties.cluster_id}return at}_appendLeaves(rt,at,_t,Zt,jt){const ye=this.getChildren(at);for(const Te of ye){const Ht=Te.properties;if(Ht&&Ht.cluster?jt+Ht.point_count<=Zt?jt+=Ht.point_count:jt=this._appendLeaves(rt,Ht.cluster_id,_t,Zt,jt):jt<Zt?jt++:rt.push(Te),rt.length===_t)break}return jt}_createTree(rt){const at=new s.aZ(rt.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _t=0;_t<rt.length;_t+=this.stride)at.add(rt[_t],rt[_t+1]);return at.finish(),at.data=rt,at}_addTileFeatures(rt,at,_t,Zt,jt,ye){for(const Te of rt){const Ht=Te*this.stride,ze=at[Ht+Pn]>1;let Fe,Ve,Ur;if(ze)Fe=go(at,Ht,this.clusterProps),Ve=at[Ht],Ur=at[Ht+1];else{const Jr=this.points[at[Ht+ti]];Fe=Jr.properties;const[en,Gr]=Jr.geometry.coordinates;Ve=ul(en),Ur=cl(Gr)}const tn={type:1,geometry:[[Math.round(this.options.extent*(Ve*jt-_t)),Math.round(this.options.extent*(Ur*jt-Zt))]],tags:Fe};let Un;Un=ze||this.options.generateId?at[Ht+ti]:this.points[at[Ht+ti]].id,Un!==void 0&&(tn.id=Un),ye.features.push(tn)}}_limitZoom(rt){return Math.max(this.options.minZoom,Math.min(Math.floor(+rt),this.options.maxZoom+1))}_cluster(rt,at){const{radius:_t,extent:Zt,reduce:jt,minPoints:ye}=this.options,Te=_t/(Zt*Math.pow(2,at)),Ht=rt.data,ze=[],Fe=this.stride;for(let Ve=0;Ve<Ht.length;Ve+=Fe){if(Ht[Ve+2]<=at)continue;Ht[Ve+2]=at;const Ur=Ht[Ve],tn=Ht[Ve+1],Un=rt.within(Ht[Ve],Ht[Ve+1],Te),Jr=Ht[Ve+Pn];let en=Jr;for(const Gr of Un){const ei=Gr*Fe;Ht[ei+2]>at&&(en+=Ht[ei+Pn])}if(en>Jr&&en>=ye){let Gr,ei=Ur*Jr,ui=tn*Jr,Mo=-1;const Gi=((Ve/Fe|0)<<5)+(at+1)+this.points.length;for(const $s of Un){const ci=$s*Fe;if(Ht[ci+2]<=at)continue;Ht[ci+2]=at;const Js=Ht[ci+Pn];ei+=Ht[ci]*Js,ui+=Ht[ci+1]*Js,Ht[ci+4]=Gi,jt&&(Gr||(Gr=this._map(Ht,Ve,!0),Mo=this.clusterProps.length,this.clusterProps.push(Gr)),jt(Gr,this._map(Ht,ci)))}Ht[Ve+4]=Gi,ze.push(ei/en,ui/en,1/0,Gi,-1,en),jt&&ze.push(Mo)}else{for(let Gr=0;Gr<Fe;Gr++)ze.push(Ht[Ve+Gr]);if(en>1)for(const Gr of Un){const ei=Gr*Fe;if(!(Ht[ei+2]<=at)){Ht[ei+2]=at;for(let ui=0;ui<Fe;ui++)ze.push(Ht[ei+ui])}}}}return ze}_getOriginId(rt){return rt-this.points.length>>5}_getOriginZoom(rt){return(rt-this.points.length)%32}_map(rt,at,_t){if(rt[at+Pn]>1){const ye=this.clusterProps[rt[at+Ui]];return _t?Object.assign({},ye):ye}const Zt=this.points[rt[at+ti]].properties,jt=this.options.map(Zt);return _t&&jt===Zt?Object.assign({},jt):jt}}function Ys($t,rt,at){return{type:"Feature",id:$t[rt+ti],properties:go($t,rt,at),geometry:{type:"Point",coordinates:[(_t=$t[rt],360*(_t-.5)),nh($t[rt+1])]}};var _t}function go($t,rt,at){const _t=$t[rt+Pn],Zt=_t>=1e4?`${Math.round(_t/1e3)}k`:_t>=1e3?Math.round(_t/100)/10+"k":_t,jt=$t[rt+Ui],ye=jt===-1?{}:Object.assign({},at[jt]);return Object.assign(ye,{cluster:!0,cluster_id:$t[rt+ti],point_count:_t,point_count_abbreviated:Zt})}function ul($t){return $t/360+.5}function cl($t){const rt=Math.sin($t*Math.PI/180),at=.5-.25*Math.log((1+rt)/(1-rt))/Math.PI;return at<0?0:at>1?1:at}function nh($t){const rt=(180-360*$t)*Math.PI/180;return 360*Math.atan(Math.exp(rt))/Math.PI-90}var eu={exports:{}};eu.exports=function(){function $t(Ot,kt,Yt,Jt){for(var te,se=Jt,le=Yt-kt>>1,re=Yt-kt,ve=Ot[kt],Qt=Ot[kt+1],He=Ot[Yt],Sr=Ot[Yt+1],Ae=kt+3;Ae<Yt;Ae+=3){var Lr=rt(Ot[Ae],Ot[Ae+1],ve,Qt,He,Sr);if(Lr>se)te=Ae,se=Lr;else if(Lr===se){var _n=Math.abs(Ae-le);_n<re&&(te=Ae,re=_n)}}se>Jt&&(te-kt>3&&$t(Ot,kt,te,Jt),Ot[te+2]=se,Yt-te>3&&$t(Ot,te,Yt,Jt))}function rt(Ot,kt,Yt,Jt,te,se){var le=te-Yt,re=se-Jt;if(le!==0||re!==0){var ve=((Ot-Yt)*le+(kt-Jt)*re)/(le*le+re*re);ve>1?(Yt=te,Jt=se):ve>0&&(Yt+=le*ve,Jt+=re*ve)}return(le=Ot-Yt)*le+(re=kt-Jt)*re}function at(Ot,kt,Yt,Jt){var te={id:Ot===void 0?null:Ot,type:kt,geometry:Yt,tags:Jt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(se){var le=se.geometry,re=se.type;if(re==="Point"||re==="MultiPoint"||re==="LineString")_t(se,le);else if(re==="Polygon"||re==="MultiLineString")for(var ve=0;ve<le.length;ve++)_t(se,le[ve]);else if(re==="MultiPolygon")for(ve=0;ve<le.length;ve++)for(var Qt=0;Qt<le[ve].length;Qt++)_t(se,le[ve][Qt])}(te),te}function _t(Ot,kt){for(var Yt=0;Yt<kt.length;Yt+=3)Ot.minX=Math.min(Ot.minX,kt[Yt]),Ot.minY=Math.min(Ot.minY,kt[Yt+1]),Ot.maxX=Math.max(Ot.maxX,kt[Yt]),Ot.maxY=Math.max(Ot.maxY,kt[Yt+1])}function Zt(Ot,kt,Yt,Jt){if(kt.geometry){var te=kt.geometry.coordinates,se=kt.geometry.type,le=Math.pow(Yt.tolerance/((1<<Yt.maxZoom)*Yt.extent),2),re=[],ve=kt.id;if(Yt.promoteId?ve=kt.properties[Yt.promoteId]:Yt.generateId&&(ve=Jt||0),se==="Point")jt(te,re);else if(se==="MultiPoint")for(var Qt=0;Qt<te.length;Qt++)jt(te[Qt],re);else if(se==="LineString")ye(te,re,le,!1);else if(se==="MultiLineString"){if(Yt.lineMetrics){for(Qt=0;Qt<te.length;Qt++)ye(te[Qt],re=[],le,!1),Ot.push(at(ve,"LineString",re,kt.properties));return}Te(te,re,le,!1)}else if(se==="Polygon")Te(te,re,le,!0);else{if(se!=="MultiPolygon"){if(se==="GeometryCollection"){for(Qt=0;Qt<kt.geometry.geometries.length;Qt++)Zt(Ot,{id:ve,geometry:kt.geometry.geometries[Qt],properties:kt.properties},Yt,Jt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Qt=0;Qt<te.length;Qt++){var He=[];Te(te[Qt],He,le,!0),re.push(He)}}Ot.push(at(ve,se,re,kt.properties))}}function jt(Ot,kt){kt.push(Ht(Ot[0])),kt.push(ze(Ot[1])),kt.push(0)}function ye(Ot,kt,Yt,Jt){for(var te,se,le=0,re=0;re<Ot.length;re++){var ve=Ht(Ot[re][0]),Qt=ze(Ot[re][1]);kt.push(ve),kt.push(Qt),kt.push(0),re>0&&(le+=Jt?(te*Qt-ve*se)/2:Math.sqrt(Math.pow(ve-te,2)+Math.pow(Qt-se,2))),te=ve,se=Qt}var He=kt.length-3;kt[2]=1,$t(kt,0,He,Yt),kt[He+2]=1,kt.size=Math.abs(le),kt.start=0,kt.end=kt.size}function Te(Ot,kt,Yt,Jt){for(var te=0;te<Ot.length;te++){var se=[];ye(Ot[te],se,Yt,Jt),kt.push(se)}}function Ht(Ot){return Ot/360+.5}function ze(Ot){var kt=Math.sin(Ot*Math.PI/180),Yt=.5-.25*Math.log((1+kt)/(1-kt))/Math.PI;return Yt<0?0:Yt>1?1:Yt}function Fe(Ot,kt,Yt,Jt,te,se,le,re){if(Jt/=kt,se>=(Yt/=kt)&&le<Jt)return Ot;if(le<Yt||se>=Jt)return null;for(var ve=[],Qt=0;Qt<Ot.length;Qt++){var He=Ot[Qt],Sr=He.geometry,Ae=He.type,Lr=te===0?He.minX:He.minY,_n=te===0?He.maxX:He.maxY;if(Lr>=Yt&&_n<Jt)ve.push(He);else if(!(_n<Yt||Lr>=Jt)){var xn=[];if(Ae==="Point"||Ae==="MultiPoint")Ve(Sr,xn,Yt,Jt,te);else if(Ae==="LineString")Ur(Sr,xn,Yt,Jt,te,!1,re.lineMetrics);else if(Ae==="MultiLineString")Un(Sr,xn,Yt,Jt,te,!1);else if(Ae==="Polygon")Un(Sr,xn,Yt,Jt,te,!0);else if(Ae==="MultiPolygon")for(var Ln=0;Ln<Sr.length;Ln++){var bi=[];Un(Sr[Ln],bi,Yt,Jt,te,!0),bi.length&&xn.push(bi)}if(xn.length){if(re.lineMetrics&&Ae==="LineString"){for(Ln=0;Ln<xn.length;Ln++)ve.push(at(He.id,Ae,xn[Ln],He.tags));continue}Ae!=="LineString"&&Ae!=="MultiLineString"||(xn.length===1?(Ae="LineString",xn=xn[0]):Ae="MultiLineString"),Ae!=="Point"&&Ae!=="MultiPoint"||(Ae=xn.length===3?"Point":"MultiPoint"),ve.push(at(He.id,Ae,xn,He.tags))}}}return ve.length?ve:null}function Ve(Ot,kt,Yt,Jt,te){for(var se=0;se<Ot.length;se+=3){var le=Ot[se+te];le>=Yt&&le<=Jt&&(kt.push(Ot[se]),kt.push(Ot[se+1]),kt.push(Ot[se+2]))}}function Ur(Ot,kt,Yt,Jt,te,se,le){for(var re,ve,Qt=tn(Ot),He=te===0?en:Gr,Sr=Ot.start,Ae=0;Ae<Ot.length-3;Ae+=3){var Lr=Ot[Ae],_n=Ot[Ae+1],xn=Ot[Ae+2],Ln=Ot[Ae+3],bi=Ot[Ae+4],_o=te===0?Lr:_n,Ao=te===0?Ln:bi,yo=!1;le&&(re=Math.sqrt(Math.pow(Lr-Ln,2)+Math.pow(_n-bi,2))),_o<Yt?Ao>Yt&&(ve=He(Qt,Lr,_n,Ln,bi,Yt),le&&(Qt.start=Sr+re*ve)):_o>Jt?Ao<Jt&&(ve=He(Qt,Lr,_n,Ln,bi,Jt),le&&(Qt.start=Sr+re*ve)):Jr(Qt,Lr,_n,xn),Ao<Yt&&_o>=Yt&&(ve=He(Qt,Lr,_n,Ln,bi,Yt),yo=!0),Ao>Jt&&_o<=Jt&&(ve=He(Qt,Lr,_n,Ln,bi,Jt),yo=!0),!se&&yo&&(le&&(Qt.end=Sr+re*ve),kt.push(Qt),Qt=tn(Ot)),le&&(Sr+=re)}var wi=Ot.length-3;Lr=Ot[wi],_n=Ot[wi+1],xn=Ot[wi+2],(_o=te===0?Lr:_n)>=Yt&&_o<=Jt&&Jr(Qt,Lr,_n,xn),wi=Qt.length-3,se&&wi>=3&&(Qt[wi]!==Qt[0]||Qt[wi+1]!==Qt[1])&&Jr(Qt,Qt[0],Qt[1],Qt[2]),Qt.length&&kt.push(Qt)}function tn(Ot){var kt=[];return kt.size=Ot.size,kt.start=Ot.start,kt.end=Ot.end,kt}function Un(Ot,kt,Yt,Jt,te,se){for(var le=0;le<Ot.length;le++)Ur(Ot[le],kt,Yt,Jt,te,se,!1)}function Jr(Ot,kt,Yt,Jt){Ot.push(kt),Ot.push(Yt),Ot.push(Jt)}function en(Ot,kt,Yt,Jt,te,se){var le=(se-kt)/(Jt-kt);return Ot.push(se),Ot.push(Yt+(te-Yt)*le),Ot.push(1),le}function Gr(Ot,kt,Yt,Jt,te,se){var le=(se-Yt)/(te-Yt);return Ot.push(kt+(Jt-kt)*le),Ot.push(se),Ot.push(1),le}function ei(Ot,kt){for(var Yt=[],Jt=0;Jt<Ot.length;Jt++){var te,se=Ot[Jt],le=se.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")te=ui(se.geometry,kt);else if(le==="MultiLineString"||le==="Polygon"){te=[];for(var re=0;re<se.geometry.length;re++)te.push(ui(se.geometry[re],kt))}else if(le==="MultiPolygon")for(te=[],re=0;re<se.geometry.length;re++){for(var ve=[],Qt=0;Qt<se.geometry[re].length;Qt++)ve.push(ui(se.geometry[re][Qt],kt));te.push(ve)}Yt.push(at(se.id,le,te,se.tags))}return Yt}function ui(Ot,kt){var Yt=[];Yt.size=Ot.size,Ot.start!==void 0&&(Yt.start=Ot.start,Yt.end=Ot.end);for(var Jt=0;Jt<Ot.length;Jt+=3)Yt.push(Ot[Jt]+kt,Ot[Jt+1],Ot[Jt+2]);return Yt}function Mo(Ot,kt){if(Ot.transformed)return Ot;var Yt,Jt,te,se=1<<Ot.z,le=Ot.x,re=Ot.y;for(Yt=0;Yt<Ot.features.length;Yt++){var ve=Ot.features[Yt],Qt=ve.geometry,He=ve.type;if(ve.geometry=[],He===1)for(Jt=0;Jt<Qt.length;Jt+=2)ve.geometry.push(Gi(Qt[Jt],Qt[Jt+1],kt,se,le,re));else for(Jt=0;Jt<Qt.length;Jt++){var Sr=[];for(te=0;te<Qt[Jt].length;te+=2)Sr.push(Gi(Qt[Jt][te],Qt[Jt][te+1],kt,se,le,re));ve.geometry.push(Sr)}}return Ot.transformed=!0,Ot}function Gi(Ot,kt,Yt,Jt,te,se){return[Math.round(Yt*(Ot*Jt-te)),Math.round(Yt*(kt*Jt-se))]}function $s(Ot,kt,Yt,Jt,te){for(var se=kt===te.maxZoom?0:te.tolerance/((1<<kt)*te.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Yt,y:Jt,z:kt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},re=0;re<Ot.length;re++){le.numFeatures++,ci(le,Ot[re],se,te);var ve=Ot[re].minX,Qt=Ot[re].minY,He=Ot[re].maxX,Sr=Ot[re].maxY;ve<le.minX&&(le.minX=ve),Qt<le.minY&&(le.minY=Qt),He>le.maxX&&(le.maxX=He),Sr>le.maxY&&(le.maxY=Sr)}return le}function ci(Ot,kt,Yt,Jt){var te=kt.geometry,se=kt.type,le=[];if(se==="Point"||se==="MultiPoint")for(var re=0;re<te.length;re+=3)le.push(te[re]),le.push(te[re+1]),Ot.numPoints++,Ot.numSimplified++;else if(se==="LineString")Js(le,te,Ot,Yt,!1,!1);else if(se==="MultiLineString"||se==="Polygon")for(re=0;re<te.length;re++)Js(le,te[re],Ot,Yt,se==="Polygon",re===0);else if(se==="MultiPolygon")for(var ve=0;ve<te.length;ve++){var Qt=te[ve];for(re=0;re<Qt.length;re++)Js(le,Qt[re],Ot,Yt,!0,re===0)}if(le.length){var He=kt.tags||null;if(se==="LineString"&&Jt.lineMetrics){for(var Sr in He={},kt.tags)He[Sr]=kt.tags[Sr];He.mapbox_clip_start=te.start/te.size,He.mapbox_clip_end=te.end/te.size}var Ae={geometry:le,type:se==="Polygon"||se==="MultiPolygon"?3:se==="LineString"||se==="MultiLineString"?2:1,tags:He};kt.id!==null&&(Ae.id=kt.id),Ot.features.push(Ae)}}function Js(Ot,kt,Yt,Jt,te,se){var le=Jt*Jt;if(Jt>0&&kt.size<(te?le:Jt))Yt.numPoints+=kt.length/3;else{for(var re=[],ve=0;ve<kt.length;ve+=3)(Jt===0||kt[ve+2]>le)&&(Yt.numSimplified++,re.push(kt[ve]),re.push(kt[ve+1])),Yt.numPoints++;te&&function(Qt,He){for(var Sr=0,Ae=0,Lr=Qt.length,_n=Lr-2;Ae<Lr;_n=Ae,Ae+=2)Sr+=(Qt[Ae]-Qt[_n])*(Qt[Ae+1]+Qt[_n+1]);if(Sr>0===He)for(Ae=0,Lr=Qt.length;Ae<Lr/2;Ae+=2){var xn=Qt[Ae],Ln=Qt[Ae+1];Qt[Ae]=Qt[Lr-2-Ae],Qt[Ae+1]=Qt[Lr-1-Ae],Qt[Lr-2-Ae]=xn,Qt[Lr-1-Ae]=Ln}}(re,se),Ot.push(re)}}function Ta(Ot,kt){var Yt=(kt=this.options=function(te,se){for(var le in se)te[le]=se[le];return te}(Object.create(this.options),kt)).debug;if(Yt&&console.time("preprocess data"),kt.maxZoom<0||kt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(kt.promoteId&&kt.generateId)throw new Error("promoteId and generateId cannot be used together.");var Jt=function(te,se){var le=[];if(te.type==="FeatureCollection")for(var re=0;re<te.features.length;re++)Zt(le,te.features[re],se,re);else Zt(le,te.type==="Feature"?te:{geometry:te},se);return le}(Ot,kt);this.tiles={},this.tileCoords=[],Yt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",kt.indexMaxZoom,kt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Jt=function(te,se){var le=se.buffer/se.extent,re=te,ve=Fe(te,1,-1-le,le,0,-1,2,se),Qt=Fe(te,1,1-le,2+le,0,-1,2,se);return(ve||Qt)&&(re=Fe(te,1,-le,1+le,0,-1,2,se)||[],ve&&(re=ei(ve,1).concat(re)),Qt&&(re=re.concat(ei(Qt,-1)))),re}(Jt,kt)).length&&this.splitTile(Jt,0,0,0),Yt&&(Jt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hi(Ot,kt,Yt){return 32*((1<<Ot)*Yt+kt)+Ot}return Ta.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ta.prototype.splitTile=function(Ot,kt,Yt,Jt,te,se,le){for(var re=[Ot,kt,Yt,Jt],ve=this.options,Qt=ve.debug;re.length;){Jt=re.pop(),Yt=re.pop(),kt=re.pop(),Ot=re.pop();var He=1<<kt,Sr=hi(kt,Yt,Jt),Ae=this.tiles[Sr];if(!Ae&&(Qt>1&&console.time("creation"),Ae=this.tiles[Sr]=$s(Ot,kt,Yt,Jt,ve),this.tileCoords.push({z:kt,x:Yt,y:Jt}),Qt)){Qt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",kt,Yt,Jt,Ae.numFeatures,Ae.numPoints,Ae.numSimplified),console.timeEnd("creation"));var Lr="z"+kt;this.stats[Lr]=(this.stats[Lr]||0)+1,this.total++}if(Ae.source=Ot,te){if(kt===ve.maxZoom||kt===te)continue;var _n=1<<te-kt;if(Yt!==Math.floor(se/_n)||Jt!==Math.floor(le/_n))continue}else if(kt===ve.indexMaxZoom||Ae.numPoints<=ve.indexMaxPoints)continue;if(Ae.source=null,Ot.length!==0){Qt>1&&console.time("clipping");var xn,Ln,bi,_o,Ao,yo,wi=.5*ve.buffer/ve.extent,ro=.5-wi,Ks=.5+wi,nu=1+wi;xn=Ln=bi=_o=null,Ao=Fe(Ot,He,Yt-wi,Yt+Ks,0,Ae.minX,Ae.maxX,ve),yo=Fe(Ot,He,Yt+ro,Yt+nu,0,Ae.minX,Ae.maxX,ve),Ot=null,Ao&&(xn=Fe(Ao,He,Jt-wi,Jt+Ks,1,Ae.minY,Ae.maxY,ve),Ln=Fe(Ao,He,Jt+ro,Jt+nu,1,Ae.minY,Ae.maxY,ve),Ao=null),yo&&(bi=Fe(yo,He,Jt-wi,Jt+Ks,1,Ae.minY,Ae.maxY,ve),_o=Fe(yo,He,Jt+ro,Jt+nu,1,Ae.minY,Ae.maxY,ve),yo=null),Qt>1&&console.timeEnd("clipping"),re.push(xn||[],kt+1,2*Yt,2*Jt),re.push(Ln||[],kt+1,2*Yt,2*Jt+1),re.push(bi||[],kt+1,2*Yt+1,2*Jt),re.push(_o||[],kt+1,2*Yt+1,2*Jt+1)}}},Ta.prototype.getTile=function(Ot,kt,Yt){var Jt=this.options,te=Jt.extent,se=Jt.debug;if(Ot<0||Ot>24)return null;var le=1<<Ot,re=hi(Ot,kt=(kt%le+le)%le,Yt);if(this.tiles[re])return Mo(this.tiles[re],te);se>1&&console.log("drilling down to z%d-%d-%d",Ot,kt,Yt);for(var ve,Qt=Ot,He=kt,Sr=Yt;!ve&&Qt>0;)Qt--,He=Math.floor(He/2),Sr=Math.floor(Sr/2),ve=this.tiles[hi(Qt,He,Sr)];return ve&&ve.source?(se>1&&console.log("found parent tile z%d-%d-%d",Qt,He,Sr),se>1&&console.time("drilling down"),this.splitTile(ve.source,Qt,He,Sr,Ot,kt,Yt),se>1&&console.timeEnd("drilling down"),this.tiles[re]?Mo(this.tiles[re],te):null):null},function(Ot,kt){return new Ta(Ot,kt)}}();var ru=s.dc(eu.exports);function Hu($t,rt){const at=$t.tileID.canonical;if(!this._geoJSONIndex)return rt(null,null);const _t=this._geoJSONIndex.getTile(at.z,at.x,at.y);if(!_t)return rt(null,null);const Zt=new class{constructor(ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.J,this.length=ye.length,this._features=ye}feature(ye){return new class{constructor(Te){this._feature=Te,this.extent=s.J,this.type=Te.type,this.properties=Te.tags,"id"in Te&&!isNaN(Te.id)&&(this.id=parseInt(Te.id,10))}loadGeometry(){if(this._feature.type===1){const Te=[];for(const Ht of this._feature.geometry)Te.push([new s.P(Ht[0],Ht[1])]);return Te}{const Te=[];for(const Ht of this._feature.geometry){const ze=[];for(const Fe of Ht)ze.push(new s.P(Fe[0],Fe[1]));Te.push(ze)}return Te}}toGeoJSON(Te,Ht,ze){return Wt.call(this,Te,Ht,ze)}}(this._features[ye])}}(_t.features);let jt=$r(Zt);jt.byteOffset===0&&jt.byteLength===jt.buffer.byteLength||(jt=new Uint8Array(jt)),rt(null,{vectorTile:Zt,rawData:jt.buffer})}class ih extends s.dh{constructor(rt,at,_t,Zt,jt,ye){super(rt,at,_t,Zt,Hu,ye),jt&&(this.loadGeoJSON=jt)}loadData(rt,at){const _t=rt&&rt.request,Zt=_t&&_t.collectResourceTiming;this.loadGeoJSON(rt,(jt,ye)=>{if(jt||!ye)return at(jt);if(typeof ye!="object")return at(new Error(`Input data given to '${rt.source}' is not a valid GeoJSON object.`));{xt(ye,!0);try{if(rt.filter){const Ht=s.cw(rt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ht.result==="error")throw new Error(Ht.value.map(Fe=>`${Fe.key}: ${Fe.message}`).join(", "));ye={type:"FeatureCollection",features:ye.features.filter(Fe=>Ht.value.evaluate({zoom:0},Fe))}}this._geoJSONIndex=rt.cluster?new Qr(function({superclusterOptions:Ht,clusterProperties:ze}){if(!ze||!Ht)return Ht;const Fe={},Ve={},Ur={accumulated:null,zoom:0},tn={properties:null},Un=Object.keys(ze);for(const Jr of Un){const[en,Gr]=ze[Jr],ei=s.cw(Gr),ui=s.cw(typeof en=="string"?[en,["accumulated"],["get",Jr]]:en);Fe[Jr]=ei.value,Ve[Jr]=ui.value}return Ht.map=Jr=>{tn.properties=Jr;const en={};for(const Gr of Un)en[Gr]=Fe[Gr].evaluate(Ur,tn);return en},Ht.reduce=(Jr,en)=>{tn.properties=en;for(const Gr of Un)Ur.accumulated=Jr[Gr],Jr[Gr]=Ve[Gr].evaluate(Ur,tn)},Ht}(rt)).load(ye.features):ru(ye,rt.geojsonVtOptions)}catch(Ht){return at(Ht)}this.loaded={};const Te={};if(Zt){const Ht=s.di(_t);Ht&&(Te.resourceTiming={},Te.resourceTiming[rt.source]=JSON.parse(JSON.stringify(Ht)))}at(null,Te)}})}reloadTile(rt,at){const _t=this.loaded;return _t&&_t[rt.uid]?super.reloadTile(rt,at):this.loadTile(rt,at)}loadGeoJSON(rt,at){if(rt.request)s.a1(rt.request,at);else{if(typeof rt.data!="string")return at(new Error(`Input data given to '${rt.source}' is not a valid GeoJSON object.`));try{return at(null,JSON.parse(rt.data))}catch{return at(new Error(`Input data given to '${rt.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(rt,at){try{at(null,this._geoJSONIndex.getClusterExpansionZoom(rt.clusterId))}catch(_t){at(_t)}}getClusterChildren(rt,at){try{at(null,this._geoJSONIndex.getChildren(rt.clusterId))}catch(_t){at(_t)}}getClusterLeaves(rt,at){try{at(null,this._geoJSONIndex.getLeaves(rt.clusterId,rt.limit,rt.offset))}catch(_t){at(_t)}}}class Ho{constructor(rt,at){this.tileID=new s.O(rt.tileID.overscaledZ,rt.tileID.wrap,rt.tileID.canonical.z,rt.tileID.canonical.x,rt.tileID.canonical.y),this.tileZoom=rt.tileZoom,this.uid=rt.uid,this.zoom=rt.zoom,this.canonical=rt.tileID.canonical,this.pixelRatio=rt.pixelRatio,this.tileSize=rt.tileSize,this.source=rt.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=rt.projection,this.brightness=at}parse(rt,at,_t,Zt){this.status="parsing";const jt=new s.O(_t.tileID.overscaledZ,_t.tileID.wrap,_t.tileID.canonical.z,_t.tileID.canonical.x,_t.tileID.canonical.y),ye={},Te=at.familiesBySource[_t.source],Ht=new s.dk(jt,_t.promoteId);return Ht.bucketLayerIDs=[],s.dl(rt).then(ze=>{if(!ze)return Zt(new Error("Could not parse tile"));const Fe=s.dm(ze,1/s.cg(_t.tileID.canonical)),Ve=ze.json.extensionsUsed&&ze.json.extensionsUsed.includes("MAPBOX_mesh_features"),Ur=new s.al(this.zoom,{brightness:this.brightness});for(const tn in Te)for(const Un of Te[tn]){const Jr=Un[0],en=ze.json.extensionsUsed;Jr.recalculate(Ur,[]);const Gr=new s.dn(Fe,jt,en&&en.includes("MAPBOX_mesh_features"),this.brightness);Ve||(Gr.needsUpload=!0),ye[Jr.fqid]=Gr,Gr.evaluate(Jr)}this.status="done",Zt(null,{buckets:ye,featureIndex:Ht})}).catch(ze=>Zt(new Error(ze.message)))}}class oh{constructor(rt,at,_t,Zt,jt,ye){this.actor=rt,this.layerIndex=at,this.brightness=ye,this.loading={},this.loaded={}}loadTile(rt,at){const _t=rt.uid,Zt=this.loading[_t]=new Ho(rt,this.brightness);s.dj(rt.request,(jt,ye)=>{const Te=!this.loading[_t];return delete this.loading[_t],Te||jt?(Zt.status="done",Te||(this.loaded[_t]=Zt),at(jt)):ye&&ye.byteLength!==0?void Zt.parse(ye,this.layerIndex,rt,(Ht,ze)=>{Zt.status="done",this.loaded=this.loaded||{},this.loaded[_t]=Zt,Ht||!ze?at(Ht):at(null,ze)}):(Zt.status="done",this.loaded[_t]=Zt,at())})}reloadTile(rt,at){const _t=this.loaded,Zt=rt.uid;if(_t&&_t[Zt]){const jt=_t[Zt];jt.projection=rt.projection,jt.brightness=rt.brightness;const ye=(Te,Ht)=>{jt.reloadCallback&&(delete jt.reloadCallback,this.loadTile(rt,at)),at(Te,Ht)};jt.status==="parsing"?jt.reloadCallback=ye:jt.status==="done"&&this.loadTile(rt,at)}}abortTile(rt,at){const _t=rt.uid;this.loading[_t]&&delete this.loading[_t],at()}removeTile(rt,at){const _t=this.loaded,Zt=rt.uid;_t&&_t[Zt]&&delete _t[Zt],at()}}class pn{constructor(rt){this.self=rt,this.actor=new s.dp(rt,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.o({name:"mercator"}),this.workerSourceTypes={vector:s.dh,geojson:ih,"batched-model":oh},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(at,_t)=>{if(this.workerSourceTypes[at])throw new Error(`Worker source with name "${at}" already registered.`);this.workerSourceTypes[at]=_t},this.self.registerRTLTextPlugin=at=>{if(s.dq.isParsed())throw new Error("RTL text plugin already registered.");s.dq.applyArabicShaping=at.applyArabicShaping,s.dq.processBidirectionalText=at.processBidirectionalText,s.dq.processStyledBidirectionalText=at.processStyledBidirectionalText}}clearCaches(rt,at,_t){delete this.layerIndexes[rt],delete this.availableImages[rt],delete this.workerSources[rt],delete this.demWorkerSources[rt],_t()}checkIfReady(rt,at,_t){_t()}setReferrer(rt,at){this.referrer=at}spriteLoaded(rt,{scope:at,isLoaded:_t}){if(this.isSpriteLoaded[rt]||(this.isSpriteLoaded[rt]={}),this.isSpriteLoaded[rt][at]=_t,this.workerSources[rt]&&this.workerSources[rt][at])for(const Zt in this.workerSources[rt][at]){const jt=this.workerSources[rt][at][Zt];for(const ye in jt)jt[ye]instanceof s.dh&&(jt[ye].isSpriteLoaded=_t,jt[ye].fire(new s.a8("isSpriteLoaded")))}}setImages(rt,{scope:at,images:_t},Zt){if(this.availableImages[rt]||(this.availableImages[rt]={}),this.availableImages[rt][at]=_t,this.workerSources[rt]&&this.workerSources[rt][at]){for(const jt in this.workerSources[rt][at]){const ye=this.workerSources[rt][at][jt];for(const Te in ye)ye[Te].availableImages=_t}Zt()}else Zt()}setProjection(rt,at){this.projections[rt]=s.o(at)}setBrightness(rt,at,_t){this.brightness=at,_t()}setLayers(rt,at,_t){this.getLayerIndex(rt,at.scope).replace(at.layers,at.options),_t()}updateLayers(rt,at,_t){this.getLayerIndex(rt,at.scope).update(at.layers,at.removedIds,at.options),_t()}loadTile(rt,at,_t){at.projection=this.projections[rt]||this.defaultProjection,this.getWorkerSource(rt,at.type,at.source,at.scope).loadTile(at,_t)}loadDEMTile(rt,at,_t){this.getDEMWorkerSource(rt,at.source,at.scope).loadTile(at,_t)}reloadTile(rt,at,_t){at.projection=this.projections[rt]||this.defaultProjection,this.getWorkerSource(rt,at.type,at.source,at.scope).reloadTile(at,_t)}abortTile(rt,at,_t){this.getWorkerSource(rt,at.type,at.source,at.scope).abortTile(at,_t)}removeTile(rt,at,_t){this.getWorkerSource(rt,at.type,at.source,at.scope).removeTile(at,_t)}removeSource(rt,at,_t){if(!(this.workerSources[rt]&&this.workerSources[rt][at.scope]&&this.workerSources[rt][at.scope][at.type]&&this.workerSources[rt][at.scope][at.type][at.source]))return;const Zt=this.workerSources[rt][at.scope][at.type][at.source];delete this.workerSources[rt][at.scope][at.type][at.source],Zt.removeSource!==void 0?Zt.removeSource(at,_t):_t()}loadWorkerSource(rt,at,_t){try{this.self.importScripts(at.url),_t()}catch(Zt){_t(Zt.toString())}}syncRTLPluginState(rt,at,_t){try{s.dq.setState(at);const Zt=s.dq.getPluginURL();if(s.dq.isLoaded()&&!s.dq.isParsed()&&Zt!=null){this.self.importScripts(Zt);const jt=s.dq.isParsed();_t(jt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Zt}`),jt)}}catch(Zt){_t(Zt.toString())}}setDracoUrl(rt,at){this.dracoUrl=at}getAvailableImages(rt,at){this.availableImages[rt]||(this.availableImages[rt]={});let _t=this.availableImages[rt][at];return _t||(_t=[]),_t}getLayerIndex(rt,at){this.layerIndexes[rt]||(this.layerIndexes[rt]={});let _t=this.layerIndexes[rt][at];return _t||(_t=this.layerIndexes[rt][at]=new G,_t.scope=at),_t}getWorkerSource(rt,at,_t,Zt){if(this.workerSources[rt]||(this.workerSources[rt]={}),this.workerSources[rt][Zt]||(this.workerSources[rt][Zt]={}),this.workerSources[rt][Zt][at]||(this.workerSources[rt][Zt][at]={}),this.isSpriteLoaded[rt]||(this.isSpriteLoaded[rt]={}),!this.workerSources[rt][Zt][at][_t]){const jt={send:(ye,Te,Ht,ze,Fe,Ve)=>{this.actor.send(ye,Te,Ht,rt,Fe,Ve)},scheduler:this.actor.scheduler};this.workerSources[rt][Zt][at][_t]=new this.workerSourceTypes[at](jt,this.getLayerIndex(rt,Zt),this.getAvailableImages(rt,Zt),this.isSpriteLoaded[rt][Zt],void 0,this.brightness)}return this.workerSources[rt][Zt][at][_t]}getDEMWorkerSource(rt,at,_t){return this.demWorkerSources[rt]||(this.demWorkerSources[rt]={}),this.demWorkerSources[rt][_t]||(this.demWorkerSources[rt][_t]={}),this.demWorkerSources[rt][_t][at]||(this.demWorkerSources[rt][_t][at]=new it),this.demWorkerSources[rt][_t][at]}enforceCacheSizeLimit(rt,at){s.dr(at)}getWorkerPerformanceMetrics(rt,at,_t){_t(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new pn(self)),pn}),b(["./shared"],function(s){function O(d,o){if(Array.isArray(d)){if(!Array.isArray(o)||d.length!==o.length)return!1;for(let l=0;l<d.length;l++)if(!O(d[l],o[l]))return!1;return!0}if(typeof d=="object"&&d!==null&&o!==null){if(typeof o!="object"||Object.keys(d).length!==Object.keys(o).length)return!1;for(const l in d)if(!O(d[l],o[l]))return!1;return!0}return d===o}var V=G;function G(d){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,v,w=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(w);try{v=new Worker(I),_=!0}catch{_=!1}return v&&v.terminate(),URL.revokeObjectURL(I),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var v=_.getContext("2d");if(!v)return!1;var w=v.getImageData(0,0,1,1);return w&&w.width===_.width}()?(it[l=o&&o.failIfMajorPerformanceCaveat]===void 0&&(it[l]=function(_){var v,w=function(I){var C=document.createElement("canvas"),P=Object.create(G.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=I,C.getContext("webgl2",P)}(_);if(!w)return!1;try{v=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!v||w.isContextLost())&&(w.shaderSource(v,"void main() {}"),w.compileShader(v),w.getShaderParameter(v,w.COMPILE_STATUS)===!0)}(l)),it[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var l}(d)}var it={};function ot(d,o,l){const _=document.createElement(d);return o!=null&&(_.className=o),l&&l.appendChild(_),_}function dt(d,o,l){const _=document.createElementNS("http://www.w3.org/2000/svg",d);for(const v of Object.keys(o))_.setAttributeNS(null,v,String(o[v]));return l&&l.appendChild(_),_}G.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const xt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Wt=xt&&xt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Vt;function ie(){xt&&Wt&&(Vt=xt[Wt],xt[Wt]="none")}function he(){xt&&Wt&&(xt[Wt]=Vt)}function ue(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",ue,!0)}function Ne(){window.addEventListener("click",ue,!0),window.setTimeout(()=>{window.removeEventListener("click",ue,!0)},0)}function je(d,o){const l=d.getBoundingClientRect();return tr(d,l,o)}function qe(d,o){const l=d.getBoundingClientRect(),_=[];for(let v=0;v<o.length;v++)_.push(tr(d,l,o[v]));return _}function rr(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function tr(d,o,l){const _=d.offsetWidth===o.width?1:d.offsetWidth/o.width;return new s.P((l.clientX-o.left)*_,(l.clientY-o.top)*_)}class At{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,l){this._updatedSourceCaches[o]=l,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const l=o.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(o.id),this.setDirty()}removeLayer(o){const l=o.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][o.id]=o,this._updatedLayers[l].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const l in this._updatedLayers)o[l]=o[l]||{},o[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)o[l]=o[l]||{},o[l].removedIds=Object.keys(this._removedLayers[l]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(o){this._updatedImages.add(o),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const hn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vr{constructor(o,l,_,v,w,I){this.length=l.length,this.attributes=_,this.itemSize=l.bytesPerElement,this.dynamicDraw=v,this.instanceCount=I,this.context=o;const C=o.gl;this.buffer=C.createBuffer(),o.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||w||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,l){for(let _=0;_<this.attributes.length;_++){const v=l.attributes[this.attributes[_].name];v!==void 0&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,l,_){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],I=l.attributes[w.name];I!==void 0&&o.vertexAttribPointer(I,w.components,o[hn[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(o,l,_){for(let v=0;v<this.attributes.length;v++){const w=l.attributes[this.attributes[v].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(w,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ae{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Tr extends ae{getDefault(){return s.C.transparent}set(o){const l=this.current;(o.r!==l.r||o.g!==l.g||o.b!==l.b||o.a!==l.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Oe extends ae{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class vr extends ae{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class $r extends ae{getDefault(){return[!0,!0,!0,!0]}set(o){const l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||o[3]!==l[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Vn extends ae{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class ke extends ae{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Qn extends ae{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const l=this.current;(o.func!==l.func||o.ref!==l.ref||o.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class ti extends ae{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Pn extends ae{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;o?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ui extends ae{getDefault(){return[0,1]}set(o){const l=this.current;(o[0]!==l[0]||o[1]!==l[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Qr extends ae{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;o?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=o,this.dirty=!1}}class Ys extends ae{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class go extends ae{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;o?l.enable(l.BLEND):l.disable(l.BLEND),this.current=o,this.dirty=!1}}class ul extends ae{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||o[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class cl extends ae{getDefault(){return s.C.transparent}set(o){const l=this.current;(o.r!==l.r||o.g!==l.g||o.b!==l.b||o.a!==l.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class nh extends ae{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class eu extends ae{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;o?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=o,this.dirty=!1}}class ru extends ae{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Hu extends ae{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let ih=class extends ae{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Ho extends ae{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class oh extends ae{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||o[3]!==l[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class pn extends ae{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class $t extends ae{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class rt extends ae{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class at extends ae{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class _t extends ae{getDefault(){return null}set(o){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Zt extends ae{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class jt extends ae{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class ye extends ae{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Te extends ae{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ht extends ae{constructor(o,l){super(o),this.context=o,this.parent=l}getDefault(){return null}}class ze extends Ht{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Fe extends Ht{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ve extends Ht{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Ur extends Fe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class tn{constructor(o,l,_,v,w){this.context=o,this.width=l,this.height=_;const I=this.framebuffer=o.gl.createFramebuffer();v&&(this.colorAttachment=new ze(o,I)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new Fe(o,I):new Ve(o,I))}destroy(){const o=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&o.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&o.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&o.deleteTexture(l)}o.deleteFramebuffer(this.framebuffer)}}class Un{constructor(o,l){this.gl=o,this.clearColor=new Tr(this),this.clearDepth=new Oe(this),this.clearStencil=new vr(this),this.colorMask=new $r(this),this.depthMask=new Vn(this),this.stencilMask=new ke(this),this.stencilFunc=new Qn(this),this.stencilOp=new ti(this),this.stencilTest=new Pn(this),this.depthRange=new Ui(this),this.depthTest=new Qr(this),this.depthFunc=new Ys(this),this.blend=new go(this),this.blendFunc=new ul(this),this.blendColor=new cl(this),this.blendEquation=new nh(this),this.cullFace=new eu(this),this.cullFaceSide=new ru(this),this.frontFace=new Hu(this),this.program=new ih(this),this.activeTexture=new Ho(this),this.viewport=new oh(this),this.bindFramebuffer=new pn(this),this.bindRenderbuffer=new $t(this),this.bindTexture=new rt(this),this.bindVertexBuffer=new at(this),this.bindElementBuffer=new _t(this),this.bindVertexArrayOES=new Zt(this),this.pixelStoreUnpack=new jt(this),this.pixelStoreUnpackPremultiplyAlpha=new ye(this),this.pixelStoreUnpackFlipY=new Te(this),this.options=l?{...l}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,l,_){return new s.I(this,o,l,_)}createVertexBuffer(o,l,_,v,w){return new Vr(this,o,l,_,v,w)}createRenderbuffer(o,l,_){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,o,l,_),this.bindRenderbuffer.set(null),w}createFramebuffer(o,l,_,v){return new tn(this,o,l,_,v)}clear({color:o,depth:l,stencil:_,colorMask:v}){const w=this.gl;let I=0;o&&(I|=w.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set(v||[!0,!0,!0,!0])),l!==void 0&&(I|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),_!==void 0&&(I|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),w.clear(I)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){O(o.blendFunction,s.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Jr{constructor(o=0,l=0,_=0,v=0){if(isNaN(o)||o<0||isNaN(l)||l<0||isNaN(_)||_<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=l,this.left=_,this.right=v}interpolate(o,l,_){return l.top!=null&&o.top!=null&&(this.top=s.n(o.top,l.top,_)),l.bottom!=null&&o.bottom!=null&&(this.bottom=s.n(o.bottom,l.bottom,_)),l.left!=null&&o.left!=null&&(this.left=s.n(o.left,l.left,_)),l.right!=null&&o.right!=null&&(this.right=s.n(o.right,l.right,_)),this}getCenter(o,l){const _=s.c((this.left+o-this.right)/2,0,o),v=s.c((this.top+l-this.bottom)/2,0,l);return new s.P(_,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Jr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function en(d,o){const l=s.g(d,3);s.m.fromQuat(d,o),s.s(d,3,l)}function Gr(d,o){const l=s.q.identity([]);return s.q.rotateZ(l,l,-o),s.q.rotateX(l,l,-d),l}function ei(d,o){const l=[d[0],d[1],0],_=[o[0],o[1],0];if(s.v.length(l)>=1e-15){const I=s.v.normalize([],l);s.v.scale(_,I,s.v.dot(_,I)),o[0]=_[0],o[1]=_[1]}const v=s.v.cross([],o,d);if(s.v.len(v)<1e-15)return null;const w=Math.atan2(-v[1],v[0]);return Gr(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),w)}class ui{constructor(o,l){this.position=o,this.orientation=l}get position(){return this._position}set position(o){if(o){const l=o instanceof s.M?o:new s.M(o[0],o[1],o[2]);this._renderWorldCopies&&(l.x=s.w(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(o,l){if(this.orientation=null,!this.position)return;const _=this.position,v=this._elevation?this._elevation.getAtPointOrZero(s.M.fromLngLat(o)):0,w=s.M.fromLngLat(o,v),I=[w.x-_.x,w.y-_.y,w.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=ei(I,l)}setPitchBearing(o,l){this.orientation=Gr(s.d(o),s.d(-l))}}class Mo{constructor(o,l){this._transform=s.m.identity([]),this.orientation=l,this.position=o}get mercatorPosition(){const o=this.position;return new s.M(o[0],o[1],o[2])}get position(){const o=s.g(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var l;o&&s.s(this._transform,3,[(l=o)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||s.q.identity([]),o&&en(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,l){this._orientation=Gr(o,l),en(this._transform,this._orientation)}forward(){const o=s.g(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=s.g(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=s.g(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,l){const _=new Float64Array(16);return s.m.invert(_,this.getWorldToCamera(o,l)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,l,_){const v=this.position;s.v.scale(v,v,-o);const w=new Float64Array(16);return s.m.fromScaling(w,[_,_,_]),s.m.translate(w,w,v),w[10]*=l,w}getWorldToCamera(o,l){const _=new Float64Array(16),v=new Float64Array(4),w=this.position;return s.q.conjugate(v,this._orientation),s.v.scale(w,w,-o),s.m.fromQuat(_,v),s.m.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=l,_[9]*=l,_[10]*=l,_[11]*=l,_}getCameraToClipPerspective(o,l,_,v){const w=new Float64Array(16);return s.m.perspective(w,o,l,_,v),w}getCameraToClipOrthographic(o,l,_,v,w,I){const C=new Float64Array(16);return s.m.ortho(C,o,l,_,v,w,I),C}getDistanceToElevation(o,l=!1){const _=o===0?0:s.b(o,l?s.l(this.position[1]):this.position[1]),v=this.forward();return(_-this.position[2])/v[2]}clone(){return new Mo([...this.position],[...this.orientation])}}const Gi={unknown:0,flipRequired:1,flipNotRequired:2},$s=Math.tan(85*Math.PI/180);function ci(d,o,l,_,v,w,I){const C=s.m.create();if(l)if(w.name==="globe"){const P=s.f(v,o);s.m.multiply(C,C,P)}else{const P=s.h.invert([],I);C[0]=P[0],C[1]=P[1],C[4]=P[2],C[5]=P[3],_||s.m.rotateZ(C,C,v.angle)}else s.m.multiply(C,v.labelPlaneMatrix,d);return C}function Js(d,o,l,_,v,w,I){const C=ci(d,o,l,_,v,w,I);return w.name==="globe"&&l||(C[2]=C[6]=C[10]=C[14]=0),C}function Ta(d,o,l,_,v,w,I){if(l){if(w.name==="globe"){const C=ci(d,o,l,_,v,w,I);return s.m.invert(C,C),s.m.multiply(C,d,C),C}{const C=s.m.clone(d),P=s.m.identity([]);return P[0]=I[0],P[1]=I[1],P[4]=I[2],P[5]=I[3],s.m.multiply(C,C,P),_||s.m.rotateZ(C,C,-v.angle),C}}return v.glCoordMatrix}function hi(d,o,l,_){const v=[d,o,l,1];l?s.e.transformMat4(v,v,_):He(v,v,_);const w=v[3];return v[0]/=w,v[1]/=w,v[2]/=w,v}function Ot(d,o){return Math.min(.5+d/o*.5,1.5)}function kt(d,o){const l=d[0]/d[3],_=d[1]/d[3];return l>=-o[0]&&l<=o[0]&&_>=-o[1]&&_<=o[1]}function Yt(d,o,l,_,v,w,I,C,P,D){const z=l.transform,k=_?d.textSizeData:d.iconSizeData,B=s.i(k,l.transform.zoom),U=z.projection.name==="globe",q=[256/l.width*2+1,256/l.height*2+1],X=_?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;X.clear();let Z=null;U&&(Z=_?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const j=d.lineVertexArray,J=_?d.text.placedSymbolArray:d.icon.placedSymbolArray,nt=l.transform.width/l.transform.height;let st,Y=!1;for(let K=0;K<J.length;K++){const lt=J.get(K),{numGlyphs:ht,writingMode:ut}=lt;if(ut!==s.W.vertical||Y||st===s.W.horizontal||(Y=!0),st=ut,(lt.hidden||ut===s.W.vertical)&&!Y){Qt(ht,X);continue}Y=!1;const pt=new s.P(lt.tileAnchorX,lt.tileAnchorY);let{x:Dt,y:wt,z:St}=z.projection.projectTilePoint(pt.x,pt.y,D.canonical);if(P){const[ce,Se,fe]=P(pt);Dt+=ce,wt+=Se,St+=fe}const mt=[Dt,wt,St,1];if(s.e.transformMat4(mt,mt,o),!kt(mt,q)){Qt(ht,X);continue}const Lt=mt[3],Tt=Ot(l.transform.getCameraToCenterDistance(z.projection),Lt),zt=s.j(k,B,lt),tt=I?zt/Tt:zt*Tt,yt=hi(Dt,wt,St,v);if(yt[3]<=0){Qt(ht,X);continue}let Gt={};const Ft=I?null:P,ge=se(lt,tt,!1,C,o,v,w,d.glyphOffsetArray,j,X,Z,yt,pt,Gt,nt,Ft,z.projection,D,I);Y=ge.useVertical,Ft&&ge.needsFlipping&&(Gt={}),(ge.notEnoughRoom||Y||ge.needsFlipping&&se(lt,tt,!0,C,o,v,w,d.glyphOffsetArray,j,X,Z,yt,pt,Gt,nt,Ft,z.projection,D,I).notEnoughRoom)&&Qt(ht,X)}_?(d.text.dynamicLayoutVertexBuffer.updateData(X),Z&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(Z)):(d.icon.dynamicLayoutVertexBuffer.updateData(X),Z&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(Z))}function Jt(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q,X){const{lineStartIndex:Z,glyphStartIndex:j,segment:J}=C,nt=j+C.numGlyphs,st=Z+C.lineLength,Y=o.getoffsetX(j),K=o.getoffsetX(nt-1),lt=ve(d*Y,l,_,v,w,I,J,Z,st,P,D,z,k,B,!0,U,q,X);if(!lt)return null;const ht=ve(d*K,l,_,v,w,I,J,Z,st,P,D,z,k,B,!0,U,q,X);return ht?{first:lt,last:ht}:null}function te(d,o,l,_){return d===s.W.horizontal&&Math.abs(_)>Math.abs(l)?{useVertical:!0}:d===s.W.vertical?_>0?{needsFlipping:!0}:null:o!==Gi.unknown&&function(v,w){return v===0||Math.abs(w/v)>$s}(l,_)?o===Gi.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function se(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q,X,Z,j,J){const nt=o/24,st=d.lineOffsetX*nt,Y=d.lineOffsetY*nt,{lineStartIndex:K,glyphStartIndex:lt,numGlyphs:ht,segment:ut,writingMode:pt,flipState:Dt}=d,wt=K+d.lineLength,St=mt=>{if(z){const[tt,yt,Gt]=mt.up,Ft=D.length;s.u(z,Ft+0,tt,yt,Gt),s.u(z,Ft+1,tt,yt,Gt),s.u(z,Ft+2,tt,yt,Gt),s.u(z,Ft+3,tt,yt,Gt)}const[Lt,Tt,zt]=mt.point;s.k(D,Lt,Tt,zt,mt.angle)};if(ht>1){const mt=Jt(nt,C,st,Y,l,k,B,d,P,w,U,X,!1,Z,j,J);if(!mt)return{notEnoughRoom:!0};if(_&&!l){let[Lt,Tt,zt]=mt.first.point,[tt,yt,Gt]=mt.last.point;[Lt,Tt]=hi(Lt,Tt,zt,I),[tt,yt]=hi(tt,yt,Gt,I);const Ft=te(pt,Dt,(tt-Lt)*q,yt-Tt);if(d.flipState=Ft&&Ft.needsFlipping?Gi.flipRequired:Gi.flipNotRequired,Ft)return Ft}St(mt.first);for(let Lt=lt+1;Lt<lt+ht-1;Lt++){const Tt=ve(nt*C.getoffsetX(Lt),st,Y,l,k,B,ut,K,wt,P,w,U,X,!1,!1,Z,j,J);if(!Tt)return D.length-=4*(Lt-lt),{notEnoughRoom:!0};St(Tt)}St(mt.last)}else{if(_&&!l){const Lt=hi(B.x,B.y,0,v),Tt=K+ut+1,zt=new s.P(P.getx(Tt),P.gety(Tt)),tt=hi(zt.x,zt.y,0,v),yt=tt[3]>0?tt:re(B,zt,Lt,1,v,void 0,Z,j.canonical),Gt=te(pt,Dt,(yt[0]-Lt[0])*q,yt[1]-Lt[1]);if(d.flipState=Gt&&Gt.needsFlipping?Gi.flipRequired:Gi.flipNotRequired,Gt)return Gt}const mt=ve(nt*C.getoffsetX(lt),st,Y,l,k,B,ut,K,wt,P,w,U,X,!1,!1,Z,j,J);if(!mt)return{notEnoughRoom:!0};St(mt)}return{}}function le(d,o,l,_,v){const{x:w,y:I,z:C}=_.projectTilePoint(d.x,d.y,o);if(!v)return hi(w,I,C,l);const[P,D,z]=v(d);return hi(w+P,I+D,C+z,l)}function re(d,o,l,_,v,w,I,C){const P=le(d.sub(o)._unit()._add(d),C,v,I,w);return s.v.sub(P,l,P),s.v.normalize(P,P),s.v.scaleAndAdd(P,l,P,_)}function ve(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q,X,Z,j){const J=_?d-o:d+o;let nt=J>0?1:-1,st=0;_&&(nt*=-1,st=Math.PI),nt<0&&(st+=Math.PI);let Y=C+I+(nt>0?0:1)|0,K=v,lt=v,ht=0,ut=0;const pt=Math.abs(J),Dt=[],wt=[];let St=w,mt=St;const Lt=()=>re(mt,St,lt,pt-ht+1,z,B,X,Z.canonical);for(;ht+ut<=pt;){if(Y+=nt,Y<C||Y>=P)return null;if(lt=K,mt=St,Dt.push(lt),U&&wt.push(mt),St=new s.P(D.getx(Y),D.gety(Y)),K=k[Y],!K){const Se=le(St,Z.canonical,z,X,B);K=Se[3]>0?k[Y]=Se:Lt()}ht+=ut,ut=s.v.distance(lt,K)}q&&B&&(k[Y]&&(K=Lt(),ut=s.v.distance(lt,K)),k[Y]=K);const Tt=(pt-ht)/ut,zt=St.sub(mt)._mult(Tt)._add(mt),tt=s.v.sub([],K,lt),yt=s.v.scaleAndAdd([],lt,tt,Tt);let Gt=[0,0,1],Ft=tt[0],ge=tt[1];if(j&&(Gt=X.upVector(Z.canonical,zt.x,zt.y),Gt[0]!==0||Gt[1]!==0||Gt[2]!==1)){const Se=[Gt[2],0,-Gt[0]],fe=s.v.cross([],Gt,Se);s.v.normalize(Se,Se),s.v.normalize(fe,fe),Ft=s.v.dot(tt,Se),ge=s.v.dot(tt,fe)}if(l){const Se=s.v.cross([],Gt,tt);s.v.normalize(Se,Se),s.v.scaleAndAdd(yt,yt,Se,l*nt)}const ce=st+Math.atan2(ge,Ft);return Dt.push(yt),U&&wt.push(zt),{point:yt,angle:ce,path:Dt,tilePath:wt,up:Gt}}function Qt(d,o){const l=o.length,_=l+4*d;o.resize(_),o.float32.fill(-1/0,4*l,4*_)}function He(d,o,l){const _=o[0],v=o[1];return d[0]=l[0]*_+l[4]*v+l[12],d[1]=l[1]*_+l[5]*v+l[13],d[3]=l[3]*_+l[7]*v+l[15],d}const Sr=(d,o,l)=>(1-l)*d+l*o,Ae=d=>d*d*d*d*d;class Lr{constructor(o,l,_,v,w,I,C){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=o||0,this._maxZoom=l||22,this._minPitch=_??0,this._maxPitch=v??60,this.setProjection(I),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new s.L(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Jr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Mo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const o=new Lr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,l=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(o||_)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return s.p(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=s.o(this.projectionOptions);const _=!O(l,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.o({name:"mercator"});const l=o!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.b(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.w(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const l=-o*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=s.h.create(),s.h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const l=s.c(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=s.d(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const l=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let v=0,w=0;for(let I=0;I<l.length;I++){const C=new s.P(l[I][0]*this.width,_+l[I][1]*(this.height-_)),P=o.pointCoordinate(C);if(!P)continue;const D=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);v+=P[3]*D,w+=D}return w===0?NaN:v/w}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*l,v=this._mercatorZfromZoom(o),w=this._mercatorZfromZoom(this._maxZoom),I=Math.max(v-_,w);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let _;_=o.z<this._camera.position[2]?[l.x,l.y,l.z]:[o.x,o.y,o.z];const v=s.v.length(s.v.sub([],this._camera.position,_));return s.c(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let l=!1;if(o.orientation&&!s.q.exactEquals(o.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(o.orientation)),o.position){const _=[o.position.x,o.position.y,o.position.z];s.v.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,l=new ui;return l.position=new s.M(o[0],o[1],o[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(o){if(!s.q.length(o))return!1;s.q.normalize(o,o);const l=s.v.transformQuat([],[0,0,-1],o),_=s.v.transformQuat([],[0,-1,0],o);if(_[2]<0)return!1;const v=ei(l,_);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(o){const l=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;o[2]=s.c(o[2],v/_,v/l),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,l,_){this._unmodified=!1,this._edgeInsets.interpolate(o,l,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const l=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(o){const l=[new s.U(0,o)];if(this.renderWorldCopies){const _=this.pointCoordinate(new s.P(0,0)),v=this.pointCoordinate(new s.P(this.width,0)),w=this.pointCoordinate(new s.P(this.width,this.height)),I=this.pointCoordinate(new s.P(0,this.height)),C=Math.floor(Math.min(_.x,v.x,w.x,I.x)),P=Math.floor(Math.max(_.x,v.x,w.x,I.x)),D=1;for(let z=C-D;z<=P+D;z++)z!==0&&l.push(new s.U(z,o))}return l}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(o,l,_){let v=[];if(l[0]===0&&l[1]===0)return v;for(const I of o){const C=I.canonical,P=I.overscaledZ,D=I.wrap,z=1<<C.z,k=C.x+1<z,B=C.x>0,U=C.y+1<z,q=C.y>0,X=I.wrap-(B?0:1),Z=I.wrap+(k?0:1),j=B?C.x-1:z-1,J=k?C.x+1:0;l[0]<0?(v.push(new s.O(P,Z,C.z,J,C.y)),l[1]<0&&U&&(v.push(new s.O(P,D,C.z,C.x,C.y+1)),v.push(new s.O(P,Z,C.z,J,C.y+1))),l[1]>0&&q&&(v.push(new s.O(P,D,C.z,C.x,C.y-1)),v.push(new s.O(P,Z,C.z,J,C.y-1)))):l[0]>0?(v.push(new s.O(P,X,C.z,j,C.y)),l[1]<0&&U&&(v.push(new s.O(P,D,C.z,C.x,C.y+1)),v.push(new s.O(P,X,C.z,j,C.y+1))),l[1]>0&&q&&(v.push(new s.O(P,D,C.z,C.x,C.y-1)),v.push(new s.O(P,X,C.z,j,C.y-1)))):l[1]<0&&U?v.push(new s.O(P,D,C.z,C.x,C.y+1)):q&&v.push(new s.O(P,D,C.z,C.x,C.y-1))}if(v.length>1){v.sort((P,D)=>P.overscaledZ-D.overscaledZ||P.wrap-D.wrap||P.canonical.z-D.canonical.z||P.canonical.x-D.canonical.x||P.canonical.y-D.canonical.y);let I=0,C=0;for(;C<v.length;)v[C].equals(v[I])?++C:v[++I]=v[C++];v.length=I+1}const w=[];for(const I of v)v.some(C=>I.isChildOf(C))||w.push(I);return v=w.filter(I=>!o.some(C=>!!(I.overscaledZ<_&&C.isChildOf(I))||I.equals(C)||I.isChildOf(C))),v}coveringTiles(o){let l=this.coveringZoomLevel(o);const _=l,v=this.elevation&&this.elevation.exaggeration(),w=v&&!o.isTerrainDEM,I=this.projection.name==="mercator";if(o.minzoom!==void 0&&l<o.minzoom)return[];o.maxzoom!==void 0&&l>o.maxzoom&&(l=o.maxzoom);const C=this.locationCoordinate(this.center),P=this.center.lat,D=1<<l,z=[D*C.x,D*C.y,0],k=this.projection.name==="globe",B=!k,U=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,B),q=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=D*s.b(1,this.center.lat),Z=this._camera.position[2]/s.b(1,this.center.lat),j=[D*q.x,D*q.y,Z*(B?1:X)],J=k||v,nt=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),st=this.isLODDisabled(!0)?l:0;let Y;if(this._elevation&&o.isTerrainDEM)Y=1e4*this._elevation.exaggeration();else if(this._elevation){const tt=this._elevation.getMinMaxForVisibleTiles();Y=tt?tt.max:this._centerAltitude}else Y=this._centerAltitude;const K=o.isTerrainDEM?-Y:this._elevation?this._elevation.getMinElevationBelowMSL():0,lt=this.projection.isReprojectedInTileSpace?s.r(this):1,ht=tt=>{const Gt=new s.M(tt.x+25e-6,tt.y,tt.z),Ft=new s.M(tt.x,tt.y+25e-6,tt.z),ge=tt.toLngLat(),ce=Gt.toLngLat(),Se=Ft.toLngLat(),fe=this.locationCoordinate(ge),Pe=this.locationCoordinate(ce),Le=this.locationCoordinate(Se),we=Math.hypot(Pe.x-fe.x,Pe.y-fe.y),Ee=Math.hypot(Le.x-fe.x,Le.y-fe.y);return Math.sqrt(we*Ee)*lt/25e-6},ut=tt=>{const yt=Y,Gt=K;return{aabb:s.y(this,D,0,0,0,tt,Gt,yt,this.projection),zoom:0,x:0,y:0,minZ:Gt,maxZ:yt,wrap:tt,fullyVisible:!1}},pt=[];let Dt=[];const wt=l,St=o.reparseOverscaled?_:l,mt=tt=>tt*tt,Lt=mt((Z-this._centerAltitude)*X),Tt=tt=>{if(!this._elevation||!tt.tileID||!I)return;const yt=this._elevation.getMinMaxForTile(tt.tileID),Gt=tt.aabb;yt?(Gt.min[2]=yt.min,Gt.max[2]=yt.max,Gt.center[2]=(Gt.min[2]+Gt.max[2])/2):(tt.shouldSplit=zt(tt),tt.shouldSplit||(Gt.min[2]=Gt.max[2]=Gt.center[2]=this._centerAltitude))},zt=tt=>{if(tt.zoom<st)return!0;if(tt.zoom===wt)return!1;if(tt.shouldSplit!=null)return tt.shouldSplit;const yt=tt.aabb.distanceX(j),Gt=tt.aabb.distanceY(j);let Ft=Lt,ge=1;if(k){Ft=mt(tt.aabb.distanceZ(j));const fe=Math.pow(2,tt.zoom),Pe=s.l((tt.y+1)/fe),Le=s.l(tt.y/fe),we=Math.min(Math.max(P,Pe),Le),Ee=s.a0(we)/s.a0(P);if(ge=we===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ee/this._mercatorScaleRatio),this.zoom<=s.Z&&tt.zoom===wt-1&&Ee>=.9)return!0}else if(w&&(Ft=mt(tt.aabb.distanceZ(j)*X)),this.projection.isReprojectedInTileSpace&&_<=5){const fe=Math.pow(2,tt.zoom),Pe=ht(new s.M((tt.x+.5)/fe,(tt.y+.5)/fe));ge=Pe>.85?1:Pe}const ce=yt*yt+Gt*Gt+Ft,Se=mt((1<<wt-tt.zoom)*nt*ge*((fe,Pe)=>{if(Pe*mt(.707)<fe)return 1;const Le=Math.sqrt(Pe/fe);return Le/(1.4144271570014144+(Math.pow(1.1,Le-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ft,Lt),ce));return ce<Se};if(this.renderWorldCopies)for(let tt=1;tt<=3;tt++)pt.push(ut(-tt)),pt.push(ut(tt));for(pt.push(ut(0));pt.length>0;){const tt=pt.pop(),yt=tt.x,Gt=tt.y;let Ft=tt.fullyVisible;const ge=()=>this.projection.name==="globe"&&(tt.y===0||tt.y===(1<<tt.zoom)-1);if(!Ft){let ce=J?tt.aabb.intersects(U):tt.aabb.intersectsFlat(U);if(ce===0&&ge()){const Se=new s.t(tt.zoom,yt,Gt);ce=s.x(this,D,Se,!0).intersects(U)}if(ce===0)continue;Ft=ce===2}if(tt.zoom!==wt&&zt(tt))for(let ce=0;ce<4;ce++){const Se=(yt<<1)+ce%2,fe=(Gt<<1)+(ce>>1),Pe={aabb:I?tt.aabb.quadrant(ce):s.y(this,D,tt.zoom+1,Se,fe,tt.wrap,tt.minZ,tt.maxZ,this.projection),zoom:tt.zoom+1,x:Se,y:fe,wrap:tt.wrap,fullyVisible:Ft,tileID:void 0,shouldSplit:void 0,minZ:tt.minZ,maxZ:tt.maxZ};w&&!k&&(Pe.tileID=new s.O(tt.zoom+1===wt?St:tt.zoom+1,tt.wrap,tt.zoom+1,Se,fe),Tt(Pe)),pt.push(Pe)}else{const ce=tt.zoom===wt?St:tt.zoom;if(o.minzoom&&o.minzoom>ce)continue;if(!Ft){let Le=J?tt.aabb.intersectsPrecise(U):tt.aabb.intersectsPreciseFlat(U);if(Le===0&&ge()){const we=new s.t(tt.zoom,yt,Gt);Le=s.x(this,D,we,!0).intersectsPrecise(U)}if(Le===0)continue}const Se=z[0]-(.5+yt+(tt.wrap<<tt.zoom))*(1<<l-tt.zoom),fe=z[1]-.5-Gt,Pe=tt.tileID?tt.tileID:new s.O(ce,tt.wrap,tt.zoom,yt,Gt);Dt.push({tileID:Pe,distanceSq:Se*Se+fe*fe})}}if(this.fogCullDistSq){const tt=this.fogCullDistSq,yt=this.horizonLineFromTop();Dt=Dt.filter(Gt=>{const Ft=[0,0,0,1],ge=[s.J,s.J,0,1],ce=this.calculateFogTileMatrix(Gt.tileID.toUnwrapped());s.e.transformMat4(Ft,Ft,ce),s.e.transformMat4(ge,ge,ce);const Se=s.e.min([],Ft,ge),fe=s.e.max([],Ft,ge),Pe=s.z(Se,fe);if(Pe===0)return!0;let Le=!1;const we=this._elevation;if(we&&Pe>tt&&yt!==0){const Ee=this.calculateProjMatrix(Gt.tileID.toUnwrapped());let dr;o.isTerrainDEM||(dr=we.getMinMaxForTile(Gt.tileID)),dr||(dr={min:K,max:Y});const Xe=s._(this.rotation),Zr=[Xe[0]*s.J,Xe[1]*s.J,dr.max];s.v.transformMat4(Zr,Zr,Ee),Le=(1-Zr[1])*this.height*.5<yt}return Pe<tt||Le})}return Dt.sort((tt,yt)=>tt.distanceSq-yt.distanceSq).map(tt=>tt.tileID)}resize(o,l){this.width=o,this.height=l,this.pixelsToGLUnits=[2/o,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const l=s.c(o.lat,-s.A,s.A),_=this.projection.project(o.lng,l);return new s.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.b(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,l){let _,v;const w=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;_=(l.x-w.x)/C,v=(l.y-w.y)/C}else{const C=this.pointCoordinate(l),P=this.pointCoordinate(w);_=C.x-P.x,v=C.y-P.y}const I=this.locationCoordinate(o);this.setLocation(new s.M(I.x-_,I.y-v))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,l){const _=l?s.b(l,o.lat):void 0,v=this.projection.project(o.lng,o.lat);return new s.M(v.x,v.y,_)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,l){const _=l??this._centerAltitude,v=[o.x,o.y,0,1],w=[o.x,o.y,1,1];s.e.transformMat4(v,v,this.pixelMatrixInverse),s.e.transformMat4(w,w,this.pixelMatrixInverse);const I=w[3];s.e.scale(v,v,1/v[3]),s.e.scale(w,w,1/I);const C=v[2],P=w[2];return{p0:v,p1:w,t:C===P?0:(_-C)/(P-C)}}screenPointToMercatorRay(o){const l=[o.x,o.y,0,1],_=[o.x,o.y,1,1];return s.e.transformMat4(l,l,this.pixelMatrixInverse),s.e.transformMat4(_,_,this.pixelMatrixInverse),s.e.scale(l,l,1/l[3]),s.e.scale(_,_,1/_[3]),l[2]=s.b(l[2],this._center.lat)*this.worldSize,_[2]=s.b(_[2],this._center.lat)*this.worldSize,s.e.scale(l,l,1/this.worldSize),s.e.scale(_,_,1/this.worldSize),new s.R([l[0],l[1],l[2]],s.v.normalize([],s.v.sub([],_,l)))}rayIntersectionCoordinate(o){const{p0:l,p1:_,t:v}=o,w=s.b(l[2],this._center.lat),I=s.b(_[2],this._center.lat);return new s.M(s.n(l[0],_[0],v)/this.worldSize,s.n(l[1],_[1],v)/this.worldSize,s.n(w,I,v))}pointCoordinate(o,l=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,l)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let l=this.projection.pointCoordinate3D(this,o.x,o.y);if(l)return new s.M(l[0],l[1],l[2]);let _=0,v=this.horizonLineFromTop();if(o.y>v)return this.pointCoordinate(o);const w=.02*v,I=o.clone();for(let C=0;C<10&&v-_>w;C++){I.y=s.n(_,v,.66);const P=this.projection.pointCoordinate3D(this,I.x,I.y);P?(v=I.y,l=P):_=I.y}return l?new s.M(l[0],l[1],l[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=s.G)return!this.isPointAboveHorizon(o);const l=this.pointCoordinate(o);return l.y>=0&&l.y<=1}_coordinatePoint(o,l){const _=l&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,v=[o.x*this.worldSize,o.y*this.worldSize,_+o.toAltitude(),1];return s.e.transformMat4(v,v,this.pixelMatrix),v[3]>0?new s.P(v[0]/v[3],v[1]/v[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:l}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=this.pointLocation3D(new s.P(l,o)),I=this.pointLocation3D(new s.P(v,o)),C=this.pointLocation3D(new s.P(v,_)),P=this.pointLocation3D(new s.P(l,_));let D=Math.min(w.lng,I.lng,C.lng,P.lng),z=Math.max(w.lng,I.lng,C.lng,P.lng),k=Math.min(w.lat,I.lat,C.lat,P.lat),B=Math.max(w.lat,I.lat,C.lat,P.lat);const U=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,X=(Z,j,J,nt,st)=>{const Y=(Z+J)/2,K=(j+nt)/2,lt=new s.P(Y,K),{lng:ht,lat:ut}=this.pointLocation3D(lt),pt=Math.max(0,D-ht,k-ut,ht-z,ut-B);D=Math.min(D,ht),z=Math.max(z,ht),k=Math.min(k,ut),B=Math.max(B,ut),(st<q||pt>U)&&(X(Z,j,Y,K,st+1),X(Y,K,J,nt,st+1))};if(X(l,o,v,o,1),X(v,o,v,_,1),X(v,_,l,_,1),X(l,_,l,o,1),this.projection.name==="globe"){const[Z,j]=s.B(this);Z?(B=90,z=180,D=-180):j&&(k=-90,z=180,D=-180)}return new s.D(new s.L(D,k),new s.L(z,B))}_getBoundsRectangular(o,l){const{top:_,left:v}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,C=new s.P(v,_),P=new s.P(I,_),D=new s.P(I,w),z=new s.P(v,w);let k=this.pointCoordinate(C,o),B=this.pointCoordinate(P,o);const U=this.pointCoordinate(D,l),q=this.pointCoordinate(z,l),X=(Z,j)=>(j.y-Z.y)/(j.x-Z.x);return k.y>1&&B.y>=0?k=new s.M((1-q.y)/X(q,k)+q.x,1):k.y<0&&B.y<=1&&(k=new s.M(-q.y/X(q,k)+q.x,0)),B.y>1&&k.y>=0?B=new s.M((1-U.y)/X(U,B)+U.x,1):B.y<0&&k.y<=1&&(B=new s.M(-U.y/X(U,B)+U.x,0)),new s.D().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=o.visibleDemTiles.reduce((_,v)=>{if(v.dem){const w=v.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*o.exaggeration(),l.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-l*(1-this._horizonShift);return o?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-s.A,this.maxLat=s.A,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.E(this.minLng)*this.tileSize,this.worldMaxX=s.E(this.maxLng)*this.tileSize,this.worldMinY=s.H(this.maxLat)*this.tileSize,this.worldMaxY=s.H(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,l){return this.projection.createTileMatrix(this,l,o)}calculateDistanceTileData(o){const l=o.key,_=this._distanceTileDataCache;if(_[l])return _[l];const v=o.canonical,w=1/this.height,I=this.cameraWorldSize,C=I/this.zoomScale(v.z),P=(v.x+Math.pow(2,v.z)*o.wrap)*C,D=v.y*C,z=this.point;z.x*=I/this.worldSize,z.y*=I/this.worldSize;const k=this.angle,B=Math.sin(-k),U=-Math.cos(-k);return _[l]={bearing:[B,U],center:[(z.x-P)*w,(z.y-D)*w],scale:C/s.J*w},_[l]}calculateFogTileMatrix(o){const l=o.key,_=this._fogTileMatrixCache;if(_[l])return _[l];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return s.m.multiply(v,this.worldToFogMatrix,v),_[l]=new Float32Array(v),_[l]}calculateProjMatrix(o,l=!1,_=!1){const v=o.key;let w;if(w=_?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,w[v])return w[v];const I=this.calculatePosMatrix(o,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,s.m.multiply(I,C,I),w[v]=new Float32Array(I),w[v]}calculatePixelsToTileUnitsMatrix(o){const l=o.tileID.key,_=this._pixelsToTileUnitsCache;if(_[l])return _[l];const v=s.K(o,this);return _[l]=v,_[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,l=s.m.fromScaling([],[o,o,o]);return s.m.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const l=s.b(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(l),v=this._camera.forward(),w=s.b(1,this._center.lat);_[2]/=w,v[2]/=w,s.v.normalize(v,v);const I=o.raycast(_,v,o.exaggeration());if(I){const C=s.v.scaleAndAdd([],_,v,I),P=new s.M(C[0],C[1],s.b(C[2],s.l(C[1]))),D=(P.z+s.v.length([P.x-_[0],P.y-_[1],P.z-_[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const l=this._elevation,_=s.b(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(_),w=l.getAtPointOrZero(new s.M(...v)),I=this.pixelsPerMeter/this.worldSize*w,C=this._minimumHeightOverTerrain(),P=v[2]-I;if(P<=C)if(P<0||o){const D=this.locationCoordinate(this._center,this._centerAltitude),z=[v[0],v[1],D.z-v[2]],k=s.v.length(z);z[2]-=(C-P)/this._pixelsPerMercatorPixel;const B=s.v.length(z);if(B===0)return;s.v.scale(z,z,k/B*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],D.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const B=this.center;return B.lat=s.c(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(B.lng=s.c(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const l=this._unmodified,{x:_,y:v}=this.point;let w=0,I=_,C=v;const P=this.width/2,D=this.height/2,z=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(v-D<z&&(C=z+D),v+D>k&&(C=k-D),k-z<this.height&&(w=Math.max(w,this.height/(k-z)),C=(k+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,q=this.worldSize/2-(B+U)/2;I=(_+q+this.worldSize)%this.worldSize-q,I-P<B&&(I=B+P),I+P>U&&(I=U-P),U-B<this.width&&(w=Math.max(w,this.width/(U-B)),I=(U+B)/2)}I===_&&C===v||(this.center=this.unproject(new s.P(I,C))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,l=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.b(1,this.center.lat)/s.b(1,s.$));const v=s.N(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?_:1,I=this._camera.getWorldToCamera(this.worldSize,w);let C;const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-o.x/this.width,P[9]=2*o.y/this.height,this.isOrthographic){let ut=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),pt=ut*this.aspect,Dt=-pt,wt=-ut;pt-=o.x,Dt-=o.x,ut+=o.y,wt+=o.y,C=this._camera.getCameraToClipOrthographic(Dt,pt,wt,ut,this._nearZ,this._farZ),((St,mt,Lt,Tt)=>{for(let zt=0;zt<16;zt++)St[zt]=Sr(mt[zt],Lt[zt],Tt)})(C,C,P,Ae(this.pitch>=15?1:this.pitch/15))}else C=P;const D=s.m.mul([],P,I);let z=s.m.mul([],C,I);if(this.projection.isReprojectedInTileSpace){const ut=this.locationCoordinate(this.center),pt=s.m.identity([]);s.m.translate(pt,pt,[ut.x*this.worldSize,ut.y*this.worldSize,0]),s.m.multiply(pt,pt,s.Q(this)),s.m.translate(pt,pt,[-ut.x*this.worldSize,-ut.y*this.worldSize,0]),s.m.multiply(z,z,pt),s.m.multiply(D,D,pt),this.inverseAdjustmentMatrix=s.S(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.m.scale([],z,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=z,this.invProjMatrix=s.m.invert(new Float64Array(16),this.projMatrix),l){const ut=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ut[8]=2*-o.x/this.width,ut[9]=2*o.y/this.height,this.expandedFarZProjMatrix=s.m.mul([],ut,I)}else this.expandedFarZProjMatrix=this.projMatrix;const k=s.m.invert([],C);this.frustumCorners=s.T.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const B=new Float32Array(16);s.m.identity(B),s.m.scale(B,B,[1,-1,1]),s.m.rotateX(B,B,this._pitch),s.m.rotateZ(B,B,this.angle);const U=s.m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.m.clone(U);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-o.x/this.width,U[9]=2*(o.y+q)/this.height,this.skyboxMatrix=s.m.multiply(B,U,B);const X=this.point,Z=X.x,j=X.y,J=this.width%2/2,nt=this.height%2/2,st=Math.cos(this.angle),Y=Math.sin(this.angle),K=Z-Math.round(Z)+st*J+Y*nt,lt=j-Math.round(j)+st*nt+Y*J,ht=new Float64Array(z);if(s.m.translate(ht,ht,[K>.5?K-1:K,lt>.5?lt-1:lt,0]),this.alignedProjMatrix=ht,z=s.m.create(),s.m.scale(z,z,[this.width/2,-this.height/2,1]),s.m.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=s.m.create(),s.m.scale(z,z,[1,-1,1]),s.m.translate(z,z,[-1,-1,0]),s.m.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=s.m.multiply(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},z=s.m.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.V(this);const ut=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.v.transformMat4(ut,ut,I),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,_=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,w=[o,o,l];s.v.scale(w,w,v),s.v.scale(_,_,-1),s.v.multiply(_,_,w);const I=s.m.create();s.m.translate(I,I,_),s.m.scale(I,I,w),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,l,v)}_computeCameraPosition(o){const l=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),v=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-o/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-_[0]*w,v.y/this.worldSize-_[1]*w,o/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],v=o[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(w=Math.min((l-_)/v,1)),this._camera.position=s.v.scaleAndAdd([],this._camera.position,o,w),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,l=this._camera.forward(),{pitch:_,bearing:v}=this._camera.getPitchBearing(),w=s.b(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.d(this._maxPitch)),C=Math.max((o[2]-w)/Math.cos(_),I),P=this._zoomFromMercatorZ(C);s.v.scaleAndAdd(o,o,l,C),this._pitch=s.c(_,s.d(this.minPitch),s.d(this.maxPitch)),this.angle=s.w(v,-Math.PI,Math.PI),this._setZoom(s.c(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.M(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let l=0,_=s.G,v=0,w=1/0;for(;_-l>1e-6&&_>l;){const I=l+.5*(_-l),C=this.tileSize*Math.pow(2,I),P=this.getCameraToCenterDistance(this.projection,I,C),D=this.scaleZoom(P/(o*this.tileSize)),z=Math.abs(I-D);z<w&&(w=z,v=I),I<D?l=I:_=I}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,l){const _=Math.min(o.x,l.x),v=Math.max(o.x,l.x),w=Math.min(o.y,l.y),I=Math.max(o.y,l.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new s.P(_,w),new s.P(v,I),new s.P(_,I),new s.P(v,w)],P=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const z of C){const k=this.pointRayIntersection(z);if(k.t<0)return!0;const B=this.rayIntersectionCoordinate(k);if(B.x<P||B.y<0||B.x>D||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.Y(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(o,l){const _=s.v.length(s.v.sub([],this._camera.position,o)),v=this._zoomFromMercatorZ(_)+l;return _-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([l,_,v],w){const I=[l,_,v,1];s.e.transformMat4(I,I,w);const C=I[3]=Math.max(I[3],1e-6);return I[0]/=C,I[1]/=C,I[2]/=C,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,o))}}getCameraToCenterDistance(o,l=this.zoom,_=this.worldSize){const v=s.N(o,l,this.width,this.height,1024),w=o.pixelSpaceConversion(this.center.lat,_,v);let I=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(I=Sr(1,I,Ae(this.pitch>=15?1:this.pitch/15))),I}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.m.multiply(o,o,this.globeMatrix),o}getFrustum(o){return s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}function _n(d){const{userImage:o}=d;return!!(o&&o.render&&o.render())&&(d.data.replace(new Uint8Array(o.data.buffer)),!0)}class xn extends s.a6{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(o){this.images[o]={},this.loaded[o]=!1,this.updatedImages[o]={},this.patterns[o]={},this.callbackDispatchedThisFrame[o]={},this.atlasImage[o]=new s.a5({width:1,height:1})}isLoaded(){for(const o in this.loaded)if(!this.loaded[o])return!1;return!0}setLoaded(o,l){if(this.loaded[l]!==o&&(this.loaded[l]=o,o)){for(const{ids:_,callback:v}of this.requestors)this._notify(_,l,v);this.requestors=[]}}hasImage(o,l){return!!this.getImage(o,l)}getImage(o,l){return this.images[l][o]}addImage(o,l,_){this._validate(o,_)&&(this.images[l][o]=_)}_validate(o,l){let _=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new s.a7(new Error(`Image "${o}" has invalid "stretchX" value`))),_=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new s.a7(new Error(`Image "${o}" has invalid "stretchY" value`))),_=!1),this._validateContent(l.content,l)||(this.fire(new s.a7(new Error(`Image "${o}" has invalid "content" value`))),_=!1),_}_validateStretch(o,l){if(!o)return!0;let _=0;for(const v of o){if(v[0]<_||v[1]<v[0]||l<v[1])return!1;_=v[1]}return!0}_validateContent(o,l){return!(o&&(o.length!==4||o[0]<0||l.data.width<o[0]||o[1]<0||l.data.height<o[1]||o[2]<0||l.data.width<o[2]||o[3]<0||l.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,l,_){_.version=this.images[l][o].version+1,this.images[l][o]=_,this.updatedImages[l][o]=!0}removeImage(o,l){const _=this.images[l][o];delete this.images[l][o],delete this.patterns[l][o],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(o){return Object.keys(this.images[o])}getImages(o,l,_){let v=!0;const w=!!this.loaded[l];if(!w)for(const I of o)this.images[l][I]||(v=!1);w||v?this._notify(o,l,_):this.requestors.push({ids:o,scope:l,callback:_})}getUpdatedImages(o){return this.updatedImages[o]}_notify(o,l,_){const v={};for(const w of o){this.images[l][w]||this.fire(new s.a8("styleimagemissing",{id:w}));const I=this.images[l][w];I?v[w]={data:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)}:s.X(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}_(null,v)}getPixelSize(o){const{width:l,height:_}=this.atlasImage[o];return{width:l,height:_}}getPattern(o,l){const _=this.patterns[l][o],v=this.getImage(o,l);if(!v)return null;if(_&&_.position.version===v.version)return _.position;if(_)_.position.version=v.version;else{const w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},I=new s.ab(w,v);this.patterns[l][o]={bin:w,position:I}}return this._updatePatternAtlas(l),this.patterns[l][o].position}bind(o,l){const _=o.gl;let v=this.atlasTexture[l];v?this.dirty&&(v.update(this.atlasImage[l]),this.dirty=!1):(v=new s.a9(o,this.atlasImage[l],_.RGBA),this.atlasTexture[l]=v),v.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(o){const l=[];for(const I in this.patterns[o])l.push(this.patterns[o][I].bin);const{w:_,h:v}=s.aa(l),w=this.atlasImage[o];w.resize({width:_||1,height:v||1});for(const I in this.patterns[o]){const{bin:C}=this.patterns[o][I],P=C.x+1,D=C.y+1,z=this.images[o][I].data,k=z.width,B=z.height;s.a5.copy(z,w,{x:0,y:0},{x:P,y:D},{width:k,height:B}),s.a5.copy(z,w,{x:0,y:B-1},{x:P,y:D-1},{width:k,height:1}),s.a5.copy(z,w,{x:0,y:0},{x:P,y:D+B},{width:k,height:1}),s.a5.copy(z,w,{x:k-1,y:0},{x:P-1,y:D},{width:1,height:B}),s.a5.copy(z,w,{x:0,y:0},{x:P+k,y:D},{width:1,height:B})}this.dirty=!0}beginFrame(){for(const o in this.images)this.callbackDispatchedThisFrame[o]={}}dispatchRenderCallbacks(o,l){for(const _ of o){if(this.callbackDispatchedThisFrame[l][_])continue;this.callbackDispatchedThisFrame[l][_]=!0;const v=this.images[l][_];_n(v)&&this.updateImage(_,l,v)}}}const Ln=new s.ac({anchor:new s.ad(s.ae.light.anchor),position:new s.af(s.ae.light.position),color:new s.ad(s.ae.light.color),intensity:new s.ad(s.ae.light.intensity)});class bi extends s.a6{constructor(o,l="flat"){super(),this._transitionable=new s.ag(Ln),this.setLight(o,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,l,_={}){this._validate(s.ah,o,_)||(this._transitionable.setTransitionOrValue(o),this.id=l)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,l,_){return(!_||_.validate!==!1)&&s.ai(this,o.call(s.aj,s.ak({value:l,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}const _o=new s.ac({source:new s.ad(s.ae.terrain.source),exaggeration:new s.ad(s.ae.terrain.exaggeration)});let Ao=class extends s.a6{constructor(d,o,l,_){super(),this.scope=l,this._transitionable=new s.ag(_o,l,_),this._transitionable.setTransitionOrValue(d,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(d,o){this._transitionable.setTransitionOrValue(d,o)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new s.al(d)).get("exaggeration")}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof s.am}};const yo=45,wi=65,ro=.05;function Ks(d,o,l,_){const v=s.an(yo,wi,l),[w,I]=nu(d,_);let C=1-Math.min(1,Math.exp((o-w)/(I-w)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*v*d.alpha}function nu(d,o){const l=.5/Math.tan(.5*o);return[d.range[0]+l,d.range[1]+l]}function kp(d,o,l,_,v){const w=s.v.transformMat4([],[o,l,_],v.mercatorFogMatrix);return Ks(d,s.v.length(w),v.pitch,v._fov)}function sh(d,o,l,_,v,w,I){const C=[[l,_,0],[v,_,0],[v,w,0],[l,w,0]];let P=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const z of C){const k=s.v.transformMat4([],z,o),B=s.v.length(k);P=Math.min(P,B),D=Math.max(D,B)}return[Ks(d,P,I.pitch,I._fov),Ks(d,D,I.pitch,I._fov)]}const ah=new s.ac({range:new s.ad(s.ae.fog.range),color:new s.ad(s.ae.fog.color),"high-color":new s.ad(s.ae.fog["high-color"]),"space-color":new s.ad(s.ae.fog["space-color"]),"horizon-blend":new s.ad(s.ae.fog["horizon-blend"]),"star-intensity":new s.ad(s.ae.fog["star-intensity"]),"vertical-range":new s.ad(s.ae.fog["vertical-range"])});class Fp extends s.a6{constructor(o,l){super(),this._transitionable=new s.ag(ah),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const o=this._transform,l=o.projection.name==="globe",_=s.ao(o.zoom),v=this.properties.get("range"),w=[.5,3];return{range:l?[s.n(w[0],v[0],_),s.n(w[1],v[1],_)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,l={}){if(this._validate(s.ap,o,l))return;const _=s.ak({},o);for(const v of Object.keys(s.ae.fog))_[v]===void 0&&(_[v]=s.ae.fog[v].default);this._transitionable.setTransitionOrValue(_)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.an(yo,wi,o))*l.a}getOpacityAtLatLng(o,l){return this._transform.projection.supportsFog?function(_,v,w){const I=s.M.fromLngLat(v),C=w.elevation?w.elevation.getAtPointOrZero(I):0;return kp(_,I.x,I.y,C,w)}(this.state,o,l):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(o.toUnwrapped());return sh(this.state,l,0,0,s.J,s.J,this._transform)}getOpacityForBounds(o,l,_,v,w){return this._transform.projection.supportsFog?sh(this.state,o,l,_,v,w,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?nu(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const _ of l){const v=o.points[_];let w;if(v[2]>=0)w=v;else{const I=o.points[_-4];w=s.aq(I,v,I[2]/(I[2]-v[2]))}if(kp(this.state,w[0],w[1],0,this._transform)>=ro)return!0}return!1}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,l,_){return(!_||_.validate!==!1)&&s.ai(this,o.call(s.aj,s.ak({value:l,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}class Yu extends s.a6{constructor(o,l,_,v){super(),this.scope=_,this._options=o,this.properties=new s.ar(l),this._transitionable=new s.ag(l,_,new Map(v)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,l){this._options=o,this._transitionable.setTransitionOrValue(o.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const hl=new s.ac({color:new s.ad(s.ae.properties_light_ambient.color),intensity:new s.ad(s.ae.properties_light_ambient.intensity)}),Zd=new s.ac({direction:new s.as(s.ae.properties_light_directional.direction),color:new s.ad(s.ae.properties_light_directional.color),intensity:new s.ad(s.ae.properties_light_directional.intensity),"cast-shadows":new s.ad(s.ae.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.ad(s.ae.properties_light_directional["shadow-intensity"])});class ji{constructor(o,l,_,v){this.screenBounds=o,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(o,l){let _,v;if(o instanceof s.P||typeof o[0]=="number"){const w=s.P.convert(o);_=[w],v=l.isPointAboveHorizon(w)}else{const w=s.P.convert(o[0]),I=s.P.convert(o[1]);_=[w,I],v=s.at(w,I).every(C=>l.isPointAboveHorizon(C))}return new ji(_,l.getCameraPoint(),v,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return s.at(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const l=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],v=s.at(l,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<_.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?v[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(v[3]=this.cameraPoint)),s.au(v,o)}bufferedCameraGeometryGlobe(o){const l=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],v=s.at(l,_,o),w=this.cameraPoint.clone();switch(3*((w.y>l.y)+(w.y>_.y))+((w.x>l.x)+(w.x>_.x))){case 0:v[0]=w,v[4]=w.clone();break;case 1:v.splice(1,0,w);break;case 2:v[1]=w;break;case 3:v.splice(4,0,w);break;case 5:v.splice(2,0,w);break;case 6:v[3]=w;break;case 7:v.splice(3,0,w);break;case 8:v[2]=w}return v}containsTile(o,l,_,v=0){const w=o.queryPadding/l._pixelsPerMercatorPixel+1,I=_?this._bufferedCameraMercator(w,l):this._bufferedScreenMercator(w,l);let C=o.tileID.wrap+(I.unwrapped?v:0);const P=I.polygon.map(Z=>s.av(o.tileTransform,Z,C));if(!s.aw(P,0,0,s.J,s.J))return;C=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const D=this.screenGeometryMercator.polygon.map(Z=>s.ax(o.tileTransform,Z,C)),z=D.map(Z=>new s.P(Z[0],Z[1])),k=l.getFreeCameraOptions().position||new s.M(0,0,0),B=s.ax(o.tileTransform,k,C),U=D.map(Z=>{const j=s.v.sub(Z,Z,B);return s.v.normalize(j,j),new s.R(B,j)}),q=s.ay(o,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:U,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(X=s.az(P),X.min.x=s.c(X.min.x,0,s.J),X.min.y=s.c(X.min.y,0,s.J),X.max.x=s.c(X.max.x,0,s.J),X.max.y=s.c(X.max.y,0,s.J),X),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:q};var X}_bufferedScreenMercator(o,l){const _=Yo(o);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let v;return v=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),l):{polygon:this.bufferedScreenGeometry(o).map(w=>l.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[_]=v,v}}_bufferedCameraMercator(o,l){const _=Yo(o);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let v;return v=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),l):{polygon:this.bufferedCameraGeometry(o).map(w=>l.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[_]=v,v}}_projectAndResample(o,l){const _=function(w,I){const C=s.m.multiply([],I.pixelMatrix,I.globeMatrix),P=[0,-s.aC,0,1],D=[0,s.aC,0,1],z=[0,0,0,1];s.e.transformMat4(P,P,C),s.e.transformMat4(D,D,C),s.e.transformMat4(z,z,C);const k=new s.P(P[0]/P[3],P[1]/P[3]),B=new s.P(D[0]/D[3],D[1]/D[3]),U=s.aA(w,k)&&P[3]<z[3],q=s.aA(w,B)&&D[3]<z[3];if(!U&&!q)return null;const X=function(lt,ht,ut){for(let pt=1;pt<lt.length;pt++){const Dt=pl(ht.pointCoordinate3D(lt[pt-1]).x),wt=pl(ht.pointCoordinate3D(lt[pt]).x);if(ut<0){if(Dt<wt)return{idx:pt,t:-Dt/(wt-1-Dt)}}else if(wt<Dt)return{idx:pt,t:(1-Dt)/(wt+1-Dt)}}return null}(w,I,U?-1:1);if(!X)return null;const{idx:Z,t:j}=X;let J=Z>1?lh(w.slice(0,Z),I):[],nt=Z<w.length?lh(w.slice(Z),I):[];J=J.map(lt=>new s.P(pl(lt.x),lt.y)),nt=nt.map(lt=>new s.P(pl(lt.x),lt.y));const st=[...J];st.length===0&&st.push(nt[nt.length-1]);const Y=s.n(st[st.length-1].y,(nt.length===0?J[0]:nt[0]).y,j);let K;return K=U?[new s.P(0,Y),new s.P(0,0),new s.P(1,0),new s.P(1,Y)]:[new s.P(1,Y),new s.P(1,1),new s.P(0,1),new s.P(0,Y)],st.push(...K),nt.length===0?st.push(J[0]):st.push(...nt),{polygon:st.map(lt=>new s.M(lt.x,lt.y)),unwrapped:!1}}(o,l);if(_)return _;const v=function(w,I){let C=!1,P=-1/0,D=0;for(let k=0;k<w.length-1;k++)w[k].x>P&&(P=w[k].x,D=k);for(let k=0;k<w.length-1;k++){const B=(D+k)%(w.length-1),U=w[B],q=w[B+1];Math.abs(U.x-q.x)>.5&&(U.x<q.x?(U.x+=1,B===0&&(w[w.length-1].x+=1)):(q.x+=1,B+1===w.length-1&&(w[0].x+=1)),C=!0)}const z=s.E(I.center.lng);return C&&z<Math.abs(z-1)&&w.forEach(k=>{k.x-=1}),{polygon:w,unwrapped:C}}(lh(o,l).map(w=>new s.P(pl(w.x),w.y)),l);return{polygon:v.polygon.map(w=>new s.M(w.x,w.y)),unwrapped:v.unwrapped}}}function lh(d,o){return s.aB(d,l=>{const _=o.pointCoordinate3D(l);l.x=_.x,l.y=_.y},1/256)}function pl(d){return d<0?1+d%1:d%1}function Yo(d){return 100*d|0}function fl(d,o,l,_,v){const w=function(I,C){if(I)return v(I);if(C){d.url&&C.tiles&&d.tiles&&delete d.tiles;const P=s.p(s.ak(C,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(P.vectorLayers=C.vector_layers,P.vectorLayerIds=P.vectorLayers.map(D=>D.id)),P.tiles=o.canonicalizeTileset(P,d.url),v(null,P)}};return d.url?s.a1(o.transformRequest(o.normalizeSourceURL(d.url,null,l,_),s.a2.Source),w):s.a4.frame(()=>w(null,d))}class xs{constructor(o,l,_){this.bounds=s.D.convert(this.validateBounds(o)),this.minzoom=l||0,this.maxzoom=_||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const l=Math.pow(2,o.z),_=Math.floor(s.E(this.bounds.getWest())*l),v=Math.floor(s.H(this.bounds.getNorth())*l),w=Math.ceil(s.E(this.bounds.getEast())*l),I=Math.ceil(s.H(this.bounds.getSouth())*l);return o.x>=_&&o.x<w&&o.y>=v&&o.y<I}}class bt extends s.a6{constructor(o,l,_,v){if(super(),this.id=o,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.ak(this,s.p(l,["url","scheme","tileSize","promoteId"])),this._options=s.ak({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new s.aD}load(o){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=fl(this._options,this.map._requestManager,l,_,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new s.a7(v))):w&&(s.ak(this,w),w.bounds&&(this.tileBounds=new xs(w.bounds,this.minzoom,this.maxzoom)),s.aH(w.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),o&&o(v)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}loadTile(o,l){const _=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(_,s.a2.Tile),data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster};if(v.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=l:o.request=o.actor.send("reloadTile",v,w.bind(this));else if(o.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",v,w.bind(this),void 0,!0);else{const I=s.aF.call({deduped:this._deduped},v,(C,P)=>{C||!P?w.call(this,C):(v.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},o.actor&&o.actor.send("loadTile",v,w.bind(this),void 0,!0))},!0);o.request={cancel:I}}function w(I,C){return delete o.request,o.aborted?l(null):I&&I.status!==404?l(I):(C&&C.resourceTiming&&(o.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&o.setExpiryData(C),o.loadVectorData(C,this.map.painter),s.aG(this.dispatcher),l(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xe extends s.a6{constructor(o,l,_,v){super(),this.id=o,this.dispatcher=_,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.ak({type:"raster"},l),s.ak(this,s.p(l,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._tileJSONRequest=fl(this._options,this.map._requestManager,null,null,(l,_)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new s.a7(l)):_&&(s.ak(this,_),_.bounds&&(this.tileBounds=new xs(_.bounds,this.minzoom,this.maxzoom)),s.aH(_.tiles),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),o&&o(l)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,l){const _=s.a4.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);o.request=s.a3(this.map._requestManager.transformRequest(v,s.a2.Tile),(w,I,C,P)=>(delete o.request,o.aborted?(o.state="unloaded",l(null)):w?(o.state="errored",l(w)):I?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:C,expires:P}),o.setTexture(I,this.map.painter),o.state="loaded",s.aG(this.dispatcher),void l(null)):l(null)))}abortTile(o,l){o.request&&(o.request.cancel(),delete o.request),l()}unloadTile(o,l){o.texture&&o.texture instanceof s.a9?(o.destroy(!0),o.texture&&o.texture instanceof s.a9&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const bs={vector:bt,raster:xe,"raster-dem":class extends xe{constructor(d,o,l,_){super(d,o,l,_),this.type="raster-dem",this.maxzoom=22,this._options=s.ak({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(d,o){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(v,w){v&&(d.state="errored",o(v)),w&&(d.dem=w,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",o(null))}d.request=s.a3(this.map._requestManager.transformRequest(l,s.a2.Tile),(function(v,w,I,C){if(delete d.request,d.aborted)d.state="unloaded",o(null);else if(v)d.state="errored",o(v);else if(w){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:I,expires:C});const P=ImageBitmap&&w instanceof ImageBitmap&&s.aI(),D=1-(w.width-s.aJ(w.width))/2;D<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const z=P?w:s.a4.getImageData(w,D),k={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:D};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",k,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const o=d.canonical,l=Math.pow(2,o.z),_=(o.x-1+l)%l,v=o.x===0?d.wrap-1:d.wrap,w=(o.x+1+l)%l,I=o.x+1===l?d.wrap+1:d.wrap,C={};return C[new s.O(d.overscaledZ,v,o.z,_,o.y).key]={backfilled:!1},C[new s.O(d.overscaledZ,I,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(C[new s.O(d.overscaledZ,v,o.z,_,o.y-1).key]={backfilled:!1},C[new s.O(d.overscaledZ,d.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},C[new s.O(d.overscaledZ,I,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<l&&(C[new s.O(d.overscaledZ,v,o.z,_,o.y+1).key]={backfilled:!1},C[new s.O(d.overscaledZ,d.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},C[new s.O(d.overscaledZ,I,o.z,w,o.y+1).key]={backfilled:!1}),C}},geojson:class extends s.a6{constructor(d,o,l,_){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(_),this._data=o.data,this._options=s.ak({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const v=s.J/this.tileSize;this.workerOptions=s.ak({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*v,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*v,extent:s.J,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.J,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*v,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},o),this}getClusterChildren(d,o){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},o),this}getClusterLeaves(d,o,l,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:o,offset:l},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.a8("dataloading",{dataType:"source"})),this._loaded=!1;const d=s.ak({},this.workerOptions);d.scope=this.scope;const o=this._data;typeof o=="string"?(d.request=this.map._requestManager.transformRequest(s.a4.resolveURL(o),s.a2.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(l,_)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new s.a7(l));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v.resourceTiming=_.resourceTiming[this.id]),this.fire(new s.a8("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,o){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const _={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};d.request=this.actor.send(l,_,(v,w)=>(delete d.request,d.destroy(),d.aborted?o(null):v?o(v):(d.loadVectorData(w,this.map.painter,l==="reloadTile"),o(null))),void 0,l==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.ak({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aK{constructor(d,o,l,_){super(d,o,l,_),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const o of d.urls)this.urls.push(this.map._requestManager.transformRequest(o,s.a2.Source).url);s.aL(this.urls,(o,l)=>{this._loaded=!0,o?this.fire(new s.a7(o)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const o=this.video.seekable;d<o.start(0)||d>o.end(0)?this.fire(new s.a7(new s.aM(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,o=d.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new s.a9(d,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aK,model:class extends s.a6{constructor(d,o,l,_){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){const d=[];for(const o in this._options.models){const l=this._options.models[o],_=s.aO(this.map._requestManager.transformRequest(l.uri,s.a2.Model).url).then(v=>{if(!v)return;const w=s.aP(v),I=new s.aQ(o,l.position,l.orientation,w);I.computeBoundsAndApplyParent(),this.models.push(I)}).catch(v=>{this.fire(new s.a7(new Error(`Could not load model ${o} from ${l.uri}: ${v.message}`)))});d.push(_)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this.fire(new s.a7(new Error(`Could not load models: ${o.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,o){}serialize(){return{type:"model"}}},"batched-model":class extends s.a6{constructor(d,o,l,_){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=fl(this._options,this.map._requestManager,o,l,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new s.a7(_))):v&&(s.ak(this,v),v.bounds&&(this.tileBounds=new xs(v.bounds,this.minzoom,this.maxzoom)),s.aH(v.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),d&&d(_)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,o){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(l,s.a2.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=o;else{if(d.buckets){const w=Object.values(d.buckets);for(const I of w)I.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",_,v.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",_,v.bind(this),void 0,!0);function v(w,I){return d.aborted?o(null):w&&w.status!==404?o(w):(I&&(I.resourceTiming&&(d.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&d.setExpiryData(I),d.buckets={...d.buckets,...I.buckets}),d.state="loaded",void o(null))}}serialize(){return s.ak({},this._options)}},canvas:class extends s.aK{constructor(d,o,l,_){super(d,o,l,_),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new s.a7(new s.aM(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.a7(new s.aM(`sources.${d}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.a7(new s.aM(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new s.a7(new s.aM(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.a7(new s.aM(`sources.${d}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.a7(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof s.aN||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.a9(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends s.a6{constructor(d,o,l,_){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=o,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.a7(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.a7(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new xs(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),s.ak(this,s.p(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.p(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:o,y:l,z:_}=d.canonical;return this._implementation.hasTile({x:o,y:l,z:_})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,o){const{x:l,y:_,z:v}=d.tileID.canonical,w=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:l,y:_,z:v},{signal:w.signal})).then((function(I){return delete d.request,d.aborted?(d.state="unloaded",o(null)):I===void 0?(d.state="errored",o(null)):I===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",o(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(I)?(this.loadTileData(d,I),d.state="loaded",void o(null)):(d.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(I=>{I.code!==20&&(d.state="errored",o(I))}),d.request.cancel=()=>w.abort()}loadTileData(d,o){d.setTexture(o,this._map.painter)}unloadTile(d,o){if(d.texture&&d.texture instanceof s.a9?(d.destroy(!0),d.texture&&d.texture instanceof s.a9&&this._map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:l,y:_,z:v}=d.tileID.canonical;this._implementation.unloadTile({x:l,y:_,z:v})}o()}abortTile(d,o){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=s.aE(this.id,this.scope);this._map.style.clearSource(d)}_update(){this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}}},$o=function(d,o,l,_){const v=new bs[o.type](d,o,l,_);if(v.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${v.id}`);return s.aR(["load","abort","unload","serialize","prepare"],v),v};function Dn(d,o){const l=s.m.identity([]);return s.m.scale(l,l,[.5*d.width,.5*-d.height,1]),s.m.translate(l,l,[1,-1,0]),s.m.multiply(l,l,d.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(l)}function Qs(d,o,l,_,v,w,I,C=!1){const P=d.tilesIn(_,I,C);P.sort(Jo);const D=[];for(const k of P)D.push({wrappedTileID:k.tile.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(o,l,d._state,k,v,w,Dn(d.transform,k.tile.tileID),C)});const z=function(k){const B={},U={};for(const q of k){const X=q.queryResults,Z=q.wrappedTileID,j=U[Z]=U[Z]||{};for(const J in X){const nt=X[J],st=j[J]=j[J]||{},Y=B[J]=B[J]||[];for(const K of nt)st[K.featureIndex]||(st[K.featureIndex]=!0,Y.push(K))}}return B}(D);for(const k in z)z[k].forEach(B=>{const U=B.feature,q=U.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(U.source=q.source,q["source-layer"]&&(U.sourceLayer=q["source-layer"]),U.state=U.id!==void 0?d.getFeatureState(q["source-layer"],U.id):{})});return z}function x_(d,o){const l=d.getRenderableIds().map(w=>d.getTileByID(w)),_=[],v={};for(let w=0;w<l.length;w++){const I=l[w],C=I.tileID.canonical.key;v[C]||(v[C]=!0,I.querySourceFeatures(_,o))}return _}function Jo(d,o){const l=d.tileID,_=o.tileID;return l.overscaledZ-_.overscaledZ||l.canonical.y-_.canonical.y||l.wrap-_.wrap||l.canonical.x-_.canonical.x}class Bp{constructor(o){this.style=o}processLayersChanged(){this.layers=[];for(const o in this.style._mergedLayers){const l=this.style._mergedLayers[o];if(l.type==="fill-extrusion")this.layers.push(l);else if(l.type==="model"){const _=this.style.getLayerSource(l);_&&_.type==="batched-model"&&this.layers.push(l)}}}updateZOffset(o,l){this.currentBuildingBuckets=[];for(let v=0;v<this.layers.length;++v){const w=this.layers[v],I=this.style.getLayerSourceCache(w);let C=1;w.type==="fill-extrusion"&&(C=w.paint.get("fill-extrusion-opacity")>0?w.paint.get("fill-extrusion-vertical-scale"):0);let P=I?I.getTile(l):null;if(!P&&I&&l.canonical.z>I.getSource().minzoom){let D=l.scaledTo(Math.min(I.getSource().maxzoom,l.overscaledZ-1));for(;D.overscaledZ>=I.getSource().minzoom&&(P=I.getTile(D),!P&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:P?P.getBucket(w):null,tileID:P?P.tileID:l,verticalScale:C})}o.hasAnyZOffset=!1;let _=!1;for(let v=0;v<o.symbolInstances.length;v++){const w=o.symbolInstances.get(v),I=w.zOffset,C=this._getHeightAtTileOffset(l,w.tileAnchorX,w.tileAnchorY);w.zOffset=C!==-1?C:I,_||I===w.zOffset||(_=!0),o.hasAnyZOffset||w.zOffset===0||(o.hasAnyZOffset=!0)}_&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,l,_,v){let w=l,I=_;if(o.canonical.z!==v.canonical.z){const C=v.canonical,P=1/(1<<o.canonical.z-C.z);w=(l+o.canonical.x*s.J)*P-C.x*s.J|0,I=(_+o.canonical.y*s.J)*P-C.y*s.J|0}return{tileX:w,tileY:I}}_getHeightAtTileOffset(o,l,_){let v,w;for(let I=0;I<this.layers.length;++I){if(this.layers[I].type!=="fill-extrusion")continue;const{bucket:C,tileID:P,verticalScale:D}=this.currentBuildingBuckets[I];if(!C)continue;const{tileX:z,tileY:k}=this._mapCoordToOverlappingTile(o,l,_,P),B=C.getHeightAtTileCoord(z,k);B&&B.height!==void 0&&(B.hidden?v=B.height:w=Math.max(B.height*D,w||0))}if(w!==void 0)return w;for(let I=0;I<this.layers.length;++I){if(this.layers[I].type!=="model")continue;const{bucket:C,tileID:P}=this.currentBuildingBuckets[I];if(!C)continue;const{tileX:D,tileY:z}=this._mapCoordToOverlappingTile(o,l,_,P),k=C.getHeightAtTileCoord(D,z);if(k&&!k.hidden)return k.height===void 0&&v!==void 0?Math.min(k.maxHeight,v)*k.verticalScale:(k.height||0)*k.verticalScale}return-1}}function b_(d,o){const l={};for(const _ in d)_!=="ref"&&(l[_]=d[_]);return s.aS.forEach(_=>{_ in o&&(l[_]=o[_])}),l}function dl(d){d=d.slice();const o=Object.create(null);for(let l=0;l<d.length;l++)o[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=b_(d[l],o[d[l].ref]));return d}const Bt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function fr(d,o,l){l.push({command:Bt.addSource,args:[d,o[d]]})}function mr(d,o,l){o.push({command:Bt.removeSource,args:[d]}),l[d]=!0}function Po(d,o,l,_){mr(d,l,_),fr(d,o,l)}function iu(d,o,l){let _;for(_ in d[l])if(d[l].hasOwnProperty(_)&&_!=="data"&&!O(d[l][_],o[l][_]))return!1;for(_ in o[l])if(o[l].hasOwnProperty(_)&&_!=="data"&&!O(d[l][_],o[l][_]))return!1;return!0}function ur(d,o,l,_,v,w){let I;for(I in o=o||{},d=d||{})d.hasOwnProperty(I)&&(O(d[I],o[I])||l.push({command:w,args:[_,I,o[I],v]}));for(I in o)o.hasOwnProperty(I)&&!d.hasOwnProperty(I)&&(O(d[I],o[I])||l.push({command:w,args:[_,I,o[I],v]}))}function ml(d){return d.id}function Sa(d,o){return d[o.id]=o,d}class $u{constructor(o,l){this.reset(o,l)}reset(o,l){this.points=o||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.c(o,0,1);let l=1,_=this._distances[l];const v=o*this.paddedLength+this.padding;for(;_<v&&l<this._distances.length;)_=this._distances[++l];const w=l-1,I=this._distances[w],C=_-I,P=C>0?(v-I)/C:0;return this.points[w].mult(1-P).add(this.points[l].mult(P))}}class qi{constructor(o,l,_){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(o/_),this.yCellCount=Math.ceil(l/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=l,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,l,_,v,w){this._forEachCell(l,_,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(l),this.bboxes.push(_),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(o,l,_,v){this._forEachCell(l-v,_-v,l+v,_+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(l),this.circles.push(_),this.circles.push(v)}_insertBoxCell(o,l,_,v,w,I){this.boxCells[w].push(I)}_insertCircleCell(o,l,_,v,w,I){this.circleCells[w].push(I)}_query(o,l,_,v,w,I){if(_<0||o>this.width||v<0||l>this.height)return!w&&[];const C=[];if(o<=0&&l<=0&&this.width<=_&&this.height<=v){if(w)return!0;for(let P=0;P<this.boxKeys.length;P++)C.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const D=this.circles[3*P],z=this.circles[3*P+1],k=this.circles[3*P+2];C.push({key:this.circleKeys[P],x1:D-k,y1:z-k,x2:D+k,y2:z+k})}return I?C.filter(I):C}return this._forEachCell(o,l,_,v,this._queryCell,C,{hitTest:w,seenUids:{box:{},circle:{}}},I),w?C.length>0:C}_queryCircle(o,l,_,v,w){const I=o-_,C=o+_,P=l-_,D=l+_;if(C<0||I>this.width||D<0||P>this.height)return!v&&[];const z=[];return this._forEachCell(I,P,C,D,this._queryCellCircle,z,{hitTest:v,circle:{x:o,y:l,radius:_},seenUids:{box:{},circle:{}}},w),v?z.length>0:z}query(o,l,_,v,w){return this._query(o,l,_,v,!1,w)}hitTest(o,l,_,v,w){return this._query(o,l,_,v,!0,w)}hitTestCircle(o,l,_,v){return this._queryCircle(o,l,_,!0,v)}_queryCell(o,l,_,v,w,I,C,P){const D=C.seenUids,z=this.boxCells[w];if(z!==null){const B=this.bboxes;for(const U of z)if(!D.box[U]){D.box[U]=!0;const q=4*U;if(o<=B[q+2]&&l<=B[q+3]&&_>=B[q+0]&&v>=B[q+1]&&(!P||P(this.boxKeys[U]))){if(C.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[U],x1:B[q],y1:B[q+1],x2:B[q+2],y2:B[q+3]})}}}const k=this.circleCells[w];if(k!==null){const B=this.circles;for(const U of k)if(!D.circle[U]){D.circle[U]=!0;const q=3*U;if(this._circleAndRectCollide(B[q],B[q+1],B[q+2],o,l,_,v)&&(!P||P(this.circleKeys[U]))){if(C.hitTest)return I.push(!0),!0;{const X=B[q],Z=B[q+1],j=B[q+2];I.push({key:this.circleKeys[U],x1:X-j,y1:Z-j,x2:X+j,y2:Z+j})}}}}}_queryCellCircle(o,l,_,v,w,I,C,P){const D=C.circle,z=C.seenUids,k=this.boxCells[w];if(k!==null){const U=this.bboxes;for(const q of k)if(!z.box[q]){z.box[q]=!0;const X=4*q;if(this._circleAndRectCollide(D.x,D.y,D.radius,U[X+0],U[X+1],U[X+2],U[X+3])&&(!P||P(this.boxKeys[q])))return I.push(!0),!0}}const B=this.circleCells[w];if(B!==null){const U=this.circles;for(const q of B)if(!z.circle[q]){z.circle[q]=!0;const X=3*q;if(this._circlesCollide(U[X],U[X+1],U[X+2],D.x,D.y,D.radius)&&(!P||P(this.circleKeys[q])))return I.push(!0),!0}}}_forEachCell(o,l,_,v,w,I,C,P){const D=this._convertToXCellCoord(o),z=this._convertToYCellCoord(l),k=this._convertToXCellCoord(_),B=this._convertToYCellCoord(v);for(let U=D;U<=k;U++)for(let q=z;q<=B;q++)if(w.call(this,o,l,_,v,this.xCellCount*q+U,I,C,P))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,l,_,v,w,I){const C=v-o,P=w-l,D=_+I;return D*D>C*C+P*P}_circleAndRectCollide(o,l,_,v,w,I,C){const P=(I-v)/2,D=Math.abs(o-(v+P));if(D>P+_)return!1;const z=(C-w)/2,k=Math.abs(l-(w+z));if(k>z+_)return!1;if(D<=P||k<=z)return!0;const B=D-P,U=k-z;return B*B+U*U<=_*_}}const jr=100;class w_{constructor(o,l,_=new qi(o.width+200,o.height+200,25),v=new qi(o.width+200,o.height+200,25)){this.transform=o,this.grid=_,this.ignoredGrid=v,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+jr,this.screenBottomBoundary=o.height+jr,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=l}placeCollisionBox(o,l,_,v,w,I,C,P){let D=_.projectedAnchorX,z=_.projectedAnchorY,k=_.projectedAnchorZ;const B=_.elevation,U=_.tileID,q=o.getProjection();if(B&&U){const[K,lt,ht]=q.upVector(U.canonical,_.tileAnchorX,_.tileAnchorY),ut=q.upVectorScale(U.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=K*B*ut,z+=lt*B*ut,k+=ht*B*ut}const X=this.projectAndGetPerspectiveRatio(C,D,z,k,_.tileID,q.name==="globe"||!!B||this.transform.pitch>0,q),Z=I*X.perspectiveRatio,j=(_.x1*l+v.x-_.padding)*Z+X.point.x,J=(_.y1*l+v.y-_.padding)*Z+X.point.y,nt=(_.x2*l+v.x+_.padding)*Z+X.point.x,st=(_.y2*l+v.y+_.padding)*Z+X.point.y,Y=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(j,J,nt,st)||!w&&this.grid.hitTest(j,J,nt,st,P)||Y?{box:[],offscreen:!1,occluded:X.occluded}:{box:[j,J,nt,st],offscreen:this.isOffscreen(j,J,nt,st),occluded:!1}}placeCollisionCircles(o,l,_,v,w,I,C,P,D,z,k,B,U,q,X){const Z=[],j=this.transform.elevation,J=o.getProjection(),nt=j?j.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,J):null,st=new s.P(_.tileAnchorX,_.tileAnchorY);let{x:Y,y:K,z:lt}=J.projectTilePoint(st.x,st.y,X.canonical);if(nt){const[zt,tt,yt]=nt(st);Y+=zt,K+=tt,lt+=yt}const ht=J.name==="globe",ut=this.projectAndGetPerspectiveRatio(C,Y,K,lt,X,ht||!!j||this.transform.pitch>0,J),{perspectiveRatio:pt}=ut,Dt=(k?I/pt:I*pt)/s.aV,wt=hi(Y,K,lt,P),St=ut.signedDistanceFromCamera>0?Jt(Dt,w,_.lineOffsetX*Dt,_.lineOffsetY*Dt,!1,wt,st,_,v,P,{},j&&!k?nt:null,k&&!!j,J,X,k):null;let mt=!1,Lt=!1,Tt=!0;if(St&&!ut.occluded){const zt=.5*U*pt+q,tt=new s.P(-100,-100),yt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Gt=new $u,{first:Ft,last:ge}=St,ce=Ft.path.length;let Se=[];for(let Le=ce-1;Le>=1;Le--)Se.push(Ft.path[Le]);for(let Le=1;Le<ge.path.length;Le++)Se.push(ge.path[Le]);const fe=2.5*zt;D&&(Se=Se.map(([Le,we,Ee],dr)=>(nt&&!ht&&(Ee=nt(dr<ce-1?Ft.tilePath[ce-1-dr]:ge.tilePath[dr-ce+2])[2]),hi(Le,we,Ee,D))),Se.some(Le=>Le[3]<=0)&&(Se=[]));let Pe=[];if(Se.length>0){let Le=1/0,we=-1/0,Ee=1/0,dr=-1/0;for(const Xe of Se)Le=Math.min(Le,Xe[0]),Ee=Math.min(Ee,Xe[1]),we=Math.max(we,Xe[0]),dr=Math.max(dr,Xe[1]);we>=tt.x&&Le<=yt.x&&dr>=tt.y&&Ee<=yt.y&&(Pe=[Se.map(Xe=>new s.P(Xe[0],Xe[1]))],(Le<tt.x||we>yt.x||Ee<tt.y||dr>yt.y)&&(Pe=s.aT(Pe,tt.x,tt.y,yt.x,yt.y)))}for(const Le of Pe){Gt.reset(Le,.25*zt);let we=0;we=Gt.length<=.5*zt?1:Math.ceil(Gt.paddedLength/fe)+1;for(let Ee=0;Ee<we;Ee++){const dr=Ee/Math.max(we-1,1),Xe=Gt.lerp(dr),Zr=Xe.x+jr,Dr=Xe.y+jr;Z.push(Zr,Dr,zt,0);const Wi=Zr-zt,Oo=Dr-zt,Mr=Zr+zt,gr=Dr+zt;if(Tt=Tt&&this.isOffscreen(Wi,Oo,Mr,gr),Lt=Lt||this.isInsideGrid(Wi,Oo,Mr,gr),!l&&this.grid.hitTestCircle(Zr,Dr,zt,B)&&(mt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:mt,occluded:!1}}}}return{circles:!z&&mt||!Lt?[]:Z,offscreen:Tt,collisionDetected:mt,occluded:ut.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let _=1/0,v=1/0,w=-1/0,I=-1/0;for(const z of o){const k=new s.P(z.x+jr,z.y+jr);_=Math.min(_,k.x),v=Math.min(v,k.y),w=Math.max(w,k.x),I=Math.max(I,k.y),l.push(k)}const C=this.grid.query(_,v,w,I).concat(this.ignoredGrid.query(_,v,w,I)),P={},D={};for(const z of C){const k=z.key;if(P[k.bucketInstanceId]===void 0&&(P[k.bucketInstanceId]={}),P[k.bucketInstanceId][k.featureIndex])continue;const B=[new s.P(z.x1,z.y1),new s.P(z.x2,z.y1),new s.P(z.x2,z.y2),new s.P(z.x1,z.y2)];s.aU(l,B)&&(P[k.bucketInstanceId][k.featureIndex]=!0,D[k.bucketInstanceId]===void 0&&(D[k.bucketInstanceId]=[]),D[k.bucketInstanceId].push(k.featureIndex))}return D}insertCollisionBox(o,l,_,v,w){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:w},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,l,_,v,w){const I=l?this.ignoredGrid:this.grid,C={bucketInstanceId:_,featureIndex:v,collisionGroupID:w};for(let P=0;P<o.length;P+=4)I.insertCircle(C,o[P],o[P+1],o[P+2])}projectAndGetPerspectiveRatio(o,l,_,v,w,I,C){const P=[l,_,v,1];let D=!1;v||this.transform.pitch>0?(s.e.transformMat4(P,P,o),this.fogState&&w&&C.name!=="globe"&&(D=function(B,U,q,X,Z,j){const J=j.calculateFogTileMatrix(Z),nt=[U,q,X];return s.v.transformMat4(nt,nt,J),Ks(B,s.v.length(nt),j.pitch,j._fov)}(this.fogState,l,_,v,w.toUnwrapped(),this.transform)>.9)):He(P,P,o);const z=P[3];return{point:new s.P((P[0]/z+1)/2*this.transform.width+jr,(-P[1]/z+1)/2*this.transform.height+jr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/z*.5,1.5),signedDistanceFromCamera:z,occluded:I&&P[2]>z||D}}isOffscreen(o,l,_,v){return _<jr||o>=this.screenRightBoundary||v<jr||l>this.screenBottomBoundary}isInsideGrid(o,l,_,v){return _>=0&&o<this.gridRightBoundary&&v>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const o=s.m.identity([]);return s.m.translate(o,o,[-100,-100,0]),o}}function gl(d,o,l){const _=o.createTileMatrix(d,d.worldSize,l.toUnwrapped());return s.m.multiply(new Float32Array(16),d.projMatrix,_)}function Vp(d,o,l){if(o.projection.name===l.projection.name)return d.projMatrix;const _=l.clone();return _.setProjection(o.projection),gl(_,o.getProjection(),d)}function _l(d,o,l){return o.name===l.projection.name?d.projMatrix:gl(l,o,d)}class uh{constructor(o,l,_,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?l:-l))):v&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class ou{constructor(o,l,_,v,w,I=!1){this.text=new uh(o?o.text:null,l,_,w),this.icon=new uh(o?o.icon:null,l,v,w),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class su{constructor(o,l,_,v=!1){this.text=o,this.icon=l,this.skipFade=_,this.clipped=v}}class Up{constructor(){this.invProjMatrix=s.m.create(),this.viewportMatrix=s.m.create(),this.circles=[]}}class ch{constructor(o,l,_,v,w){this.bucketInstanceId=o,this.featureIndex=l,this.sourceLayerIndex=_,this.bucketIndex=v,this.tileID=w}}class Gp{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const l=++this.maxGroupID;this.collisionGroups[o]={ID:l,predicate:_=>_.collisionGroupID===l}}return this.collisionGroups[o]}}function Zi(d,o,l,_,v){const{horizontalAlign:w,verticalAlign:I}=s.aY(d),C=-(w-.5)*o,P=-(I-.5)*l,D=s.aW(d,_);return new s.P(C+D[0]*v,P+D[1]*v)}function rn(d,o,l,_,v){const w=new s.P(d,o);return l&&w._rotate(_?v:-v),w}class jp{constructor(o,l,_,v,w,I){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new w_(this.transform,w),this.buildingIndex=I,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Gp(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,l,_,v){const w=_.getBucket(l),I=_.latestFeatureIndex;if(!w||!I||l.fqid!==w.layerIds[0])return;const C=w.layers[0].layout,P=_.collisionBoxArray,D=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),z=_.tileSize/s.J,k=_.tileID.toUnwrapped();this.transform.setProjection(w.projection);const B=(U=_.tileID,q=w.getProjection(),X=this.transform,q.name===this.projection?X.calculateProjMatrix(U.toUnwrapped()):gl(X,q,U));var U,q,X;const Z=C.get("text-pitch-alignment")==="map",j=C.get("text-rotation-alignment")==="map";l.compileFilter();const J=l.dynamicFilter(),nt=l.dynamicFilterNeedsFeature(),st=this.transform.calculatePixelsToTileUnitsMatrix(_),Y=Js(B,_.tileID.canonical,Z,j,this.transform,w.getProjection(),st);let K=null;if(Z){const ut=Ta(B,_.tileID.canonical,Z,j,this.transform,w.getProjection(),st);K=s.m.multiply([],this.transform.labelPlaneMatrix,ut)}let lt=null;J&&_.latestFeatureIndex&&(lt={unwrappedTileID:k,dynamicFilter:J,dynamicFilterNeedsFeature:nt,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new ch(w.bucketInstanceId,I,w.sourceLayerIndex,w.index,_.tileID);const ht={bucket:w,layout:C,posMatrix:B,textLabelPlaneMatrix:Y,labelToScreenMatrix:K,clippingData:lt,scale:D,textPixelRatio:z,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:s.i(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.i(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(v)for(const ut of w.sortKeyRanges){const{sortKey:pt,symbolInstanceStart:Dt,symbolInstanceEnd:wt}=ut;o.push({sortKey:pt,symbolInstanceStart:Dt,symbolInstanceEnd:wt,parameters:ht})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ht})}attemptAnchorPlacement(o,l,_,v,w,I,C,P,D,z,k,B,U,q,X,Z,j,J){const{textOffset0:nt,textOffset1:st,crossTileID:Y}=B,K=[nt,st],lt=Zi(o,_,v,K,w),ht=this.collisionIndex.placeCollisionBox(q,w,l,rn(lt.x,lt.y,I,C,this.transform.angle),k,P,D,z.predicate);if(Z){const ut=q.getSymbolInstanceIconSize(J,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,ut,Z,rn(lt.x,lt.y,I,C,this.transform.angle),k,P,D,z.predicate).box.length===0)return}if(ht.box.length>0){let ut;return this.prevPlacement&&this.prevPlacement.variableOffsets[Y]&&this.prevPlacement.placements[Y]&&this.prevPlacement.placements[Y].text&&(ut=this.prevPlacement.variableOffsets[Y].anchor),this.variableOffsets[Y]={textOffset:K,width:_,height:v,anchor:o,textScale:w,prevAnchor:ut},this.markUsedJustification(q,o,B,X),q.allowVerticalPlacement&&(this.markUsedOrientation(q,X,B),this.placedOrientations[Y]=X),{shift:lt,placedGlyphBoxes:ht}}}placeLayerBucketPart(o,l,_,v){const{bucket:w,layout:I,posMatrix:C,textLabelPlaneMatrix:P,labelToScreenMatrix:D,clippingData:z,textPixelRatio:k,holdingForFade:B,collisionBoxArray:U,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:X,collisionGroup:Z}=o.parameters,j=I.get("text-optional"),J=I.get("icon-optional"),nt=I.get("text-allow-overlap"),st=I.get("icon-allow-overlap"),Y=I.get("text-rotation-alignment")==="map",K=I.get("text-pitch-alignment")==="map",lt=I.get("symbol-z-order")==="viewport-y",ht=I.get("symbol-z-elevate");this.transform.setProjection(w.projection);let ut=nt&&(st||!w.hasIconData()||J),pt=st&&(nt||!w.hasTextData()||j);!w.collisionArrays&&U&&w.deserializeCollisionBoxes(U),_&&v&&w.updateCollisionDebugBuffers(this.transform.zoom,U);const Dt=(wt,St,mt)=>{const{crossTileID:Lt,numVerticalGlyphVertices:Tt}=wt;if(z){const Mr={zoom:this.transform.zoom,pitch:this.transform.pitch};let gr=null;if(z.dynamicFilterNeedsFeature){const xr=this.retainedQueryData[w.bucketInstanceId];gr=z.featureIndex.loadFeature({featureIndex:wt.featureIndex,bucketIndex:xr.bucketIndex,sourceLayerIndex:xr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Mr,gr,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.P(wt.tileAnchorX,wt.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Lt]=new su(!1,!1,!1,!0),void l.add(Lt)}if(l.has(Lt))return;if(B)return void(this.placements[Lt]=new su(!1,!1,!1));let zt=!1,tt=!1,yt=!0,Gt=!1,Ft=!1,ge=null,ce={box:null,offscreen:null,occluded:null},Se={box:null,offscreen:null,occluded:null},fe=null,Pe=null,Le=null,we=0,Ee=0,dr=0;mt.textFeatureIndex?we=mt.textFeatureIndex:wt.useRuntimeCollisionCircles&&(we=wt.featureIndex),mt.verticalTextFeatureIndex&&(Ee=mt.verticalTextFeatureIndex);const Xe=Mr=>{Mr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const gr=this.transform.elevation;Mr.elevation=wt.zOffset+(gr?gr.getAtTileOffset(Mr.tileID,Mr.tileAnchorX,Mr.tileAnchorY):0)},Zr=mt.textBox;if(Zr){Xe(Zr);const Mr=xr=>{let nn=s.W.horizontal;if(w.allowVerticalPlacement&&!xr&&this.prevPlacement){const ri=this.prevPlacement.placedOrientations[Lt];ri&&(this.placedOrientations[Lt]=ri,nn=ri,this.markUsedOrientation(w,nn,wt))}return nn},gr=(xr,nn)=>{if(w.allowVerticalPlacement&&Tt>0&&mt.verticalTextBox){for(const ri of w.writingModes)if(ri===s.W.vertical?(ce=nn(),Se=ce):ce=xr(),ce&&ce.box&&ce.box.length)break}else ce=xr()};if(I.get("text-variable-anchor")){let xr=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lt]){const Hr=this.prevPlacement.variableOffsets[Lt];xr.indexOf(Hr.anchor)>0&&(xr=xr.filter(Ei=>Ei!==Hr.anchor),xr.unshift(Hr.anchor))}const nn=(Hr,Ei,Hi)=>{const Ii=w.getSymbolInstanceTextSize(q,wt,this.transform.zoom,St),zo=(Hr.x2-Hr.x1)*Ii+2*Hr.padding,ra=(Hr.y2-Hr.y1)*Ii+2*Hr.padding,rs=wt.hasIconTextFit&&!st?Ei:null;rs&&Xe(rs);let Or={box:[],offscreen:!1,occluded:!1};const ns=nt?2*xr.length:xr.length;for(let Ts=0;Ts<ns;++Ts){const na=this.attemptAnchorPlacement(xr[Ts%xr.length],Hr,zo,ra,Ii,Y,K,k,C,Z,Ts>=xr.length,wt,St,w,Hi,rs,q,X);if(na&&(Or=na.placedGlyphBoxes,Or&&Or.box&&Or.box.length)){zt=!0,ge=na.shift;break}}return Or};gr(()=>nn(Zr,mt.iconBox,s.W.horizontal),()=>{const Hr=mt.verticalTextBox;return Hr&&Xe(Hr),w.allowVerticalPlacement&&!(ce&&ce.box&&ce.box.length)&&Tt>0&&Hr?nn(Hr,mt.verticalIconBox,s.W.vertical):{box:null,offscreen:null,occluded:null}}),ce&&(zt=ce.box,yt=ce.offscreen,Gt=ce.occluded);const ri=Mr(!(!ce||!ce.box));if(!zt&&this.prevPlacement){const Hr=this.prevPlacement.variableOffsets[Lt];Hr&&(this.variableOffsets[Lt]=Hr,this.markUsedJustification(w,Hr.anchor,wt,ri))}}else{const xr=(nn,ri)=>{const Hr=w.getSymbolInstanceTextSize(q,wt,this.transform.zoom,St),Ei=this.collisionIndex.placeCollisionBox(w,Hr,nn,new s.P(0,0),nt,k,C,Z.predicate);return Ei&&Ei.box&&Ei.box.length&&(this.markUsedOrientation(w,ri,wt),this.placedOrientations[Lt]=ri),Ei};gr(()=>xr(Zr,s.W.horizontal),()=>{const nn=mt.verticalTextBox;return w.allowVerticalPlacement&&Tt>0&&nn?(Xe(nn),xr(nn,s.W.vertical)):{box:null,offscreen:null,occluded:null}}),Mr(!!(ce&&ce.box&&ce.box.length))}}if(fe=ce,zt=fe&&fe.box&&fe.box.length>0,yt=fe&&fe.offscreen,Gt=fe&&fe.occluded,wt.useRuntimeCollisionCircles){const Mr=w.text.placedSymbolArray.get(wt.centerJustifiedTextSymbolIndex>=0?wt.centerJustifiedTextSymbolIndex:wt.verticalPlacedTextSymbolIndex),gr=s.j(w.textSizeData,q,Mr),xr=I.get("text-padding");Pe=this.collisionIndex.placeCollisionCircles(w,nt,Mr,w.lineVertexArray,w.glyphOffsetArray,gr,C,P,D,_,K,Z.predicate,wt.collisionCircleDiameter*gr/s.aV,xr,this.retainedQueryData[w.bucketInstanceId].tileID),zt=nt||Pe.circles.length>0&&!Pe.collisionDetected,yt=yt&&Pe.offscreen,Gt=Pe.occluded}if(mt.iconFeatureIndex&&(dr=mt.iconFeatureIndex),mt.iconBox){const Mr=gr=>{Xe(gr);const xr=wt.hasIconTextFit&&ge?rn(ge.x,ge.y,Y,K,this.transform.angle):new s.P(0,0),nn=w.getSymbolInstanceIconSize(X,this.transform.zoom,wt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,nn,gr,xr,st,k,C,Z.predicate)};Se&&Se.box&&Se.box.length&&mt.verticalIconBox?(Le=Mr(mt.verticalIconBox),tt=Le.box.length>0):(Le=Mr(mt.iconBox),tt=Le.box.length>0),yt=yt&&Le.offscreen,Ft=Le.occluded}const Dr=j||wt.numHorizontalGlyphVertices===0&&Tt===0,Wi=J||wt.numIconVertices===0;if(Dr||Wi?Wi?Dr||(tt=tt&&zt):zt=tt&&zt:tt=zt=tt&&zt,zt&&fe&&fe.box&&this.collisionIndex.insertCollisionBox(fe.box,I.get("text-ignore-placement"),w.bucketInstanceId,Se&&Se.box&&Ee?Ee:we,Z.ID),tt&&Le&&this.collisionIndex.insertCollisionBox(Le.box,I.get("icon-ignore-placement"),w.bucketInstanceId,dr,Z.ID),Pe&&(zt&&this.collisionIndex.insertCollisionCircles(Pe.circles,I.get("text-ignore-placement"),w.bucketInstanceId,we,Z.ID),_)){const Mr=w.bucketInstanceId;let gr=this.collisionCircleArrays[Mr];gr===void 0&&(gr=this.collisionCircleArrays[Mr]=new Up);for(let xr=0;xr<Pe.circles.length;xr+=4)gr.circles.push(Pe.circles[xr+0]),gr.circles.push(Pe.circles[xr+1]),gr.circles.push(Pe.circles[xr+2]),gr.circles.push(Pe.collisionDetected?1:0)}const Oo=w.projection.name!=="globe";ut=ut&&(Oo||!Gt),pt=pt&&(Oo||!Ft),this.placements[Lt]=new su(zt||ut,tt||pt,yt||w.justReloaded),l.add(Lt)};if(ht&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),lt){const wt=w.getSortedSymbolIndexes(this.transform.angle);for(let St=wt.length-1;St>=0;--St){const mt=wt[St];Dt(w.symbolInstances.get(mt),mt,w.collisionArrays[mt])}w.hasAnyZOffset&&s.X(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const wt=w.getSortedIndexesByZOffset();for(let St=0;St<wt.length;++St){const mt=wt[St];Dt(w.symbolInstances.get(mt),mt,w.collisionArrays[mt])}}else for(let wt=o.symbolInstanceStart;wt<o.symbolInstanceEnd;wt++)Dt(w.symbolInstances.get(wt),wt,w.collisionArrays[wt]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const wt=this.collisionCircleArrays[w.bucketInstanceId];s.m.invert(wt.invProjMatrix,C),wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(o,l,_,v){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:P,crossTileID:D}=_,z=s.aX(l),k=v===s.W.vertical?P:z==="left"?w:z==="center"?I:z==="right"?C:-1;w>=0&&(o.text.placedSymbolArray.get(w).crossTileID=k>=0&&w!==k?0:D),I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=k>=0&&I!==k?0:D),C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=k>=0&&C!==k?0:D),P>=0&&(o.text.placedSymbolArray.get(P).crossTileID=k>=0&&P!==k?0:D)}markUsedOrientation(o,l,_){const v=l===s.W.horizontal||l===s.W.horizontalOnly?l:0,w=l===s.W.vertical?l:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:D}=_,z=o.text.placedSymbolArray;I>=0&&(z.get(I).placedOrientation=v),C>=0&&(z.get(C).placedOrientation=v),P>=0&&(z.get(P).placedOrientation=v),D>=0&&(z.get(D).placedOrientation=w)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let _=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const v=l?l.symbolFadeChange(o):1,w=l?l.opacities:{},I=l?l.variableOffsets:{},C=l?l.placedOrientations:{};for(const P in this.placements){const D=this.placements[P],z=w[P];z?(this.opacities[P]=new ou(z,v,D.text,D.icon,null,D.clipped),_=_||D.text!==z.text.placed||D.icon!==z.icon.placed):(this.opacities[P]=new ou(null,v,D.text,D.icon,D.skipFade,D.clipped),_=_||D.text||D.icon)}for(const P in w){const D=w[P];if(!this.opacities[P]){const z=new ou(D,v,!1,!1);z.isHidden()||(this.opacities[P]=z,_=_||D.text.placed||D.icon.placed)}}for(const P in I)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=I[P]);for(const P in C)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=C[P]);_?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:o)}updateLayerOpacities(o,l){const _=new Set;for(const v of l){const w=v.getBucket(o);w&&v.latestFeatureIndex&&o.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,_,v.collisionBoxArray),w.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,v.tileID),w.updateZOffset()))}}updateBucketOpacities(o,l,_){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const v=o.layers[0].layout,w=!!o.layers[0].dynamicFilter(),I=new ou(null,0,!1,!1,!0),C=v.get("text-allow-overlap"),P=v.get("icon-allow-overlap"),D=v.get("text-variable-anchor"),z=v.get("text-rotation-alignment")==="map",k=v.get("text-pitch-alignment")==="map",B=new ou(null,0,C&&(P||!o.hasIconData()||v.get("icon-optional")),P&&(C||!o.hasTextData()||v.get("text-optional")),!0);!o.collisionArrays&&_&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(_);const U=(X,Z,j)=>{for(let J=0;J<Z/4;J++)X.opacityVertexArray.emplaceBack(j)};let q=0;for(let X=0;X<o.symbolInstances.length;X++){const Z=o.symbolInstances.get(X),{numHorizontalGlyphVertices:j,numVerticalGlyphVertices:J,crossTileID:nt,numIconVertices:st}=Z,Y=l.has(nt);let K=this.opacities[nt];Y?K=I:K||(K=B,this.opacities[nt]=K),l.add(nt);const lt=j>0||J>0,ht=st>0,ut=this.placedOrientations[nt],pt=ut===s.W.vertical,Dt=ut===s.W.horizontal||ut===s.W.horizontalOnly;if(!lt&&!ht||K.isHidden()||q++,lt){const wt=lu(K.text);U(o.text,j,pt?Rn:wt),U(o.text,J,Dt?Rn:wt);const St=K.text.isHidden(),{leftJustifiedTextSymbolIndex:mt,centerJustifiedTextSymbolIndex:Lt,rightJustifiedTextSymbolIndex:Tt,verticalPlacedTextSymbolIndex:zt}=Z,tt=o.text.placedSymbolArray,yt=St||pt?1:0;mt>=0&&(tt.get(mt).hidden=yt),Lt>=0&&(tt.get(Lt).hidden=yt),Tt>=0&&(tt.get(Tt).hidden=yt),zt>=0&&(tt.get(zt).hidden=St||Dt?1:0);const Gt=this.variableOffsets[nt];Gt&&this.markUsedJustification(o,Gt.anchor,Z,ut);const Ft=this.placedOrientations[nt];Ft&&(this.markUsedJustification(o,"left",Z,Ft),this.markUsedOrientation(o,Ft,Z))}if(ht){const wt=lu(K.icon),{placedIconSymbolIndex:St,verticalPlacedIconSymbolIndex:mt}=Z,Lt=o.icon.placedSymbolArray,Tt=K.icon.isHidden()?1:0;St>=0&&(U(o.icon,st,pt?Rn:wt),Lt.get(St).hidden=Tt),mt>=0&&(U(o.icon,Z.numVerticalIconVertices,Dt?Rn:wt),Lt.get(mt).hidden=Tt)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const wt=o.collisionArrays[X];if(wt){let St=new s.P(0,0),mt=!0;if(wt.textBox||wt.verticalTextBox){if(D){const Tt=this.variableOffsets[nt];Tt?(St=Zi(Tt.anchor,Tt.width,Tt.height,Tt.textOffset,Tt.textScale),z&&St._rotate(k?this.transform.angle:-this.transform.angle)):mt=!1}w&&(mt=!K.clipped),wt.textBox&&yl(o.textCollisionBox.collisionVertexArray,K.text.placed,!mt||pt,St.x,St.y),wt.verticalTextBox&&yl(o.textCollisionBox.collisionVertexArray,K.text.placed,!mt||Dt,St.x,St.y)}const Lt=mt&&!!(!Dt&&wt.verticalIconBox);wt.iconBox&&yl(o.iconCollisionBox.collisionVertexArray,K.icon.placed,Lt,Z.hasIconTextFit?St.x:0,Z.hasIconTextFit?St.y:0),wt.verticalIconBox&&yl(o.iconCollisionBox.collisionVertexArray,K.icon.placed,!Lt,Z.hasIconTextFit?St.x:0,Z.hasIconTextFit?St.y:0)}}}if(o.fullyClipped=q===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=X.invProjMatrix,o.placementViewportMatrix=X.viewportMatrix,o.collisionCircleArray=X.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,l){const _=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*_>o}setStale(){this.stale=!0}}function yl(d,o,l,_,v){d.emplaceBack(o?1:0,l?1:0,_||0,v||0),d.emplaceBack(o?1:0,l?1:0,_||0,v||0),d.emplaceBack(o?1:0,l?1:0,_||0,v||0),d.emplaceBack(o?1:0,l?1:0,_||0,v||0)}const Xi=Math.pow(2,25),Lo=Math.pow(2,24),Xd=Math.pow(2,17),au=Math.pow(2,16),Zn=Math.pow(2,9),Ju=Math.pow(2,8),qp=Math.pow(2,1);function lu(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const o=d.placed?1:0,l=Math.floor(127*d.opacity);return l*Xi+o*Lo+l*Xd+o*au+l*Zn+o*Ju+l*qp+o}const Rn=0;class Zp{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,l,_,v,w){const I=this._bucketParts;for(;this._currentTileIndex<o.length;)if(l.getBucketParts(I,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((C,P)=>C.sortKey-P.sortKey));this._currentPartIndex<I.length;){const C=I[this._currentPartIndex];if(l.placeLayerBucketPart(C,this._seenCrossTileIDs,_,C.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class Xp{constructor(o,l,_,v,w,I,C,P,D){this.placement=new jp(o,w,I,C,P,D),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,l,_,v){const w=s.a4.now(),I=()=>{const C=s.a4.now()-w;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=l[o[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=P)&&(!C.maxzoom||C.maxzoom>P)){const D=C,z=D.layout.get("symbol-z-elevate"),k=this._inProgressLayer=this._inProgressLayer||new Zp(D),B=s.aE(C.source,C.scope);if(k.continuePlacement(z?v[B]:_[B],this.placement,this._showCollisionBoxes,C,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Ko=512/s.J/2;class Ku{constructor(o,l,_){this.tileID=o,this.bucketInstanceId=_,this.index=new s.aZ(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=o.canonical.x*s.J,w=o.canonical.y*s.J;for(let I=0;I<l.length;I++){const{key:C,crossTileID:P,tileAnchorX:D,tileAnchorY:z}=l.get(I),k=Math.floor((v+D)*Ko),B=Math.floor((w+z)*Ko);this.index.add(k,B),this.keys.push(C),this.crossTileIDs.push(P)}this.index.finish()}findMatches(o,l,_){const v=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),w=Ko/Math.pow(2,l.canonical.z-this.tileID.canonical.z),I=l.canonical.x*s.J,C=l.canonical.y*s.J;for(let P=0;P<o.length;P++){const D=o.get(P);if(D.crossTileID)continue;const{key:z,tileAnchorX:k,tileAnchorY:B}=D,U=Math.floor((I+k)*w),q=Math.floor((C+B)*w),X=this.index.range(U-v,q-v,U+v,q+v);for(const Z of X){const j=this.crossTileIDs[Z];if(this.keys[Z]===z&&!_.has(j)){_.add(j),D.crossTileID=j;break}}}}}class Qu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Er{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const l=Math.round((o-this.lng)/360);if(l!==0)for(const _ in this.indexes){const v=this.indexes[_],w={};for(const I in v){const C=v[I];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+l),w[C.tileID.key]=C}this.indexes[_]=w}this.lng=o}addBucket(o,l,_){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let w=0;w<l.symbolInstances.length;w++)l.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const v=this.usedCrossTileIDs[o.overscaledZ];for(const w in this.indexes){const I=this.indexes[w];if(Number(w)>o.overscaledZ)for(const C in I){const P=I[C];P.tileID.isChildOf(o)&&P.findMatches(l.symbolInstances,o,v)}else{const C=I[o.scaledTo(Number(w)).key];C&&C.findMatches(l.symbolInstances,o,v)}}for(let w=0;w<l.symbolInstances.length;w++){const I=l.symbolInstances.get(w);I.crossTileID||(I.crossTileID=_.generate(),v.add(I.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Ku(o,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(o,l){for(const _ of l.crossTileIDs)this.usedCrossTileIDs[o].delete(_)}removeStaleBuckets(o){let l=!1;for(const _ in this.indexes){const v=this.indexes[_];for(const w in v)o[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,v[w]),delete v[w],l=!0)}return l}}class E_{constructor(){this.layerIndexes={},this.crossTileIDs=new Qu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,l,_,v){let w=this.layerIndexes[o.fqid];w===void 0&&(w=this.layerIndexes[o.fqid]=new Er);let I=!1;const C={};v.name!=="globe"&&w.handleWrapJump(_);for(const P of l){const D=P.getBucket(o);D&&o.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(P.tileID,D,this.crossTileIDs)&&(I=!0),C[D.bucketInstanceId]=!0)}return w.removeStaleBuckets(C)&&(I=!0),I}pruneUnusedLayers(o){const l={};o.forEach(_=>{l[_]=!0});for(const _ in this.layerIndexes)l[_]||delete this.layerIndexes[_]}}var hh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Ca=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Wd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Wp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ma=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Hd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qo=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,tc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Hp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Yd=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ph=[];ta(hh,ph),ta(Wd,ph),ta(Ca,ph);const Aa={"_prelude_fog.vertex.glsl":Hd,"_prelude_terrain.vertex.glsl":Ma,"_prelude_shadow.vertex.glsl":Hp,"_prelude_fog.fragment.glsl":Qo,"_prelude_shadow.fragment.glsl":Yd,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":tc},Pa={};ar("",Ma),ar(Qo,Hd),ar(Yd,Hp),ar(tc,"");const $d=ar(Ca,Wd),vl=hh;var Yp={background:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ar("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ar(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ar(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ar("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ar("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ar("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ar(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ar(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ar(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ar(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:ar(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:ar(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:ar(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:ar("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ar(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wp),skyboxGradient:ar(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wp),skyboxCapture:ar(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ar(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ar(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ar(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ar(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function ta(d,o){const l=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of l)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=_.split(" ");for(const w of v)o.includes(w)||o.push(w)}}function ar(d,o){const l=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(D=>{const z=D.split(" ");return z[z.length-1]}),v=[...new Set(v)]);const w={},I=[],C=[];if(d=d.replace(l,(D,z)=>(C.push(z),"")),(o=o.replace(l,(D,z)=>(I.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...ph];ta(d,P),ta(o,P);for(const D of[...I,...C])Aa[D]||console.error(`Undefined include: ${D}`),Pa[D]||(Pa[D]=[],ta(Aa[D],Pa[D])),P=[...P,...Pa[D]];return{fragmentSource:d=d.replace(_,(D,z,k,B,U)=>(w[U]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${k} ${B} ${U};
#else
uniform ${k} ${B} u_${U};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${U}
    ${k} ${B} ${U} = u_${U};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${k} ${B} ${U};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(_,(D,z,k,B,U)=>{const q=B==="float"?"vec2":B,X=U.match(/color/)?"color":q;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${U}
in ${k} ${B} a_${U};
#endif
`:w[U]?z==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${k} ${q} a_${U};
out ${k} ${B} ${U};
#else
uniform ${k} ${B} u_${U};
#endif
`:z==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${k} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${X}(a_${U}, u_${U}_t);
#else
    ${k} ${B} ${U} = u_${U};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${k} ${B} a_${U};
    out ${k} ${B} ${U};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${U} = a_${U};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${k} ${q} a_${U};
#else
uniform ${k} ${B} u_${U};
#endif
`:z==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${U}0;
in vec4 a_${U}1;
in vec4 a_${U}2;
in vec4 a_${U}3;
#else
uniform ${k} ${B} u_${U};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${q} a_${U};
#else
uniform ${k} ${B} u_${U};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${k} ${B} ${U} = a_${U};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${k} ${B} ${U} = a_${U};
#else
    ${k} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${k} ${B} ${U} = unpack_mix_${X}(a_${U}, u_${U}_t);
#else
    ${k} ${B} ${U} = u_${U};
#endif
`}),staticAttributes:v,usedDefines:P,vertexIncludes:I,fragmentIncludes:C}}class I_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,l,_,v,w,I,C,P){this.context=o;let D=this.boundPaintVertexBuffers.length!==v.length;for(let k=0;!D&&k<v.length;k++)this.boundPaintVertexBuffers[k]!==v[k]&&(D=!0);let z=this.boundDynamicVertexBuffers.length!==C.length;for(let k=0;!z&&k<C.length;k++)this.boundDynamicVertexBuffers[k]!==C[k]&&(z=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==_||D||z||this.boundIndexBuffer!==w||this.boundVertexOffset!==I)this.freshBind(l,_,v,w,I,C,P);else{o.bindVertexArrayOES.set(this.vao);for(const k of C)k&&(k.bind(),P&&k.instanceCount&&k.setVertexAttribDivisor(o.gl,l,P));w&&w.dynamicDraw&&w.bind()}}freshBind(o,l,_,v,w,I,C){const P=o.numAttributes,D=this.context,z=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=I,l.enableAttributes(z,o),l.bind(),l.setVertexAttribPointers(z,o,w);for(const k of _)k.enableAttributes(z,o),k.bind(),k.setVertexAttribPointers(z,o,w);for(const k of I)k&&(k.enableAttributes(z,o),k.bind(),k.setVertexAttribPointers(z,o,w),C&&k.instanceCount&&k.setVertexAttribDivisor(z,o,C));v&&v.bind(),D.currentNumAttributes=P}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function T_(d,o){const l=Math.pow(2,o.canonical.z),_=o.canonical.y;return[new s.M(0,_/l).toLngLat().lat,new s.M(0,(_+1)/l).toLngLat().lat]}function S_(d,o,l,_,v,w,I){const C=d.context,P=C.gl,D=l.hillshadeFBO;if(!D)return;d.prepareDrawTile();const z=d.isTileAffectedByFog(o),k=d.getOrCreateProgram("hillshade",{overrideFog:z});C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,D.colorAttachment.get());const B=((Z,j,J,nt)=>{const st=J.paint.get("hillshade-shadow-color"),Y=J.paint.get("hillshade-highlight-color"),K=J.paint.get("hillshade-accent-color"),lt=J.paint.get("hillshade-emissive-strength");let ht=s.d(J.paint.get("hillshade-illumination-direction"));if(J.paint.get("hillshade-illumination-anchor")==="viewport")ht-=Z.transform.angle;else if(Z.style&&Z.style.enable3dLights()&&Z.style.directionalLight){const pt=Z.style.directionalLight.properties.get("direction"),Dt=s.b3(pt.x,pt.y,pt.z);ht=s.d(Dt[1])}const ut=!Z.options.moving;return{u_matrix:nt||Z.transform.calculateProjMatrix(j.tileID.toUnwrapped(),ut),u_image:0,u_latrange:T_(0,j.tileID),u_light:[J.paint.get("hillshade-exaggeration"),ht],u_shadow:st,u_highlight:Y,u_emissive_strength:lt,u_accent:K}})(d,l,_,d.terrain?o.projMatrix:null);d.uploadCommonUniforms(C,k,o.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:q,tileBoundsSegments:X}=d.getTileBoundsBuffers(l);k.draw(d,P.TRIANGLES,v,w,I,s.b5.disabled,B,_.id,U,q,X)}function $p(d,o,l){if(!o.needsDEMTextureUpload)return;const _=d.context,v=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||d.getTileTexture(l.stride);const w=l.getPixels();o.demTexture?o.demTexture.update(w,{premultiply:!1}):o.demTexture=new s.a9(_,w,v.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function C_(d,o,l){const _=d.context,v=_.gl;if(!o.dem)return;const w=o.dem;if(_.activeTexture.set(v.TEXTURE1),$p(d,o,w),!o.demTexture)return;o.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const I=w.dim;_.activeTexture.set(v.TEXTURE0);let C=o.hillshadeFBO;if(!C){const B=new s.a9(_,{width:I,height:I,data:null},v.RGBA);B.bind(v.LINEAR,v.CLAMP_TO_EDGE),C=o.hillshadeFBO=_.createFramebuffer(I,I,!0,"renderbuffer"),C.colorAttachment.set(B.texture)}_.bindFramebuffer.set(C.framebuffer),_.viewport.set([0,0,I,I]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:D,tileBoundsSegments:z}=d.getMercatorTileBoundsBuffers(),k=[];d.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(d,v.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.disabled,((B,U)=>{const q=U.stride,X=s.m.create();return s.m.ortho(X,0,s.J,-s.J,0,0,1),s.m.translate(X,X,[0,-s.J,0]),{u_matrix:X,u_image:1,u_dimension:[q,q],u_zoom:B.overscaledZ}})(o.tileID,w),l.id,P,D,z),o.needsHillshadePrepare=!1}const fh=d=>({u_matrix:new s.a_(d),u_image0:new s.a$(d),u_skirt_height:new s.b2(d),u_ground_shadow_factor:new s.b7(d)}),Jp=(d,o,l)=>({u_matrix:d,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:l}),Kp=(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:l,u_zoom_transition:v,u_merc_center:w,u_image0:0,u_frustum_tl:I,u_frustum_tr:C,u_frustum_br:P,u_frustum_bl:D,u_globe_pos:z,u_globe_radius:k,u_viewport:B,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:U}),xl=(d,o)=>{if(o>0&&d.terrain&&s.X("Cutoff is currently disabled on terrain"),o<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=d.transform,_=Math.max(Math.abs(l._zoom-(d.minCutoffZoom-1)),1),v=l.isLODDisabled(!1)?s.an(60,45,l.pitch):s.an(30,15,l.pitch),w=l._farZ-l._nearZ,I=o*l.height,C=((1-(P=v))*l.cameraToCenterDistance+P*(l._farZ+I))*_;var P;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(C-l._nearZ)/w,(C-I-l._nearZ)/w]}}};function Qp(d,o){return d!=null&&o!=null&&!(!d.hasData()||!o.hasData())&&d.demTexture!=null&&o.demTexture!=null&&d.tileID.key!==o.tileID.key}const ws=new class{constructor(){this.operations={}}newMorphing(d,o,l,_,v){if(d in this.operations){const w=this.operations[d];w.to.tileID.key!==l.tileID.key&&(w.queued=l)}else this.operations[d]={startTime:_,phase:0,duration:v,from:o,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const o=this.operations[d];return{from:o.from,to:o.to,phase:o.phase}}update(d){for(const o in this.operations){const l=this.operations[o];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[o];break}}}_nextOp(d,o){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=o,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},dh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function tf(d,o,l){if(o===0)return 0;const _=o<1&&l===514?.25/o:1;return 6*Math.pow(1.5,22-d)*Math.max(o,1)*_}function ef(d,o){const l=1<<d.z;return!o&&(d.x===0||d.x===l-1)||d.y===0||d.y===l-1}const mh=d=>({u_matrix:d});function gh(d,o,l,_,v){if(v>0){const w=s.a4.now(),I=(w-d.timeAdded)/v,C=o?(w-o.timeAdded)/v:-1,P=l.getSource(),D=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),z=!o||Math.abs(o.tileID.overscaledZ-D)>Math.abs(d.tileID.overscaledZ-D),k=z&&d.refreshedUponExpiration?1:s.c(z?I:1-C,0,1);return d.refreshedUponExpiration&&I>=1&&(d.refreshedUponExpiration=!1),o?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class ee extends s.bq{constructor(o){const l={type:"raster-dem",maxzoom:o.transform.maxZoom},_=new s.br(s.bs(),null),v=$o("mock-dem",l,_,o.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,l){o.state="loaded",l(null)}}class Jd extends s.bq{constructor(o){const l=$o("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new s.br(s.bs(),null),o.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,l,_){if(o.freezeTileCoverage)return;this.transform=o;const v=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,I)=>{if(w[I.key]="",!this._tiles[I.key]){const C=new s.bt(I,this._source.tileSize*I.overscaleFactor(),o.tileZoom);C.state="loaded",this._tiles[I.key]=C}return w},{});for(const w in this._tiles)w in v||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(o){const l=this.proxyCachedFBO[o];if(l!==void 0){const _=Object.values(l);this.renderCachePool.push(..._),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _h extends s.O{constructor(o,l,_){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=l,this.projMatrix=_}}class rf extends s.bk{constructor(o,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,v,w]=function(P){const D=new s.bo,z=new s.bp,k=131;D.reserve(17161),z.reserve(33800);const B=s.J/128,U=s.J+B/2,q=U+B;for(let Z=-B;Z<q;Z+=B)for(let j=-B;j<q;j+=B){const J=j<0||j>U||Z<0||Z>U?24575:0,nt=s.c(Math.round(j),0,s.J),st=s.c(Math.round(Z),0,s.J);D.emplaceBack(nt+J,st)}const X=(Z,j)=>{const J=j*k+Z;z.emplaceBack(J+1,J,J+k),z.emplaceBack(J+k,J+k+1,J+1)};for(let Z=1;Z<129;Z++)for(let j=1;j<129;j++)X(j,Z);return[0,129].forEach(Z=>{for(let j=0;j<130;j++)X(j,Z),X(Z,j)}),[D,z,32768]}(),I=o.context;this.gridBuffer=I.createVertexBuffer(_,s.bl.members),this.gridIndexBuffer=I.createIndexBuffer(v),this.gridSegments=s.bm.simpleSegment(0,0,_.length,v.length),this.gridNoSkirtSegments=s.bm.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Jd(l.map),this.orthoMatrix=s.m.create(),s.m.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.J,0,s.J,0,1);const C=I.gl;this._overlapStencilMode=new s.b6({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ee(l.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,l,_){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const v=o.terrain.properties,w=o.terrain.drapeRenderMode===0,I=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.a4.now();const C=o.terrain&&o.terrain.scope,P=v.get("source"),D=w?this._mockSourceCache:o.getSourceCache(P,C);if(!D)return void s.X(`Couldn't find terrain source "${P}".`);if(this.sourceCache=D,this._exaggeration=I?this.calculateExaggeration(l):v.get("exaggeration"),!l.projection.requiresDraping&&I&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&s.X(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(l,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),l.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(o){const l=this._previousCameraAltitude,_=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=_;const v=l!=null?_-l:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const w=o.zoom,I=this._style.terrain;if(!this._previousUpdateTimestamp)return I.getExaggeration(w);let C=w-this._previousZoom;const P=this._previousUpdateTimestamp;let D=w;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(w-D)>.5&&(C=.5*(w-D+C)),C*v<0&&(D+=C)),this._evaluationZoom=D;const z=I.getExaggeration(D),k=z===I.getExaggeration(Math.max(0,D-.1));if(k&&Math.abs(z-this._exaggeration)<.01)return z;let B=Math.min(.1,.00375*(this._updateTimestamp-P));return(k||z<.1||Math.abs(C)<1e-4)&&(B=Math.min(.2,4*B)),s.n(this._exaggeration,z,B)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(s.M.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=l.getIds().map(P=>{const D=l.getTileByID(P).tileID;return D.projMatrix=_.calculateProjMatrix(D.toUnwrapped()),D});(function(P,D){const z=D.transform.pointCoordinate(D.transform.getCameraPoint()),k=new s.P(z.x,z.y);P.sort((B,U)=>{if(U.overscaledZ-B.overscaledZ)return U.overscaledZ-B.overscaledZ;const q=new s.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),X=new s.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Z=k.mult(1<<B.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(q)-Z.distSqr(X)})})(v,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},v.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const I=this._style._mergedSourceCaches;for(const P in I){const D=I[P];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,o[P],w),D.usedForTerrain))continue;const z=o[P];D.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[l.id]=v.map(P=>new _h(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const D=this.terrainTileForTile[P.key];if(!D)continue;const z=D.tileID.key;z in C||(this._visibleDemTiles.push(D),C[z]=z)}}_assignTerrainTiles(o){this._initializing||o.forEach(l=>{if(this.terrainTileForTile[l.key])return;const _=this._findTileCoveringTileID(l,this.sourceCache);_&&(this.terrainTileForTile[l.key]=_)})}_prepareDEMTextures(){const o=this.painter.context,l=o.gl;for(const _ in this.terrainTileForTile){const v=this.terrainTileForTile[_],w=v.dem;!w||v.demTexture&&!v.needsDEMTextureUpload||(o.activeTexture.set(l.TEXTURE1),$p(this.painter,v,w))}}_prepareDemTileUniforms(o,l,_,v){if(!l||l.demTexture==null)return!1;const w=o.tileID.canonical,I=Math.pow(2,l.tileID.canonical.z-w.z),C=v||"";return _[`u_dem_tl${C}`]=[w.x*I%1,w.y*I%1],_[`u_dem_scale${C}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,l=o.gl;if(!this._emptyDepthBufferTexture){const _=new s.a5({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.a9(o,_,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const l=this._visibleDemTiles.reduce((_,v)=>{if(!v.dem)return _;const w=v.dem.tree.minimums[0];return w>0&&o++,_+w},0);return o?l/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,l=o.gl;o.activeTexture.set(l.TEXTURE2);const _=this._getLoadedAreaMinimum(),[v,w]=(()=>{const C=new s.bu({width:1,height:1},new Float32Array([_]));return[l.R32F,C]})();this._emptyDEMTextureDirty=!1;let I=this._emptyDEMTexture;return I?I.update(w,{premultiply:!1}):I=this._emptyDEMTexture=new s.a9(o,w,v,{premultiply:!1}),I}setupElevationDraw(o,l,_){const v=this.painter.context,w=v.gl,I={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};I.u_exaggeration=this.exaggeration();let C=null,P=null,D=1;if(_&&_.morphing&&this._useVertexMorphing){const B=_.morphing.srcDemTile,U=_.morphing.dstDemTile;D=_.morphing.phase,B&&U&&(this._prepareDemTileUniforms(o,B,I,"_prev")&&(P=B),this._prepareDemTileUniforms(o,U,I)&&(C=U))}const z=B=>B&&B.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST,k=B=>{I.u_dem_size=B.size[0]===1?1:B.size[0]-2};if(P&&C)v.activeTexture.set(w.TEXTURE2),C.demTexture.bind(z(C),w.CLAMP_TO_EDGE),v.activeTexture.set(w.TEXTURE4),P.demTexture.bind(z(P),w.CLAMP_TO_EDGE),C.demTexture&&k(C.demTexture),I.u_dem_lerp=D;else{C=this.terrainTileForTile[o.tileID.key],v.activeTexture.set(w.TEXTURE2);const B=this._prepareDemTileUniforms(o,C,I)?C.demTexture:this.emptyDEMTexture;B.bind(z(C),w.CLAMP_TO_EDGE),k(B)}if(v.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&C){const B=(1<<C.tileID.canonical.z)*s.b(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=B}if(_&&_.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),l.setTerrainUniformValues(v,I),this.painter.transform.projection.name==="globe"){const B=this.globeUniformValues(this.painter.transform,o.tileID.canonical,_&&_.useDenormalizedUpVectorScale);l.setGlobeUniformValues(v,B)}}globeUniformValues(o,l,_){const v=o.projection;return{u_tile_tl_up:v.upVector(l,0,0),u_tile_tr_up:v.upVector(l,s.J,0),u_tile_br_up:v.upVector(l,s.J,s.J),u_tile_bl_up:v.upVector(l,0,s.J),u_tile_up_scale:_?s.bn(1):v.upVectorScale(l,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const l=this.painter,_=this.painter.context;o.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,w,I,C,P){if(v.transform.projection.name==="globe")(function(D,z,k,B,U){const q=D.context,X=q.gl;let Z,j;const J=D.transform,nt=s.bb(D,q,J),st=(St,mt)=>{if(j===mt)return;const Lt=[dh[mt],"PROJECTION_GLOBE_VIEW"];nt&&Lt.push("CUSTOM_ANTIALIASING");const Tt=D.isTileAffectedByFog(St);Z=D.getOrCreateProgram("globeRaster",{defines:Lt,overrideFog:Tt}),j=mt},Y=D.colorModeForRenderPass(),K=new s.b4(X.LEQUAL,s.b4.ReadWrite,D.depthRangeFor3D);ws.update(U);const lt=s.bc(J),ht=[s.E(J.center.lng),s.H(J.center.lat)],ut=D.globeSharedBuffers,pt=[J.width*s.a4.devicePixelRatio,J.height*s.a4.devicePixelRatio],Dt=Float32Array.from(J.globeMatrix),wt={useDenormalizedUpVectorScale:!0};{const St=D.transform,mt=tf(St.zoom,z.exaggeration(),z.sourceCache._source.tileSize);j=-1;const Lt=X.TRIANGLES;for(const Tt of B){const zt=k.getTile(Tt),tt=s.b6.disabled,yt=z.prevTerrainTileForTile[Tt.key],Gt=z.terrainTileForTile[Tt.key];Qp(yt,Gt)&&ws.newMorphing(Tt.key,yt,Gt,U,250),q.activeTexture.set(X.TEXTURE0),zt.texture&&zt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Ft=ws.getMorphValuesForProxy(Tt.key),ge=Ft?1:0;Ft&&s.bd(wt,{morphing:{srcDemTile:Ft.from,dstDemTile:Ft.to,phase:s.ba(Ft.phase)}});const ce=s.be(Tt.canonical),Se=s.bf(ce.getCenter().lat),fe=s.bg(Tt.canonical,ce,Se,St.worldSize/St._pixelsPerMercatorPixel),Pe=s.bh(s.bi(Tt.canonical)),Le=Kp(St.expandedFarZProjMatrix,Dt,lt,Pe,s.ao(St.zoom),ht,St.frustumCorners.TL,St.frustumCorners.TR,St.frustumCorners.BR,St.frustumCorners.BL,St.globeCenterInViewSpace,St.globeRadius,pt,mt,fe);if(st(Tt,ge),Z&&(z.setupElevationDraw(zt,Z,wt),D.uploadCommonUniforms(q,Z,Tt.toUnwrapped()),ut)){const[we,Ee,dr]=ut.getGridBuffers(Se,mt!==0);Z.draw(D,Lt,K,tt,Y,s.b5.backCCW,Le,"globe_raster",we,Ee,dr)}}}if(ut&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const St=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];nt&&St.push("CUSTOM_ANTIALIASING"),Z=D.getOrCreateProgram("globeRaster",{defines:St});for(const mt of B){const{x:Lt,y:Tt,z:zt}=mt.canonical,tt=Tt===0,yt=Tt===(1<<zt)-1,[Gt,Ft,ge,ce]=ut.getPoleBuffers(zt,!1);if(ce&&(tt||yt)){const Se=k.getTile(mt);q.activeTexture.set(X.TEXTURE0),Se.texture&&Se.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let fe=s.bj(zt,Lt,J);const Pe=s.bh(s.bi(mt.canonical)),Le=(we,Ee)=>we.draw(D,X.TRIANGLES,K,s.b6.disabled,Y,s.b5.disabled,Kp(J.expandedFarZProjMatrix,fe,fe,Pe,0,ht,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,pt,0),"globe_pole_raster",Ee,ge,ce);z.setupElevationDraw(Se,Z,wt),D.uploadCommonUniforms(q,Z,mt.toUnwrapped()),tt&&D.renderDefaultNorthPole&&Le(Z,Gt),yt&&D.renderDefaultSouthPole&&(fe=s.m.scale(s.m.create(),fe,[1,-1,1]),Le(Z,Ft))}}}})(v,w,I,C,P);else{const D=v.context,z=D.gl;let k,B;const U=v.shadowRenderer,q=xl(v,v.longestCutoffRange),X=Y=>{if(B===Y)return;const K=[];K.push(dh[Y]),q.shouldRenderCutoff&&K.push("RENDER_CUTOFF"),k=v.getOrCreateProgram("terrainRaster",{defines:K}),B=Y},Z=v.colorModeForRenderPass(),j=new s.b4(z.LEQUAL,s.b4.ReadWrite,v.depthRangeFor3D);ws.update(P);const J=v.transform,nt=tf(J.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let st=[0,0,0];if(U){const Y=v.style.directionalLight,K=v.style.ambientLight;Y&&K&&(st=Ph(Y,K))}{B=-1;const Y=z.TRIANGLES,[K,lt]=[w.gridIndexBuffer,w.gridSegments];for(const ht of C){const ut=I.getTile(ht),pt=s.b6.disabled,Dt=w.prevTerrainTileForTile[ht.key],wt=w.terrainTileForTile[ht.key];Qp(Dt,wt)&&ws.newMorphing(ht.key,Dt,wt,P,250),D.activeTexture.set(z.TEXTURE0),ut.texture&&ut.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const St=ws.getMorphValuesForProxy(ht.key),mt=St?1:0;let Lt;St&&(Lt={morphing:{srcDemTile:St.from,dstDemTile:St.to,phase:s.ba(St.phase)}});const Tt=Jp(ht.projMatrix,ef(ht.canonical,J.renderWorldCopies)?nt/10:nt,st);if(X(mt),!k)continue;w.setupElevationDraw(ut,k,Lt);const zt=ht.toUnwrapped();U&&U.setupShadows(zt,k),v.uploadCommonUniforms(D,k,zt,null,q),k.draw(v,Y,j,pt,Z,s.b5.backCCW,Tt,"terrain_raster",w.gridBuffer,K,lt)}}}}(l,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const l=this.painter,_=this.painter.context,v=this.proxySourceCache,w=this.proxiedCoords[v.id],I=this._drapedRenderBatches.shift(),C=l.style.order,P=[];let D=0;for(const z of w){const k=v.getTileByID(z.proxyTileKey),B=v.proxyCachedFBO[z.key]?v.proxyCachedFBO[z.key][o]:void 0,U=B!==void 0?v.renderCache[B]:this.pool[D++],q=B!==void 0;if(k.texture=U.tex,q&&!U.dirty){P.push(k.tileID);continue}let X;_.bindFramebuffer.set(U.fb.framebuffer),this.renderedToTile=!1,U.dirty&&(_.clear({color:s.C.transparent,stencil:0}),U.dirty=!1);for(let Z=I.start;Z<=I.end;++Z){const j=l.style._mergedLayers[C[Z]];if(j.isHidden(l.transform.zoom))continue;const J=l.style.getLayerSourceCache(j),nt=J?this.proxyToSource[z.key][J.id]:[z];if(!nt)continue;const st=nt;_.viewport.set([0,0,U.fb.width,U.fb.height]),X!==(J?J.id:null)&&(this._setupStencil(U,nt,j,J),X=J?J.id:null),l.renderLayer(l,J,j,st)}if(this._drapedRenderBatches.length===0)for(const Z of this._pendingGroundEffectLayers){const j=l.style._mergedLayers[C[Z]];if(j.isHidden(l.transform.zoom))continue;const J=l.style.getLayerSourceCache(j),nt=J?this.proxyToSource[z.key][J.id]:[z];if(!nt)continue;const st=nt;_.viewport.set([0,0,U.fb.width,U.fb.height]),X!==(J?J.id:null)&&(this._setupStencil(U,nt,j,J),X=J?J.id:null),l.renderLayer(l,J,j,st)}this.renderedToTile?(U.dirty=!0,P.push(k.tileID)):q||--D,D===5&&(D=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,l.width,l.height]),I.end+1}postRender(){}isLayerOrderingCorrect(o){const l=o.order.length;let _=-1,v=l;for(let w=0;w<l;++w)this._style.isLayerDraped(o._mergedLayers[o.order[w]])?_=Math.max(_,w):v=Math.min(v,w);return v>_}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{o=Math.min(o,l.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,l,_){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const I=w.tileID,C=1<<I.overscaledZ,{x:P,y:D}=I.canonical,z=P/C,k=(P+1)/C,B=D/C,U=(D+1)/C;return{minx:z,miny:B,maxx:k,maxy:U,t:w.dem.tree.raycastRoot(z,B,k,U,o,l,_),tile:w}});v.sort((w,I)=>(w.t!==null?w.t:Number.MAX_VALUE)-(I.t!==null?I.t:Number.MAX_VALUE));for(const w of v){if(w.t==null)return null;const I=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,o,l,_);if(I!=null)return I}return null}_createFBO(){const o=this.painter.context,l=o.gl,_=this.drapeBufferSize;o.activeTexture.set(l.TEXTURE0);const v=new s.a9(o,{width:_[0],height:_[1],data:null},l.RGBA);v.bind(l.LINEAR,l.CLAMP_TO_EDGE);const w=o.createFramebuffer(_[0],_[1],!0,null);return w.colorAttachment.set(v.texture),w.depthAttachment=new Ur(o,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:w,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const l=this._style._mergedLayers[o],_=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!_&&l.shouldRedrape():!_&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const _ of this._style.getSources())if(_ instanceof bt){o=!0;break}if(!o)return;const l={};for(let _=0;_<this._style.order.length;++_){const v=this._style._mergedLayers[this._style.order[_]],w=this._style.getLayerSourceCache(v);if(w&&!l[w.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof s.am){l[w.id]=!0;for(const I of this.proxyCoords){const C=this.proxyToSource[I.key][w.id];if(C)for(const P of C)this._clearRenderCacheForTile(w.id,P)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof xe){o=!0;break}if(!o)return;const l={};for(let _=0;_<this._style.order.length;++_){const v=this._style._mergedLayers[this._style.order[_]],w=this._style.getLayerSourceCache(v);if(!w||l[w.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const I=v.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const P=this.proxyToSource[C.key][w.id];if(P)for(const D of P){const z=gh(w.getTile(D),w.findLoadedParent(D,0),w,this.painter.transform,I);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(w.id,D)}}}}_setupDrapedRenderBatches(){const o=this._style.order,l=o.length;if(l===0)return;const _=[];this._pendingGroundEffectLayers=[];let v,w=0,I=this._style._mergedLayers[o[w]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++w<l;)I=this._style._mergedLayers[o[w]];for(;w<l;++w){const C=this._style._mergedLayers[o[w]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?v===void 0&&(v=w):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),v!==void 0&&(_.push({start:v,end:w-1}),v=void 0)))}if(v!==void 0&&_.push({start:v,end:w-1}),_.length!==0){const C=_[_.length-1];this._pendingGroundEffectLayers.every(P=>P>C.end)||s.X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(o){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const I=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let C=0;C<I.length;++C){const P=Object.values(I[C]);l.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,v=this._tilesDirty;for(let I=_.length-1;I>=0;I--){const C=_[I];if(l.getTileByID(C.key),l.proxyCachedFBO[C.key]!==void 0){const P=o[C.key],D=this.proxyToSource[C.key];let z=0;for(const k in D){const B=D[k],U=P[k];if(!U||U.length!==B.length||B.some((q,X)=>q!==U[X]||v[k]&&v[k].hasOwnProperty(q.key))){z=-1;break}++z}for(const k in l.proxyCachedFBO[C.key])l.renderCache[l.proxyCachedFBO[C.key][k]].dirty=z<0||z!==Object.values(P).length}}const w=[...this._drapedRenderBatches];w.sort((I,C)=>C.end-C.start-(I.end-I.start));for(const I of w)for(const C of _){if(l.proxyCachedFBO[C.key])continue;let P=l.renderCachePool.pop();P===void 0&&l.renderCache.length<50&&(P=l.renderCache.length,l.renderCache.push(this._createFBO())),P!==void 0&&(l.proxyCachedFBO[C.key]={},l.proxyCachedFBO[C.key][I.start]=P,l.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(o,l,_,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,I=w.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let C;if(_.isTileClipped())C=l.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):s.b6.disabled}_renderTileClippingMasks(o,l){const _=this.painter,v=this.painter.context,w=v.gl;_._tileClippingMaskIDs={},v.setColorMode(s.a.disabled),v.setDepthMode(s.b4.disabled);const I=_.getOrCreateProgram("clippingMask");for(const C of o){const P=_._tileClippingMaskIDs[C.key]=--l;I.draw(_,w.TRIANGLES,s.b4.disabled,new s.b6({func:w.ALWAYS,mask:0},P,255,w.KEEP,w.KEEP,w.REPLACE),s.a.disabled,s.b5.disabled,mh(C.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(o){const l=this.painter.transform;if(o.x<0||o.x>l.width||o.y<0||o.y>l.height)return null;const _=[o.x,o.y,1,1];s.e.transformMat4(_,_,l.pixelMatrixInverse),s.e.scale(_,_,1/_[3]),_[0]/=l.worldSize,_[1]/=l.worldSize;const v=l._camera.position,w=s.b(1,l.center.lat),I=[v[0],v[1],v[2]/w,0],C=s.v.subtract([],_.slice(0,3),I);s.v.normalize(C,C);const P=this.raycast(I,C,this._exaggeration);return P!==null&&P?(s.v.scaleAndAdd(I,I,C,P),I[3]=I[2],I[2]*=w,I):null}drawDepth(){const o=this.painter,l=o.context,_=this.proxySourceCache,v=Math.ceil(o.width),w=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=l.gl,C=l.createFramebuffer(v,w,!0,"renderbuffer");l.activeTexture.set(I.TEXTURE0);const P=new s.a9(l,{width:v,height:w,data:null},I.RGBA);P.bind(I.NEAREST,I.CLAMP_TO_EDGE),C.colorAttachment.set(P.texture);const D=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,v,w);C.depthAttachment.set(D),this._depthFBO=C,this._depthTexture=P}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,v,w]),function(I,C,P,D){if(I.transform.projection.name==="globe")return;const z=I.context,k=z.gl;z.clear({depth:1});const B=I.getOrCreateProgram("terrainDepth"),U=new s.b4(k.LESS,s.b4.ReadWrite,I.depthRangeFor3D);for(const q of D){const X=P.getTile(q),Z=Jp(q.projMatrix,0,[0,0,0]);C.setupElevationDraw(X,B),B.draw(I,k.TRIANGLES,U,s.b6.disabled,s.a.unblended,s.b5.backCCW,Z,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(o,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,l,_){if(o.getSource()instanceof s.aK)return this._setupProxiedCoordsForImageSource(o,l,_);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const v=this.proxiedCoords[o.id]=[],w=this.proxyCoords;for(let P=0;P<w.length;P++){const D=w[P],z=this._findTileCoveringTileID(D,o);if(z){const k=this._createProxiedId(D,z,_[D.key]&&_[D.key][o.id]);v.push(k),this.proxyToSource[D.key][o.id]=[k]}}let I=!1;const C=new Set;for(let P=0;P<l.length;P++){const D=o.getTile(l[P]);if(!D||!D.hasData())continue;const z=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==D.tileID.canonical.z){const k=this.proxyToSource[z.tileID.key][o.id],B=this._createProxiedId(z.tileID,D,_[z.tileID.key]&&_[z.tileID.key][o.id]);k?k.splice(k.length-1,0,B):this.proxyToSource[z.tileID.key][o.id]=[B];const U=this.proxyToSource[z.tileID.key][o.id];C.has(U)||C.add(U),v.push(B),I=!0}}if(this._sourceTilesOverlap[o.id]=I,I&&this._debugParams.sortTilesHiZFirst)for(const P of C)P.sort((D,z)=>z.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(o,l,_){if(!o.getSource().loaded())return;const v=this.proxiedCoords[o.id]=[],w=this.proxyCoords,I=o.getSource(),C=I.tileID;if(!C)return;const P=new s.P(C.x,C.y)._div(1<<C.z),D=I.coordinates.map(s.M.fromLngLat).reduce((k,B)=>(k.min.x=Math.min(k.min.x,B.x-P.x),k.min.y=Math.min(k.min.y,B.y-P.y),k.max.x=Math.max(k.max.x,B.x-P.x),k.max.y=Math.max(k.max.y,B.y-P.y),k),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(k,B)=>{const U=k.wrap+k.canonical.x/(1<<k.canonical.z),q=k.canonical.y/(1<<k.canonical.z),X=s.J/(1<<k.canonical.z),Z=B.wrap+B.canonical.x/(1<<B.canonical.z),j=B.canonical.y/(1<<B.canonical.z);return U+X<Z+D.min.x||U>Z+D.max.x||q+X<j+D.min.y||q>j+D.max.y};for(let k=0;k<w.length;k++){const B=w[k];for(let U=0;U<l.length;U++){const q=o.getTile(l[U]);if(!q||!q.hasData()||z(B,q.tileID))continue;const X=this._createProxiedId(B,q,_[B.key]&&_[B.key][o.id]),Z=this.proxyToSource[B.key][o.id];Z?Z.push(X):this.proxyToSource[B.key][o.id]=[X],v.push(X)}}}_createProxiedId(o,l,_){let v=this.orthoMatrix;if(_){const w=_.find(I=>I.key===l.tileID.key);if(w)return w}if(l.tileID.key!==o.key){const w=o.canonical.z-l.tileID.canonical.z;let I,C,P;v=s.m.create();const D=l.tileID.wrap-o.wrap<<o.overscaledZ;w>0?(I=s.J>>w,C=I*((l.tileID.canonical.x<<w)-o.canonical.x+D),P=I*((l.tileID.canonical.y<<w)-o.canonical.y)):(I=s.J<<-w,C=s.J*(l.tileID.canonical.x-(o.canonical.x+D<<-w)),P=s.J*(l.tileID.canonical.y-(o.canonical.y<<-w))),s.m.ortho(v,0,I,0,I,0,1),s.m.translate(v,v,[C,P,0])}return new _h(l.tileID,o.key,v)}_findTileCoveringTileID(o,l){let _=l.getTile(o);if(_&&_.hasData())return _;const v=this._findCoveringTileCache[l.id],w=v[o.key];if(_=w?l.getTileByID(w):null,_&&_.hasData()||w===null)return _;let I=_?_.tileID:o,C=I.overscaledZ;const P=l.getSource().minzoom,D=[];if(!w){const k=l.getSource().maxzoom;if(o.canonical.z>=k){const B=o.canonical.z-k;l.getSource().reparseOverscaled?(C=Math.max(o.canonical.z+2,l.transform.tileZoom),I=new s.O(C,o.wrap,k,o.canonical.x>>B,o.canonical.y>>B)):B!==0&&(C=k,I=new s.O(C,o.wrap,k,o.canonical.x>>B,o.canonical.y>>B))}I.key!==o.key&&(D.push(I.key),_=l.getTile(I))}const z=k=>{D.forEach(B=>{v[B]=k}),D.length=0};for(C-=1;C>=P&&(!_||!_.hasData());C--){_&&z(_.tileID.key);const k=I.calculateScaledKey(C);if(_=l.getTileByID(k),_&&_.hasData())break;const B=v[k];if(B===null)break;B===void 0?D.push(k):_=l.getTileByID(B)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,l){let _=this._tilesDirty[o];_||(_=this._tilesDirty[o]={}),_[l.key]=!0}}function Kd(d,o,l){const _=function(C,P,D){const z=s.v.dot(P,C),k=s.v.dot(D,[.2126,.7152,.0722]),B=(q,X,Z)=>(1-Z)*q+Z*X,U=B(1-.3*Math.min(k,1),1,Math.min(z+1,1));return B(.92,1,Math.asin(s.c(P[2],-1,1))/Math.PI+.5)*U}(d,[0,0,1],o),v=[0,0,0];s.v.scale(v,l.slice(0,3),_);const w=[0,0,0];s.v.scale(w,o.slice(0,3),d[2]);const I=[0,0,0];return s.v.add(I,v,w),s.bw(I)}const yh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ea=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class vh{static cacheKey(o,l,_,v){let w=`${l}${v?v.cacheKey:""}`;for(const I of _)o.usedDefines.includes(I)&&(w+=`/${I}`);return w}constructor(o,l,_,v,w,I){const C=o.gl;this.program=C.createProgram(),this.configuration=v,this.name=l,this.fixedDefines=[...I];const P=v?v.getBinderAttributes():[],D=(_.staticAttributes||[]).concat(P);let z=v?v.defines():[];z=z.concat(I.map(Z=>`#define ${Z}`));const k=`#version 300 es
`;let B=k+z.concat("precision mediump float;",vl,$d.fragmentSource).join(`
`);for(const Z of _.fragmentIncludes)B+=`
${Aa[Z]}`;B+=`
${_.fragmentSource}`;let U=k+z.concat("precision highp float;",vl,$d.vertexSource).join(`
`);for(const Z of _.vertexIncludes)U+=`
${Aa[Z]}`;U+=`
${_.vertexSource}`;const q=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(q,B),C.compileShader(q),C.attachShader(this.program,q);const X=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(X,U),C.compileShader(X),C.attachShader(this.program,X),this.attributes={},this.numAttributes=D.length;for(let Z=0;Z<this.numAttributes;Z++)if(D[Z]){const j=D[Z].startsWith("a_")?D[Z]:`a_${D[Z]}`;C.bindAttribLocation(this.program,Z,j),this.attributes[j]=Z}C.linkProgram(this.program),C.deleteShader(X),C.deleteShader(q),this.fixedUniforms=w(o),this.binderUniforms=v?v.getUniforms(o):[],I.includes("TERRAIN")&&(this.terrainUniforms=(Z=>({u_dem:new s.a$(Z),u_dem_prev:new s.a$(Z),u_dem_tl:new s.b0(Z),u_dem_scale:new s.b2(Z),u_dem_tl_prev:new s.b0(Z),u_dem_scale_prev:new s.b2(Z),u_dem_size:new s.b2(Z),u_dem_lerp:new s.b2(Z),u_exaggeration:new s.b2(Z),u_depth:new s.a$(Z),u_depth_size_inv:new s.b0(Z),u_meter_to_dem:new s.b2(Z),u_label_plane_matrix_inv:new s.a_(Z)}))(o)),I.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new s.b7(Z),u_tile_tr_up:new s.b7(Z),u_tile_br_up:new s.b7(Z),u_tile_bl_up:new s.b7(Z),u_tile_up_scale:new s.b2(Z)}))(o)),I.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new s.a_(Z),u_fog_range:new s.b0(Z),u_fog_color:new s.b9(Z),u_fog_horizon_blend:new s.b2(Z),u_fog_vertical_limit:new s.b0(Z),u_fog_temporal_offset:new s.b2(Z),u_frustum_tl:new s.b7(Z),u_frustum_tr:new s.b7(Z),u_frustum_br:new s.b7(Z),u_frustum_bl:new s.b7(Z),u_globe_pos:new s.b7(Z),u_globe_radius:new s.b2(Z),u_globe_transition:new s.b2(Z),u_is_globe:new s.a$(Z),u_viewport:new s.b0(Z)}))(o)),I.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new s.b9(Z)}))(o)),I.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new s.b7(Z),u_lighting_directional_dir:new s.b7(Z),u_lighting_directional_color:new s.b7(Z),u_ground_radiance:new s.b7(Z)}))(o)),I.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new s.a_(Z),u_light_matrix_1:new s.a_(Z),u_fade_range:new s.b0(Z),u_shadow_normal_offset:new s.b7(Z),u_shadow_intensity:new s.b2(Z),u_shadow_texel_size:new s.b2(Z),u_shadow_map_resolution:new s.b2(Z),u_shadow_direction:new s.b7(Z),u_shadow_bias:new s.b7(Z),u_shadowmap_0:new s.a$(Z),u_shadowmap_1:new s.a$(Z)}))(o))}}setTerrainUniformValues(o,l){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in l)_[v]&&_[v].set(this.program,v,l[v])}}setGlobeUniformValues(o,l){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in l)_[v]&&_[v].set(this.program,v,l[v])}}setFogUniformValues(o,l){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in l)_[v].set(this.program,v,l[v])}}setCutoffUniformValues(o,l){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in l)_[v].set(this.program,v,l[v])}}setLightsUniformValues(o,l){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in l)_[v].set(this.program,v,l[v])}}setShadowUniformValues(o,l){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;o.program.set(this.program);for(const v in l)_[v].set(this.program,v,l[v])}_drawDebugWireframe(o,l,_,v,w,I,C,P,D,z){const k=o.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;const B=o.context;if(!(()=>!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||o._terrain&&o._terrain.renderingToTexture||!yh.includes(this.name))||!(!k.layers3D||!ea.includes(this.name)))())return;const U=B.gl,q=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,w,B);if(!q)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const Z=o.getOrCreateProgram(this.name,{config:this.configuration,defines:X});B.program.set(Z.program);const j=(st,Y,K)=>{if(Y[st]&&K[st])for(const lt in Y[st])K[st][lt]&&K[st][lt].set(K.program,lt,Y[st][lt].current)};D&&D.setUniforms(Z.program,B,Z.binderUniforms,C,{zoom:P}),j("fixedUniforms",this,Z),j("terrainUniforms",this,Z),j("globeUniforms",this,Z),j("fogUniforms",this,Z),j("lightsUniforms",this,Z),j("shadowUniforms",this,Z),q.bind(),B.setColorMode(new s.a([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],s.C.transparent,[!0,!0,!0,!1])),B.setDepthMode(new s.b4(l.func===U.LESS?U.LEQUAL:l.func,s.b4.ReadOnly,l.range)),B.setStencilMode(s.b6.disabled);const J=3*I.primitiveLength*2,nt=3*I.primitiveOffset*2*2;z&&z>1?U.drawElementsInstanced(U.LINES,J,U.UNSIGNED_SHORT,nt,z):U.drawElements(U.LINES,J,U.UNSIGNED_SHORT,nt),w.bind(),B.program.set(this.program),B.setDepthMode(l),B.setStencilMode(_),B.setColorMode(v)}draw(o,l,_,v,w,I,C,P,D,z,k,B,U,q,X,Z){const j=o.context,J=j.gl;if(this.failedToCreate)return;j.program.set(this.program),j.setDepthMode(_),j.setStencilMode(v),j.setColorMode(w),j.setCullFace(I);for(const Y of Object.keys(this.fixedUniforms))this.fixedUniforms[Y].set(this.program,Y,C[Y]);q&&q.setUniforms(this.program,j,this.binderUniforms,B,{zoom:U});const nt={[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[l],st=Z&&Z>0?1:void 0;for(const Y of k.get()){const K=Y.vaos||(Y.vaos={});(K[P]||(K[P]=new I_)).bind(j,this,D,q?q.getPaintVertexBuffers():[],z,Y.vertexOffset,X||[],st),Z&&Z>1?J.drawElementsInstanced(l,Y.primitiveLength*nt,J.UNSIGNED_SHORT,Y.primitiveOffset*nt*2,Z):J.drawElements(l,Y.primitiveLength*nt,J.UNSIGNED_SHORT,Y.primitiveOffset*nt*2),l===J.TRIANGLES&&this._drawDebugWireframe(o,_,v,w,z,Y,B,U,q,Z)}}}function La(d,o){const l=Math.pow(2,o.tileID.overscaledZ),_=o.tileSize*Math.pow(2,d.transform.tileZoom)/l,v=_*(o.tileID.canonical.x+o.tileID.wrap*l),w=_*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(o,1,d.transform.tileZoom),u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const xh=s.m.create(),bl=(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q,X)=>{const Z=o.style.light,j=Z.properties.get("position"),J=[j.x,j.y,j.z],nt=s.bx.create();Z.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(nt,-o.transform.angle),s.v.transformMat3(J,J,nt));const st=Z.properties.get("color"),Y=o.transform,K={u_matrix:d,u_lightpos:J,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[st.r,st.g,st.b],u_vertical_gradient:+l,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:w,u_flood_light_color:k,u_vertical_scale:B,u_flood_light_intensity:U,u_ground_shadow_factor:q,u_emissive_strength:X};return Y.projection.name==="globe"&&(K.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],K.u_zoom_transition=P,K.u_inv_rot_matrix=z,K.u_merc_center=D,K.u_up_dir=Y.projection.upVector(new s.t(0,0,0),D[0]*s.J,D[1]*s.J),K.u_height_lift=C),K},nf=(d,o,l)=>({u_matrix:d,u_edge_radius:o,u_vertical_scale:l}),M_=(d,o,l,_,v,w,I,C,P,D,z,k,B,U)=>{const q=bl(d,o,l,_,v,w,I,P,D,z,k,B,U,1,[0,0,0],0),X={u_height_factor:-Math.pow(2,I.overscaledZ)/C.tileSize/8};return s.ak(q,La(o,C),X)},of=(d,o)=>({u_matrix:d,u_emissive_strength:o}),sf=(d,o,l,_)=>s.ak(of(d,o),La(l,_)),af=(d,o,l)=>({u_matrix:d,u_world:l,u_emissive_strength:o}),A_=(d,o,l,_,v)=>s.ak(sf(d,o,l,_),{u_world:v}),P_=(d,o,l,_)=>{const v=s.J/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:o.getCameraToCenterDistance(_),u_extrude_scale:[o.pixelsToGLUnits[0]/v,o.pixelsToGLUnits[1]/v]}},Qd=(d,o,l=1)=>({u_matrix:d,u_color:o,u_overlay:0,u_overlay_scale:l}),L_=s.m.create(),tm=(d,o,l,_,v,w,I)=>{const C=d.transform,P=C.projection.name==="globe",D=P?s.by(C.zoom,o.canonical)*C._pixelsPerMercatorPixel:s.ay(l,1,w),z={u_matrix:o.projMatrix,u_extrude_scale:D,u_intensity:I,u_inv_rot_matrix:L_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){z.u_inv_rot_matrix=_,z.u_merc_center=v,z.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],z.u_zoom_transition=s.ao(C.zoom);const k=v[0]*s.J,B=v[1]*s.J;z.u_up_dir=C.projection.upVector(new s.t(0,0,0),k,B)}return z},em=(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q,X,Z,j,J,nt,st)=>{return{u_matrix:d,u_normalize_matrix:o,u_globe_matrix:l,u_merc_matrix:_,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:D,u_fade_t:z.mix,u_opacity:z.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:(K=k.paint.get("raster-saturation"),K>0?1-1/(1.001-K):-K),u_contrast_factor:(Y=k.paint.get("raster-contrast"),Y>0?1/(1-Y):1+Y),u_spin_weights:bh(k.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:U,u_zoom_transition:I,u_merc_center:C,u_cutoff_params:P,u_colorization_mix:D_(X,j),u_colorization_offset:rm(Z,j),u_color_ramp:q,u_texture_offset:[nt/(J+2*nt),J/(J+2*nt)],u_texture_res:[J+2*nt,J+2*nt],u_emissive_strength:st};var Y,K};function bh(d){d*=Math.PI/180;const o=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*o-l+1)/3,(Math.sqrt(3)*o-l+1)/3]}function D_([d,o,l,_],[v,w]){if(v===w)return[0,0,0,0];const I=(s.bz+3)/(s.bz+1)/(w-v);return[d*I,o*I,l*I,_*I]}function rm(d,[o,l]){return o===l?0:((d-o)/(l-o)*(s.bz+3)-1)/(s.bz+1)}const wh=s.m.create(),ec=(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q,X,Z,j)=>{const J=v.transform,nt={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:J.getCameraToCenterDistance(X),u_rotate_symbol:+l,u_aspect_ratio:J.width/J.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:I,u_coord_matrix:C,u_is_text:+P,u_pitch_with_map:+_,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:wh,u_up_vector:[0,-1,0],u_icon_transition:j||0,u_icon_saturation:Z};return X.name==="globe"&&(nt.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],nt.u_zoom_transition=k,nt.u_inv_rot_matrix=U,nt.u_merc_center=B,nt.u_camera_forward=J._camera.forward(),nt.u_ecef_origin=s.bA(J.globeMatrix,z.toUnwrapped()),nt.u_tile_matrix=Float32Array.from(J.globeMatrix),nt.u_up_vector=q),nt},Eh=(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q,X,Z)=>s.ak(ec(d,o,l,_,v,w,I,C,P,D,k,B,U,q,X,Z,1),{u_gamma_scale:_?v.transform.getCameraToCenterDistance(Z)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:s.a4.devicePixelRatio,u_is_halo:+z,undefined:void 0}),rc=(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q,X)=>s.ak(Eh(d,o,l,_,v,w,I,C,!0,P,!0,z,k,B,U,q,X),{u_texsize_icon:D,u_texture_icon:1}),lf=(d,o,l,_)=>({u_matrix:d,u_emissive_strength:o,u_opacity:l,u_color:_}),uu=(d,o,l,_,v,w,I)=>s.ak(function(C,P,D,z){const k=D.imageManager.getPattern(C.toString(),P),{width:B,height:U}=D.imageManager.getPixelSize(P),q=Math.pow(2,z.tileID.overscaledZ),X=z.tileSize*Math.pow(2,D.transform.tileZoom)/q,Z=X*(z.tileID.canonical.x+z.tileID.wrap*q),j=X*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[B,U],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/s.ay(z,1,D.transform.tileZoom),u_pixel_coord_upper:[Z>>16,j>>16],u_pixel_coord_lower:[65535&Z,65535&j]}}(v,w,_,I),{u_matrix:d,u_emissive_strength:o,u_opacity:l}),pi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},nc=(d,o,l,_,v,w,I,C,P,D,z,k,B=[0,0,0])=>{const U=_.style.light,q=U.properties.get("position"),X=[-q.x,-q.y,q.z],Z=s.bx.create();U.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(Z,-_.transform.angle),s.v.transformMat3(X,X,Z));const j=D.alphaMode==="MASK",J=U.properties.get("color"),nt=k.paint.get("model-ambient-occlusion-intensity"),st=k.paint.get("model-color").constantOr(s.C.white),Y=k.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:o,u_normal_matrix:l,u_lightpos:X,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_camera_pos:B,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+j,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:C,u_roughnessFactor:P,u_baseColorTexture:pi.BaseColor,u_metallicRoughnessTexture:pi.MetallicRoughness,u_normalTexture:pi.Normal,u_occlusionTexture:pi.Occlusion,u_emissionTexture:pi.Emission,u_color_mix:[st.r,st.g,st.b,Y],u_aoIntensity:nt,u_emissive_strength:z}},wl=new Float32Array(16),Ih=(d,o=wl,l=wl)=>({u_matrix:d,u_instance:o,u_node_matrix:l}),nm={fillExtrusion:d=>({u_matrix:new s.a_(d),u_lightpos:new s.b7(d),u_lightintensity:new s.b2(d),u_lightcolor:new s.b7(d),u_vertical_gradient:new s.b2(d),u_opacity:new s.b2(d),u_edge_radius:new s.b2(d),u_ao:new s.b0(d),u_tile_id:new s.b7(d),u_zoom_transition:new s.b2(d),u_inv_rot_matrix:new s.a_(d),u_merc_center:new s.b0(d),u_up_dir:new s.b7(d),u_height_lift:new s.b2(d),u_flood_light_color:new s.b7(d),u_vertical_scale:new s.b2(d),u_flood_light_intensity:new s.b2(d),u_ground_shadow_factor:new s.b7(d),u_emissive_strength:new s.b2(d)}),fillExtrusionDepth:d=>({u_matrix:new s.a_(d),u_edge_radius:new s.b2(d),u_vertical_scale:new s.b2(d)}),fillExtrusionPattern:d=>({u_matrix:new s.a_(d),u_lightpos:new s.b7(d),u_lightintensity:new s.b2(d),u_lightcolor:new s.b7(d),u_vertical_gradient:new s.b2(d),u_height_factor:new s.b2(d),u_edge_radius:new s.b2(d),u_ao:new s.b0(d),u_tile_id:new s.b7(d),u_zoom_transition:new s.b2(d),u_inv_rot_matrix:new s.a_(d),u_merc_center:new s.b0(d),u_up_dir:new s.b7(d),u_height_lift:new s.b2(d),u_image:new s.a$(d),u_texsize:new s.b0(d),u_pixel_coord_upper:new s.b0(d),u_pixel_coord_lower:new s.b0(d),u_tile_units_to_pixels:new s.b2(d),u_opacity:new s.b2(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new s.a_(d),u_opacity:new s.b2(d),u_ao_pass:new s.b2(d),u_meter_to_tile:new s.b2(d),u_ao:new s.b0(d),u_flood_light_intensity:new s.b2(d),u_flood_light_color:new s.b7(d),u_attenuation:new s.b2(d),u_edge_radius:new s.b2(d),u_fb:new s.a$(d),u_fb_size:new s.b2(d)}),fill:d=>({u_matrix:new s.a_(d),u_emissive_strength:new s.b2(d)}),fillPattern:d=>({u_matrix:new s.a_(d),u_emissive_strength:new s.b2(d),u_image:new s.a$(d),u_texsize:new s.b0(d),u_pixel_coord_upper:new s.b0(d),u_pixel_coord_lower:new s.b0(d),u_tile_units_to_pixels:new s.b2(d)}),fillOutline:d=>({u_matrix:new s.a_(d),u_emissive_strength:new s.b2(d),u_world:new s.b0(d)}),fillOutlinePattern:d=>({u_matrix:new s.a_(d),u_emissive_strength:new s.b2(d),u_world:new s.b0(d),u_image:new s.a$(d),u_texsize:new s.b0(d),u_pixel_coord_upper:new s.b0(d),u_pixel_coord_lower:new s.b0(d),u_tile_units_to_pixels:new s.b2(d)}),circle:s.bB,collisionBox:d=>({u_matrix:new s.a_(d),u_camera_to_center_distance:new s.b2(d),u_extrude_scale:new s.b0(d)}),collisionCircle:d=>({u_matrix:new s.a_(d),u_inv_matrix:new s.a_(d),u_camera_to_center_distance:new s.b2(d),u_viewport_size:new s.b0(d)}),debug:d=>({u_color:new s.b1(d),u_matrix:new s.a_(d),u_overlay:new s.a$(d),u_overlay_scale:new s.b2(d)}),clippingMask:d=>({u_matrix:new s.a_(d)}),heatmap:d=>({u_extrude_scale:new s.b2(d),u_intensity:new s.b2(d),u_matrix:new s.a_(d),u_inv_rot_matrix:new s.a_(d),u_merc_center:new s.b0(d),u_tile_id:new s.b7(d),u_zoom_transition:new s.b2(d),u_up_dir:new s.b7(d)}),heatmapTexture:d=>({u_image:new s.a$(d),u_color_ramp:new s.a$(d),u_opacity:new s.b2(d)}),hillshade:d=>({u_matrix:new s.a_(d),u_image:new s.a$(d),u_latrange:new s.b0(d),u_light:new s.b0(d),u_shadow:new s.b1(d),u_highlight:new s.b1(d),u_emissive_strength:new s.b2(d),u_accent:new s.b1(d)}),hillshadePrepare:d=>({u_matrix:new s.a_(d),u_image:new s.a$(d),u_dimension:new s.b0(d),u_zoom:new s.b2(d)}),line:s.bC,linePattern:s.bD,raster:d=>({u_matrix:new s.a_(d),u_normalize_matrix:new s.a_(d),u_globe_matrix:new s.a_(d),u_merc_matrix:new s.a_(d),u_grid_matrix:new s.b8(d),u_tl_parent:new s.b0(d),u_scale_parent:new s.b2(d),u_fade_t:new s.b2(d),u_opacity:new s.b2(d),u_image0:new s.a$(d),u_image1:new s.a$(d),u_brightness_low:new s.b2(d),u_brightness_high:new s.b2(d),u_saturation_factor:new s.b2(d),u_contrast_factor:new s.b2(d),u_spin_weights:new s.b7(d),u_perspective_transform:new s.b0(d),u_raster_elevation:new s.b2(d),u_zoom_transition:new s.b2(d),u_merc_center:new s.b0(d),u_cutoff_params:new s.b9(d),u_colorization_mix:new s.b9(d),u_colorization_offset:new s.b2(d),u_color_ramp:new s.a$(d),u_texture_offset:new s.b0(d),u_texture_res:new s.b0(d),u_emissive_strength:new s.b2(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new s.a$(d),u_is_size_feature_constant:new s.a$(d),u_size_t:new s.b2(d),u_size:new s.b2(d),u_camera_to_center_distance:new s.b2(d),u_rotate_symbol:new s.a$(d),u_aspect_ratio:new s.b2(d),u_fade_change:new s.b2(d),u_matrix:new s.a_(d),u_label_plane_matrix:new s.a_(d),u_coord_matrix:new s.a_(d),u_is_text:new s.a$(d),u_pitch_with_map:new s.a$(d),u_texsize:new s.b0(d),u_tile_id:new s.b7(d),u_zoom_transition:new s.b2(d),u_inv_rot_matrix:new s.a_(d),u_merc_center:new s.b0(d),u_camera_forward:new s.b7(d),u_tile_matrix:new s.a_(d),u_up_vector:new s.b7(d),u_ecef_origin:new s.b7(d),u_texture:new s.a$(d),u_icon_transition:new s.b2(d),u_icon_saturation:new s.b2(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new s.a$(d),u_is_size_feature_constant:new s.a$(d),u_size_t:new s.b2(d),u_size:new s.b2(d),u_camera_to_center_distance:new s.b2(d),u_rotate_symbol:new s.a$(d),u_aspect_ratio:new s.b2(d),u_fade_change:new s.b2(d),u_matrix:new s.a_(d),u_label_plane_matrix:new s.a_(d),u_coord_matrix:new s.a_(d),u_is_text:new s.a$(d),u_pitch_with_map:new s.a$(d),u_texsize:new s.b0(d),u_texture:new s.a$(d),u_gamma_scale:new s.b2(d),u_device_pixel_ratio:new s.b2(d),u_tile_id:new s.b7(d),u_zoom_transition:new s.b2(d),u_inv_rot_matrix:new s.a_(d),u_merc_center:new s.b0(d),u_camera_forward:new s.b7(d),u_tile_matrix:new s.a_(d),u_up_vector:new s.b7(d),u_ecef_origin:new s.b7(d),u_is_halo:new s.a$(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new s.a$(d),u_is_size_feature_constant:new s.a$(d),u_size_t:new s.b2(d),u_size:new s.b2(d),u_camera_to_center_distance:new s.b2(d),u_rotate_symbol:new s.a$(d),u_aspect_ratio:new s.b2(d),u_fade_change:new s.b2(d),u_matrix:new s.a_(d),u_label_plane_matrix:new s.a_(d),u_coord_matrix:new s.a_(d),u_is_text:new s.a$(d),u_pitch_with_map:new s.a$(d),u_texsize:new s.b0(d),u_texsize_icon:new s.b0(d),u_texture:new s.a$(d),u_texture_icon:new s.a$(d),u_gamma_scale:new s.b2(d),u_device_pixel_ratio:new s.b2(d),u_is_halo:new s.a$(d)}),background:d=>({u_matrix:new s.a_(d),u_emissive_strength:new s.b2(d),u_opacity:new s.b2(d),u_color:new s.b1(d)}),backgroundPattern:d=>({u_matrix:new s.a_(d),u_emissive_strength:new s.b2(d),u_opacity:new s.b2(d),u_image:new s.a$(d),u_pattern_tl:new s.b0(d),u_pattern_br:new s.b0(d),u_texsize:new s.b0(d),u_pattern_size:new s.b0(d),u_pixel_coord_upper:new s.b0(d),u_pixel_coord_lower:new s.b0(d),u_tile_units_to_pixels:new s.b2(d)}),terrainRaster:fh,terrainDepth:fh,skybox:d=>({u_matrix:new s.a_(d),u_sun_direction:new s.b7(d),u_cubemap:new s.a$(d),u_opacity:new s.b2(d),u_temporal_offset:new s.b2(d)}),skyboxGradient:d=>({u_matrix:new s.a_(d),u_color_ramp:new s.a$(d),u_center_direction:new s.b7(d),u_radius:new s.b2(d),u_opacity:new s.b2(d),u_temporal_offset:new s.b2(d)}),skyboxCapture:d=>({u_matrix_3f:new s.b8(d),u_sun_direction:new s.b7(d),u_sun_intensity:new s.b2(d),u_color_tint_r:new s.b9(d),u_color_tint_m:new s.b9(d),u_luminance:new s.b2(d)}),globeRaster:d=>({u_proj_matrix:new s.a_(d),u_globe_matrix:new s.a_(d),u_normalize_matrix:new s.a_(d),u_merc_matrix:new s.a_(d),u_zoom_transition:new s.b2(d),u_merc_center:new s.b0(d),u_image0:new s.a$(d),u_grid_matrix:new s.b8(d),u_skirt_height:new s.b2(d),u_frustum_tl:new s.b7(d),u_frustum_tr:new s.b7(d),u_frustum_br:new s.b7(d),u_frustum_bl:new s.b7(d),u_globe_pos:new s.b7(d),u_globe_radius:new s.b2(d),u_viewport:new s.b0(d)}),globeAtmosphere:d=>({u_frustum_tl:new s.b7(d),u_frustum_tr:new s.b7(d),u_frustum_br:new s.b7(d),u_frustum_bl:new s.b7(d),u_horizon:new s.b2(d),u_transition:new s.b2(d),u_fadeout_range:new s.b2(d),u_color:new s.b9(d),u_high_color:new s.b9(d),u_space_color:new s.b9(d),u_temporal_offset:new s.b2(d),u_horizon_angle:new s.b2(d)}),model:d=>({u_matrix:new s.a_(d),u_lighting_matrix:new s.a_(d),u_normal_matrix:new s.a_(d),u_lightpos:new s.b7(d),u_lightintensity:new s.b2(d),u_lightcolor:new s.b7(d),u_camera_pos:new s.b7(d),u_opacity:new s.b2(d),u_baseColorFactor:new s.b9(d),u_emissiveFactor:new s.b9(d),u_metallicFactor:new s.b2(d),u_roughnessFactor:new s.b2(d),u_baseTextureIsAlpha:new s.a$(d),u_alphaMask:new s.a$(d),u_alphaCutoff:new s.b2(d),u_baseColorTexture:new s.a$(d),u_metallicRoughnessTexture:new s.a$(d),u_normalTexture:new s.a$(d),u_occlusionTexture:new s.a$(d),u_emissionTexture:new s.a$(d),u_color_mix:new s.b9(d),u_aoIntensity:new s.b2(d),u_emissive_strength:new s.b2(d)}),modelDepth:d=>({u_matrix:new s.a_(d),u_instance:new s.a_(d),u_node_matrix:new s.a_(d)}),groundShadow:d=>({u_matrix:new s.a_(d),u_ground_shadow_factor:new s.b7(d)}),stars:d=>({u_matrix:new s.a_(d),u_up:new s.b7(d),u_right:new s.b7(d),u_intensity_multiplier:new s.b2(d)})};let cu;function uf(d,o,l,_,v,w,I){const C=d.context,P=C.gl,D=d.transform,z=d.getOrCreateProgram("collisionBox"),k=[];let B=0,U=0;for(let st=0;st<_.length;st++){const Y=_[st],K=o.getTile(Y),lt=K.getBucket(l);if(!lt)continue;const ht=Vp(Y,lt,D);let ut=ht;v[0]===0&&v[1]===0||(ut=d.translatePosMatrix(ht,K,v,w));const pt=I?lt.textCollisionBox:lt.iconCollisionBox,Dt=lt.collisionCircleArray;if(Dt.length>0){const wt=s.m.create(),St=ut;s.m.mul(wt,lt.placementInvProjMatrix,D.glCoordMatrix),s.m.mul(wt,wt,lt.placementViewportMatrix),k.push({circleArray:Dt,circleOffset:U,transform:St,invTransform:wt,projection:lt.getProjection()}),B+=Dt.length/4,U=B}pt&&(d.terrain&&d.terrain.setupElevationDraw(K,z),z.draw(d,P.LINES,s.b4.disabled,s.b6.disabled,d.colorModeForRenderPass(),s.b5.disabled,P_(ut,D,K,lt.getProjection()),l.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,null,D.zoom,null,[pt.collisionVertexBuffer,pt.collisionVertexBufferExt]))}if(!I||!k.length)return;const q=d.getOrCreateProgram("collisionCircle"),X=new s.bE;X.resize(4*B),X._trim();let Z=0;for(const st of k)for(let Y=0;Y<st.circleArray.length/4;Y++){const K=4*Y,lt=st.circleArray[K+0],ht=st.circleArray[K+1],ut=st.circleArray[K+2],pt=st.circleArray[K+3];X.emplace(Z++,lt,ht,ut,pt,0),X.emplace(Z++,lt,ht,ut,pt,1),X.emplace(Z++,lt,ht,ut,pt,2),X.emplace(Z++,lt,ht,ut,pt,3)}(!cu||cu.length<2*B)&&(cu=function(st){const Y=2*st,K=new s.bp;K.resize(Y),K._trim();for(let lt=0;lt<Y;lt++){const ht=6*lt;K.uint16[ht+0]=4*lt+0,K.uint16[ht+1]=4*lt+1,K.uint16[ht+2]=4*lt+2,K.uint16[ht+3]=4*lt+2,K.uint16[ht+4]=4*lt+3,K.uint16[ht+5]=4*lt+0}return K}(B));const j=C.createIndexBuffer(cu,!0),J=C.createVertexBuffer(X,s.bF.members,!0);for(const st of k){const Y={u_matrix:st.transform,u_inv_matrix:st.invTransform,u_camera_to_center_distance:(nt=D).getCameraToCenterDistance(st.projection),u_viewport_size:[nt.width,nt.height]};q.draw(d,P.TRIANGLES,s.b4.disabled,s.b6.disabled,d.colorModeForRenderPass(),s.b5.disabled,Y,l.id,J,j,s.bm.simpleSegment(0,2*st.circleOffset,st.circleArray.length,st.circleArray.length/2),null,D.zoom)}var nt;J.destroy(),j.destroy()}const Th=s.m.create();function Sh({width:d,height:o,anchor:l,textOffset:_,textScale:v},w){const{horizontalAlign:I,verticalAlign:C}=s.aY(l),P=-(I-.5)*d,D=-(C-.5)*o,z=s.aW(l,_);return new s.P((P/v+z[0])*w,(D/v+z[1])*w)}function cf(d,o,l,_,v,w,I,C,P,D,z){const k=d.text.placedSymbolArray,B=d.text.dynamicLayoutVertexArray,U=d.icon.dynamicLayoutVertexArray,q={},X=d.getProjection(),Z=_l(C,X,w),j=w.elevation,J=X.upVectorScale(C.canonical,w.center.lat,w.worldSize).metersToTile;B.clear();for(let nt=0;nt<k.length;nt++){const st=k.get(nt),{tileAnchorX:Y,tileAnchorY:K,numGlyphs:lt}=st,ht=st.hidden||!st.crossTileID||d.allowVerticalPlacement&&!st.placedOrientation?null:_[st.crossTileID];if(ht){let ut=0,pt=0,Dt=0;if(j){const Gt=j?j.getAtTileOffset(C,Y,K):0,[Ft,ge,ce]=X.upVector(C.canonical,Y,K);ut=Gt*Ft*J,pt=Gt*ge*J,Dt=Gt*ce*J}let[wt,St,mt,Lt]=hi(st.projectedAnchorX+ut,st.projectedAnchorY+pt,st.projectedAnchorZ+Dt,l?Z:I);const Tt=Ot(w.getCameraToCenterDistance(X),Lt);let zt=v.evaluateSizeForFeature(d.textSizeData,D,st)*Tt/s.aV;l&&(zt*=d.tilePixelRatio/P);const tt=Sh(ht,zt);l?({x:wt,y:St,z:mt}=X.projectTilePoint(Y+tt.x,K+tt.y,C.canonical),[wt,St,mt]=hi(wt+ut,St+pt,mt+Dt,I)):(o&&tt._rotate(-w.angle),wt+=tt.x,St+=tt.y,mt=0);const yt=d.allowVerticalPlacement&&st.placedOrientation===s.W.vertical?Math.PI/2:0;for(let Gt=0;Gt<lt;Gt++)s.k(B,wt,St,mt,yt);z&&st.associatedIconIndex>=0&&(q[st.associatedIconIndex]={x:wt,y:St,z:mt,angle:yt})}else Qt(lt,B)}if(z){U.clear();const nt=d.icon.placedSymbolArray;for(let st=0;st<nt.length;st++){const Y=nt.get(st),{numGlyphs:K}=Y,lt=q[st];if(Y.hidden||!lt)Qt(K,U);else{const{x:ht,y:ut,z:pt,angle:Dt}=lt;for(let wt=0;wt<K;wt++)s.k(U,ht,ut,pt,Dt)}}d.icon.dynamicLayoutVertexBuffer.updateData(U)}d.text.dynamicLayoutVertexBuffer.updateData(B)}function hf(d,o,l){return l.iconsInText&&o?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function nr(d,o,l,_,v,w,I,C,P,D,z,k,B){const U=d.context,q=U.gl,X=d.transform,Z=C==="map",j=P==="map",J=Z&&l.layout.get("symbol-placement")!=="point",nt=Z&&!j&&!J,st=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Y=!1;const K=d.depthModeForSublayer(0,s.b4.ReadOnly),lt=[s.E(X.center.lng),s.H(X.center.lat)],ht=l.layout.get("text-variable-anchor"),ut=X.projection.name==="globe",pt=[],Dt=[0,-1,0];let wt=Dt;!ut&&!X.mercatorFromTransition||Z||(wt=function(St){const mt=St._camera.getWorldToCamera(St.worldSize,1),Lt=s.m.multiply([],mt,St.globeMatrix);s.m.invert(Lt,Lt);const Tt=[0,0,0],zt=[0,1,0,0];return s.e.transformMat4(zt,zt,Lt),Tt[0]=zt[0],Tt[1]=zt[1],Tt[2]=zt[2],s.v.normalize(Tt,Tt),Tt}(X));for(const St of _){const mt=o.getTile(St),Lt=mt.getBucket(l);if(!Lt||Lt.projection.name==="mercator"&&ut)continue;const Tt=v?Lt.text:Lt.icon;if(!Tt||Lt.fullyClipped||!Tt.segments.get().length)continue;const zt=Tt.programConfigurations.get(l.id),tt=v||Lt.sdfIcons,yt=v?Lt.textSizeData:Lt.iconSizeData,Gt=j||X.pitch!==0,Ft=s.i(yt,X.zoom);let ge,ce,Se,fe,Pe=[0,0],Le=null;if(v)ce=mt.glyphAtlasTexture?mt.glyphAtlasTexture:null,Se=q.LINEAR,ge=mt.glyphAtlasTexture?mt.glyphAtlasTexture.size:[0,0],Lt.iconsInText&&(Pe=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0],Le=mt.imageAtlasTexture?mt.imageAtlasTexture:null,fe=Gt||d.options.rotating||d.options.zooming||yt.kind==="composite"||yt.kind==="camera"?q.LINEAR:q.NEAREST);else{const Or=l.layout.get("icon-size").constantOr(0)!==1||Lt.iconsNeedLinear;ce=mt.imageAtlasTexture?mt.imageAtlasTexture:null,Se=tt||d.options.rotating||d.options.zooming||Or||Gt?q.LINEAR:q.NEAREST,ge=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0]}const we=Lt.projection.name==="globe",Ee=we?wt:Dt,dr=we?s.ao(X.zoom):0,Xe=_l(St,Lt.getProjection(),X),Zr=X.calculatePixelsToTileUnitsMatrix(mt),Dr=ci(Xe,mt.tileID.canonical,j,Z,X,Lt.getProjection(),Zr),Wi=d.terrain&&j&&J?s.m.invert(s.m.create(),Dr):Th,Oo=Ta(Xe,mt.tileID.canonical,j,Z,X,Lt.getProjection(),Zr),Mr=ht&&Lt.hasTextData(),gr=Lt.hasIconTextFit()&&Mr&&Lt.hasIconData();if(J){const Or=X.elevation,ns=Or?Or.getAtTileOffsetFunc(St,X.center.lat,X.worldSize,Lt.getProjection()):null,Ts=Js(Xe,mt.tileID.canonical,j,Z,X,Lt.getProjection(),Zr);Yt(Lt,Xe,d,v,Ts,Oo,j,D,ns,St)}const xr=J||v&&ht||gr,nn=d.translatePosMatrix(Xe,mt,w,I),ri=xr?Th:Dr,Hr=d.translatePosMatrix(Oo,mt,w,I,!0),Ei=Lt.getProjection().createInversionMatrix(X,St.canonical),Hi=l.paint.get("icon-image-cross-fade").constantOr(0),Ii=[];d.terrainRenderModeElevated()&&j&&Ii.push("PITCH_WITH_MAP_TERRAIN"),we&&(Ii.push("PROJECTION_GLOBE_VIEW"),xr&&Ii.push("PROJECTED_POS_ON_VIEWPORT")),Hi>0&&Ii.push("ICON_TRANSITION"),Tt.zOffsetVertexBuffer&&Ii.push("Z_OFFSET");const zo=tt&&l.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ra;tt?ra=Lt.iconsInText?rc(yt.kind,Ft,nt,j,d,nn,ri,Hr,ge,Pe,St,dr,lt,Ei,Ee,Lt.getProjection()):Eh(yt.kind,Ft,nt,j,d,nn,ri,Hr,v,ge,!0,St,dr,lt,Ei,Ee,Lt.getProjection()):(z<1&&Ii.push("SATURATION"),ra=ec(yt.kind,Ft,nt,j,d,nn,ri,Hr,v,ge,St,dr,lt,Ei,Ee,Lt.getProjection(),z,Hi));const rs={program:d.getOrCreateProgram(hf(tt,v,Lt),{config:zt,defines:Ii}),buffers:Tt,uniformValues:ra,atlasTexture:ce,atlasTextureIcon:Le,atlasInterpolation:Se,atlasInterpolationIcon:fe,isSDF:tt,hasHalo:zo,tile:mt,labelPlaneMatrixInv:Wi};if(st&&Lt.canOverlap){Y=!0;const Or=Tt.segments.get();for(const ns of Or)pt.push({segments:new s.bm([ns]),sortKey:ns.sortKey,state:rs})}else pt.push({segments:Tt.segments,sortKey:0,state:rs})}Y&&pt.sort((St,mt)=>St.sortKey-mt.sortKey);for(const St of pt){const mt=St.state;if(d.terrain&&d.terrain.setupElevationDraw(mt.tile,mt.program,{useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:mt.labelPlaneMatrixInv}),U.activeTexture.set(q.TEXTURE0),mt.atlasTexture&&mt.atlasTexture.bind(mt.atlasInterpolation,q.CLAMP_TO_EDGE,!0),mt.atlasTextureIcon&&(U.activeTexture.set(q.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,q.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,mt.program),mt.hasHalo){const Lt=mt.uniformValues;Lt.u_is_halo=1,Ch(mt.buffers,St.segments,l,d,mt.program,K,k,B,Lt,2),Lt.u_is_halo=0}else{if(mt.isSDF){const Lt=mt.uniformValues;mt.hasHalo&&(Lt.u_is_halo=1,Ch(mt.buffers,St.segments,l,d,mt.program,K,k,B,Lt,1)),Lt.u_is_halo=0}Ch(mt.buffers,St.segments,l,d,mt.program,K,k,B,mt.uniformValues,1)}}}function Ch(d,o,l,_,v,w,I,C,P,D){const z=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];v.draw(_,_.context.gl.TRIANGLES,w,I,C,s.b5.disabled,P,l.id,d.layoutVertexBuffer,d.indexBuffer,o,l.paint,_.transform.zoom,d.programConfigurations.get(l.id),z,D)}function ic(d,o,l,_,v,w,I){const C=d.context.gl,P=l.paint.get("fill-pattern"),D=P&&P.constantOr(1);let z,k,B,U,q;I?(k=D&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=C.LINES):(k=D?"fillPattern":"fill",z=C.TRIANGLES);for(const X of _){const Z=o.getTile(X);if(D&&!Z.patternsLoaded())continue;const j=Z.getBucket(l);if(!j)continue;d.prepareDrawTile();const J=j.programConfigurations.get(l.id),nt=d.isTileAffectedByFog(X),st=d.getOrCreateProgram(k,{config:J,overrideFog:nt});D&&(d.context.activeTexture.set(C.TEXTURE0),Z.imageAtlasTexture&&Z.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),J.updatePaintBuffers());const Y=P.constantOr(null);if(Y&&Z.imageAtlas){const ht=Z.imageAtlas.patternPositions[Y.toString()];ht&&J.setConstantPatternPositions(ht)}const K=d.translatePosMatrix(X.projMatrix,Z,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),lt=l.paint.get("fill-emissive-strength");if(I){U=j.indexBuffer2,q=j.segments2;const ht=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];B=k==="fillOutlinePattern"&&D?A_(K,lt,d,Z,ht):af(K,lt,ht)}else U=j.indexBuffer,q=j.segments,B=D?sf(K,lt,d,Z):of(K,lt);d.uploadCommonUniforms(d.context,st,X.toUnwrapped()),st.draw(d,z,v,d.stencilModeForClipping(X),w,s.b5.disabled,B,l.id,j.layoutVertexBuffer,U,q,l.paint,d.transform.zoom,J,void 0)}}function oc(d,o,l,_,v,w,I,C){l.resetLayerRenderingStats();const P=d.context,D=P.gl,z=d.transform,k=l.paint.get("fill-extrusion-pattern"),B=k.constantOr(1),U=l.paint.get("fill-extrusion-opacity"),q=d.style.enable3dLights(),X=l.paint.get(q&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Z=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],j=l.layout.get("fill-extrusion-edge-radius"),J=j>0&&!l.paint.get("fill-extrusion-rounded-roof"),nt=J?0:j,st=z.projection.name==="globe"?s.bO():0,Y=z.projection.name==="globe",K=Y?s.ao(z.zoom):0,lt=[s.E(z.center.lng),s.H(z.center.lat)],ht=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ut=l.paint.get("fill-extrusion-flood-light-intensity"),pt=l.paint.get("fill-extrusion-vertical-scale"),Dt=xl(d,l.paint.get("fill-extrusion-cutoff-fade-range")),wt=l.paint.get("fill-extrusion-emissive-strength"),St=[];let mt;Y&&St.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&St.push("FAUX_AO"),J&&St.push("ZERO_ROOF_RADIUS"),C&&St.push("HAS_CENTROID"),ut>0&&St.push("FLOOD_LIGHT"),Dt.shouldRenderCutoff&&St.push("RENDER_CUTOFF");const Lt=d.renderPass==="shadow",Tt=d.shadowRenderer,zt=Lt&&!!Tt;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let tt=[0,0,0];if(Tt){const Ft=d.style.directionalLight,ge=d.style.ambientLight;Ft&&ge&&(tt=Ph(Ft,ge)),mt=St.concat(["SHADOWS_SINGLE_CASCADE"])}const yt=zt?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",Gt=l.getLayerRenderingStats();for(const Ft of _){const ge=o.getTile(Ft),ce=ge.getBucket(l);if(!ce||ce.projection.name!==z.projection.name)continue;let Se=!1;Tt&&(Se=Tt.getMaxCascadeForTile(Ft.toUnwrapped())===0);const fe=d.isTileAffectedByFog(Ft),Pe=ce.programConfigurations.get(l.id),Le=d.getOrCreateProgram(yt,{config:Pe,defines:Se?mt:St,overrideFog:fe});if(d.terrain&&d.terrain.setupElevationDraw(ge,Le,{useMeterToDem:!0}),!ce.centroidVertexBuffer){const Dr=Le.attributes.a_centroid_pos;Dr!==void 0&&D.vertexAttrib2f(Dr,0,0)}!Lt&&Tt&&Tt.setupShadows(ge.tileID.toUnwrapped(),Le,"vector-tile",ge.tileID.overscaledZ),B&&(d.context.activeTexture.set(D.TEXTURE0),ge.imageAtlasTexture&&ge.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Pe.updatePaintBuffers());const we=k.constantOr(null);if(we&&ge.imageAtlas){const Dr=ge.imageAtlas.patternPositions[we.toString()];Dr&&Pe.setConstantPatternPositions(Dr)}const Ee=l.paint.get("fill-extrusion-vertical-gradient");let dr;if(Lt&&Tt){if(O_(ge.tileID,ce,d))continue;const Dr=Tt.calculateShadowPassMatrixFromTile(ge.tileID.toUnwrapped());dr=nf(Dr,nt,pt)}else{const Dr=d.translatePosMatrix(Ft.expandedProjMatrix,ge,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Wi=z.projection.createInversionMatrix(z,Ft.canonical);dr=B?M_(Dr,d,Ee,U,Z,nt,Ft,ge,st,K,lt,Wi,ht,pt):bl(Dr,d,Ee,U,Z,nt,Ft,st,K,lt,Wi,ht,pt,ut,tt,wt)}d.uploadCommonUniforms(P,Le,Ft.toUnwrapped(),null,Dt);let Xe=ce.segments;if(z.projection.name==="mercator"&&!Lt&&(Xe=ce.getVisibleSegments(ge.tileID,d.terrain,d.transform.getFrustum(0)),!Xe.get().length))continue;if(Gt)if(Lt)for(const Dr of Xe.get())Gt.numRenderedVerticesInShadowPass+=Dr.primitiveLength;else for(const Dr of Xe.get())Gt.numRenderedVerticesInTransparentPass+=Dr.primitiveLength;const Zr=[];(d.terrain||C)&&Zr.push(ce.centroidVertexBuffer),Y&&Zr.push(ce.layoutVertexExtBuffer),Le.draw(d,P.gl.TRIANGLES,v,w,I,s.b5.backCCW,dr,l.id,ce.layoutVertexBuffer,ce.indexBuffer,Xe,l.paint,d.transform.zoom,Pe,Zr)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function El(d,o,l,_,v,w,I,C,P,D,z,k,B,U,q,X,Z,j,J){const nt=d.context,st=nt.gl,Y=d.transform,K=d.transform.zoom,lt=[],ht=xl(d,l.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(lt.push("CLEAR_SUBPASS"),J&&(lt.push("CLEAR_FROM_TEXTURE"),nt.activeTexture.set(st.TEXTURE0),J.bind(st.LINEAR,st.CLAMP_TO_EDGE))):D==="sdf"&&lt.push("SDF_SUBPASS"),Z&&lt.push("HAS_CENTROID"),ht.shouldRenderCutoff&&lt.push("RENDER_CUTOFF");const ut=l.layout.get("fill-extrusion-edge-radius"),pt=(Dt,wt,St,mt,Lt)=>{const Tt=wt.programConfigurations.get(l.id),zt=d.isTileAffectedByFog(Dt),tt=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Tt,defines:lt,overrideFog:zt}),yt=((Ft,ge,ce,Se,fe,Pe,Le,we,Ee,dr,Xe)=>({u_matrix:ge,u_opacity:ce,u_ao_pass:Se?1:0,u_meter_to_tile:fe,u_ao:Pe,u_flood_light_intensity:Le,u_flood_light_color:we,u_attenuation:Ee,u_edge_radius:dr,u_fb:0,u_fb_size:Xe}))(0,mt,z,P,Lt,[k,B*Lt],U,q,X,K>=17?0:ut*Lt,J?J.size[0]:0),Gt=[];Z&&Gt.push(wt.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(nt,tt,Dt.toUnwrapped(),null,ht),tt.draw(d,nt.gl.TRIANGLES,v,w,I,C,yt,l.id,wt.vertexBuffer,wt.indexBuffer,St,l.paint,K,Tt,Gt)};for(const Dt of _){const wt=o.getTile(Dt),St=wt.getBucket(l);if(!St||St.projection.name!==Y.projection.name||!St.groundEffect||St.groundEffect&&!St.groundEffect.hasData())continue;const mt=St.groundEffect,Lt=1/St.tileToMeter;{const Tt=d.translatePosMatrix(Dt.projMatrix,wt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),zt=mt.getDefaultSegment();pt(Dt,mt,zt,Tt,Lt)}if(j)for(let Tt=0;Tt<4;Tt++){const zt=s.bP[Tt](Dt),tt=o.getTile(zt);if(!tt)continue;const yt=tt.getBucket(l);if(!yt||yt.projection.name!==Y.projection.name||!yt.groundEffect||yt.groundEffect&&!yt.groundEffect.hasData())continue;const Gt=yt.groundEffect;let Ft,ge;Tt===0?(Ft=[-s.J,0,0],ge=1):Tt===1?(Ft=[s.J,0,0],ge=0):Tt===2?(Ft=[0,-s.J,0],ge=3):(Ft=[0,s.J,0],ge=2);const ce=Gt.regionSegments[ge];if(!ce)continue;const Se=new Float32Array(16);s.m.translate(Se,Dt.projMatrix,Ft),pt(Dt,Gt,ce,d.translatePosMatrix(Se,wt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Lt)}}}function im(d,o,l,_,v,w,I){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();const C=w?w.findDEMTileFor(l):null;if(!(C&&C.dem||I))return;const P=j=>new s.P(Math.ceil((j+s.bS)*s.bT),0),D=j=>{const J=o.getSource().minzoom,nt=Y=>{const K=o.getTileByID(Y);if(K&&K.hasData())return K.getBucket(v)},st=[0,-1,1];for(const Y of st){if(j.overscaledZ+Y<J)continue;const K=nt(j.calculateScaledKey(j.overscaledZ+Y));if(K)return K}},z=[0,0,0],k=(j,J)=>(z[0]=Math.min(j.min.y,J.min.y),z[1]=Math.max(j.max.y,J.max.y),z[2]=s.J-J.min.x>j.max.x?J.min.x-s.J:j.max.x,z),B=(j,J)=>(z[0]=Math.min(j.min.x,J.min.x),z[1]=Math.max(j.max.x,J.max.x),z[2]=s.J-J.min.y>j.max.y?J.min.y-s.J:j.max.y,z),U=[(j,J)=>k(j,J),(j,J)=>k(J,j),(j,J)=>B(j,J),(j,J)=>B(J,j)],q=(j,J,nt,st,Y,K,lt)=>{if(!w)return 0;const ht=[[K?nt:j,K?j:nt,0],[K?nt:J,K?J:nt,0]],ut=lt<0?s.J+lt:lt,pt=[K?ut:(j+J)/2,K?(j+J)/2:ut,0];return nt===0&&lt<0||nt!==0&&lt>0?w.getForTilePoints(Y,[pt],!0,st):ht.push(pt),w.getForTilePoints(l,ht,!0,C),Math.max(ht[0][2],ht[1][2],pt[2])/w.exaggeration()};for(let j=0;j<4;j++){const J=_.borderFeatureIndices[j];if(J.length===0)continue;const nt=s.bP[j](l),st=D(nt);if(!(st&&st instanceof s.bQ)||_.borderDoneWithNeighborZ[j]===st.canonical.z)continue;st.centroidVertexArray.length===0&&st.createCentroidsBuffer();const Y=w?w.findDEMTileFor(nt):null;if(!(Y&&Y.dem||I))continue;const K=(j<2?1:5)-j,lt=st.borderDoneWithNeighborZ[K]!==_.canonical.z,ht=st.borderFeatureIndices[K];let ut=0;if(_.canonical.z!==st.canonical.z){for(const pt of J)_.showCentroid(_.featuresOnBorder[pt]);if(lt)for(const pt of ht)st.showCentroid(st.featuresOnBorder[pt]);_.borderDoneWithNeighborZ[j]=st.canonical.z,st.borderDoneWithNeighborZ[K]=_.canonical.z}for(const pt of J){const Dt=_.featuresOnBorder[pt],wt=_.centroidData[Dt.centroidDataIndex],St=Dt.borders[j];let mt;for(;ut<ht.length;){mt=st.featuresOnBorder[ht[ut]];const Lt=mt.borders[K];if(Lt[1]>St[0]+3||Lt[0]>St[0]-3)break;st.showCentroid(mt),ut++}if(mt&&ut<ht.length){const Lt=ut;let Tt=0;for(;!(mt.borders[K][0]>St[1]-3)&&(Tt++,++ut!==ht.length);)mt=st.featuresOnBorder[ht[ut]];if(mt=st.featuresOnBorder[ht[Lt]],Tt>1){const yt=mt.borders[K];Math.abs(St[0]-yt[0])<3&&Math.abs(St[1]-yt[1])<3&&(Tt=1,ut=Lt+1)}else if(Tt===0){_.showCentroid(Dt);continue}const zt=st.centroidData[mt.centroidDataIndex];I&&Tt===1&&(((X=wt).flags|(Z=zt).flags)&s.bR?(X.flags|=s.bR,Z.flags|=s.bR):(X.flags&=~s.bR,Z.flags&=~s.bR));const tt=Dt.intersectsCount()>1||mt.intersectsCount()>1;if(Tt>1)ut=Lt,wt.centroidXY=zt.centroidXY=new s.P(0,0);else if(Y&&Y.dem&&!tt){const yt=U[j](wt,zt),Gt=j%2?s.J-1:0,Ft=q(yt[0],Math.min(s.J-1,yt[1]),Gt,Y,nt,j<2,yt[2]);wt.centroidXY=zt.centroidXY=P(Ft)}else tt?wt.centroidXY=zt.centroidXY=new s.P(0,0):(wt.centroidXY=_.encodeBorderCentroid(Dt),zt.centroidXY=st.encodeBorderCentroid(mt));_.writeCentroidToBuffer(wt),st.writeCentroidToBuffer(zt)}else _.showCentroid(Dt)}_.borderDoneWithNeighborZ[j]=st.canonical.z,st.borderDoneWithNeighborZ[K]=_.canonical.z}var X,Z;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(d)}const hu=[1,0,0],om=[0,1,0],R_=[0,0,1];function O_(d,o,l){const _=l.transform,v=l.shadowRenderer;if(!v)return!0;const w=d.toUnwrapped(),I=_.tileSize*v._cascades[l.currentShadowCascade].scale;let C=o.maxHeight;if(_.elevation){const X=_.elevation.getMinMaxForTile(d);X&&(C+=X.max)}const P=[...v.shadowDirection];P[2]=-P[2];const D=v.computeSimplifiedTileShadowVolume(w,C,I,P);if(!D)return!1;const z=[hu,om,R_,P,[P[0],0,P[2]],[0,P[1],P[2]]],k=_.projection.name==="globe",B=_.scaleZoom(I),U=s.F.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,B,!k),q=v.getCurrentCascadeFrustum();return U.intersectsPrecise(D.vertices,D.planes,z)===0||q.intersectsPrecise(D.vertices,D.planes,z)===0}function z_(d){const o=d._nearZ,l=d.projection.farthestPixelDistance(d),_=l-o,v=.2*d.height,w=o+v;return[o,l,(w-v-o)/_,(w-o)/_]}const pf=new s.C(1,0,0,1),ff=new s.C(0,1,0,1),df=new s.C(0,0,1,1),mf=new s.C(1,0,1,1),sm=new s.C(0,1,1,1);function Il(d,o,l,_,v,w){const I=d.context,C=d.transform,P=I.gl,D=C.projection.name==="globe",z=D?["PROJECTION_GLOBE_VIEW"]:[];let k=s.m.clone(l.projMatrix);if(D&&s.ao(C.zoom)>0){const mt=s.bU(l.canonical,C),Lt=s.bV(mt);k=s.m.multiply(new Float32Array(16),C.globeMatrix,Lt),s.m.multiply(k,C.projMatrix,k)}const B=s.m.create();B[12]+=2*v/(s.a4.devicePixelRatio*C.width),B[13]+=2*w/(s.a4.devicePixelRatio*C.height),s.m.multiply(k,B,k);const U=d.getOrCreateProgram("debug",{defines:z}),q=o.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(q,U);const X=s.b4.disabled,Z=s.b6.disabled,j=d.colorModeForRenderPass(),J="$debug";I.activeTexture.set(P.TEXTURE0),d.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),D?q._makeGlobeTileDebugBuffers(d.context,C):q._makeDebugTileBoundsBuffers(d.context,C.projection);const nt=q._tileDebugBuffer||d.debugBuffer,st=q._tileDebugIndexBuffer||d.debugIndexBuffer,Y=q._tileDebugSegments||d.debugSegments;U.draw(d,P.LINE_STRIP,X,Z,j,s.b5.disabled,Qd(k,_),J,nt,st,Y,null,null,null,[q._globeTileDebugBorderBuffer]);const K=q.latestRawTileData,lt=Math.floor((K&&K.byteLength||0)/1024),ht=o.getTile(l).tileSize,ut=512/Math.min(ht,512)*(l.overscaledZ/C.zoom)*.5;let pt=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(pt+=` => ${l.overscaledZ}`),pt+=` ${lt}kb`,function(mt,Lt){mt.initDebugOverlayCanvas();const Tt=mt.debugOverlayCanvas,zt=mt.context.gl,tt=mt.debugOverlayCanvas.getContext("2d");tt.clearRect(0,0,Tt.width,Tt.height),tt.shadowColor="white",tt.shadowBlur=2,tt.lineWidth=1.5,tt.strokeStyle="white",tt.textBaseline="top",tt.font="bold 36px Open Sans, sans-serif",tt.fillText(Lt,5,5),tt.strokeText(Lt,5,5),mt.debugOverlayTexture.update(Tt),mt.debugOverlayTexture.bind(zt.LINEAR,zt.CLAMP_TO_EDGE)}(d,pt);const Dt=q._tileDebugTextBuffer||d.debugBuffer,wt=q._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,St=q._tileDebugTextSegments||d.debugSegments;U.draw(d,P.TRIANGLES,X,Z,s.a.alphaBlended,s.b5.disabled,Qd(k,s.C.transparent,ut),J,Dt,wt,St,null,null,null,[q._globeTileDebugTextBuffer])}function am(d,o,l,_){Da(d,0,o+l/2,d.transform.width,l,_)}function pu(d,o,l,_){Da(d,o-l/2,0,l,d.transform.height,_)}function Da(d,o,l,_,v,w){const I=d.context,C=I.gl;C.enable(C.SCISSOR_TEST),C.scissor(o*s.a4.devicePixelRatio,l*s.a4.devicePixelRatio,_*s.a4.devicePixelRatio,v*s.a4.devicePixelRatio),I.clear({color:w}),C.disable(C.SCISSOR_TEST)}const lm=s.bW([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mh}=lm;function Es(d,o,l,_){d.emplaceBack(o,l,_)}class ts{constructor(o){this.vertexArray=new s.bX,this.indices=new s.bp,Es(this.vertexArray,-1,-1,1),Es(this.vertexArray,1,-1,1),Es(this.vertexArray,-1,1,1),Es(this.vertexArray,1,1,1),Es(this.vertexArray,-1,-1,-1),Es(this.vertexArray,1,-1,-1),Es(this.vertexArray,-1,1,-1),Es(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Mh),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=s.bm.simpleSegment(0,0,36,12)}}function Ra(d,o,l,_,v,w){const I=d.context.gl,C=o.paint.get("sky-atmosphere-color"),P=o.paint.get("sky-atmosphere-halo-color"),D=o.paint.get("sky-atmosphere-sun-intensity"),z=((k,B,U,q,X)=>({u_matrix_3f:k,u_sun_direction:B,u_sun_intensity:U,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(s.bx.fromMat4(s.bx.create(),_),v,D,C,P);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+w,o.skyboxTexture,0),l.draw(d,I.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.frontCW,z,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const um=s.bW([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class gf{constructor(o){const l=new s.bY;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const _=new s.bp;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(l,um.members),this.indexBuffer=o.createIndexBuffer(_),this.segments=s.bm.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const cm=s.bW([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class _f{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15}}class N_{constructor(o){this.colorModeAlphaBlendedWriteRGB=new s.a([s.bZ,s.b_,s.bZ,s.b_],s.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new s.a([s.bZ,s.b$,s.bZ,s.b$],s.C.transparent,[!1,!1,!1,!0]),this.params=new _f,this.allocatedStarsCount=0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01})}update(o){const l=o.context;if(!this.atmosphereBuffer||this.allocatedStarsCount!==this.params.starsCount){this.atmosphereBuffer=new gf(l),this.allocatedStarsCount=this.params.starsCount;const _=100,v=200,w=function(z){const k=s.c2(30),B=[];for(let U=0;U<z;++U){const q=2*Math.PI*k(),X=Math.acos(1-2*k())-.5*Math.PI;B.push(s.v.fromValues(Math.cos(X)*Math.cos(q),Math.cos(X)*Math.sin(q),Math.sin(X)))}return B}(this.allocatedStarsCount),I=s.c2(300),C=new s.c0,P=new s.bp;let D=0;for(let z=0;z<w.length;++z){const k=s.v.scale([],w[z],200),B=Math.max(0,1+.01*_*(1*I()-.5)),U=Math.max(0,1+.01*v*(1*I()-.5));C.emplaceBack(k[0],k[1],k[2],-1,-1,B,U),C.emplaceBack(k[0],k[1],k[2],1,-1,B,U),C.emplaceBack(k[0],k[1],k[2],1,1,B,U),C.emplaceBack(k[0],k[1],k[2],-1,1,B,U),P.emplaceBack(D+0,D+1,D+2),P.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=l.createVertexBuffer(C,cm.members),this.starsIdx=l.createIndexBuffer(P),this.starsSegments=s.bm.simpleSegment(0,0,C.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,l){const _=o.context,v=_.gl,w=o.transform,I=new s.b4(v.LEQUAL,s.b4.ReadOnly,[0,1]),C=s.ao(w.zoom),P=l.properties.get("color").toArray01(),D=l.properties.get("high-color").toArray01(),z=l.properties.get("space-color").toArray01PremultipliedAlpha(),k=5e-4,B=s.c1(l.properties.get("horizon-blend"),0,1,k,.25),U=s.bb(o,_,w)&&B===k?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,q=o.frameCounter/1e3%1,X=s.v.length(w.globeCenterInViewSpace),Z=Math.sqrt(Math.pow(X,2)-Math.pow(U,2)),j=Math.acos(Z/X),J=nt=>{const st=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];nt&&st.push("ALPHA_PASS");const Y=o.getOrCreateProgram("globeAtmosphere",{defines:st}),K=((ht,ut,pt,Dt,wt,St,mt,Lt,Tt,zt,tt,yt)=>({u_frustum_tl:ht,u_frustum_tr:ut,u_frustum_br:pt,u_frustum_bl:Dt,u_horizon:wt,u_transition:St,u_fadeout_range:mt,u_color:Lt,u_high_color:Tt,u_space_color:zt,u_temporal_offset:tt,u_horizon_angle:yt}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,C,B,P,D,z,q,j);o.uploadCommonUniforms(_,Y);const lt=this.atmosphereBuffer;lt&&Y.draw(o,v.TRIANGLES,I,s.b6.disabled,nt?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,s.b5.backCW,K,nt?"atmosphere_glow_alpha":"atmosphere_glow",lt.vertexBuffer,lt.indexBuffer,lt.segments)};J(!1),J(!0)}drawStars(o,l){const _=s.c(l.properties.get("star-intensity"),0,1);if(_===0)return;const v=o.context,w=v.gl,I=o.transform,C=o.getOrCreateProgram("stars"),P=s.q.identity([]);s.q.rotateX(P,P,-I._pitch),s.q.rotateZ(P,P,-I.angle),s.q.rotateX(P,P,s.d(I._center.lat)),s.q.rotateY(P,P,-s.d(I._center.lng));const D=s.m.fromQuat(new Float32Array(16),P),z=s.m.multiply([],I.starsProjMatrix,D),k=s.bx.fromMat4([],D),B=s.bx.invert([],k),U=[0,1,0];s.v.transformMat3(U,U,B),s.v.scale(U,U,this.params.sizeMultiplier);const q=[1,0,0];s.v.transformMat3(q,q,B),s.v.scale(q,q,this.params.sizeMultiplier);const X=(Z=U,j=q,J=_,{u_matrix:Float32Array.from(z),u_up:Z,u_right:j,u_intensity_multiplier:J});var Z,j,J;o.uploadCommonUniforms(v,C),this.starsVx&&this.starsIdx&&C.draw(o,w.TRIANGLES,s.b4.disabled,s.b6.disabled,this.colorModeAlphaBlendedWriteRGB,s.b5.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ah(d,o){const l=[...d],_=o.cameraWorldSizeForFog/o.worldSize,v=s.m.identity([]);return s.m.scale(v,v,[_,_,1]),s.m.multiply(l,v,l),s.m.multiply(l,o.worldToFogMatrix,l),l}function yf(d,o,l,_){const v=l.material,w=_.context,{baseColorTexture:I,metallicRoughnessTexture:C}=v.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:D,emissionTexture:z}=v;function k(B,U,q){if(B&&(d.push(U),w.activeTexture.set(w.gl.TEXTURE0+q),B.gfxTexture)){const{minFilter:X,magFilter:Z,wrapS:j,wrapT:J}=B.sampler;B.gfxTexture.bindExtraParam(X,Z,j,J)}}k(I,"HAS_TEXTURE_u_baseColorTexture",pi.BaseColor),k(C,"HAS_TEXTURE_u_metallicRoughnessTexture",pi.MetallicRoughness),k(P,"HAS_TEXTURE_u_normalTexture",pi.Normal),k(D,"HAS_TEXTURE_u_occlusionTexture",pi.Occlusion),k(z,"HAS_TEXTURE_u_emissionTexture",pi.Emission),l.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(l.texcoordBuffer)),l.colorBuffer&&(d.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(l.colorBuffer)),l.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(l.normalBuffer)),l.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(l.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES")}function Tl(d,o,l,_,v,w){const I=l.paint.get("model-opacity"),C=o.context,P=new s.b4(o.context.gl.LEQUAL,s.b4.ReadWrite,o.depthRangeFor3D),D=o.transform,z=d.mesh,k=z.material,B=k.pbrMetallicRoughness,U=o.style.fog;let q;q=o.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:s.m.multiply([],_.zScaleMatrix,d.nodeModelMatrix),s.m.multiply(q,_.negCameraPosMatrix,q);const X=s.m.invert([],q);s.m.transpose(X,X);const Z=l.paint.get("model-emissive-strength").constantOr(0),j=nc(new Float32Array(d.worldViewProjection),new Float32Array(q),new Float32Array(X),o,I,B.baseColorFactor,k.emissiveFactor,B.metallicFactor,B.roughnessFactor,k,Z,l),J={defines:[]},nt=[];yf(J.defines,nt,z,o);const st=o.shadowRenderer;st&&(st.useNormalOffset=!1);let Y=null;if(U){const ht=Ah(d.nodeModelMatrix,o.transform);if(Y=new Float32Array(ht),D.projection.name!=="globe"){const ut=z.aabb.min,pt=z.aabb.max,[Dt,wt]=U.getOpacityForBounds(ht,ut[0],ut[1],pt[0],pt[1]);J.overrideFog=Dt>=ro||wt>=ro}}const K=xl(o,l.paint.get("model-cutoff-fade-range"));K.shouldRenderCutoff&&J.defines.push("RENDER_CUTOFF");const lt=o.getOrCreateProgram("model",J);o.uploadCommonUniforms(C,lt,null,Y,K),o.renderPass!=="shadow"&&st&&st.setupShadowsFromMatrix(d.nodeModelMatrix,lt),lt.draw(o,C.gl.TRIANGLES,P,v,w,z.material.doubleSided?s.b5.disabled:s.b5.backCCW,j,l.id,z.vertexBuffer,z.indexBuffer,z.segments,l.paint,o.transform.zoom,void 0,nt)}function hm(d,o,l,_,v,w,I){let C;C=d.projection.name==="globe"?s.c5(l,d):[...l],s.m.multiply(C,C,o.matrix);const P=s.m.multiply([],_,C);if(o.meshes)for(const D of o.meshes){if(D.material.alphaMode!=="BLEND"){I.push({mesh:D,depth:0,modelIndex:v,worldViewProjection:P,nodeModelMatrix:C});continue}const z=s.v.transformMat4([],D.centroid,P);z[2]>0&&w.push({mesh:D,depth:z[2],modelIndex:v,worldViewProjection:P,nodeModelMatrix:C})}if(o.children)for(const D of o.children)hm(d,D,l,_,v,w,I)}function sc(d,o,l,_){const v=l.shadowRenderer;if(!v)return;const w=v.getShadowPassDepthMode(),I=v.getShadowPassColorMode(),C=v.calculateShadowPassMatrixFromMatrix(o),P=Ih(C);l.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,w,s.b6.disabled,I,s.b5.backCCW,P,_.id,d.vertexBuffer,d.indexBuffer,d.segments,_.paint,l.transform.zoom,void 0,void 0)}function k_(d,o,l){const _=o.updateZoomBasedPaintProperties(),v=function(w,I,C){let P,D,z,k=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&k>0){const B=w.terrain,U=B.findDEMTileFor(C);U&&U.dem?P=s.c7.create(B,C,U):k=0}if(k===0&&(I.terrainElevationMin=0,I.terrainElevationMax=0),k===I.validForExaggeration&&(k===0||P&&P._demTile&&P._demTile.tileID===I.validForDEMTile.id&&P._dem._timestamp===I.validForDEMTile.timestamp))return!1;for(const B in I.instancesPerModel){const U=I.instancesPerModel[B];for(let q=0;q<U.instancedDataArray.length;++q){const X=(P?k*P.getElevationAt(0|U.instancedDataArray.float32[16*q],0|U.instancedDataArray.float32[16*q+1],!0,!0):0)+U.instancesEvaluatedElevation[q];U.instancedDataArray.float32[16*q+6]=X,D=D?Math.min(I.terrainElevationMin,X):X,z=z?Math.max(I.terrainElevationMax,X):X}}return I.terrainElevationMin=D||0,I.terrainElevationMax=z||0,I.validForExaggeration=k,I.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,o,l);(_||v)&&(o.uploaded=!1,o.upload(d.context))}const Do={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.c3([0,0,0],[s.J,s.J,0])};function F_(d,o){const l=1<<d.canonical.z,_=o.getFreeCameraOptions().position,v=o.elevation,w=d.canonical.x/l,I=(d.canonical.x+1)/l,C=d.canonical.y/l,P=(d.canonical.y+1)/l;let D=o._centerAltitude;if(v){const U=v.getMinMaxForTile(d);U&&U.max>D&&(D=U.max)}const z=s.c(_.x,w,I)-_.x,k=s.c(_.y,C,P)-_.y,B=s.b(D,o.center.lat)-_.z;return o._zoomFromMercatorZ(Math.sqrt(z*z+k*k+B*B))}function ac(d,o,l,_,v,w,I){const C=d.context,P=d.renderPass==="shadow",D=d.shadowRenderer,z=P&&D?D.getShadowPassDepthMode():new s.b4(C.gl.LEQUAL,s.b4.ReadWrite,d.depthRangeFor3D),k=d.isTileAffectedByFog(w);if(l.meshes)for(const B of l.meshes){const U=["MODEL_POSITION_ON_GPU"],q=[];let X,Z,j;_.instancedDataArray.length>20&&U.push("INSTANCED_ARRAYS");const J=xl(d,o.paint.get("model-cutoff-fade-range"));if(J.shouldRenderCutoff&&U.push("RENDER_CUTOFF"),P&&D)X=d.getOrCreateProgram("modelDepth",{defines:U}),Z=Ih(I.shadowTileMatrix,I.shadowTileMatrix,Float32Array.from(l.matrix)),j=D.getShadowPassColorMode();else{yf(U,q,B,d),X=d.getOrCreateProgram("model",{defines:U,overrideFog:k});const st=B.material,Y=st.pbrMetallicRoughness,K=o.paint.get("model-opacity"),lt=o.paint.get("model-emissive-strength").constantOr(0);Z=nc(w.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),d,K,Y.baseColorFactor,st.emissiveFactor,Y.metallicFactor,Y.roughnessFactor,st,lt,o,v),D&&(I.shadowUniformsInitialized?X.setShadowUniformValues(C,D.getShadowUniformValues()):(D.setupShadows(w.toUnwrapped(),X,"model-tile",w.overscaledZ),I.shadowUniformsInitialized=!0)),j=J.shouldRenderCutoff||K<1||st.alphaMode!=="OPAQUE"?s.a.alphaBlended:s.a.unblended}d.uploadCommonUniforms(C,X,w.toUnwrapped(),null,J);const nt=B.material.doubleSided?s.b5.disabled:s.b5.backCCW;if(_.instancedDataArray.length>20)q.push(_.instancedDataBuffer),X.draw(d,C.gl.TRIANGLES,z,s.b6.disabled,j,nt,Z,o.id,B.vertexBuffer,B.indexBuffer,B.segments,o.paint,d.transform.zoom,void 0,q,_.instancedDataArray.length);else{const st=P?"u_instance":"u_normal_matrix";for(let Y=0;Y<_.instancedDataArray.length;++Y)Z[st]=new Float32Array(_.instancedDataArray.arrayBuffer,64*Y,16),X.draw(d,C.gl.TRIANGLES,z,s.b6.disabled,j,nt,Z,o.id,B.vertexBuffer,B.indexBuffer,B.segments,o.paint,d.transform.zoom,void 0,q)}}if(l.children)for(const B of l.children)ac(d,o,B,_,v,w,I)}const B_=[1,-1,1];function pm(d,o,l,_){if(!l.modelManager)return!0;const v=l.modelManager;if(!l.shadowRenderer)return!0;const w=l.shadowRenderer,I=o.aabb;let C=!0,P=d.maxHeight;if(P===0){let z=0;for(const k in d.instancesPerModel){const B=v.getModel(k,_);B?z=Math.max(z,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):C=!1}P=d.maxScale*z*1.41+d.maxVerticalOffset,C&&(d.maxHeight=P)}I.max[2]=P,I.min[2]+=d.terrainElevationMin,I.max[2]+=d.terrainElevationMax,s.v.transformMat4(I.min,I.min,o.tileMatrix),s.v.transformMat4(I.max,I.max,o.tileMatrix);const D=I.intersects(w.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=D===2),D===0}class fm{}class fu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,l,_){{const k=this._storage.get(l.id);if(k)return k.lastUsedFrameIdx=o,k.buf}const v=_.gl,w=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),I=new ArrayBuffer(w),C=new Int16Array(I);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(I));const P=new s.c9;for(let k=0;k<w/2;k+=3){const B=C[k],U=C[k+1],q=C[k+2];P.emplaceBack(B,U),P.emplaceBack(U,q),P.emplaceBack(q,B)}const D=_.bindVertexArrayOES.current,z=new fm;return z.buf=new s.I(_,P),z.lastUsedFrameIdx=o,this._storage.set(l.id,z),_.bindVertexArrayOES.set(D),z.buf}update(o){for(const[l,_]of this._storage)o-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(l))}destroy(){for(const[o,l]of this._storage)l.buf.destroy(),this._storage.delete(o)}}class dm{registerParameter(o,l,_,v,w){}registerButton(o,l,_){}}const vf={symbol:function(d,o,l,_,v){if(d.renderPass!=="translucent")return;const w=s.b6.disabled,I=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(C,P,D,z,k,B,U){const q=P.transform,X=k==="map",Z=B==="map";for(const j of C){const J=z.getTile(j),nt=J.getBucket(D);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const st=s.i(nt.textSizeData,q.zoom),Y=_l(j,nt.getProjection(),q),K=q.calculatePixelsToTileUnitsMatrix(J),lt=ci(Y,J.tileID.canonical,Z,X,q,nt.getProjection(),K),ht=nt.hasIconTextFit()&&nt.hasIconData();if(st){const ut=Math.pow(2,q.zoom-J.tileID.overscaledZ);cf(nt,X,Z,U,s.bG,q,lt,j,ut,st,ht)}}}(_,d,l,o,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),v),l.paint.get("icon-opacity").constantOr(1)!==0&&nr(d,o,l,_,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),l.paint.get("icon-color-saturation"),w,I),l.paint.get("text-opacity").constantOr(1)!==0&&nr(d,o,l,_,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),l.paint.get("icon-color-saturation"),w,I),o.map.showCollisionBoxes&&(uf(d,o,l,_,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),uf(d,o,l,_,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,o,l,_){if(d.renderPass!=="translucent")return;const v=l.paint.get("circle-opacity"),w=l.paint.get("circle-stroke-width"),I=l.paint.get("circle-stroke-opacity"),C=l.layout.get("circle-sort-key").constantOr(1)!==void 0,P=l.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(w.constantOr(1)===0||I.constantOr(1)===0))return;const D=d.context,z=D.gl,k=d.transform,B=d.depthModeForSublayer(0,s.b4.ReadOnly),U=s.b6.disabled,q=d.colorModeForDrapableLayerRenderPass(P),X=k.projection.name==="globe",Z=[s.E(k.center.lng),s.H(k.center.lat)],j=[];for(let nt=0;nt<_.length;nt++){const st=_[nt],Y=o.getTile(st),K=Y.getBucket(l);if(!K||K.projection.name!==k.projection.name)continue;const lt=K.programConfigurations.get(l.id),ht=s.bH(l),ut=d.isTileAffectedByFog(st);X&&ht.push("PROJECTION_GLOBE_VIEW");const pt=d.getOrCreateProgram("circle",{config:lt,defines:ht,overrideFog:ut}),Dt=K.layoutVertexBuffer,wt=K.globeExtVertexBuffer,St=K.indexBuffer,mt=k.projection.createInversionMatrix(k,st.canonical),Lt={programConfiguration:lt,program:pt,layoutVertexBuffer:Dt,globeExtVertexBuffer:wt,indexBuffer:St,uniformValues:s.bI(d,st,Y,mt,Z,l),tile:Y};if(C){const Tt=K.segments.get();for(const zt of Tt)j.push({segments:new s.bm([zt]),sortKey:zt.sortKey,state:Lt})}else j.push({segments:K.segments,sortKey:0,state:Lt})}C&&j.sort((nt,st)=>nt.sortKey-st.sortKey);const J={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(const nt of j){const{programConfiguration:st,program:Y,layoutVertexBuffer:K,globeExtVertexBuffer:lt,indexBuffer:ht,uniformValues:ut,tile:pt}=nt.state,Dt=nt.segments;d.terrain&&d.terrain.setupElevationDraw(pt,Y,J),d.uploadCommonUniforms(D,Y,pt.tileID.toUnwrapped()),Y.draw(d,z.TRIANGLES,B,U,q,s.b5.disabled,ut,l.id,K,ht,Dt,l.paint,k.zoom,st,[lt])}},heatmap:function(d,o,l,_){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const v=d.context,w=v.gl,I=s.b6.disabled,C=new s.a([w.ONE,w.ONE,w.ONE,w.ONE],s.C.transparent,[!0,!0,!0,!0]);(function(U,q,X,Z){const j=U.gl,J=q.width*Z,nt=q.height*Z;U.activeTexture.set(j.TEXTURE1),U.viewport.set([0,0,J,nt]);let st=X.heatmapFbo;if(!st||st&&(st.width!==J||st.height!==nt)){st&&st.destroy();const Y=j.createTexture();j.bindTexture(j.TEXTURE_2D,Y),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),st=X.heatmapFbo=U.createFramebuffer(J,nt,!0,null),function(K,lt,ht,ut,pt,Dt){const wt=K.gl;wt.texImage2D(wt.TEXTURE_2D,0,K.extRenderToTextureHalfFloat?wt.RGBA16F:wt.RGBA,pt,Dt,0,wt.RGBA,K.extRenderToTextureHalfFloat?wt.HALF_FLOAT:wt.UNSIGNED_BYTE,null),ut.colorAttachment.set(ht)}(U,0,Y,st,J,nt)}else j.bindTexture(j.TEXTURE_2D,st.colorAttachment.get()),U.bindFramebuffer.set(st.framebuffer)})(v,d,l,d.transform.projection.name==="globe"?.5:.25),v.clear({color:s.C.transparent});const P=d.transform,D=P.projection.name==="globe",z=D?["PROJECTION_GLOBE_VIEW"]:[],k=D?s.b5.frontCCW:s.b5.disabled,B=[s.E(P.center.lng),s.H(P.center.lat)];for(let U=0;U<_.length;U++){const q=_[U];if(o.hasRenderableParent(q))continue;const X=o.getTile(q),Z=X.getBucket(l);if(!Z||Z.projection.name!==P.projection.name)continue;const j=d.isTileAffectedByFog(q),J=Z.programConfigurations.get(l.id),nt=d.getOrCreateProgram("heatmap",{config:J,defines:z,overrideFog:j}),{zoom:st}=d.transform;d.terrain&&d.terrain.setupElevationDraw(X,nt),d.uploadCommonUniforms(v,nt,q.toUnwrapped());const Y=P.projection.createInversionMatrix(P,q.canonical);nt.draw(d,w.TRIANGLES,s.b4.disabled,I,C,k,tm(d,q,X,Y,B,st,l.paint.get("heatmap-intensity")),l.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,l.paint,d.transform.zoom,J,D?[Z.globeExtVertexBuffer]:null)}v.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(v,w){const I=v.context,C=I.gl,P=w.heatmapFbo;if(!P)return;I.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,P.colorAttachment.get()),I.activeTexture.set(C.TEXTURE1);let D=w.colorRampTexture;D||(D=w.colorRampTexture=new s.a9(I,w.colorRamp,C.RGBA)),D.bind(C.LINEAR,C.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,C.TRIANGLES,s.b4.disabled,s.b6.disabled,v.colorModeForRenderPass(),s.b5.disabled,((z,k,B,U)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,w),w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(d,l))},line:function(d,o,l,_){if(d.renderPass!=="translucent")return;const v=l.paint.get("line-opacity"),w=l.paint.get("line-width");if(v.constantOr(1)===0||w.constantOr(1)===0)return;const I=l.paint.get("line-emissive-strength"),C=d.depthModeForSublayer(0,s.b4.ReadOnly),P=d.colorModeForDrapableLayerRenderPass(I),D=d.terrain&&d.terrain.renderingToTexture?1:s.a4.devicePixelRatio,z=l.paint.get("line-dasharray"),k=z.constantOr(1),B=l.layout.get("line-cap"),U=l.paint.get("line-pattern"),q=U.constantOr(1),X=l.paint.get("line-pattern").constantOr(1),Z=l.paint.get("line-opacity").constantOr(1)!==1;let j=!X&&Z;const J=l.paint.get("line-gradient"),nt=q?"linePattern":"line",st=d.context,Y=st.gl,K=s.bJ(l);d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(j=!1);for(const lt of _){const ht=o.getTile(lt);if(q&&!ht.patternsLoaded())continue;const ut=ht.getBucket(l);if(!ut)continue;d.prepareDrawTile();const pt=ut.programConfigurations.get(l.id),Dt=d.isTileAffectedByFog(lt),wt=d.getOrCreateProgram(nt,{config:pt,defines:K,overrideFog:Dt}),St=U.constantOr(null);if(St&&ht.imageAtlas){const Ft=ht.imageAtlas.patternPositions[St.toString()];Ft&&pt.setConstantPatternPositions(Ft)}const mt=z.constantOr(null),Lt=B.constantOr(null);if(!q&&mt&&Lt&&ht.lineAtlas){const Ft=ht.lineAtlas.getDash(mt,Lt);Ft&&pt.setConstantPatternPositions(Ft)}let[Tt,zt]=l.paint.get("line-trim-offset");(Lt==="round"||Lt==="square")&&Tt!==zt&&(Tt===0&&(Tt-=1),zt===1&&(zt+=1));const tt=d.terrain?lt.projMatrix:null,yt=q?s.bK(d,ht,l,tt,D):s.bL(d,ht,l,tt,ut.lineClipsArray.length,D,[Tt,zt]);if(J){const Ft=ut.gradients[l.id];let ge=Ft.texture;if(l.gradientVersion!==Ft.version){let ce=256;if(l.stepInterpolant){const Se=o.getSource().maxzoom,fe=lt.canonical.z===Se?Math.ceil(1<<d.transform.maxZoom-lt.canonical.z):1;ce=s.c(s.bM(ut.maxLineLength/s.J*1024*fe),256,st.maxTextureSize)}Ft.gradient=s.bN({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:ce,image:Ft.gradient||void 0,clips:ut.lineClipsArray}),Ft.texture?Ft.texture.update(Ft.gradient):Ft.texture=new s.a9(st,Ft.gradient,Y.RGBA),Ft.version=l.gradientVersion,ge=Ft.texture}st.activeTexture.set(Y.TEXTURE1),ge.bind(l.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}k&&(st.activeTexture.set(Y.TEXTURE0),ht.lineAtlasTexture&&ht.lineAtlasTexture.bind(Y.LINEAR,Y.REPEAT),pt.updatePaintBuffers()),q&&(st.activeTexture.set(Y.TEXTURE0),ht.imageAtlasTexture&&ht.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),pt.updatePaintBuffers()),d.uploadCommonUniforms(st,wt,lt.toUnwrapped());const Gt=Ft=>{wt.draw(d,Y.TRIANGLES,C,Ft,P,s.b5.disabled,yt,l.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,l.paint,d.transform.zoom,pt,[ut.layoutVertexBuffer2])};if(j){const Ft=d.stencilModeForClipping(lt).ref;Ft===0&&d.terrain&&st.clear({stencil:0});const ge={func:Y.EQUAL,mask:255};yt.u_alpha_discard_threshold=.8,Gt(new s.b6(ge,Ft,255,Y.KEEP,Y.KEEP,Y.INVERT)),yt.u_alpha_discard_threshold=0,Gt(new s.b6(ge,Ft,255,Y.KEEP,Y.KEEP,Y.KEEP))}else Gt(d.stencilModeForClipping(lt))}j&&(d.resetStencilClippingMasks(),d.terrain&&st.clear({stencil:0}))},fill:function(d,o,l,_){const v=l.paint.get("fill-color"),w=l.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const I=l.paint.get("fill-emissive-strength"),C=d.colorModeForDrapableLayerRenderPass(I),P=l.paint.get("fill-pattern"),D=d.opaquePassEnabledForLayer()&&!P.constantOr(1)&&v.constantOr(s.C.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===D){const z=d.depthModeForSublayer(1,d.renderPass==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly);ic(d,o,l,_,z,C,!1)}if(d.renderPass==="translucent"&&l.paint.get("fill-antialias")){const z=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,s.b4.ReadOnly);ic(d,o,l,_,z,C,!0)}},"fill-extrusion":function(d,o,l,_){const v=l.paint.get("fill-extrusion-opacity"),w=d.context,I=w.gl,C=d.terrain,P=C&&C.renderingToTexture;if(v===0)return;const D=d.conflationActive&&d.layerUsedInConflation(l,o.getSource());if(D&&function(z,k,B,U){for(const q of U){const X=k.getTile(q).getBucket(B);X&&(X.updateReplacement(q,z.replacementSource),X.uploadCentroid(z.context))}}(d,o,l,_),C||D)for(const z of _){const k=o.getTile(z).getBucket(l);k&&im(d.context,o,z,k,l,C,D)}if(d.renderPass==="shadow"&&d.shadowRenderer){const z=d.shadowRenderer;if(C&&v<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.am)return;const k=z.getShadowPassDepthMode(),B=z.getShadowPassColorMode();oc(d,o,l,_,k,s.b6.disabled,B,D)}else if(d.renderPass==="translucent"){const z=!l.paint.get("fill-extrusion-pattern").constantOr(1),k=l.paint.get("fill-extrusion-color").constantOr(s.C.white);if(!P&&k.a!==0){const B=new s.b4(d.context.gl.LEQUAL,s.b4.ReadWrite,d.depthRangeFor3D);v===1&&z?oc(d,o,l,_,B,s.b6.disabled,s.a.unblended,D):(oc(d,o,l,_,B,s.b6.disabled,s.a.disabled,D),oc(d,o,l,_,B,d.stencilModeFor3D(),d.colorModeForRenderPass(),D),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&z&&(!C&&d.transform.projection.name!=="globe"||P)){const B=l.paint.get("fill-extrusion-opacity"),U=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=l.paint.get("fill-extrusion-flood-light-intensity"),Z=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),j=U>0&&q>0,J=X>0,nt=(Y,K,lt)=>(1-lt)*Y+lt*K,st=Y=>{const K=d.depthModeForSublayer(1,s.b4.ReadOnly,I.LEQUAL,!0),lt=l.paint.get(Y?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ht=nt(.1,3,lt),ut=d._showOverdrawInspector;if(!ut){const pt=new s.b6({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),Dt=new s.a([I.ONE,I.ONE,I.ONE,I.ONE],s.C.transparent,[!1,!1,!1,!0],I.MIN);El(d,o,l,_,K,pt,Dt,s.b5.disabled,Y,"sdf",B,U,q,X,Z,ht,D,!1)}{const pt=ut?s.b6.disabled:new s.b6({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),Dt=ut?d.colorModeForRenderPass():new s.a([I.ONE_MINUS_DST_ALPHA,I.DST_ALPHA,I.ONE,I.ONE],s.C.transparent,[!0,!0,!0,!0]);El(d,o,l,_,K,pt,Dt,s.b5.disabled,Y,"color",B,U,q,X,Z,ht,D,!1)}};if(P){const Y=(K,lt,ht)=>{const ut=d.depthModeForSublayer(1,s.b4.ReadOnly,I.LEQUAL,!1),pt=l.paint.get(K?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Dt=nt(.1,3,pt);{const wt=new s.a([I.ONE,I.ONE,I.ONE,I.ONE],s.C.transparent,[!1,!1,!1,!0]);El(d,o,l,_,ut,s.b6.disabled,wt,s.b5.disabled,K,"clear",B,U,q,X,Z,Dt,D,lt)}{const wt=new s.b6({func:I.ALWAYS,mask:255},255,255,I.KEEP,I.KEEP,I.REPLACE),St=new s.a([I.ONE,I.ONE,I.ONE,I.ONE],s.C.transparent,[!1,!1,!1,!0],I.MIN);El(d,o,l,_,ut,wt,St,s.b5.disabled,K,"sdf",B,U,q,X,Z,Dt,D,lt)}{const wt=K?I.ZERO:I.ONE_MINUS_DST_ALPHA,St=new s.b6({func:I.EQUAL,mask:255},255,255,I.KEEP,I.DECR,I.DECR),mt=new s.a([wt,I.DST_ALPHA,I.ONE_MINUS_DST_ALPHA,I.ZERO],s.C.transparent,[!0,!0,!0,!0]);El(d,o,l,_,ut,St,mt,s.b5.disabled,K,"color",B,U,q,X,Z,Dt,D,lt)}{const wt=new s.a([I.ONE,I.ONE,I.ONE,K?I.ZERO:I.ONE],s.C.transparent,[!1,!1,!1,!0],K?I.FUNC_ADD:I.MAX);El(d,o,l,_,ut,s.b6.disabled,wt,s.b5.disabled,K,"clear",B,U,q,X,Z,Dt,D,lt,ht)}};if(j||J){let K;if(d.prepareDrawTile(),C){const lt=C.drapeBufferSize[0],ht=C.drapeBufferSize[1];K=C.framebufferCopyTexture,K&&(!K||K.size[0]===lt&&K.size[1]===ht)||(K&&K.destroy(),K=C.framebufferCopyTexture=new s.a9(w,new s.a5({width:lt,height:ht}),I.RGBA)),K.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.copyTexImage2D(I.TEXTURE_2D,0,I.RGBA,0,0,lt,ht,0)}j&&Y(!0,!1,K),J&&Y(!1,!0,K)}}else j&&st(!0),J&&st(!1)}}},hillshade:function(d,o,l,_){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const v=d.context,w=d.terrain&&d.terrain.renderingToTexture,[I,C]=d.renderPass!=="translucent"||w?[{},_]:d.stencilConfigForOverlap(_);for(const P of C){const D=o.getTile(P);if(D.needsHillshadePrepare&&d.renderPass==="offscreen")C_(d,D,l);else if(d.renderPass==="translucent"){const z=d.depthModeForSublayer(0,s.b4.ReadOnly),k=l.paint.get("hillshade-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(k),U=w&&d.terrain?d.terrain.stencilModeForRTTOverlap(P):I[P.overscaledZ];S_(d,P,D,l,z,U,B)}}v.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,o,l,_,v,w){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const I=d.context,C=I.gl,P=o.getSource(),D=function(lt,ht,ut){const pt=lt.paint.get("raster-color"),Dt=[],wt=lt.paint.get("raster-resampling"),St=lt.paint.get("raster-color-mix"),mt=lt.paint.get("raster-color-range"),Lt=[St[0],St[1],St[2],0],Tt=St[3],zt=wt==="nearest"?ut.NEAREST:ut.LINEAR;if(pt&&Dt.push("RASTER_COLOR"),pt){ht.activeTexture.set(ut.TEXTURE2);let tt=lt.colorRampTexture;tt||(tt=lt.colorRampTexture=new s.a9(ht,lt.colorRamp,ut.RGBA)),tt.bind(ut.LINEAR,ut.CLAMP_TO_EDGE)}return{mix:Lt,range:mt,offset:Tt,defines:Dt,resampling:zt}}(l,I,C),z=D.defines,k=d.transform.projection.name==="globe";let B=!1;if(P instanceof s.aK&&!_.length){if(!k)return;if(P.onNorthPole)B=!0,z.push("GLOBE_POLES");else{if(!P.onSouthPole)return;B=!0,z.push("GLOBE_POLES")}}const U=l.paint.get("raster-emissive-strength"),q=d.colorModeForDrapableLayerRenderPass(U),X=d.terrain&&d.terrain.renderingToTexture,Z=P instanceof s.aK&&l.paint.get("raster-elevation")!==0,j=!d.options.moving,J=l.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;if(B){const lt=o.getSource();if(!(lt instanceof s.aK))return;const ht=lt.texture;if(!ht)return;const ut=d.globeSharedBuffers;if(!ut)return;const pt=new s.b4(C.LEQUAL,s.b4.ReadWrite,d.depthRangeFor3D),Dt=Float32Array.from(d.transform.expandedFarZProjMatrix);let wt=s.bj(0,0,d.transform);const St=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),mt={opacity:1,mix:0};d.terrain&&d.terrain.prepareDrawTile(),I.activeTexture.set(C.TEXTURE0),ht.bind(J,C.CLAMP_TO_EDGE),I.activeTexture.set(C.TEXTURE1),ht.bind(J,C.CLAMP_TO_EDGE),ht.useMipmap&&I.extTextureFilterAnisotropic&&d.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const[Lt,Tt,zt,tt]=ut.getPoleBuffers(0,!0);let yt;lt.onNorthPole?(yt=Lt,d.renderDefaultNorthPole=!1):(wt=s.m.scale(s.m.create(),wt,[1,-1,1]),yt=Tt,d.renderDefaultSouthPole=!1);const Gt=((ge,ce,Se,fe,Pe,Le,we,Ee,dr,Xe,Zr,Dr)=>em(ge,ce,Se,new Float32Array(16),new Float32Array(9),[0,0],0,[0,0],[0,0,0,0],1,fe,Pe,[0,0],we,2,dr,Xe,Zr,1,0,Dr))(Dt,St,wt,mt,l,0,l.paint.get("raster-elevation"),0,D.mix,D.offset,D.range,U),Ft=d.getOrCreateProgram("raster",{defines:D.defines});return d.uploadCommonUniforms(I,Ft,null),void Ft.draw(d,C.TRIANGLES,pt,s.b6.disabled,q,s.b5.disabled,Gt,l.id,yt,zt,tt)}if(!_.length)return;const[nt,st]=P instanceof s.aK||X?[{},_]:d.stencilConfigForOverlap(_),Y=st[st.length-1].overscaledZ,K=Z&&k;K&&D.defines.push("PROJECTION_GLOBE_VIEW"),Z&&D.defines.push("RENDER_CUTOFF");for(const lt of st){const ht=lt.toUnwrapped(),ut=o.getTile(lt);if(X&&(!ut||!ut.hasData())||!ut.texture)continue;let pt,Dt;X?(pt=s.b4.disabled,Dt=lt.projMatrix):Z?(pt=new s.b4(C.LEQUAL,s.b4.ReadWrite,d.depthRangeFor3D),Dt=k?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(ht,j)):(pt=d.depthModeForSublayer(lt.overscaledZ-Y,l.paint.get("raster-opacity")===1?s.b4.ReadWrite:s.b4.ReadOnly,C.LESS),Dt=d.transform.calculateProjMatrix(ht,j));const wt=d.terrain&&X?d.terrain.stencilModeForRTTOverlap(lt):nt[lt.overscaledZ],St=w?0:l.paint.get("raster-fade-duration");ut.registerFadeDuration(St);const mt=o.findLoadedParent(lt,0),Lt=gh(ut,mt,o,d.transform,St);let Tt,zt;d.terrain&&d.terrain.prepareDrawTile(),I.activeTexture.set(C.TEXTURE0),ut.texture&&ut.texture.bind(J,C.CLAMP_TO_EDGE),I.activeTexture.set(C.TEXTURE1),mt?(mt.texture&&mt.texture.bind(J,C.CLAMP_TO_EDGE),Tt=Math.pow(2,mt.tileID.overscaledZ-ut.tileID.overscaledZ),zt=[ut.tileID.canonical.x*Tt%1,ut.tileID.canonical.y*Tt%1]):ut.texture&&ut.texture.bind(J,C.CLAMP_TO_EDGE),ut.texture&&ut.texture.useMipmap&&I.extTextureFilterAnisotropic&&d.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const tt=d.transform;let yt;const Gt=Z?z_(tt):[0,0,0,0];let Ft,ge,ce,Se,fe;K&&P instanceof s.aK&&P.coordinates.length>3?(Ft=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),ge=Float32Array.from(tt.globeMatrix),ce=Float32Array.from(s.bc(tt)),Se=[s.E(tt.center.lng),s.H(tt.center.lat)],yt=P.elevatedGlobePerspectiveTransform,fe=P.elevatedGlobeGridMatrix||new Float32Array(9)):(yt=P instanceof s.aK?P.perspectiveTransform:[0,0],Ft=new Float32Array(16),ge=new Float32Array(9),ce=new Float32Array(16),Se=[0,0],fe=new Float32Array(9));const Pe=em(Dt,Ft,ge,ce,fe,zt||[0,0],s.ao(d.transform.zoom),Se,Gt,Tt||1,Lt,l,yt,Z?l.paint.get("raster-elevation"):0,2,D.mix,D.offset,D.range,1,0,U),Le=d.isTileAffectedByFog(lt),we=d.getOrCreateProgram("raster",{defines:D.defines,overrideFog:Le});if(d.uploadCommonUniforms(I,we,ht),P instanceof s.aK){const Ee=P.elevatedGlobeVertexBuffer,dr=P.elevatedGlobeIndexBuffer;if(X||!k)P.boundsBuffer&&P.boundsSegments&&we.draw(d,C.TRIANGLES,pt,s.b6.disabled,q,s.b5.disabled,Pe,l.id,P.boundsBuffer,d.quadTriangleIndexBuffer,P.boundsSegments);else if(Ee&&dr){const Xe=tt.zoom<=s.Z?P.elevatedGlobeSegments:P.getSegmentsForLongitude(tt.center.lng);Xe&&(we.draw(d,C.TRIANGLES,pt,s.b6.disabled,q,s.b5.backCW,Pe,l.id,Ee,dr,Xe),we.draw(d,C.TRIANGLES,pt,s.b6.disabled,q,s.b5.frontCW,Pe,l.id,Ee,dr,Xe))}}else{const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:dr,tileBoundsSegments:Xe}=d.getTileBoundsBuffers(ut);we.draw(d,C.TRIANGLES,pt,wt,q,s.b5.disabled,Pe,l.id,Ee,dr,Xe)}}d.resetStencilClippingMasks()},background:function(d,o,l,_){const v=l.paint.get("background-color"),w=l.paint.get("background-opacity"),I=l.paint.get("background-emissive-strength");if(w===0)return;const C=d.context,P=C.gl,D=d.transform,z=D.tileSize,k=l.paint.get("background-pattern");if(d.isPatternMissing(k,l.scope))return;const B=!k&&v.a===1&&w===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==B)return;const U=s.b6.disabled,q=d.depthModeForSublayer(0,B==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly),X=d.colorModeForDrapableLayerRenderPass(I),Z=k?"backgroundPattern":"background";let j,J=_;J||(j=d.getBackgroundTiles(),J=Object.values(j).map(nt=>nt.tileID)),k&&(C.activeTexture.set(P.TEXTURE0),d.imageManager.bind(d.context,l.scope));for(const nt of J){const st=d.isTileAffectedByFog(nt),Y=d.getOrCreateProgram(Z,{overrideFog:st}),K=nt.toUnwrapped(),lt=_?nt.projMatrix:d.transform.calculateProjMatrix(K);d.prepareDrawTile();const ht=o?o.getTile(nt):j?j[nt.key]:new s.bt(nt,z,D.zoom,d),ut=k?uu(lt,I,w,d,k,l.scope,{tileID:nt,tileSize:z}):lf(lt,I,w,v);d.uploadCommonUniforms(C,Y,K);const{tileBoundsBuffer:pt,tileBoundsIndexBuffer:Dt,tileBoundsSegments:wt}=d.getTileBoundsBuffers(ht);Y.draw(d,P.TRIANGLES,q,U,X,s.b5.disabled,ut,l.id,pt,Dt,wt)}},sky:function(d,o,l){const _=d._atmosphere?s.ao(d.transform.zoom):1,v=l.paint.get("sky-opacity")*_;if(v===0)return;const w=d.context,I=l.paint.get("sky-type"),C=new s.b4(w.gl.LEQUAL,s.b4.ReadOnly,[0,1]),P=d.frameCounter/1e3%1;I==="atmosphere"?d.renderPass==="offscreen"?l.needsSkyboxCapture(d)&&(function(D,z,k,B){const U=D.context,q=U.gl;let X=z.skyboxFbo;if(!X){X=z.skyboxFbo=U.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new ts(U),z.skyboxTexture=U.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,z.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let nt=0;nt<6;++nt)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+nt,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(X.framebuffer),U.viewport.set([0,0,32,32]);const Z=z.getCenter(D,!0),j=D.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);s.m.identity(J),s.m.rotateY(J,J,.5*-Math.PI),Ra(D,z,j,J,Z,0),s.m.identity(J),s.m.rotateY(J,J,.5*Math.PI),Ra(D,z,j,J,Z,1),s.m.identity(J),s.m.rotateX(J,J,.5*-Math.PI),Ra(D,z,j,J,Z,2),s.m.identity(J),s.m.rotateX(J,J,.5*Math.PI),Ra(D,z,j,J,Z,3),s.m.identity(J),Ra(D,z,j,J,Z,4),s.m.identity(J),s.m.rotateY(J,J,Math.PI),Ra(D,z,j,J,Z,5),U.viewport.set([0,0,D.width,D.height])}(d,l),l.markSkyboxValid(d)):d.renderPass==="sky"&&function(D,z,k,B,U){const q=D.context,X=q.gl,Z=D.transform,j=D.getOrCreateProgram("skybox");q.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,z.skyboxTexture);const J=((nt,st,Y,K,lt)=>({u_matrix:nt,u_sun_direction:st,u_cubemap:0,u_opacity:K,u_temporal_offset:lt}))(Z.skyboxMatrix,z.getCenter(D,!1),0,B,U);D.uploadCommonUniforms(q,j),j.draw(D,X.TRIANGLES,k,s.b6.disabled,D.colorModeForRenderPass(),s.b5.backCW,J,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(d,l,C,v,P):I==="gradient"&&d.renderPass==="sky"&&function(D,z,k,B,U){const q=D.context,X=q.gl,Z=D.transform,j=D.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new ts(q)),q.activeTexture.set(X.TEXTURE0);let J=z.colorRampTexture;J||(J=z.colorRampTexture=new s.a9(q,z.colorRamp,X.RGBA)),J.bind(X.LINEAR,X.CLAMP_TO_EDGE);const nt=((st,Y,K,lt,ht)=>({u_matrix:st,u_color_ramp:0,u_center_direction:Y,u_radius:s.d(K),u_opacity:lt,u_temporal_offset:ht}))(Z.skyboxMatrix,z.getCenter(D,!1),z.paint.get("sky-gradient-radius"),B,U);D.uploadCommonUniforms(q,j),j.draw(D,X.TRIANGLES,k,s.b6.disabled,D.colorModeForRenderPass(),s.b5.backCW,nt,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(d,l,C,v,P)},debug:function(d,o,l,_,v){for(let w=0;w<l.length;w++)if(v){const P=new s.C(_.r*.8,_.g*.8,_.b*.8,1);Il(d,o,l[w],_,-1,-1),Il(d,o,l[w],_,-1,1),Il(d,o,l[w],_,1,1),Il(d,o,l[w],_,1,-1),Il(d,o,l[w],P,0,0)}else Il(d,o,l[w],_,0,0)},custom:function(d,o,l,_){const v=d.context,w=l.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&l.isLayerDraped(o)){if(d.renderPass==="offscreen"){const I=w.prerender;if(I){if(d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const C=d.transform.pointMerc;I.call(w,v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.ao(d.transform.zoom),[C.x,C.y],d.transform.pixelsPerMeterRatio)}else I.call(w,v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const C=w.renderToTile;if(C){const P=_[0].canonical,D=new s.M(P.x+_[0].wrap*(1<<P.z),P.y,P.z);v.setDepthMode(s.b4.disabled),v.setStencilMode(s.b6.disabled),v.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),C.call(w,v.gl,D),v.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),v.setStencilMode(s.b6.disabled);const I=w.renderingMode==="3d"?new s.b4(d.context.gl.LEQUAL,s.b4.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,s.b4.ReadOnly);if(v.setDepthMode(I),d.transform.projection.name==="globe"){const C=d.transform.pointMerc;w.render(v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.ao(d.transform.zoom),[C.x,C.y],d.transform.pixelsPerMeterRatio)}else w.render(v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState(),v.bindFramebuffer.set(null)}}else s.X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,o,l,_){if(d.renderPass==="opaque")return;const v=l.paint.get("model-opacity");if(v===0)return;const w=l.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!w||d.terrain&&v<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof s.am))return;const I=d.shadowRenderer,C=l.paint.get("model-receive-shadows");I&&(I.useNormalOffset=!0,C||(I.enabled=!1));const P=()=>{I&&(I.useNormalOffset=!0,C||(I.enabled=!0))},D=o.getSource();if(d.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(j,J,nt,st){const Y=j.transform;if(Y.projection.name!=="mercator")return void s.X(`Drawing 3D models for ${Y.projection.name} projection is not yet implemented`);const K=Y.getFreeCameraOptions().position;if(!j.modelManager)return;const lt=j.modelManager,ht=j.shadowRenderer;if(!nt._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ut=nt._unevaluatedLayout._values["model-id"],pt={...nt.layout.get("model-id").parameters};for(const Dt of st){const wt=J.getTile(Dt).getBucket(nt);if(!wt||wt.projection.name!==Y.projection.name)continue;const St=F_(Dt,Y);pt.zoom=St;const mt=ut.possiblyEvaluate(pt);if(k_(j,wt,Dt),Do.shadowUniformsInitialized=!1,Do.useSingleShadowCascade=!!ht&&ht.getMaxCascadeForTile(Dt.toUnwrapped())===0,j.renderPass==="shadow"&&ht){if(j.currentShadowCascade===1&&wt.isInsideFirstShadowMapFrustum)continue;const zt=Y.calculatePosMatrix(Dt.toUnwrapped(),Y.worldSize);if(Do.tileMatrix.set(zt),Do.shadowTileMatrix=Float32Array.from(ht.calculateShadowPassMatrixFromMatrix(zt)),Do.aabb.min.fill(0),Do.aabb.max[0]=Do.aabb.max[1]=s.J,Do.aabb.max[2]=0,pm(wt,Do,j,nt.scope))continue}const Lt=1<<Dt.canonical.z,Tt=[((K.x-Dt.wrap)*Lt-Dt.canonical.x)*s.J,(K.y*Lt-Dt.canonical.y)*s.J,K.z*Lt*s.J];for(let zt in wt.instancesPerModel){const tt=wt.instancesPerModel[zt];tt.features.length>0&&(zt=mt.evaluate(tt.features[0].feature,{}));const yt=lt.getModel(zt,nt.scope);if(yt&&yt.uploaded)for(const Gt of yt.nodes)ac(j,nt,Gt,tt,Tt,Dt,Do)}}}(d,o,l,_),void P();if(!D.loaded())return;if(D.type==="batched-model")return function(j,J,nt,st){const Y=j.context,K=j.transform,lt=j.style.fog,ht=j.shadowRenderer;if(K.projection.name!=="mercator")return void s.X(`Drawing 3D landmark models for ${K.projection.name} projection is not yet implemented`);const ut=j.transform.getFreeCameraOptions().position,pt=s.v.scale([],[ut.x,ut.y,ut.z],j.transform.worldSize);s.v.negate(pt,pt);const Dt=s.m.identity([]),wt=s.c4(K.center.lat,K.zoom),St=s.m.fromScaling([],[1,1,1/wt]);s.m.translate(Dt,Dt,pt);const mt=nt.paint.get("model-opacity"),Lt=new s.b4(Y.gl.LEQUAL,s.b4.ReadWrite,j.depthRangeFor3D),Tt=new s.b4(Y.gl.LEQUAL,s.b4.ReadOnly,j.depthRangeFor3D),zt=function(tt,yt){for(const Gt of st){const Ft=J.getTile(Gt).getBucket(nt);if(!Ft||!Ft.uploaded)continue;let ge=!1;ht&&(ge=ht.getMaxCascadeForTile(Gt.toUnwrapped())===0);const ce=K.calculatePosMatrix(Gt.toUnwrapped(),K.worldSize),Se=Ft.modelTraits;for(const fe of Ft.getNodesInfo()){if(fe.hiddenByReplacement||!fe.node.meshes)continue;const Pe=fe.node,Le=j.renderPass==="light-beam",we=[...ce],Ee=fe.evaluatedScale;let dr=0;j.terrain&&Pe.elevation&&(dr=Pe.elevation*j.terrain.exaggeration()),s.m.translate(we,we,[(Pe.anchor?Pe.anchor[0]:0)*(Ee[0]-1),(Pe.anchor?Pe.anchor[1]:0)*(Ee[1]-1),dr]),Ee!==s.c6&&s.m.scale(we,we,Ee),s.m.multiply(we,we,Pe.matrix);const Xe=s.m.multiply([],St,we);s.m.multiply(Xe,Dt,Xe);const Zr=s.m.invert([],Xe);s.m.transpose(Zr,Zr),s.m.scale(Zr,Zr,B_);const Dr=s.m.multiply([],K.expandedFarZProjMatrix,we),Wi=Se&s.c8.HasMapboxMeshFeatures,Oo=Wi?0:fe.evaluatedRMEA[0][2];for(let Mr=0;Mr<Pe.meshes.length;++Mr){const gr=Pe.meshes[Mr],xr=Mr===Pe.lightMeshIndex;if(xr){if(!Le&&!j.terrain&&j.shadowRenderer){j.currentLayer<j.firstLightBeamLayer&&(j.firstLightBeamLayer=j.currentLayer);continue}}else if(Le)continue;const nn={defines:[]},ri=[];yf(nn.defines,ri,gr,j),Wi||nn.defines.push("DIFFUSE_SHADED"),ge&&nn.defines.push("SHADOWS_SINGLE_CASCADE");const Hr=j.renderPass==="shadow";if(Hr){sc(gr,we,j,nt);continue}let Ei=null;if(lt){const rs=Ah(we,j.transform);if(Ei=new Float32Array(rs),K.projection.name!=="globe"){const Or=gr.aabb.min,ns=gr.aabb.max,[Ts,na]=lt.getOpacityForBounds(rs,Or[0],Or[1],ns[0],ns[1]);nn.overrideFog=Ts>=ro||na>=ro}}const Hi=j.getOrCreateProgram("model",nn);!Hr&&ht&&(ht.useNormalOffset=!!gr.normalBuffer,ht.setupShadowsFromMatrix(we,Hi,ht.useNormalOffset)),j.uploadCommonUniforms(Y,Hi,Gt.toUnwrapped(),Ei);const Ii=gr.material,zo=Ii.pbrMetallicRoughness;zo.metallicFactor=.9,zo.roughnessFactor=.5;const ra=nc(new Float32Array(Dr),new Float32Array(Xe),new Float32Array(Zr),j,mt,zo.baseColorFactor,Ii.emissiveFactor,zo.metallicFactor,zo.roughnessFactor,Ii,Oo,nt);Hi.draw(j,Y.gl.TRIANGLES,yt&&!xr?Lt:Tt,s.b6.disabled,tt?xr||mt<1||fe.hasTranslucentParts?s.a.alphaBlended:s.a.unblended:s.a.disabled,s.b5.backCCW,ra,nt.id,gr.vertexBuffer,gr.indexBuffer,gr.segments,nt.paint,j.transform.zoom,void 0,ri)}}}};(function(tt,yt,Gt,Ft){const ge=tt.terrain?tt.terrain.exaggeration():0,ce=tt.transform.zoom;for(const Se of Ft){const fe=yt.getTile(Se).getBucket(Gt);fe&&(tt.conflationActive&&fe.updateReplacement(Se,tt.replacementSource),fe.evaluateScale(tt,Gt),tt.terrain&&ge>0&&fe.elevationUpdate(tt.terrain,ge,Se,Gt.source),fe.needsReEvaluation(tt,ce,Gt)&&fe.evaluate(Gt))}})(j,J,nt,st),mt===1?zt(!0,!0):(zt(!1,!0),zt(!0,!1))}(d,o,l,_),void P();const z=D.getModels(),k=[],B=d.transform.getFreeCameraOptions().position,U=s.v.scale([],[B.x,B.y,B.z],d.transform.worldSize);s.v.negate(U,U);const q=[],X=[];let Z=0;for(const j of z){const J=l.paint.get("model-rotation").constantOr(null),nt=l.paint.get("model-scale").constantOr(null),st=l.paint.get("model-translation").constantOr(null);j.computeModelMatrix(d,J,nt,st,!0,!0,!1);const Y=s.m.identity([]),K=s.c4(j.position.lat,d.transform.zoom),lt=s.m.fromScaling([],[1,1,1/K]);s.m.translate(Y,Y,U),k.push({zScaleMatrix:lt,negCameraPosMatrix:Y});for(const ht of j.nodes)hm(d.transform,ht,j.matrix,d.transform.expandedFarZProjMatrix,Z,q,X);Z++}if(q.sort((j,J)=>J.depth-j.depth),d.renderPass!=="shadow"){if(v===1)for(const j of X)Tl(j,d,l,k[j.modelIndex],s.b6.disabled,d.colorModeForRenderPass());else{for(const j of X)Tl(j,d,l,k[j.modelIndex],s.b6.disabled,s.a.disabled);for(const j of X)Tl(j,d,l,k[j.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const j of q)Tl(j,d,l,k[j.modelIndex],s.b6.disabled,d.colorModeForRenderPass());P()}else{for(const j of X)sc(j.mesh,j.nodeModelMatrix,d,l);for(const j of q)sc(j.mesh,j.nodeModelMatrix,d,l);P()}}},mm={modelUpload:function(d,o,l){const _=o.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson")return void(d.modelManager&&d.modelManager.upload(d,l));if(_.type==="batched-model")return;const v=_.getModels();for(const w of v)w.upload(d.context)}};class V_{constructor(o,l,_,v){this.context=new Un(o,l),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._debugParams={showTerrainProxyTiles:!1},v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=s.bq.maxUnderzooming+s.bq.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.ca,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new bf(this),this._wireframeDebugCache=new fu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(o,l){const _=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new rf(this,o));const v=this._terrain;this.transform.elevation=_?v:null,v.update(o,this.transform,l),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(o){const l=o.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,v]=l.getFovAdjustedRange(this.transform._fov);if(_>v)return void(this.transform.fogCullDistSq=null);const w=_+.78*(v-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,l){if(this.width=o*s.a4.devicePixelRatio,this.height=l*s.a4.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const o=this.context,l=new s.bo;l.emplaceBack(0,0),l.emplaceBack(s.J,0),l.emplaceBack(0,s.J),l.emplaceBack(s.J,s.J),this.tileExtentBuffer=o.createVertexBuffer(l,s.bl.members),this.tileExtentSegments=s.bm.simpleSegment(0,0,4,2);const _=new s.bo;_.emplaceBack(0,0),_.emplaceBack(s.J,0),_.emplaceBack(0,s.J),_.emplaceBack(s.J,s.J),this.debugBuffer=o.createVertexBuffer(_,s.bl.members),this.debugSegments=s.bm.simpleSegment(0,0,4,5);const v=new s.bo;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,s.bl.members),this.viewportSegments=s.bm.simpleSegment(0,0,4,2);const w=new s.cb;w.emplaceBack(0,0,0,0),w.emplaceBack(s.J,0,s.J,0),w.emplaceBack(0,s.J,0,s.J),w.emplaceBack(s.J,s.J,s.J,s.J),this.mercatorBoundsBuffer=o.createVertexBuffer(w,s.cc.members),this.mercatorBoundsSegments=s.bm.simpleSegment(0,0,4,2);const I=new s.bp;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I);const C=new s.cd;for(const D of[0,1,3,2,0])C.emplaceBack(D);this.debugIndexBuffer=o.createIndexBuffer(C),this.emptyTexture=new s.a9(o,new s.a5({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=s.m.create();const P=this.context.gl;this.stencilClearMode=new s.b6({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,s.b4.disabled,this.stencilClearMode,s.a.disabled,s.b5.disabled,mh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,l,_){if(!l||this.currentStencilSource===l.id||!o.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const P of _)if(this._tileClippingMaskIDs[P.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=l.id;const v=this.context,w=v.gl;this.nextStencilID+_.length>256&&this.clearStencil(),v.setColorMode(s.a.disabled),v.setDepthMode(s.b4.disabled);const I=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of _){const P=l.getTile(C),D=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:k,tileBoundsSegments:B}=this.getTileBoundsBuffers(P);I.draw(this,w.TRIANGLES,s.b4.disabled,new s.b6({func:w.ALWAYS,mask:0},D,255,w.KEEP,w.KEEP,w.REPLACE),s.a.disabled,s.b5.disabled,mh(C.projMatrix),"$clipping",z,k,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,l=this.context.gl;return new s.b6({func:l.NOTEQUAL,mask:255},o,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const l=this.context.gl;return new s.b6({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(o){const l=this.context.gl,_=o.sort((I,C)=>C.overscaledZ-I.overscaledZ),v=_[_.length-1].overscaledZ,w=_[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const I={};for(let C=0;C<w;C++)I[C+v]=new s.b6({func:l.GEQUAL,mask:255},C+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=w,[I,_]}return[{[v]:s.b6.disabled},_]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new s.a([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new s.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.a.unblended:s.a.alphaBlended}colorModeForDrapableLayerRenderPass(o){const l=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new s.a([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new s.C(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,l,_,v=!1){if(!this.opaquePassEnabledForLayer()&&!v)return s.b4.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new s.b4(_||this.context.gl.LEQUAL,l,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,l){this._wireframeDebugCache.update(this.frameCounter),this.style=o,this.options=l;const _=this.style._mergedLayers,v=this.style.order,w=v.map(Y=>_[Y]),I=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(s.a4.now()),this.imageManager.beginFrame();let C=0,P=!1;for(const Y in I){const K=I[Y];K.used&&(K.prepare(this.context),K.getSource().usedInConflation&&++C)}const D={},z={},k={},B={},U={};for(const Y in I){const K=I[Y];D[Y]=K.getVisibleCoordinates(),z[Y]=D[Y].slice().reverse(),k[Y]=K.getVisibleCoordinates(!0).reverse(),B[Y]=K.getShadowCasterCoordinates(),U[Y]=K.sortCoordinatesByDistance(D[Y])}const q=Y=>{const K=this.style.getLayerSourceCache(Y);return K&&K.used?K.getSource():null};if(C){const Y=[];for(const K of w)this.layerUsedInConflation(K,q(K))&&Y.push(K);if(Y&&Y.length>1){const K=[];for(const lt of Y){const ht=this.style.getLayerSourceCache(lt);ht&&ht.used&&ht.getSource().usedInConflation&&K.push({layer:lt.fqid,cache:ht})}this.replacementSource.setSources(K),P=!0}}P||this.replacementSource.clear(),this.conflationActive=P,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const Y of w){const K=Y.cutoffRange();if(this.longestCutoffRange=Math.max(K,this.longestCutoffRange),K>0){const lt=q(Y);lt&&(this.minCutoffZoom=Math.max(lt.minzoom,this.minCutoffZoom)),Y.minzoom&&(this.minCutoffZoom=Math.max(Y.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let Y=0;Y<w.length;Y++)if(w[Y].is3D()){this.opaquePassCutoff=Y;break}const X=this.style&&this.style.fog;X?(this._fogVisible=X.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=X.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0);const Z=this._shadowRenderer;if(Z){Z.updateShadowParameters(this.transform,this.style.directionalLight);for(const Y in I)for(const K of D[Y]){let lt={min:0,max:0};this.terrain&&(lt=this.terrain.getMinMaxForTile(K)||lt),Z.addShadowReceiver(K.toUnwrapped(),lt.min,lt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.ce(this.context));for(const Y of w){if(Y.isHidden(this.transform.zoom))continue;const K=o.getLayerSourceCache(Y);this.uploadLayer(this,Y,K)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new N_(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!s.cf(this.context.gl))return;this.renderPass="offscreen";for(const Y of w){const K=o.getLayerSourceCache(Y);if(!Y.hasOffscreenPass()||Y.isHidden(this.transform.zoom))continue;const lt=K?z[K.id]:void 0;(Y.type==="custom"||Y.type==="raster"||Y.isSky()||lt&&lt.length)&&this.renderLayer(this,K,Y,lt)}this.depthRangeFor3D=[0,1-(w.length+2)*this.numSublayers*this.depthEpsilon];const j=this.terrain;j&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&j.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,B)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const J=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),nt=(()=>{if(l.showOverdrawInspector)return s.C.black;if(this.style.fog&&this.transform.projection.supportsFog&&!J){const Y=this.style.fog.properties.get("color").toArray01();return new s.C(...Y)}if(this.style.fog&&this.transform.projection.supportsFog&&J){const Y=this.style.fog.properties.get("space-color").toArray01();return new s.C(...Y)}return s.C.transparent})();if(this.context.clear({color:nt,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&J&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const Y=w[this.currentLayer],K=o.getLayerSourceCache(Y);if(Y.isSky())continue;const lt=K?(Y.is3D()?U:z)[K.id]:void 0;this._renderTileClippingMasks(Y,K,lt),this.renderLayer(this,K,Y,lt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&J&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ao(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const Y=w[this.currentLayer],K=o.getLayerSourceCache(Y);Y.isSky()&&this.renderLayer(this,K,Y,K?z[K.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let st=0;for(Z&&(st=Z.getShadowCastingLayerCount());this.currentLayer<v.length;){const Y=w[this.currentLayer],K=o.getLayerSourceCache(Y);if(Y.isSky()){++this.currentLayer;continue}if(j&&this.style.isLayerDraped(Y)){if(Y.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=j.renderBatch(this.currentLayer);continue}let lt;if(K&&(lt=(Y.type==="symbol"?k:Y.is3D()?U:z)[K.id]),this._renderTileClippingMasks(Y,K,K?D[K.id]:void 0),this.renderLayer(this,K,Y,lt),!j&&Z&&st>0&&Y.hasShadowPass()&&--st==0&&(Z.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ht=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ht;this.currentLayer++){const ut=w[this.currentLayer];if(!ut.hasLightBeamPass())continue;const pt=o.getLayerSourceCache(ut);this.renderLayer(this,pt,ut,pt?z[pt.id]:void 0)}this.currentLayer=ht,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Y=null;w.forEach(K=>{const lt=o.getLayerSourceCache(K);lt&&!K.isHidden(this.transform.zoom)&&lt.getVisibleCoordinates().length&&(!Y||Y.getSource().maxzoom<lt.getSource().maxzoom)&&(Y=lt)}),Y&&this.options.showTileBoundaries&&vf.debug(this,Y,Y.getVisibleCoordinates(),s.C.red,!1)}this.terrain&&this._debugParams.showTerrainProxyTiles&&vf.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.C(1,.8,.1,1),!0),this.options.showPadding&&function(Y){const K=Y.transform.padding;am(Y,Y.transform.height-(K.top||0),3,pf),am(Y,K.bottom||0,3,ff),pu(Y,K.left||0,3,df),pu(Y,Y.transform.width-(K.right||0),3,mf);const lt=Y.transform.centerPoint;(function(ht,ut,pt,Dt){Da(ht,ut-1,pt-10,2,20,Dt),Da(ht,ut-10,pt-1,20,2,Dt)})(Y,lt.x,Y.transform.height-lt.y,sm)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),P||(this.conflationActive=!1)}uploadLayer(o,l,_){this.gpuTimingStart(l),(!o.transform.projection.unsupportedLayers||!o.transform.projection.unsupportedLayers.includes(l.type)||o.terrain&&l.type==="custom")&&mm[`${l.type}Upload`]&&mm[`${l.type}Upload`](o,_,l.scope),this.gpuTimingEnd()}renderLayer(o,l,_,v){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||v&&v.length)&&(this.id=_.id,this.gpuTimingStart(_),(!o.transform.projection.unsupportedLayers||!o.transform.projection.unsupportedLayers.includes(_.type)||o.terrain&&_.type==="custom")&&vf[_.type](o,l,_,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,_=this.context.gl;let v=this.gpuTimers[o.id];v||(v=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:_.createQuery()}),v.calls++,_.beginQuery(l.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,l=this.context.gl,_=l.createQuery();this.deferredRenderGpuTimeQueries.push(_),l.beginQuery(o.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const l={};for(const _ in o){const v=o[_],w=this.context.extTimerQuery,I=w.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(v.query),l[_]=I}return l}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery,_=this.context.gl;let v=0;for(const w of o)v+=l.getQueryParameter(w,_.QUERY_RESULT)/1e6,l.deleteQueryEXT(w);return v}translatePosMatrix(o,l,_,v,w){if(!_[0]&&!_[1])return o;const I=w?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(I){const D=Math.sin(I),z=Math.cos(I);_=[_[0]*z-_[1]*D,_[0]*D+_[1]*z]}const C=[w?_[0]:s.ay(l,_[0],this.transform.zoom),w?_[1]:s.ay(l,_[1],this.transform.zoom),0],P=new Float32Array(16);return s.m.translate(P,o,C),P}saveTileTexture(o){const l=o.size[0],_=this._tileTextures[l];_?_.push(o):this._tileTextures[l]=[o]}getTileTexture(o){const l=this._tileTextures[o];return l&&l.length>0?l.pop():null}isPatternMissing(o,l){return o===null||o!==void 0&&!this.imageManager.getPattern(o.toString(),l)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,l,_){const v=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,w=this.terrain&&this.terrain.exaggeration()===0,I=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(I.push("LIGHTING_3D_MODE"),I.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||I.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||I.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?I.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):I.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(I.push("TERRAIN"),this.linearFloatFilteringSupported()&&I.push("TERRAIN_DEM_FLOAT_FORMAT"),w&&I.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&I.push("GLOBE"),!this._fogVisible||v||l!==void 0&&!l||I.push("FOG","FOG_DITHERING"),v&&I.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&I.push("OVERDRAW_INSPECTOR"),I}getOrCreateProgram(o,l){this.cache=this.cache||{};const _=l&&l.defines||[],v=l&&l.config,w=this.currentGlobalDefines(o,l&&l.overrideFog,l&&l.overrideRtt).concat(_),I=vh.cacheKey(Yp[o],o,w,v);return this.cache[I]||(this.cache[I]=new vh(this.context,o,Yp[o],v,nm[o],w)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.a9(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,l){if(this.style.enable3dLights()){const _=this.style.directionalLight,v=this.style.ambientLight;if(_&&v){const w=((I,C)=>{const P=I.properties.get("direction"),D=I.properties.get("color").toArray01(),z=I.properties.get("intensity"),k=C.properties.get("color").toArray01(),B=C.properties.get("intensity"),U=[P.x,P.y,P.z],q=s.bv(k,B),X=s.bv(D,z);return{u_lighting_ambient_color:q,u_lighting_directional_dir:U,u_lighting_directional_color:X,u_ground_radiance:Kd(U,X,q)}})(_,v);l.setLightsUniformValues(o,w)}}}uploadCommonUniforms(o,l,_,v,w){if(this.uploadCommonLightUniforms(o,l),this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const C=I.getOpacity(this.transform.pitch),P=((D,z,k,B,U,q,X,Z,j,J,nt,st)=>{const Y=D.transform,K=z.properties.get("color").toArray01();K[3]=B;const lt=D.frameCounter/1e3%1,[ht,ut]=z.properties.get("vertical-range");return{u_fog_matrix:k?Y.calculateFogTileMatrix(k):st||D.identityMat,u_fog_range:z.getFovAdjustedRange(Y._fov),u_fog_color:K,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ht,ut),ut],u_fog_temporal_offset:lt,u_frustum_tl:U,u_frustum_tr:q,u_frustum_br:X,u_frustum_bl:Z,u_globe_pos:j,u_globe_radius:J,u_viewport:nt,u_globe_transition:s.ao(Y.zoom),u_is_globe:+(Y.projection.name==="globe")}})(this,I,_,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.a4.devicePixelRatio,this.transform.height*s.a4.devicePixelRatio],v);l.setFogUniformValues(o,P)}w&&l.setCutoffUniformValues(o,w.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,l=o.createTexture();return o.bindTexture(o.TEXTURE_2D,l),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,l=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const v of _)l[v.key]=o[v.key]||new s.bt(v,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(o,l){return!(!o.is3D()||o.minzoom&&o.minzoom>this.transform.zoom||o.sourceLayer!=="building"&&(!l||l.type!=="batched-model"))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[o.key];return l||(this._cachedTileFogOpacities[o.key]=l=this.style.fog.getOpacityForTile(o)),l[0]>=ro||l[1]>=ro}}const no={cascadeCount:2,shadowMapResolution:2048};class U_{constructor(o,l){this.aabb=o,this.lastCascade=l}}class xf{add(o,l){const _=this.receivers[o.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],l.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],l.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],l.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],l.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],l.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],l.max[2])):this.receivers[o.key]=new U_(l,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,l,_){const v=s.c3.fromPoints(o.points);let w=0;for(const I in this.receivers){const C=this.receivers[I];if(!C||!v.intersectsAabb(C.aabb))continue;C.aabb.min=v.closestPoint(C.aabb.min),C.aabb.max=v.closestPoint(C.aabb.max);const P=C.aabb.getCorners();for(let D=0;D<_.length;D++){let z=!0;for(const k of P){const B=[k[0]*l,k[1]*l,k[2]];if(s.v.transformMat4(B,B,_[D].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){z=!1;break}}if(C.lastCascade=D,w=Math.max(w,D),z)break}}return w+1}}class bf{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new xf,this._depthMode=new s.b4(o.context.gl.LEQUAL,s.b4.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,o.tp.registerParameter(no,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(no,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,l){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const v=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||v<=0||(this._shadowLayerCount=_.style.order.reduce((q,X)=>{const Z=_.style._mergedLayers[X];return q+(Z.hasShadowPass()&&!Z.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const w=_.context,I=no.shadowMapResolution,C=no.shadowMapResolution;if(this._cascades.length===0||no.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<no.cascadeCount;++q){const X=_._shadowMapDebug,Z=w.gl,j=w.createFramebuffer(I,C,X,"texture"),J=new s.a9(w,{width:I,height:C,data:null},Z.DEPTH_COMPONENT);if(j.depthAttachment.set(J.texture),X){const nt=new s.a9(w,{width:I,height:C,data:null},Z.RGBA);j.colorAttachment.set(nt.texture)}this._cascades.push({framebuffer:j,texture:J,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.F,scale:0})}}this.shadowDirection=wf(l);let P=0;if(o.elevation){const q=o.elevation,X=[1e4,-1e4];q.visibleDemTiles.filter(Z=>Z.dem).forEach(Z=>{const j=Z.dem.tree;X[0]=Math.min(X[0],j.minimums[0]),X[1]=Math.max(X[1],j.maximums[0])}),X[0]!==1e4&&(P=(X[1]-X[0])*q.exaggeration())}const D=1.5*o.cameraToCenterDistance,z=3*D,k=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const X=this._cascades[q];let Z=o.height/50,j=1;no.cascadeCount===1?j=z:q===0?j=D:(Z=D,j=z);const[J,nt]=gm(o,this.shadowDirection,Z,j,no.shadowMapResolution,P);X.scale=o.scale,X.matrix=J,X.boundingSphereRadius=nt,s.m.invert(k,X.matrix),X.frustum=s.F.fromInvProjectionMatrix(k,1,0,!0),X.far=j}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/no.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=no.shadowMapResolution,this._uniformValues.u_shadowmap_0=pi.ShadowMap0,this._uniformValues.u_shadowmap_1=pi.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const U=_.transform.elevation;for(const q of this._groundShadowTiles){let X={min:0,max:0};if(U){const Z=U.getMinMaxForTile(q);Z&&(X=Z)}this.addShadowReceiver(q.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled}set enabled(o){this._enabled=o}drawShadowPass(o,l){if(!this._enabled)return;const _=this.painter,v=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),v.viewport.set([0,0,no.shadowMapResolution,no.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){_.currentShadowCascade=w,v.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),v.clear({color:s.C.white,depth:1});for(const I of o.order){const C=o._mergedLayers[I];if(!C.hasShadowPass()||C.isHidden(_.transform.zoom))continue;const P=o.getLayerSourceCache(C),D=P?l[P.id]:void 0;(C.type==="model"||D&&D.length)&&_.renderLayer(_,P,C,D)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const o=this.painter,l=o.style,_=o.context,v=l.directionalLight,w=l.ambientLight;if(!v||!w)return;const I=[],C=xl(o,o.longestCutoffRange);C.shouldRenderCutoff&&I.push("RENDER_CUTOFF");const P=Ph(v,w),D=new s.b4(_.gl.LEQUAL,s.b4.ReadOnly,o.depthRangeFor3D);for(const z of this._groundShadowTiles){const k=z.toUnwrapped(),B=o.isTileAffectedByFog(z),U=o.getOrCreateProgram("groundShadow",{defines:I,overrideFog:B});this.setupShadows(k,U),o.uploadCommonUniforms(_,U,k,null,C);const q={u_matrix:o.transform.calculateProjMatrix(k),u_ground_shadow_factor:P};U.draw(o,_.gl.TRIANGLES,D,s.b6.disabled,s.a.multiply,s.b5.disabled,q,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,{},o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?s.a.unblended:s.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const l=this.painter.transform,_=l.calculatePosMatrix(o,l.worldSize);return s.m.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(o){return s.m.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,l,_,v=0){if(!this._enabled)return;const w=this.painter.transform,I=this.painter.context,C=I.gl,P=this._uniformValues,D=new Float64Array(16),z=w.calculatePosMatrix(o,w.worldSize);for(let k=0;k<this._cascades.length;k++)s.m.multiply(D,this._cascades[k].matrix,z),P[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),I.activeTexture.set(C.TEXTURE0+pi.ShadowMap0+k),this._cascades[k].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){const k=s.cg(o.canonical),B=2/w.tileSize*s.J/no.shadowMapResolution,U=B*this._cascades[0].boundingSphereRadius,q=B*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(_==="vector-tile"?1:3)/Math.pow(2,v-o.canonical.z-(1-w.zoom+Math.floor(w.zoom)));P.u_shadow_normal_offset=[k,U*X,q*X],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(I,P)}setupShadowsFromMatrix(o,l,_=!1){if(!this._enabled)return;const v=this.painter.context,w=v.gl,I=this._uniformValues,C=new Float64Array(16);for(let P=0;P<no.cascadeCount;P++)s.m.multiply(C,this._cascades[P].matrix,o),I[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(w.TEXTURE0+pi.ShadowMap0+P),this._cascades[P].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);this.useNormalOffset=_,_?(I.u_shadow_normal_offset=[1,5,5],I.u_shadow_bias=[6e-5,.0012,.012]):I.u_shadow_bias=[36e-5,.0012,.012],l.setShadowUniformValues(v,I)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,l,_,v){if(v[2]>=0)return{};const w=function(P,D,z){const k=z/(1<<P.canonical.z);return new s.c3([P.canonical.x*k+P.wrap*z,P.canonical.y*k+P.wrap*z,0],[(P.canonical.x+1)*k+P.wrap*z,(P.canonical.y+1)*k+P.wrap*z,D])}(o,l,_).getCorners(),I=l/-v[2];v[0]<0?(s.v.add(w[0],w[0],[v[0]*I,0,0]),s.v.add(w[3],w[3],[v[0]*I,0,0])):v[0]>0&&(s.v.add(w[1],w[1],[v[0]*I,0,0]),s.v.add(w[2],w[2],[v[0]*I,0,0])),v[1]<0?(s.v.add(w[0],w[0],[0,v[1]*I,0]),s.v.add(w[1],w[1],[0,v[1]*I,0])):v[1]>0&&(s.v.add(w[2],w[2],[0,v[1]*I,0]),s.v.add(w[3],w[3],[0,v[1]*I,0]));const C={};return C.vertices=w,C.planes=[lc(w[1],w[0],w[4]),lc(w[2],w[1],w[5]),lc(w[3],w[2],w[6]),lc(w[0],w[3],w[7])],C}addShadowReceiver(o,l,_){this._receivers.add(o,s.c3.fromTileIdAndHeight(o,l,_))}getMaxCascadeForTile(o){const l=this._receivers.get(o);return l&&l.lastCascade?l.lastCascade:0}}function lc(d,o,l){const _=s.v.sub([],l,o),v=s.v.sub([],d,o),w=s.v.cross([],_,v),I=s.v.length(w);return I===0?[0,0,1,0]:(s.v.scale(w,w,1/I),[w[0],w[1],w[2],-s.v.dot(w,o)])}function wf(d){const o=d.properties.get("direction"),l=s.b3(o.x,o.y,o.z);l[2]=s.c(l[2],0,75);const _=s.ch([l[0],l[1],l[2]]);return s.v.fromValues(_.x,_.y,_.z)}function Ph(d,o){const l=d.properties.get("color"),_=d.properties.get("intensity"),v=d.properties.get("direction"),w=[v.x,v.y,v.z],I=o.properties.get("color"),C=o.properties.get("intensity"),P=Math.max(s.v.dot([0,0,1],w),0),D=[0,0,0];s.v.scale(D,I.toArray01Linear().slice(0,3),C);const z=[0,0,0];return s.v.scale(z,l.toArray01Linear().slice(0,3),P*_),s.bw([D[0]>0?D[0]/(D[0]+z[0]):0,D[1]>0?D[1]/(D[1]+z[1]):0,D[2]>0?D[2]/(D[2]+z[2]):0])}function gm(d,o,l,_,v,w){const I=d.zoom,C=d.scale,P=d.worldSize,D=1/P,z=d.aspect,k=Math.sqrt(1+z*z)*Math.tan(.5*d.fovX),B=k*k,U=_-l,q=_+l;let X,Z;B>U/q?(X=_,Z=_*k):(X=.5*q*(1+B),Z=.5*Math.sqrt(U*U+2*(_*_+l*l)*B+q*q*B*B));const j=d.projection.pixelsPerMeter(d.center.lat,P),J=d._camera.getCameraToWorldMercator(),nt=[0,0,-X*D];s.v.transformMat4(nt,nt,J);let st=Z*D;const Y=d._edgeInsets;if(!(Y.left===0&&Y.top===0&&Y.right===0&&Y.bottom===0||Y.left===Y.right&&Y.top===Y.bottom)){const Ft=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?j:1),ge=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,l,_);ge[8]=2*-d.centerOffset.x/d.width,ge[9]=2*d.centerOffset.y/d.height;const ce=new Float64Array(16);s.m.mul(ce,ge,Ft);const Se=new Float64Array(16);s.m.invert(Se,ce);const fe=s.F.fromInvProjectionMatrix(Se,P,I,!0);for(const Pe of fe.points){const Le=((K=Pe)[0]/=C,K[1]/=C,K[2]=s.b(K[2],d._center.lat),K);st=Math.max(st,s.v.len(s.v.subtract([],nt,Le)))}}var K;st*=v/(v-1);const lt=Math.acos(o[2]),ht=Math.atan2(-o[0],-o[1]),ut=new Mo;ut.position=nt,ut.setPitchBearing(lt,ht);const pt=ut.getWorldToCamera(P,j),Dt=st*P,wt=Math.min(d._mercatorZfromZoom(17)*P*-2,-2*Dt),St=ut.getCameraToClipOrthographic(-Dt,Dt,-Dt,Dt,wt,(Dt+w*j)/o[2]),mt=new Float64Array(16);s.m.multiply(mt,St,pt);const Lt=s.v.fromValues(Math.floor(1e6*nt[0])/1e6*P,Math.floor(1e6*nt[1])/1e6*P,0),Tt=.5*v,zt=[0,0,0];s.v.transformMat4(zt,Lt,mt),s.v.scale(zt,zt,Tt);const tt=[Math.floor(zt[0]),Math.floor(zt[1]),Math.floor(zt[2])],yt=[0,0,0];s.v.sub(yt,zt,tt),s.v.scale(yt,yt,-1/Tt);const Gt=new Float64Array(16);return s.m.identity(Gt),s.m.translate(Gt,Gt,yt),s.m.multiply(mt,Gt,mt),[mt,Dt]}class _m extends s.a6{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.numModelsLoading={}}loadModel(o,l){return s.aO(this.requestManager.transformRequest(l,s.a2.Model).url).then(_=>{if(!_)return;const v=s.aP(_),w=new s.aQ(o,void 0,void 0,v);return w.computeBoundsAndApplyParent(),w}).catch(_=>{this.fire(new s.a7(new Error(`Could not load model ${o} from ${l}: ${_.message}`)))})}load(o,l){this.models[l]||(this.models[l]={});const _=Object.keys(o);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+_.length;const v=[];for(const w of _)v.push(this.loadModel(w,o[w]));Promise.allSettled(v).then(w=>{for(let I=0;I<w.length;I++){const{status:C,value:P}=w[I];C==="fulfilled"&&P&&(this.models[l][_[I]]=P)}this.numModelsLoading[l]-=_.length,this.fire(new s.a8("data",{dataType:"style"}))}).catch(w=>{this.fire(new s.a7(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,l){return!!this.getModel(o,l)}getModel(o,l){return this.models[l]||(this.models[l]={}),this.models[l][o]}addModel(o,l,_){this.models[_]||(this.models[_]={}),this.hasModel(o,_)&&this.removeModel(o,_),this.load({[o]:this.requestManager.normalizeModelURL(l)},_)}addModels(o,l){const _={};for(const v in o)_[v]=this.requestManager.normalizeModelURL(o[v]);this.load(_,l)}removeModel(o,l){this.models[l]||(this.models[l]={});const _=this.models[l][o];delete this.models[l][o],_.destroy()}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,l){this.models[l]||(this.models[l]={});for(const _ in this.models[l])this.models[l][_].upload(o.context)}}const Sl=(d,o)=>s.ai(d,o&&o.filter(l=>l.identifier!=="source.canvas")),ym=s.p(Bt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),vm=s.p(Bt,["setCenter","setZoom","setBearing","setPitch"]),Ef={version:8,layers:[],sources:{}},Oa={duration:300,delay:0},uc=new Set(["fill","line","background","hillshade","raster"]);class Ro extends s.a6{constructor(o,l={}){super(),this.map=o,this.scope=l.scope||"",this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=s.ak({},Oa),this._buildingIndex=new Bp(this),this.crossTileSymbolIndex=new E_,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new At,this.dispatcher=l.dispatcher?l.dispatcher:new s.br(s.bs(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new xn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new s.cj(o._requestManager,l.localFontFamily?s.ck.all:l.localIdeographFontFamily?s.ck.ideographs:s.ck.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new _m(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this.dispatcher.broadcast("setReferrer",s.cl());const _=this;this._rtlTextPluginCallback=Ro.registerForPluginStateChange(v=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(w,I)=>{if(s.cm(w),I&&I.every(C=>C))for(const C in _._sourceCaches){const P=_._sourceCaches[C],D=P.getSource().type;D!=="vector"&&D!=="geojson"||P.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.getOwnSource(v.sourceId);if(w&&w.vectorLayerIds)for(const I in this._layers){const C=this._layers[I];C.source===w.id&&this._validateLayer(C)}})}loadURL(o,l={}){this.fire(new s.a8("dataloading",{dataType:"style"}));const _=typeof l.validate=="boolean"?l.validate:!s.cn(o);o=this.map._requestManager.normalizeStyleURL(o,l.accessToken),this.resolvedImports.add(o);const v=this.importsCache.get(o);if(v)return this._load(v,_);const w=this.map._requestManager.transformRequest(o,s.a2.Style);this._request=s.a1(w,(I,C)=>{if(this._request=null,I)this.fire(new s.a7(I));else if(C)return this.importsCache.set(o,C),this._load(C,_)})}loadJSON(o,l={}){this.fire(new s.a8("dataloading",{dataType:"style"})),this._request=s.a4.frame(()=>{this._request=null,this._load(o,l.validate!==!1)})}loadEmpty(){this.fire(new s.a8("dataloading",{dataType:"style"})),this._load(Ef,!1)}_loadImports(o,l){if(this.importDepth>=4)return s.X("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const v of o){const w=this._createFragmentStyle(v),I=new Promise(P=>{w.once("style.import.load",P),w.once("error",P)}).then(()=>this.mergeAll());if(_.push(I),this.resolvedImports.has(v.url)){w.loadEmpty();continue}const C=v.data||this.importsCache.get(v.url);C?w.loadJSON(C,{validate:l}):v.url?w.loadURL(v.url,{validate:l}):w.loadEmpty(),this.fragments.push({style:w,id:v.id,config:v.config})}return Promise.allSettled(_)}_createFragmentStyle(o){const l=this.scope?s.aE(o.id,this.scope):o.id,_=new Ro(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:o.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const o=this.isRootStyle();this._shouldPrecompile=o,this.fire(new s.a8(o?"style.load":"style.import.load"))}_load(o,l){const _=o.schema;if(this.isRootStyle()&&(o.fragment||_&&o.fragment!==!1)){const I=s.ak({},Ef,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(I,l)}if(this.setConfig(this._config,_),l&&Sl(this,s.aj(o)))return;this._loaded=!0,this.stylesheet=s.co(o);for(const I in o.sources)this.addSource(I,o.sources[I],{validate:!1,isInitialLoad:!0});o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(o.glyphs,this.scope);const v=dl(this.stylesheet.layers);if(this._order=v.map(I=>I.id),this.stylesheet.light&&s.X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const I=this.stylesheet.lights[0];this.light=new bi(I.properties,I.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new bi(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const I of v){const C=s.cp(I,this.scope,this.options);C.isConfigDependent&&this._configDependentLayers.add(C.fqid),C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize();const P=this.getOwnLayerSourceCache(C),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&C.canCastShadows()&&D&&(P.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const w=this.stylesheet.terrain;w&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.a4.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?s.X("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.a8("data",{dataType:"style"})),o.imports?this._loadImports(o.imports,l).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,l,_,v,w,I,C,P;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(o=D.light),D.stylesheet.lights)for(const z of D.stylesheet.lights)z.type==="ambient"&&D.ambientLight!=null&&(l=D.ambientLight),z.type==="directional"&&D.directionalLight!=null&&(_=D.directionalLight);v=this._prioritizeTerrain(v,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(w=D.fog),D.stylesheet.camera!=null&&(P=D.stylesheet.camera),D.stylesheet.projection!=null&&(I=D.stylesheet.projection),D.stylesheet.transition!=null&&(C=D.stylesheet.transition)}}),this.light=o,this.ambientLight=l,this.directionalLight=_,this.fog=w,v===null?delete this.terrain:this.terrain=v,this.camera=P||{"camera-projection":"perspective"},this.projection=I||{name:"mercator"},this.transition=s.ak({},Oa,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){const l=_=>{for(const v of _.fragments)l(v.style);o(_)};l(this)}_prioritizeTerrain(o,l,_){const v=o&&o.drapeRenderMode===0;return _===null?l&&l.drapeRenderMode===0?l:v?o:null:l!=null&&(!o||v||l&&l.drapeRenderMode===1)?l:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{o=this._prioritizeTerrain(o,l.terrain,l.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(o=l.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},l={},_={};this.forEachFragmentStyle(v=>{for(const w in v._sourceCaches){const I=s.aE(w,v.scope);o[I]=v._sourceCaches[w]}for(const w in v._otherSourceCaches){const I=s.aE(w,v.scope);l[I]=v._otherSourceCaches[w]}for(const w in v._symbolSourceCaches){const I=s.aE(w,v.scope);_[I]=v._symbolSourceCaches[w]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=_}mergeLayers(){const o={},l=[],_={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const I of w._order){const C=w._layers[I];if(C.type==="slot"){const P=s.cq(I);if(o[P])continue;o[P]=[]}C.slot&&o[C.slot]?o[C.slot].push(C):l.push(C)}}),this._mergedOrder=[];const v=(w=[])=>{for(const I of w)if(I.type==="slot"){const C=s.cq(I.id);o[C]&&v(o[C])}else{const C=s.aE(I.id,I.scope);this._mergedOrder.push(C),_[C]=I,I.is3D()&&(this._has3DLayers=!0),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0)}};v(l),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=s.ak({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(l,_,v){let w,I,C;const P=s.a4.devicePixelRatio>1?"@2x":"";let D=s.a1(_.transformRequest(_.normalizeSpriteURL(l,P,".json"),s.a2.SpriteJSON),(B,U)=>{D=null,C||(C=B,w=U,k())}),z=s.a3(_.transformRequest(_.normalizeSpriteURL(l,P,".png"),s.a2.SpriteImage),(B,U)=>{z=null,C||(C=B,I=U,k())});function k(){if(C)v(C);else if(w&&I){const B=s.a4.getImageData(I),U={};for(const q in w){const{width:X,height:Z,x:j,y:J,sdf:nt,pixelRatio:st,stretchX:Y,stretchY:K,content:lt}=w[q],ht=new s.a5({width:X,height:Z});s.a5.copy(B,ht,{x:j,y:J},{x:0,y:0},{width:X,height:Z}),U[q]={data:ht,pixelRatio:st,sdf:nt,stretchX:Y,stretchY:K,content:lt}}v(null,U)}}return{cancel(){D&&(D.cancel(),D=null),z&&(z.cancel(),z=null)}}}(o,this.map._requestManager,(l,_)=>{if(this._spriteRequest=null,l)this.fire(new s.a7(l));else if(_)for(const v in _)this.imageManager.addImage(v,this.scope,_[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.a8("data",{dataType:"style"}))})}_validateLayer(o){const l=this.getOwnSource(o.source);if(!l)return;const _=o.sourceLayer;_&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.a7(new Error(`Source layer "${_}" does not exist on source "${l.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,l)=>{const _=this.fragments[l];return _&&_.style&&(o.data=_.style.serialize()),o})}_serializeSources(){const o={};for(const l in this._sourceCaches){const _=this._sourceCaches[l].getSource();o[_.id]||(o[_.id]=_.serialize())}return o}_serializeLayers(o){const l=[];for(const _ of o){const v=this._layers[_];v&&v.type!=="custom"&&l.push(v.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&(typeof o.isLayerDraped=="function"?o.isLayerDraped(this.getLayerSourceCache(o)):uc.has(o.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const l=this.getOwnLayer(o);if(l)return l;this.fire(new s.a7(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const l=this.getOwnSource(o);if(l)return l;this.fire(new s.a7(new Error(`The source '${o}' does not exist in the map's style.`)))}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const l=this.calculateLightsBrightness();o.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));const _=this._changes.isDirty();if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const I in w){const{updatedIds:C,removedIds:P}=w[I];(C||P)&&this._updateWorkerLayers(I,C,P)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._changes.reset()}const v={};for(const w in this._mergedSourceCaches){const I=this._mergedSourceCaches[w];v[w]=I.used,I.used=!1}for(const w of this._mergedOrder){const I=this._mergedLayers[w];if(I.recalculate(o,this._availableImages),!I.isHidden(o.zoom)){const C=this.getLayerSourceCache(I);C&&(C.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let C=I.minzoom||0;C<(I.maxzoom||25.5);C++){const P=this.map.painter;if(P){const D=I.getProgramIds();if(!D)continue;for(const z of D){const k=I.getDefaultProgramParams(z,o.zoom);k&&(P.style=this,this.fog&&(P._fogVisible=!0,k.overrideFog=!0,P.getOrCreateProgram(z,k)),P._fogVisible=!1,k.overrideFog=!1,P.getOrCreateProgram(z,k),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(k.overrideRtt=!0,P.getOrCreateProgram(z,k)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const w in v){const I=this._mergedSourceCaches[w];v[w]!==I.used&&I.getSource().fire(new s.a8("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),_&&this.fire(new s.a8("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=this._changes.getUpdatedImages();if(o.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],o);this._changes.resetUpdatedImages()}}_updateWorkerLayers(o,l,_){const v=this.getFragmentStyle(o);v&&this.dispatcher.broadcast("updateLayers",{layers:l?v._serializeLayers(l):[],scope:o,removedIds:_||[],options:v.options})}setState(o){if(this._checkLoaded(),Sl(this,s.aj(o)))return!1;(o=s.co(o)).layers=dl(o.layers);const l=function(v,w){if(!v)return[{command:Bt.setStyle,args:[w]}];let I=[];try{if(!O(v.version,w.version))return[{command:Bt.setStyle,args:[w]}];O(v.center,w.center)||I.push({command:Bt.setCenter,args:[w.center]}),O(v.zoom,w.zoom)||I.push({command:Bt.setZoom,args:[w.zoom]}),O(v.bearing,w.bearing)||I.push({command:Bt.setBearing,args:[w.bearing]}),O(v.pitch,w.pitch)||I.push({command:Bt.setPitch,args:[w.pitch]}),O(v.sprite,w.sprite)||I.push({command:Bt.setSprite,args:[w.sprite]}),O(v.glyphs,w.glyphs)||I.push({command:Bt.setGlyphs,args:[w.glyphs]}),O(v.imports,w.imports)||function(k=[],B=[],U){B=B||[];const q=(k=k||[]).map(ml),X=B.map(ml),Z=k.reduce(Sa,{}),j=B.reduce(Sa,{}),J=q.slice();let nt,st,Y,K;for(nt=0,st=0;nt<q.length;nt++)Y=q[nt],j.hasOwnProperty(Y)?st++:(U.push({command:Bt.removeImport,args:[Y]}),J.splice(J.indexOf(Y,st),1));for(nt=0,st=0;nt<X.length;nt++)Y=X[X.length-1-nt],J[J.length-1-nt]!==Y&&(Z.hasOwnProperty(Y)?(U.push({command:Bt.removeImport,args:[Y]}),J.splice(J.lastIndexOf(Y,J.length-st),1)):st++,K=J[J.length-nt],U.push({command:Bt.addImport,args:[j[Y],K]}),J.splice(J.length-nt,0,Y));for(const lt of B){const ht=Z[lt.id];if(!ht||O(ht,lt))continue;O(ht.config,lt.config)||U.push({command:Bt.setImportConfig,args:[lt.id,lt.config]}),O(ht.url,lt.url)||U.push({command:Bt.setImportUrl,args:[lt.id,lt.url]});const ut=lt.data;O(ht&&ht.data,ut)||U.push({command:Bt.setImportData,args:[lt.id,ut]})}}(v.imports,w.imports,I),O(v.transition,w.transition)||I.push({command:Bt.setTransition,args:[w.transition]}),O(v.light,w.light)||I.push({command:Bt.setLight,args:[w.light]}),O(v.fog,w.fog)||I.push({command:Bt.setFog,args:[w.fog]}),O(v.projection,w.projection)||I.push({command:Bt.setProjection,args:[w.projection]}),O(v.lights,w.lights)||I.push({command:Bt.setLights,args:[w.lights]}),O(v.camera,w.camera)||I.push({command:Bt.setCamera,args:[w.camera]});const C={},P=[];(function(k,B,U,q){let X;for(X in B=B||{},k=k||{})k.hasOwnProperty(X)&&(B.hasOwnProperty(X)||mr(X,U,q));for(X in B){if(!B.hasOwnProperty(X))continue;const Z=B[X];k.hasOwnProperty(X)?O(k[X],Z)||(k[X].type==="geojson"&&Z.type==="geojson"&&iu(k,B,X)?U.push({command:Bt.setGeoJSONSourceData,args:[X,Z.data]}):Po(X,B,U,q)):fr(X,B,U)}})(v.sources,w.sources,P,C);const D=[];v.layers&&v.layers.forEach(k=>{k.source&&C[k.source]?I.push({command:Bt.removeLayer,args:[k.id]}):D.push(k)});let z=v.terrain;z&&C[z.source]&&(I.push({command:Bt.setTerrain,args:[void 0]}),z=void 0),I=I.concat(P),O(z,w.terrain)||I.push({command:Bt.setTerrain,args:[w.terrain]}),function(k,B,U){B=B||[];const q=(k=k||[]).map(ml),X=B.map(ml),Z=k.reduce(Sa,{}),j=B.reduce(Sa,{}),J=q.slice(),nt=Object.create(null);let st,Y,K,lt,ht,ut,pt;for(st=0,Y=0;st<q.length;st++)K=q[st],j.hasOwnProperty(K)?Y++:(U.push({command:Bt.removeLayer,args:[K]}),J.splice(J.indexOf(K,Y),1));for(st=0,Y=0;st<X.length;st++)K=X[X.length-1-st],J[J.length-1-st]!==K&&(Z.hasOwnProperty(K)?(U.push({command:Bt.removeLayer,args:[K]}),J.splice(J.lastIndexOf(K,J.length-Y),1)):Y++,ut=J[J.length-st],U.push({command:Bt.addLayer,args:[j[K],ut]}),J.splice(J.length-st,0,K),nt[K]=!0);for(st=0;st<X.length;st++)if(K=X[st],lt=Z[K],ht=j[K],!nt[K]&&!O(lt,ht))if(O(lt.source,ht.source)&&O(lt["source-layer"],ht["source-layer"])&&O(lt.type,ht.type)){for(pt in ur(lt.layout,ht.layout,U,K,null,Bt.setLayoutProperty),ur(lt.paint,ht.paint,U,K,null,Bt.setPaintProperty),O(lt.slot,ht.slot)||U.push({command:Bt.setSlot,args:[K,ht.slot]}),O(lt.filter,ht.filter)||U.push({command:Bt.setFilter,args:[K,ht.filter]}),O(lt.minzoom,ht.minzoom)&&O(lt.maxzoom,ht.maxzoom)||U.push({command:Bt.setLayerZoomRange,args:[K,ht.minzoom,ht.maxzoom]}),lt)lt.hasOwnProperty(pt)&&pt!=="layout"&&pt!=="paint"&&pt!=="filter"&&pt!=="metadata"&&pt!=="minzoom"&&pt!=="maxzoom"&&pt!=="slot"&&(pt.indexOf("paint.")===0?ur(lt[pt],ht[pt],U,K,pt.slice(6),Bt.setPaintProperty):O(lt[pt],ht[pt])||U.push({command:Bt.setLayerProperty,args:[K,pt,ht[pt]]}));for(pt in ht)ht.hasOwnProperty(pt)&&!lt.hasOwnProperty(pt)&&pt!=="layout"&&pt!=="paint"&&pt!=="filter"&&pt!=="metadata"&&pt!=="minzoom"&&pt!=="maxzoom"&&pt!=="slot"&&(pt.indexOf("paint.")===0?ur(lt[pt],ht[pt],U,K,pt.slice(6),Bt.setPaintProperty):O(lt[pt],ht[pt])||U.push({command:Bt.setLayerProperty,args:[K,pt,ht[pt]]}))}else U.push({command:Bt.removeLayer,args:[K]}),ut=J[J.lastIndexOf(K)+1],U.push({command:Bt.addLayer,args:[ht,ut]})}(D,w.layers,I)}catch(C){console.warn("Unable to compute style diff:",C),I=[{command:Bt.setStyle,args:[w]}]}return I}(this.serialize(),o).filter(v=>!(v.command in vm));if(l.length===0)return!1;const _=l.filter(v=>!(v.command in ym));if(_.length>0)throw new Error(`Unimplemented: ${_.map(v=>v.command).join(", ")}.`);return l.forEach(v=>{this[v.command].apply(this,v.args)}),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(o,l){return this.getImage(o)?this.fire(new s.a7(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,this.scope,l),this._afterImageUpdated(o),this)}updateImage(o,l){this.imageManager.updateImage(o,this.scope,l)}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._afterImageUpdated(o),this):this.fire(new s.a7(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(o),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.a8("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(o,l,_={}){return this._checkLoaded(),this._validate(s.cr,`models.${o}`,l,null,_)||(this.modelManager.addModel(o,l,this.scope),this._changes.setDirty()),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this):this.fire(new s.a7(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,l,_={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(s.cs,`sources.${o}`,l,null,_))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const v=$o(o,l,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const w=I=>{const C=(I?"symbol:":"other:")+v.id,P=s.aE(C,this.scope),D=this._sourceCaches[C]=new s.bq(P,v,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=D,D.onAdd(this.map)};w(!1),l.type!=="vector"&&l.type!=="geojson"||w(!0),v.onAdd&&v.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const l=this.getOwnSource(o);if(!l)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===o)return this.fire(new s.a7(new Error(`Source "${o}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new s.a7(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const _=this.getOwnSourceCaches(o);for(const v of _){const w=s.cq(v.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(v.id),v.fire(new s.a8("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,l){this._checkLoaded(),this.getOwnSource(o).setData(l),this._changes.setDirty()}getOwnSource(o){const l=this.getOwnSourceCache(o);return l&&l.getSource()}getOwnSources(){const o=[];for(const l in this._otherSourceCaches){const _=this.getOwnSourceCache(l);_&&o.push(_.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const l in o){const _=o[l]._tiles;for(const v in _){const w=_[v];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const v of o){if(this._validate(s.ct,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(v),w.updateTransitions(l)}else this.ambientLight=new Yu(v,hl,this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(v),w.updateTransitions(l)}else this.directionalLight=new Yu(v,Zd,this.scope,this.options)}}const _=new s.al(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,l=this.ambientLight;if(!o||!l)return;const _=k=>.2126*(k[0]<=.03928?k[0]/12.92:Math.pow((k[0]+.055)/1.055,2.4))+.7152*(k[1]<=.03928?k[1]/12.92:Math.pow((k[1]+.055)/1.055,2.4))+.0722*(k[2]<=.03928?k[2]/12.92:Math.pow((k[2]+.055)/1.055,2.4)),v=o.properties.get("color").toArray01(),w=o.properties.get("intensity"),I=o.properties.get("direction"),C=1-s.b3(I.x,I.y,I.z)[2]/90,P=_(v)*w*C,D=l.properties.get("color").toArray01(),z=l.properties.get("intensity");return(P+_(D)*z)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(!o)return this;if(s.cu(o)){const l=s.cv(o),_=this.fragments.find(({id:w})=>w===l);if(!_)throw new Error(`Style import not found: ${o}`);const v=s.cq(o);return _.style.getFragmentStyle(v)}{const l=this.fragments.find(({id:_})=>_===o);if(!l)throw new Error(`Style import not found: ${o}`);return l.style}}getConfigProperty(o,l){const _=this.getFragmentStyle(o);if(!_)return null;const v=s.aE(l,_.scope),w=_.options.get(v),I=w?w.value||w.default:null;return I?I.serialize():null}setConfigProperty(o,l,_){const v=s.cw(_);if(v.result!=="success")return void Sl(this,v.value);const w=v.value.expression,I=this.getFragmentStyle(o);if(!I)return;const C=s.aE(l,I.scope),P=I.options.get(C);P&&(this.options.set(C,{...P,value:w}),this.updateConfigDependencies())}setConfig(o,l){if(this._config=o,o||l)if(l)for(const _ in l){let v,w;const I=s.cw(l[_].default);if(I.result==="success"&&(v=I.value.expression),o&&o[_]!==void 0){const B=s.cw(o[_]);B.result==="success"&&(w=B.value.expression)}const{minValue:C,maxValue:P,stepValue:D,type:z,values:k}=l[_];if(v){const B=s.aE(_,this.scope);this.options.set(B,{default:v,value:w,minValue:C,maxValue:P,stepValue:D,type:z,values:k})}else this.fire(new s.a7(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new s.a7(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const o of this._configDependentLayers){const l=this.getLayer(o);l&&(l.possiblyEvaluateVisibility(),this._updateLayer(l))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(o,l,_={}){this._checkLoaded();const v=o.id;if(this._layers[v])return void this.fire(new s.a7(new Error(`Layer with id "${v}" already exists on this map`)));let w;if(o.type==="custom"){if(Sl(this,s.cx(o)))return;w=s.cp(o,this.scope,this.options)}else{if(typeof o.source=="object"&&(this.addSource(v,o.source),o=s.co(o),o=s.ak(o,{source:v})),this._validate(s.cy,`layers.${v}`,o,{arrayIndex:-1},_))return;w=s.cp(o,this.scope,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[w.id]=w.serialize()}w.isConfigDependent&&this._configDependentLayers.add(w.fqid);let I=this._order.length;if(l){const z=this._order.indexOf(l);if(z===-1)return void this.fire(new s.a7(new Error(`Layer with id "${l}" does not exist on this map.`)));w.slot===this._layers[l].slot?I=z:s.X(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(I,0,v),this._layerOrderChanged=!0,this._layers[v]=w;const C=this.getOwnLayerSourceCache(w),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&w.canCastShadows()&&P&&(C.castsShadows=!0);const D=this._changes.getRemovedLayer(w);if(D&&w.source&&C&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const z=s.aE(w.source,w.scope);D.type!==w.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),C.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(o,l){this._checkLoaded();const _=this._checkLayer(o);if(!_||o===l)return;const v=this._order.indexOf(o);this._order.splice(v,1);let w=this._order.length;if(l){const I=this._order.indexOf(l);if(I===-1)return void this.fire(new s.a7(new Error(`Layer with id "${l}" does not exist on this map.`)));_.slot===this._layers[l].slot?w=I:s.X(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const l=this._checkLayer(o);if(!l)return;l.setEventedParent(null);const _=this._order.indexOf(o);this._order.splice(_,1),delete this._layers[o],delete this._serializedLayers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const v=this.getOwnLayerSourceCache(l);if(v&&v.castsShadows){let w=!1;for(const I in this._layers)if(this._layers[I].source===l.source&&this._layers[I].canCastShadows()){w=!0;break}v.castsShadows=w}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const l in this._layers)if(this._layers[l].type===o)return!0;return!1}setLayerZoomRange(o,l,_){this._checkLoaded();const v=this._checkLayer(o);v&&(v.minzoom===l&&v.maxzoom===_||(l!=null&&(v.minzoom=l),_!=null&&(v.maxzoom=_),this._updateLayer(v)))}setSlot(o,l){this._checkLoaded();const _=this._checkLayer(o);_&&_.slot!==l&&(_.slot=l,this._updateLayer(_))}setFilter(o,l,_={}){this._checkLoaded();const v=this._checkLayer(o);if(v&&!O(v.filter,l))return l==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(s.cz,`layers.${v.id}.filter`,l,{layerType:v.type},_)||(v.filter=s.co(l),this._updateLayer(v)))}getFilter(o){const l=this._checkLayer(o);if(l)return s.co(l.filter)}setLayoutProperty(o,l,_,v={}){this._checkLoaded();const w=this._checkLayer(o);w&&(O(w.getLayoutProperty(l),_)||(w.setLayoutProperty(l,_,v),w.isConfigDependent&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)))}getLayoutProperty(o,l){const _=this._checkLayer(o);if(_)return _.getLayoutProperty(l)}setPaintProperty(o,l,_,v={}){this._checkLoaded();const w=this._checkLayer(o);if(!w||O(w.getPaintProperty(l),_))return;const I=w.setPaintProperty(l,_,v);w.isConfigDependent&&this._configDependentLayers.add(w.fqid),I&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(o,l){const _=this._checkLayer(o);if(_)return _.getPaintProperty(l)}setFeatureState(o,l){this._checkLoaded();const _=o.source,v=o.sourceLayer,w=this._checkSource(_);if(!w)return;const I=w.type;if(I==="geojson"&&v)return void this.fire(new s.a7(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(I==="vector"&&!v)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(_);for(const P of C)P.setFeatureState(v,o.id,l)}removeFeatureState(o,l){this._checkLoaded();const _=o.source,v=this._checkSource(_);if(!v)return;const w=v.type,I=w==="vector"?o.sourceLayer:void 0;if(w==="vector"&&!I)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new s.a7(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(_);for(const P of C)P.removeFeatureState(I,o.id,l)}getFeatureState(o){this._checkLoaded();const l=o.source,_=o.sourceLayer,v=this._checkSource(l);if(v){if(v.type!=="vector"||_)return o.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(_,o.id);this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=s.ak({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return s.ak({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),l=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return s.cA({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateLayer(o){this._changes.updateLayer(o);const l=this.getLayerSourceCache(o),_=s.aE(o.source,o.scope),v=this._changes.getUpdatedSourceCaches();o.source&&!v[_]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),l.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const l=C=>this._mergedLayers[C].type==="fill-extrusion",_=this.order,v={},w=[];for(let C=_.length-1;C>=0;C--){const P=_[C];if(l(P)){v[P]=C;for(const D of o){const z=D[P];if(z)for(const k of z)w.push(k)}}}w.sort((C,P)=>P.intersectionZ-C.intersectionZ);const I=[];for(let C=_.length-1;C>=0;C--){const P=_[C];if(l(P))for(let D=w.length-1;D>=0;D--){const z=w[D].feature;if(v[z.layer.id]<C)break;I.push(z),w.pop()}else for(const D of o){const z=D[P];if(z)for(const k of z)I.push(k.feature)}}return I}queryRenderedFeatures(o,l,_){l&&l.filter&&this._validate(s.cz,"queryRenderedFeatures.filter",l.filter,null,l),l.scope=this.scope,l.availableImages=this._availableImages,l.serializedLayers=this._serializedLayers;const v={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new s.a7(new Error("parameters.layers must be an Array."))),[];for(const D of l.layers){const z=this._mergedLayers[D];if(!z)return this.fire(new s.a7(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];v[z.source]=!0}}const w=[],I=l.serializedLayers||{},C=l&&l.layers?l.layers.some(D=>{const z=this.getLayer(D);return z&&z.is3D()}):this.has3DLayers(),P=ji.createFromScreenPoints(o,_);for(const D in this._mergedSourceCaches){const z=this._mergedSourceCaches[D].getSource();if(!z||z.scope!==l.scope)continue;const k=this._mergedSourceCaches[D].getSource().id;l.layers&&!v[k]||w.push(Qs(this._mergedSourceCaches[D],this._mergedLayers,I,P,l,_,C,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(D,z,k,B,U,q,X){const Z={},j=q.queryRenderedSymbols(B),J=[];for(const nt of Object.keys(j).map(Number))J.push(X[nt]);J.sort(Jo);for(const nt of J){const st=nt.featureIndex.lookupSymbolFeatures(j[nt.bucketInstanceId],z,nt.bucketIndex,nt.sourceLayerIndex,U.filter,U.layers,U.availableImages,D);for(const Y in st){const K=Z[Y]=Z[Y]||[],lt=st[Y];lt.sort((ht,ut)=>{const pt=nt.featureSortOrder;if(pt){const Dt=pt.indexOf(ht.featureIndex);return pt.indexOf(ut.featureIndex)-Dt}return ut.featureIndex-ht.featureIndex});for(const ht of lt)K.push(ht)}}for(const nt in Z)Z[nt].forEach(st=>{const Y=st.feature,K=k(D[nt]);if(!K)return;const lt=K.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=lt});return Z}(this._mergedLayers,I,this.getLayerSourceCache.bind(this),P.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(o,l){l&&l.filter&&this._validate(s.cz,"querySourceFeatures.filter",l.filter,null,l);const _=this.getOwnSourceCaches(o);let v=[];for(const w of _)v=v.concat(x_(w,l));return v}addSourceType(o,l,_){return Ro.getSourceType(o)?_(new Error(`A source type called "${o}" already exists.`)):(Ro.setSourceType(o,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:l.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,l,_={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const C in o)if(!O(o[C],v[C])){w=!0;break}if(!w)return;const I=this._getTransitionParameters();this.light.setLight(o,l,_),this.light.updateTransitions(I)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,l=1){if(this._checkLoaded(),!o)return delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=o;const v=o.source==null;if(l===1){if(typeof _.source=="object"){const C="terrain-dem-src";this.addSource(C,_.source),_=s.co(_),_=s.ak(_,{source:C})}const w=s.ak({},_),I={};if(this.terrain&&v){w.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(I.style=C.serialize())}if(this._validate(s.cB,"terrain",w,I))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&l!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,l),this.fire(new s.a8("data",{dataType:"style"}))}else{const w=this.terrain,I=w.get();for(const C of Object.keys(s.ae.terrain))!_.hasOwnProperty(C)&&s.ae.terrain[C].default&&(_[C]=s.ae.terrain[C].default);for(const C in o)if(!O(o[C],I[C])){w.set(o,this.options),this.stylesheet.terrain=o;const P=this._getTransitionParameters({duration:0});w.updateTransitions(P),this.fire(new s.a8("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const l=this.fog=new Fp(o,this.map.transform);this.stylesheet.fog=l.get();const _=this._getTransitionParameters({duration:0});l.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!O(l.get(),o)){l.set(o),this.stylesheet.fog=l.get();const _=this._getTransitionParameters({duration:0});l.updateTransitions(_)}}else this._createFog(o);this._markersNeedUpdate=!0}_getTransitionParameters(o){return{now:s.a4.now(),transition:s.ak(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],l=[];for(const _ in this._mergedLayers)this.isLayerDraped(this._mergedLayers[_])?o.push(_):l.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...l)}_createTerrain(o,l){const _=this.terrain=new Ao(o,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});_.updateTransitions(v)}_force3DLayerUpdate(){for(const o in this._layers){const l=this._layers[o];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const l=this._layers[o];l.type==="symbol"&&this._updateLayer(l)}}_validate(o,l,_,v,w={}){if(w&&w.validate===!1)return!1;const I=s.ak({},this.serialize());return Sl(this,o.call(s.aj,s.ak({key:l,style:I,value:_,styleSpec:s.ae},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cC.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(o){const l=this.getSourceCaches(o);for(const _ of l)_.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){const l=this.getSourceCaches(o);for(const _ of l)_.resume(),_.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}updateSources(o){let l;this.directionalLight&&(l=wf(this.directionalLight));for(const _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(o,void 0,void 0,l)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const l=this._sourceCaches[o];l.resume(),l.reload()}}_updatePlacement(o,l,_,v,w=!1){let I=!1,C=!1;const P={},D={};for(const z of this._mergedOrder){const k=this._mergedLayers[z];if(k.type!=="symbol")continue;const B=s.aE(k.source,k.scope);let U=P[B];if(!U){const X=this.getLayerSourceCache(k);if(!X)continue;const Z=X.getRenderableIds(!0).map(j=>X.getTileByID(j));D[B]=Z.slice(),U=P[B]=Z.sort((j,J)=>J.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(J.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(k,U,o.center.lng,o.projection);I=I||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new s.a8("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.a4.now(),o.zoom))&&(this.pauseablePlacement=new Xp(o,this._mergedOrder,w,l,_,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.a4.now()),C=!0),I&&this.pauseablePlacement.placement.setStale()),C||I)for(const z of this._mergedOrder){const k=this._mergedLayers[z];k.type==="symbol"&&this.placement.updateLayerOpacities(k,P[s.aE(k.source,k.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.a4.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o){this._checkLoaded();const l=this.stylesheet.imports=this.stylesheet.imports||[];return l.findIndex(({id:_})=>_===o.id)!==-1?this.fire(new s.a7(new Error(`Import with id '${o.id}' already exists in the map's style.`))):(l.push(o),this._loadImports([o],!0),this)}setImportUrl(o,l){this._checkLoaded();const _=this.stylesheet.imports||[],v=this.getImportIndex(o);if(v===-1)return this;_[v].url=l;const w=this.fragments[v];return w.style=this._createFragmentStyle(_[v]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(l),this}setImportData(o,l){this._checkLoaded();const _=this.getImportIndex(o),v=this.stylesheet.imports||[];return _===-1?this:l?(this.fragments[_].style.setState(l),this._reloadImports(),this):(delete v[_].data,this.setImportUrl(o,v[_].url))}setImportConfig(o,l){this._checkLoaded();const _=this.getImportIndex(o),v=this.stylesheet.imports||[];if(_===-1)return this;l?v[_].config=l:delete v[_].config;const w=this.fragments[_],I=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=l,w.style.setConfig(l,I),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const l=this.stylesheet.imports||[],_=this.getImportIndex(o);return _===-1||(l.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports()),this}getImportIndex(o){const l=(this.stylesheet.imports||[]).findIndex(_=>_.id===o);return l===-1&&this.fire(new s.a7(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),l}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const l in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[l];_&&o.push(_.getSource())}return o}getSource(o,l){const _=this.getSourceCache(o,l);return _&&_.getSource()}getLayerSource(o){const l=this.getLayerSourceCache(o);return l&&l.getSource()}getSourceCache(o,l){const _=s.aE(o,l);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(o){const l=s.aE(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(o){const l=[];return this._mergedOtherSourceCaches[o]&&l.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&l.push(this._mergedSymbolSourceCaches[o]),l}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const l in o){const _=o[l];_==="reload"?this.reloadSource(l):_==="clear"&&this.clearSource(l)}}updateLayers(o){const l=this._changes.getUpdatedPaintProperties();for(const _ of l){const v=this.getLayer(_);v&&v.updateTransitions(o)}}getImages(o,l,_){this.imageManager.getImages(l.icons,l.scope,_),this._updateTilesForChangedImages();const v=w=>{w&&w.setDependencies(l.tileID.key,l.type,l.icons)};v(this._otherSourceCaches[l.source]),v(this._symbolSourceCaches[l.source])}getGlyphs(o,l,_){this.glyphManager.getGlyphs(l.stacks,l.scope,_)}getResource(o,l,_){return s.cD(l,_)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const l=[];return this._otherSourceCaches[o]&&l.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&l.push(this._symbolSourceCaches[o]),l}_isSourceCacheLoaded(o){const l=this.getOwnSourceCaches(o);return l.length===0?(this.fire(new s.a7(new Error(`There is no source with ID '${o}'`))),!1):l.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function za(d,o){let l=!1,_=null;const v=()=>{_=null,l&&(d(),_=setTimeout(v,o),l=!1)};return()=>(l=!0,_||v(),_)}Ro.getSourceType=function(d){return bs[d]},Ro.setSourceType=function(d,o){bs[d]=o},Ro.registerForPluginStateChange=s.ci;class xm{constructor(o){this._hashName=o&&encodeURIComponent(o),s.aR(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=za(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const l=Na(o);if(this._hashName){const _=this._hashName;let v=!1;const w=location.hash.slice(1).split("&").map(I=>{const C=I.split("=")[0];return C===_?(v=!0,`${C}=${l}`):I}).filter(I=>I);return v||w.push(`${_}=${l}`),`#${w.join("&")}`}return`#${l}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let l;return o.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(l=_)}),(l&&l[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(_=>isNaN(_))){const _=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(l[3]||0):o.getBearing();return o.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:_,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Na(d,o){const l=d.getCenter(),_=Math.round(100*d.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),I=Math.round(l.lng*w)/w,C=Math.round(l.lat*w)/w,P=d.getBearing(),D=d.getPitch();let z=o?`/${I}/${C}/${_}`:`${_}/${C}/${I}`;return(P||D)&&(z+="/"+Math.round(10*P)/10),D&&(z+=`/${Math.round(D)}`),z}const cc={linearity:.3,easing:s.cE(0,0,.3,1)},If=s.ak({deceleration:2500,maxSpeed:1400},cc),Tf=s.ak({deceleration:20,maxSpeed:1400},cc),Lh=s.ak({deceleration:1e3,maxSpeed:360},cc),G_=s.ak({deceleration:1e3,maxSpeed:90},cc);class bm{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.a4.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,l=s.a4.now();for(;o.length>0&&l-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)l.zoom+=w.zoomDelta||0,l.bearing+=w.bearingDelta||0,l.pitch+=w.pitchDelta||0,w.panDelta&&l.pan._add(w.panDelta),w.around&&(l.around=w.around),w.pinchAround&&(l.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(l.pan.mag()){const w=Dh(l.pan.mag(),_,s.ak({},If,o||{}));v.offset=l.pan.mult(w.amount/l.pan.mag()),v.center=this._map.transform.center,ka(v,w)}if(l.zoom){const w=Dh(l.zoom,_,Tf);v.zoom=this._map.transform.zoom+w.amount,ka(v,w)}if(l.bearing){const w=Dh(l.bearing,_,Lh);v.bearing=this._map.transform.bearing+s.c(w.amount,-179,179),ka(v,w)}if(l.pitch){const w=Dh(l.pitch,_,G_);v.pitch=this._map.transform.pitch+w.amount,ka(v,w)}if(v.zoom||v.bearing){const w=l.pinchAround===void 0?l.around:l.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function ka(d,o){(!d.duration||d.duration<o.duration)&&(d.duration=o.duration,d.easing=o.easing)}function Dh(d,o,l){const{maxSpeed:_,linearity:v,deceleration:w}=l,I=s.c(d*v/(o/1e3),-_,_),C=Math.abs(I)/(w*v);return{easing:l.easing,duration:1e3*C,amount:I*(C/2)}}class vo extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,l,_,v={}){const w=je(l.getCanvasContainer(),_),I=l.unproject(w);super(o,s.ak({point:w,lngLat:I,originalEvent:_},v)),this._defaultPrevented=!1,this.target=l}}class hc extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,l,_){const v=o==="touchend"?_.changedTouches:_.touches,w=qe(l.getCanvasContainer(),v),I=w.map(P=>l.unproject(P)),C=w.reduce((P,D,z,k)=>P.add(D.div(k.length)),new s.P(0,0));super(o,{points:w,point:C,lngLats:I,lngLat:l.unproject(C),originalEvent:_}),this._defaultPrevented=!1}}class j_ extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,l,_){super(o,{originalEvent:_}),this._defaultPrevented=!1}}class Sf{constructor(o,l){this._map=o,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new j_(o.type,this._map,o))}mousedown(o,l){return this._mousedownPos=l,this._firePreventable(new vo(o.type,this._map,o))}mouseup(o){this._map.fire(new vo(o.type,this._map,o))}preclick(o){const l=s.ak({},o);l.type="preclick",this._map.fire(new vo(l.type,this._map,l))}click(o,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(o),this._map.fire(new vo(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new vo(o.type,this._map,o))}mouseover(o){this._map.fire(new vo(o.type,this._map,o))}mouseout(o){this._map.fire(new vo(o.type,this._map,o))}touchstart(o){return this._firePreventable(new hc(o.type,this._map,o))}touchmove(o){this._map.fire(new hc(o.type,this._map,o))}touchend(o){this._map.fire(new hc(o.type,this._map,o))}touchcancel(o){this._map.fire(new hc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rh{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new vo(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new vo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new vo(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pc{constructor(o,l){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,l){this.isEnabled()&&o.shiftKey&&o.button===0&&(ie(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(o,l){if(!this._active)return;const _=l,v=this._startPos,w=this._lastPos;if(!v||!w||w.equals(_)||!this._box&&_.dist(v)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=ot("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const I=Math.min(v.x,_.x),C=Math.max(v.x,_.x),P=Math.min(v.y,_.y),D=Math.max(v.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${P}px)`,this._box.style.width=C-I+"px",this._box.style.height=D-P+"px")})}mouseupWindow(o,l){if(!this._active)return;const _=this._startPos,v=l;if(_&&o.button===0){if(this.reset(),Ne(),_.x!==v.x||_.y!==v.y)return this._map.fire(new s.a8("boxzoomend",{originalEvent:o})),{cameraAnimation:w=>w.fitScreenCoordinates(_,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),he(),delete this._startPos,delete this._lastPos}_fireEvent(o,l){return this._map.fire(new s.a8(o,{originalEvent:l}))}}function fc(d,o){const l={};for(let _=0;_<d.length;_++)l[d[_].identifier]=o[_];return l}class dc{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,l,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),_.length===this.numTouches&&(this.centroid=function(v){const w=new s.P(0,0);for(const I of v)w._add(I);return w.div(v.length)}(l),this.touches=fc(_,l)))}touchmove(o,l,_){if(this.aborted||!this.centroid)return;const v=fc(_,l);for(const w in this.touches){const I=v[w];(!I||I.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(o,l,_){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class mc{constructor(o){this.singleTap=new dc(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,l,_){this.singleTap.touchstart(o,l,_)}touchmove(o,l,_){this.singleTap.touchmove(o,l,_)}touchend(o,l,_){const v=this.singleTap.touchend(o,l,_);if(v){const w=o.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(v)<30;if(w&&I||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Oh{constructor(){this._zoomIn=new mc({numTouches:1,numTaps:2}),this._zoomOut=new mc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,l,_){this._zoomIn.touchstart(o,l,_),this._zoomOut.touchstart(o,l,_)}touchmove(o,l,_){this._zoomIn.touchmove(o,l,_),this._zoomOut.touchmove(o,l,_)}touchend(o,l,_){const v=this._zoomIn.touchend(o,l,_),w=this._zoomOut.touchend(o,l,_);return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(v)},{originalEvent:o})}):w?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(w)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const zh={0:1,2:2};class io{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,l){return!1}_move(o,l){return{}}mousedown(o,l){if(this._lastPoint)return;const _=rr(o);this._correctButton(o,_)&&(this._lastPoint=l,this._eventButton=_)}mousemoveWindow(o,l){const _=this._lastPoint;if(_){if(o.preventDefault(),this._eventButton!=null&&function(v,w){const I=zh[w];return v.buttons===void 0||(v.buttons&I)!==I}(o,this._eventButton))this.reset();else if(this._moved||!(l.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(_,l)}}mouseupWindow(o){this._lastPoint&&rr(o)===this._eventButton&&(this._moved&&Ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wm extends io{mousedown(o,l){super.mousedown(o,l),this._lastPoint&&(this._active=!0)}_correctButton(o,l){return l===0&&!o.ctrlKey}_move(o,l){return{around:l,panDelta:l.sub(o)}}}class Cf extends io{_correctButton(o,l){return l===0&&o.ctrlKey||l===2}_move(o,l){const _=.8*(l.x-o.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(o){o.preventDefault()}}class Mf extends io{_correctButton(o,l){return l===0&&o.ctrlKey||l===2}_move(o,l){const _=-.5*(l.y-o.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(o){o.preventDefault()}}class Cl{constructor(o,l){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),s.aR(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(o,l,_){return this._calculateTransform(o,l,_)}touchmove(o,l,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!s.cF())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,l,_)}}touchend(o,l,_){this._calculateTransform(o,l,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,l,_){_.length>0&&(this._active=!0);const v=fc(_,l),w=new s.P(0,0),I=new s.P(0,0);let C=0;for(const D in v){const z=v[D],k=this._touches[D];k&&(w._add(z),I._add(z.sub(k)),C++,v[D]=z)}if(this._touches=v,C<this._minTouches||!I.mag())return;const P=I.div(C);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(C),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ot("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Nh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,l,_){return{}}touchstart(o,l,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([l[0],l[1]]))}touchmove(o,l,_){const v=this._firstTwoTouches;if(!v)return;o.preventDefault();const[w,I]=v,C=Ml(_,l,w),P=Ml(_,l,I);if(!C||!P)return;const D=this._aroundCenter?null:C.add(P).div(2);return this._move([C,P],D,o)}touchend(o,l,_){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,I=Ml(_,l,v),C=Ml(_,l,w);I&&C||(this._active&&Ne(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ml(d,o,l){for(let _=0;_<d.length;_++)if(d[_].identifier===l)return o[_]}function kh(d,o){return Math.log(d/o)/Math.LN2}class Fh extends Nh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,l){const _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(kh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:kh(this._distance,_),pinchAround:l}}}function Af(d,o){return 180*d.angleWith(o)/Math.PI}class Em extends Nh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,l){const _=this._vector;if(this._vector=o[0].sub(o[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Af(this._vector,_),pinchAround:l}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const l=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const v=Af(o,_);return Math.abs(v)<l}}function Fa(d){return Math.abs(d.y)>Math.abs(d.x)}class q_ extends Nh{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Fa(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,l,_){const v=this._lastPoints;if(!v)return;const w=o[0].sub(v[0]),I=o[1].sub(v[1]);return this._map._cooperativeGestures&&!s.cF()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,I,_.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(w.y+I.y)/2*-.5})}gestureBeginsVertically(o,l,_){if(this._valid!==void 0)return this._valid;const v=o.mag()>=2,w=l.mag()>=2;if(!v&&!w)return;if(!v||!w)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=o.y>0==l.y>0;return Fa(o)&&Fa(l)&&I}}const Z_={panStep:100,bearingStep:15,pitchStep:10};class Im{constructor(){const o=Z_;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let l=0,_=0,v=0,w=0,I=0;switch(o.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:o.shiftKey?_=-1:(o.preventDefault(),w=-1);break;case 39:o.shiftKey?_=1:(o.preventDefault(),w=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),I=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,v=0),{cameraAnimation:C=>{const P=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Bh,zoom:l?Math.round(P)+l*(o.shiftKey?2:1):P,bearing:C.getBearing()+_*this._bearingStep,pitch:C.getPitch()+v*this._pitchStep,offset:[-w*this._panStep,-I*this._panStep],center:C.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bh(d){return d*(2-d)}const Vh=4.000244140625;class Tm{constructor(o,l){this._map=o,this._el=o.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.aR(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||s.cF()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const _=s.a4.now(),v=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,l!==0&&l%Vh==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),o.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=o,this._delta-=l,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=je(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Vh?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&z!==0&&(z=1/z);const k=l(),B=Math.pow(2,k),U=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(U*z))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:l(),v=this._startZoom,w=this._easing;let I,C=!1;if(this._type==="wheel"&&v&&w){const D=Math.min((s.a4.now()-this._lastWheelEventTime)/200,1),z=w(D);I=s.n(v,_,z),D<1?this._frameId||(this._frameId=!0):C=!0}else I=_,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=I-l();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let l=s.cG;if(this._prevEase){const _=this._prevEase,v=(s.a4.now()-_.start)/_.duration,w=_.easing(v+.01)-_.easing(v),I=.27/Math.sqrt(w*w+1e-4)*.01,C=Math.sqrt(.0729-I*I);l=s.cE(I,C,.25,1)}return this._prevEase={start:s.a4.now(),duration:o,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ot("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Sm{constructor(o,l){this._clickZoom=o,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Uh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,l){return o.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(o.shiftKey?-1:1),around:_.unproject(l)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pf{constructor(){this._tap=new mc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,l,_){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=l[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(o,l,_))}touchmove(o,l,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const v=l[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(o,l,_)}touchend(o,l,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(o,l,_)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cm{constructor(o,l,_){this._el=o,this._mousePan=l,this._touchPan=_}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mm{constructor(o,l,_){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=l,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Am{constructor(o,l,_,v){this._el=o,this._touchZoom=l,this._touchRotate=_,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gc=d=>d.zoom||d.drag||d.pitch||d.rotate;class Pm extends s.a8{}class du{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,l){const _=s.v.sub([],l,o);this.radius=s.v.length(_[2]<0?s.v.div([],_,this.constants):[_[0],_[1],0])}projectRay(o){s.v.div(o,o,this.constants),s.v.normalize(o,o),s.v.mul(o,o,this.constants);const l=s.v.scale([],o,this.radius);if(l[2]>0){const _=s.v.scale([],[0,0,1],s.v.dot(l,[0,0,1])),v=s.v.scale([],s.v.normalize([],[l[0],l[1],0]),this.radius),w=s.v.add([],l,s.v.scale([],s.v.sub([],s.v.add([],v,_),l),2));l[0]=w[0],l[1]=w[1]}return l}}function _c(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Lm{constructor(o,l){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bm(o),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new du,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),s.aR(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,w,I]of this._listeners){const C=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(w,C,I)}}destroy(){for(const[o,l,_]of this._listeners){const v=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(l,v,_)}}_addDefaultHandlers(o){const l=this._map,_=l.getCanvasContainer();this._add("mapEvent",new Sf(l,o));const v=l.boxZoom=new pc(l,o);this._add("boxZoom",v);const w=new Oh,I=new Uh;l.doubleClickZoom=new Sm(I,w),this._add("tapZoom",w),this._add("clickZoom",I);const C=new Pf;this._add("tapDragZoom",C);const P=l.touchPitch=new q_(l);this._add("touchPitch",P);const D=new Cf(o),z=new Mf(o);l.dragRotate=new Mm(o,D,z),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const k=new wm(o),B=new Cl(l,o);l.dragPan=new Cm(_,k,B),this._add("mousePan",k),this._add("touchPan",B,["touchZoom","touchRotate"]);const U=new Em,q=new Fh;l.touchZoomRotate=new Am(_,q,U,C),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Rh(l));const X=l.scrollZoom=new Tm(l,this);this._add("scrollZoom",X,["mousePan"]);const Z=l.keyboard=new Im;this._add("keyboard",Z);for(const j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[j]&&l[j].enable(o[j])}_add(o,l,_){this._handlers.push({handlerName:o,handler:l,allowed:_}),this._handlersById[o]=l}stop(o){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,l,_){for(const v in o)if(v!==_&&(!l||l.indexOf(v)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const l=[];for(const _ of o)this._el.contains(_.target)&&l.push(_);return l}handleEvent(o,l){this._updatingCamera=!0;const _=o.type==="renderFrame",v=_?void 0:o,w={needsRenderFrame:!1},I={},C={},P=o.touches?this._getMapTouches(o.touches):void 0,D=P?qe(this._el,P):_?void 0:je(this._el,o);for(const{handlerName:B,handler:U,allowed:q}of this._handlers){if(!U.isEnabled())continue;let X;this._blockedByActive(C,q,B)?U.reset():U[l||o.type]&&(X=U[l||o.type](o,D,P),this.mergeHandlerResult(w,I,X,B,v),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||U.isActive())&&(C[B]=U)}const z={};for(const B in this._previousActiveHandlers)C[B]||(z[B]=v);this._previousActiveHandlers=C,(Object.keys(z).length||_c(w))&&(this._changes.push([w,I,z]),this._triggerRenderFrame()),(Object.keys(C).length||_c(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=w;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(o,l,_,v,w){if(!_)return;s.ak(o,_);const I={handlerName:v,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(l.zoom=I),_.panDelta!==void 0&&(l.drag=I),_.pitchDelta!==void 0&&(l.pitch=I),_.bearingDelta!==void 0&&(l.rotate=I)}_applyChanges(){const o={},l={},_={};for(const[v,w,I]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(o.around=v.around),v.aroundCoord!==void 0&&(o.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),s.ak(l,w),s.ak(_,I);this._updateMapTransform(o,l,_),this._changes=[]}_updateMapTransform(o,l,_){const v=this._map,w=v.transform,I=J=>[J.x,J.y,J.z];if((J=>{const nt=this._eventsInProgress.drag;return nt&&!this._handlersById[nt.handlerName].isActive()})()&&!_c(o)){const J=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),J!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&v._stop(!0),!_c(o))return void this._fireEvents(l,_,!0);let{panDelta:C,zoomDelta:P,bearingDelta:D,pitchDelta:z,around:k,aroundCoord:B,pinchAround:U}=o;w._isCameraConstrained&&(P>0&&(P=0),w._isCameraConstrained=!1),U!==void 0&&(k=U),(P||(J=>l[J]&&!this._eventsInProgress[J])("drag"))&&k&&(this._dragOrigin=I(w.pointCoordinate3D(k)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",v._stop(!0),k=k||v.transform.centerPoint,D&&(w.bearing+=D),z&&(w.pitch+=z),w._updateCameraState();const q=[0,0,0];if(C)if(w.projection.name==="mercator"){const J=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(k).dir),nt=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(k.sub(C)).dir);q[0]=nt[0]-J[0],q[1]=nt[1]-J[1]}else{const J=w.pointCoordinate(k);if(w.projection.name==="globe"){C=C.rotate(-w.angle);const nt=w._pixelsPerMercatorPixel/w.worldSize;q[0]=-C.x*s.cH(s.l(J.y))*nt,q[1]=-C.y*s.cH(w.center.lat)*nt}else{const nt=w.pointCoordinate(k.sub(C));J&&nt&&(q[0]=nt.x-J.x,q[1]=nt.y-J.y)}}const X=w.zoom,Z=[0,0,0];if(P){const J=I(B||w.pointCoordinate3D(k)),nt={dir:s.v.normalize([],s.v.sub([],J,w._camera.position))};if(nt.dir[2]<0){const st=w.zoomDeltaToMovement(J,P);s.v.scale(Z,nt.dir,st)}}const j=s.v.add(q,q,Z);w._translateCameraConstrained(j),P&&Math.abs(w.zoom-X)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(l,_,!0)}_fireEvents(o,l,_){const v=gc(this._eventsInProgress),w=gc(o),I={};for(const z in o){const{originalEvent:k}=o[z];this._eventsInProgress[z]||(I[`${z}start`]=k),this._eventsInProgress[z]=o[z]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const z in I)this._fireEvent(z,I[z]);w&&this._fireEvent("move",w.originalEvent);for(const z in o){const{originalEvent:k}=o[z];this._fireEvent(z,k)}const C={};let P;for(const z in this._eventsInProgress){const{handlerName:k,originalEvent:B}=this._eventsInProgress[z];this._handlersById[k].isActive()||(delete this._eventsInProgress[z],P=l[k]||B,C[`${z}end`]=P)}for(const z in C)this._fireEvent(z,C[z]);const D=gc(this._eventsInProgress);if(_&&(v||w)&&!D){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;z?(k(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:P})):(this._map.fire(new s.a8("moveend",{originalEvent:P})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,l){this._map.fire(new s.a8(o,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Pm("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Dm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Rm extends s.a6{constructor(o,l){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,s.aR(["_renderFrameCallback"],this)}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(o,l){return this.jumpTo({center:o},l)}panBy(o,l,_){return o=s.P.convert(o).mult(-1),this.panTo(this.transform.center,s.ak({offset:o},l),_)}panTo(o,l,_){return this.easeTo(s.ak({center:o},l),_)}getZoom(){return this.transform.zoom}setZoom(o,l){return this.jumpTo({zoom:o},l),this}zoomTo(o,l,_){return this.easeTo(s.ak({zoom:o},l),_)}zoomIn(o,l){return this.zoomTo(this.getZoom()+1,o,l),this}zoomOut(o,l){return this.zoomTo(this.getZoom()-1,o,l),this}getBearing(){return this.transform.bearing}setBearing(o,l){return this.jumpTo({bearing:o},l),this}getPadding(){return this.transform.padding}setPadding(o,l){return this.jumpTo({padding:o},l),this}rotateTo(o,l,_){return this.easeTo(s.ak({bearing:o},l),_)}resetNorth(o,l){return this.rotateTo(0,s.ak({duration:1e3},o),l),this}resetNorthPitch(o,l){return this.easeTo(s.ak({bearing:0,pitch:0,duration:1e3},o),l),this}snapToNorth(o,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,l):this}getPitch(){return this.transform.pitch}setPitch(o,l){return this.jumpTo({pitch:o},l),this}cameraForBounds(o,l){o=s.D.convert(o);const _=l&&l.bearing||0,v=l&&l.pitch||0,w=o.getNorthWest(),I=o.getSouthEast();return this._cameraForBounds(this.transform,w,I,_,v,l)}_extendCameraOptions(o){const l={top:0,bottom:0,right:0,left:0};if(typeof(o=s.ak({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const _=o.padding;o.padding={top:_,bottom:_,right:_,left:_}}return o.padding=s.ak(l,o.padding),o}_minimumAABBFrustumDistance(o,l){const _=l.max[0]-l.min[0],v=l.max[1]-l.min[1];return _/v>o.aspect?_/(2*Math.tan(.5*o.fovX)*o.aspect):v/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,l,_,v,w,I){const C=o.clone(),P=this._extendCameraOptions(I);C.bearing=v,C.pitch=w;const D=s.L.convert(l),z=s.L.convert(_),k=.5*(D.lat+z.lat),B=.5*(D.lng+z.lng),U=s.cI(k,B),q=s.v.normalize([],U),X=s.v.normalize([],s.v.cross([],q,[0,1,0])),Z=s.v.cross([],X,q),j=[X[0],X[1],X[2],0,Z[0],Z[1],Z[2],0,q[0],q[1],q[2],0,0,0,0,1],J=[U,s.cI(D.lat,D.lng),s.cI(z.lat,D.lng),s.cI(z.lat,z.lng),s.cI(D.lat,z.lng),s.cI(k,D.lng),s.cI(k,z.lng),s.cI(D.lat,B),s.cI(z.lat,B)];let nt=s.c3.fromPoints(J.map(yt=>[s.v.dot(X,yt),s.v.dot(Z,yt),s.v.dot(q,yt)]));const st=s.v.transformMat4([],nt.center,j);s.v.squaredLength(st)===0&&s.v.set(st,0,0,1),s.v.normalize(st,st),s.v.scale(st,st,s.aC),C.center=s.cJ(st);const Y=C.getWorldToCameraMatrix(),K=s.m.invert(new Float64Array(16),Y);nt=s.c3.applyTransform(nt,s.m.multiply([],Y,j)),s.v.transformMat4(st,st,Y);const lt=.5*(nt.max[2]-nt.min[2]),ht=this._minimumAABBFrustumDistance(C,nt),ut=s.v.scale([],[0,0,1],lt),pt=s.v.add(ut,st,ut),Dt=ht+(C.pitch===0?0:s.v.distance(st,pt)),wt=C.globeCenterInViewSpace,St=s.v.sub([],st,[wt[0],wt[1],wt[2]]);s.v.normalize(St,St),s.v.scale(St,St,Dt);const mt=s.v.add([],st,St);s.v.transformMat4(mt,mt,K);const Lt=s.cL/s.aC,Tt=s.v.length(mt),zt=s.b(Math.max(Tt*Lt-s.cL,Number.EPSILON),0),tt=Math.min(C.zoomFromMercatorZAdjusted(zt),P.maxZoom);return tt>.5*(s.Z+s.G)?(C.setProjection({name:"mercator"}),C.zoom=tt,this._cameraForBounds(C,l,_,v,w,I)):{center:C.center,zoom:tt,bearing:v,pitch:w}}queryTerrainElevation(o,l){const _=this.transform.elevation;return _?(l=s.ak({},{exaggerated:!0},l),_.getAtPoint(s.M.fromLngLat(o),null,l.exaggerated)):null}_cameraForBounds(o,l,_,v,w,I){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,l,_,v,w,I);const C=o.clone(),P=this._extendCameraOptions(I),D=C.padding;C.bearing=v,C.pitch=w;const z=s.L.convert(l),k=s.L.convert(_),B=new s.L(z.lng,k.lat),U=new s.L(k.lng,z.lat),q=C.project(z),X=C.project(k),Z=this.queryTerrainElevation(z),j=this.queryTerrainElevation(k),J=this.queryTerrainElevation(B),nt=this.queryTerrainElevation(U),st=[[q.x,q.y,Math.min(Z||0,j||0,J||0,nt||0)],[X.x,X.y,Math.max(Z||0,j||0,J||0,nt||0)]];let Y=s.c3.fromPoints(st);const K=C.getWorldToCameraMatrix(),lt=s.m.invert(new Float64Array(16),K);Y=s.c3.applyTransform(Y,K);const ht=s.v.sub([],Y.max,Y.min),ut=D.left||0,pt=D.right||0,Dt=D.bottom||0,wt=D.top||0,{left:St,right:mt,top:Lt,bottom:Tt}=P.padding,zt=.5*(ut+pt),tt=.5*(wt+Dt),yt=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(ut+pt+St+mt))/ht[0],(C.height-(Dt+wt+Tt+Lt))/ht[1])),P.maxZoom),Gt=C.scale/C.zoomScale(yt);Y=new s.c3([Y.min[0]-(St+zt)*Gt,Y.min[1]-(Tt+tt)*Gt,Y.min[2]],[Y.max[0]+(mt+zt)*Gt,Y.max[1]+(Lt+tt)*Gt,Y.max[2]]);const Ft=.5*ht[2],ge=this._minimumAABBFrustumDistance(C,Y),ce=[0,0,1,0];s.e.transformMat4(ce,ce,K),s.e.normalize(ce,ce);const Se=s.v.scale([],ce,ge+Ft),fe=s.v.add([],Y.center,Se),Pe=(typeof P.offset.x=="number"&&typeof P.offset.y=="number"?new s.P(P.offset.x,P.offset.y):s.P.convert(P.offset)).rotate(-s.d(v));Y.center[0]-=Pe.x*Gt,Y.center[1]+=Pe.y*Gt,s.v.transformMat4(Y.center,Y.center,lt),s.v.transformMat4(fe,fe,lt);const Le=[Y.center[0],Y.center[1],fe[2]*C.pixelsPerMeter];s.v.scale(Le,Le,1/C.worldSize);const we=s.cK(Le[0]),Ee=s.l(Le[1]),dr=Math.min(C._zoomFromMercatorZ(Le[2]),P.maxZoom),Xe=new s.L(we,Ee);return C.mercatorFromTransition&&dr<.5*(s.Z+s.G)?(C.setProjection({name:"globe"}),C.zoom=dr,this._cameraForBounds(C,l,_,v,w,I)):{center:Xe,zoom:dr,bearing:v,pitch:w}}fitBounds(o,l,_){const v=this.cameraForBounds(o,l);return this._fitInternal(v,l,_)}fitScreenCoordinates(o,l,_,v,w){const I=s.P.convert(o),C=s.P.convert(l),P=new s.P(Math.min(I.x,C.x),Math.min(I.y,C.y)),D=new s.P(Math.max(I.x,C.x),Math.max(I.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(I,C))return this;const z=this.transform.pointLocation3D(P),k=this.transform.pointLocation3D(D),B=this.transform.pointLocation3D(new s.P(P.x,D.y)),U=this.transform.pointLocation3D(new s.P(D.x,P.y)),q=[Math.min(z.lng,k.lng,B.lng,U.lng),Math.min(z.lat,k.lat,B.lat,U.lat)],X=[Math.max(z.lng,k.lng,B.lng,U.lng),Math.max(z.lat,k.lat,B.lat,U.lat)],Z=v&&v.pitch?v.pitch:this.getPitch(),j=this._cameraForBounds(this.transform,q,X,_,Z,v);return this._fitInternal(j,v,w)}_fitInternal(o,l,_){return o?(delete(l=s.ak(o,l)).padding,l.linear?this.easeTo(l,_):this.flyTo(l,_)):this}jumpTo(o,l){this.stop();const _=o.preloadOnly?this.transform.clone():this.transform;let v=!1,w=!1,I=!1;return"zoom"in o&&_.zoom!==+o.zoom&&(v=!0,_.zoom=+o.zoom),o.center!==void 0&&(_.center=s.L.convert(o.center)),"bearing"in o&&_.bearing!==+o.bearing&&(w=!0,_.bearing=+o.bearing),"pitch"in o&&_.pitch!==+o.pitch&&(I=!0,_.pitch=+o.pitch),o.padding==null||_.isPaddingEqual(o.padding)||(_.padding=o.padding),o.preloadOnly?(this._preloadTiles(_),this):(this.fire(new s.a8("movestart",l)).fire(new s.a8("move",l)),v&&this.fire(new s.a8("zoomstart",l)).fire(new s.a8("zoom",l)).fire(new s.a8("zoomend",l)),w&&this.fire(new s.a8("rotatestart",l)).fire(new s.a8("rotate",l)).fire(new s.a8("rotateend",l)),I&&this.fire(new s.a8("pitchstart",l)).fire(new s.a8("pitch",l)).fire(new s.a8("pitchend",l)),this.fire(new s.a8("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.X(Dm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,l){const _=this.transform;if(!_.projection.supportsFreeCamera)return s.X(Dm),this;this.stop();const v=_.zoom,w=_.pitch,I=_.bearing;_.setFreeCameraOptions(o);const C=v!==_.zoom,P=w!==_.pitch,D=I!==_.bearing;return this.fire(new s.a8("movestart",l)).fire(new s.a8("move",l)),C&&this.fire(new s.a8("zoomstart",l)).fire(new s.a8("zoom",l)).fire(new s.a8("zoomend",l)),D&&this.fire(new s.a8("rotatestart",l)).fire(new s.a8("rotate",l)).fire(new s.a8("rotateend",l)),P&&this.fire(new s.a8("pitchstart",l)).fire(new s.a8("pitch",l)).fire(new s.a8("pitchend",l)),this.fire(new s.a8("moveend",l)),this}easeTo(o,l){this._stop(!1,o.easeId),((o=s.ak({offset:[0,0],duration:500,easing:s.cG},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const _=this.transform,v=this.getZoom(),w=this.getBearing(),I=this.getPitch(),C=this.getPadding(),P="zoom"in o?+o.zoom:v,D="bearing"in o?this._normalizeBearing(o.bearing,w):w,z="pitch"in o?+o.pitch:I,k="padding"in o?o.padding:_.padding,B=s.P.convert(o.offset);let U,q,X;if(_.projection.name==="globe"){const ut=s.M.fromLngLat(_.center),pt=B.rotate(-_.angle);ut.x+=pt.x/_.worldSize,ut.y+=pt.y/_.worldSize;const Dt=ut.toLngLat(),wt=s.L.convert(o.center||Dt);this._normalizeCenter(wt),U=_.centerPoint.add(pt),q=new s.P(ut.x,ut.y).mult(_.worldSize),X=new s.P(s.E(wt.lng),s.H(wt.lat)).mult(_.worldSize).sub(q)}else{U=_.centerPoint.add(B);const ut=_.pointLocation(U),pt=s.L.convert(o.center||ut);this._normalizeCenter(pt),q=_.project(ut),X=_.project(pt).sub(q)}const Z=_.zoomScale(P-v);let j,J;o.around&&(j=s.L.convert(o.around),J=_.locationPoint(j));const nt=this._zooming||P!==v,st=this._rotating||w!==D,Y=this._pitching||z!==I,K=!_.isPaddingEqual(k),lt=ut=>pt=>{if(nt&&(ut.zoom=s.n(v,P,pt)),st&&(ut.bearing=s.n(w,D,pt)),Y&&(ut.pitch=s.n(I,z,pt)),K&&(ut.interpolatePadding(C,k,pt),U=ut.centerPoint.add(B)),j)ut.setLocationAtPoint(j,J);else{const Dt=ut.zoomScale(ut.zoom-v),wt=P>v?Math.min(2,Z):Math.max(.5,Z),St=Math.pow(wt,1-pt),mt=ut.unproject(q.add(X.mult(pt*St)).mult(Dt));ut.setLocationAtPoint(ut.renderWorldCopies?mt.wrap():mt,U)}return o.preloadOnly||this._fireMoveEvents(l),ut};if(o.preloadOnly){const ut=this._emulate(lt,o.duration,_);return this._preloadTiles(ut),this}const ht={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=nt,this._rotating=st,this._pitching=Y,this._easeId=o.easeId,this._prepareEase(l,o.noMoveStart,ht),this._ease(lt(_),ut=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(l,ut)},o),this}_prepareEase(o,l,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||_.moving||this.fire(new s.a8("movestart",o)),this._zooming&&!_.zooming&&this.fire(new s.a8("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new s.a8("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new s.a8("pitchstart",o))}_fireMoveEvents(o){this.fire(new s.a8("move",o)),this._zooming&&this.fire(new s.a8("zoom",o)),this._rotating&&this.fire(new s.a8("rotate",o)),this._pitching&&this.fire(new s.a8("pitch",o))}_afterEase(o,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,v=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,_&&this.fire(new s.a8("zoomend",o)),v&&this.fire(new s.a8("rotateend",o)),w&&this.fire(new s.a8("pitchend",o)),this.fire(new s.a8("moveend",o))}flyTo(o,l){if(this._prefersReducedMotion(o)){const Tt=s.p(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Tt,l)}this.stop(),o=s.ak({offset:[0,0],speed:1.2,curve:1.42,easing:s.cG},o);const _=this.transform,v=this.getZoom(),w=this.getBearing(),I=this.getPitch(),C="zoom"in o?s.c(+o.zoom,_.minZoom,_.maxZoom):v,P="bearing"in o?this._normalizeBearing(o.bearing,w):w,D="pitch"in o?+o.pitch:I,z=_.zoomScale(C-v),k=s.P.convert(o.offset),B=_.centerPoint.add(k),U=_.pointLocation(B);let q=o.center;if(q&&o.padding){const Tt=this._cameraForBounds(this.transform,q,q,P,D,o);Tt&&(q=Tt.center)}q=s.L.convert(q||U),this._normalizeCenter(q);const X=_.project(U),Z=_.project(q).sub(X);let j=o.curve;const J=Math.max(_.width,_.height),nt=J/z,st=Z.mag();if("minZoom"in o){const Tt=s.c(Math.min(o.minZoom,v,C),_.minZoom,_.maxZoom),zt=J/_.zoomScale(Tt-v);j=Math.sqrt(zt/st*2)}const Y=j*j;function K(Tt){const zt=(nt*nt-J*J+(Tt?-1:1)*Y*Y*st*st)/(2*(Tt?nt:J)*Y*st);return Math.log(Math.sqrt(zt*zt+1)-zt)}function lt(Tt){return(Math.exp(Tt)-Math.exp(-Tt))/2}function ht(Tt){return(Math.exp(Tt)+Math.exp(-Tt))/2}const ut=K(0);let pt=function(Tt){return ht(ut)/ht(ut+j*Tt)},Dt=function(Tt){return J*((ht(ut)*(lt(zt=ut+j*Tt)/ht(zt))-lt(ut))/Y)/st;var zt},wt=(K(1)-ut)/j;if(Math.abs(st)<1e-6||!isFinite(wt)){if(Math.abs(J-nt)<1e-6)return this.easeTo(o,l);const Tt=nt<J?-1:1;wt=Math.abs(Math.log(nt/J))/j,Dt=function(){return 0},pt=function(zt){return Math.exp(Tt*j*zt)}}o.duration="duration"in o?+o.duration:1e3*wt/("screenSpeed"in o?+o.screenSpeed/j:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const St=w!==P,mt=D!==I,Lt=Tt=>zt=>{const tt=zt*wt,yt=1/pt(tt);Tt.zoom=zt===1?C:v+Tt.scaleZoom(yt),St&&(Tt.bearing=s.n(w,P,zt)),mt&&(Tt.pitch=s.n(I,D,zt));const Gt=zt===1?q:Tt.unproject(X.add(Z.mult(Dt(tt))).mult(yt));return Tt.setLocationAtPoint(Tt.renderWorldCopies?Gt.wrap():Gt,B),Tt._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(l),Tt};if(o.preloadOnly){const Tt=this._emulate(Lt,o.duration,_);return this._preloadTiles(Tt),this}return this._zooming=!0,this._rotating=St,this._pitching=mt,this._prepareEase(l,!1),this._ease(Lt(_),()=>this._afterEase(l),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,l)}if(!o){const _=this.handlers;_&&_.stop(!1)}return this}_ease(o,l,_){_.animate===!1||_.duration===0?(o(1),l()):(this._easeStart=s.a4.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((s.a4.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,l){o=s.w(o,-180,180);const _=Math.abs(o-l);return Math.abs(o-360-l)<_&&(o-=360),Math.abs(o+360-l)<_&&(o+=360),o}_normalizeCenter(o){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const _=o.lng-l.center.lng;o.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&s.a4.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,l,_){const v=Math.ceil(15*l/1e3),w=[],I=o(_.clone());for(let C=0;C<=v;C++){const P=I(C/v);w.push(P.clone())}return w}}class Lf{constructor(o={}){this.options=o,s.aR(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const l=this.options&&this.options.compact;return this._map=o,this._container=ot("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ot("button","mapboxgl-ctrl-attrib-button",this._container),ot("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ot("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,l){const _=this._map._getUIString(`AttributionControl.${l}`);o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.cM.ACCESS_TOKEN}];if(o){const _=l.reduce((v,w,I)=>(w.value&&(v+=`${w.key}=${w.value}${I<l.length-1?"&":""}`),v),"?");o.href=`${s.cM.FEEDBACK_URL}/${_}#${Na(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const l=this._map.style._mergedSourceCaches;for(const v in l){const w=l[v];if(w.used){const I=w.getSource();I.attribution&&o.indexOf(I.attribution)<0&&o.push(I.attribution)}}o.sort((v,w)=>v.length-w.length),o=o.filter((v,w)=>{for(let I=w+1;I<o.length;I++)if(o[I].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const _=o.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,o.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Df{constructor(){s.aR(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=ot("div","mapboxgl-ctrl");const l=ot("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const l in o){const _=o[l].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const l=o[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Rf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const l=++this._id;return this._queue.push({callback:o,id:l,cancelled:!1}),l}remove(o){const l=this._currentlyRunning,_=l?this._queue.concat(l):this._queue;for(const v of _)if(v.id===o)return void(v.cancelled=!0)}run(o=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const _ of l)if(!_.cancelled&&(_.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Of(d,o,l){if(d=new s.L(d.lng,d.lat),o){const _=new s.L(d.lng-360,d.lat),v=new s.L(d.lng+360,d.lat),w=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),I=l.locationPoint(d).distSqr(o),C=o.x<0||o.y<0||o.x>l.width||o.y>l.height;l.locationPoint(_).distSqr(o)<I&&(C||Math.abs(_.lng-l.center.lng)<w)?d=_:l.locationPoint(v).distSqr(o)<I&&(C||Math.abs(v.lng-l.center.lng)<w)&&(d=v)}for(;Math.abs(d.lng-l.center.lng)>180;){const _=l.locationPoint(d);if(_.x>=0&&_.y>=0&&_.x<=l.width&&_.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const Gh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Xn extends s.a6{constructor(o,l){if(super(),(o instanceof HTMLElement||l)&&(o=s.ak({element:o},l)),s.aR(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=s.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=ot("div");const w=41,I=27,C=dt("svg",{display:"block",height:w*this._scale+"px",width:I*this._scale+"px",viewBox:`0 0 ${I} ${w}`},this._element),P=dt("radialGradient",{id:"shadowGradient"},dt("defs",{},C));dt("stop",{offset:"10%","stop-opacity":.4},P),dt("stop",{offset:"100%","stop-opacity":.05},P),dt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),dt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),dt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),dt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=s.P.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const _=this._element.classList;for(const w in Gh)_.remove(`mapboxgl-marker-anchor-${w}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);const v=o&&o.className?o.className.trim().split(/\s+/):[];_.add(...v),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.L.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const l=o.code,_=o.charCode||o.keyCode;l!=="Space"&&l!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(o){const l=o.originalEvent.target,_=this._element;this._popup&&(l===_||_.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,l=this._pos;if(!o||!l)return!1;const _=o.unproject(l),v=o.getFreeCameraOptions();if(!v.position)return!1;const w=v.position.toLngLat();return w.distanceTo(_)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const l=this._pos;if(!l||l.x<0||l.x>o.transform.width||l.y<0||l.y>o.transform.height)return void this._clearFadeTimer();const _=o.unproject(l);let v;o._showingGlobe()&&s.cN(o.transform,this._lngLat)?v=0:(v=1-o._queryFogOpacity(_),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Gh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const o=this._pos,l=this._map,_=this.getPitchAlignment();if(!l||!o||_!=="map")return"";if(!l._showingGlobe()){const P=l.getPitch();return P?`rotateX(${P}deg)`:""}const v=s.Y(s.cO(l.transform,this._lngLat)),w=o.sub(s.cP(l.transform)),I=Math.abs(w.x)+Math.abs(w.y);if(I===0)return"";const C=v/I;return`rotateX(${-w.y*C}deg) rotateY(${w.x*C}deg)`}_calculateZTransform(){const o=this._pos,l=this._map;if(!l||!o)return"";let _=0;const v=this.getRotationAlignment();if(v==="map")if(l._showingGlobe()){const w=l.project(new s.L(this._lngLat.lng,this._lngLat.lat+.001)),I=l.project(new s.L(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);_=s.Y(Math.atan2(I.y,I.x))-90}else _=-l.getBearing();else if(v==="horizon"){const w=s.an(4,6,l.getZoom()),I=s.cP(l.transform);I.y+=w*l.transform.height;const C=o.sub(I),P=s.Y(Math.atan2(C.y,C.x));_=(P>90?P-270:P+90)*(1-w)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Of(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=s.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const l=this._map;if(!l)return;const _=this._pointerdownPos,v=this._positionDelta;if(_&&v){if(!this._isDragging){const w=this._clickTolerance||l._clickTolerance;if(o.point.dist(_)<w)return;this._isDragging=!0}this._pos=o.point.sub(v),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.a8("dragstart"))),this.fire(new s.a8("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.a8("dragend")),this._state="inactive"}_addDragHandler(o){const l=this._map,_=this._pos;l&&_&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(_),this._pointerdownPos=o.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const l=this._map;return l&&(o?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const X_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Om=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zf(d=new s.P(0,0),o="bottom"){if(typeof d=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(o){case"top":return new s.P(0,d);case"top-left":return new s.P(l,l);case"top-right":return new s.P(-l,l);case"bottom":return new s.P(0,-d);case"bottom-left":return new s.P(l,-l);case"bottom-right":return new s.P(-l,-l);case"left":return new s.P(d,0);case"right":return new s.P(-d,0)}return new s.P(0,0)}return d instanceof s.P||Array.isArray(d)?s.P.convert(d):s.P.convert(d[o]||[0,0])}class W_{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const l=s.ba((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,l,_){this._start=this.getValue(l),this._end=o,this._startTime=l,this._endTime=l+_}}const H_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},es={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class zm{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.continuousRedraw=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Y_={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ba{constructor(o,l,_=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Cf({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,_&&(this.mousePitch=new Mf({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),s.aR(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(o,l){this.mouseRotate.mousedown(o,l),this.mousePitch&&this.mousePitch.mousedown(o,l),ie()}move(o,l){const _=this.map,v=this.mouseRotate.mousemoveWindow(o,l),w=v&&v.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const I=this.mousePitch.mousemoveWindow(o,l),C=I&&I.pitchDelta;C&&_.setPitch(_.getPitch()+C)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){he(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(s.ak({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),je(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,je(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=qe(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=qe(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Is={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},mu={maxWidth:100,unit:"metric"},jh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:s.c$,supported:V,setRTLTextPlugin:s.d1,getRTLTextPluginStatus:s.d2,Map:class extends Rm{constructor(d){const o=d;if((d=s.ak({},es,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&s.cQ(window)&&(d.antialias=!1,s.X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Lr(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!1,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Rf,this._domRenderTaskQueue=new Rf,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.cR(),this._locale=s.ak({},H_,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new W_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.cS(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?{...d.contextCreateOptions}:{},typeof d.container=="string"){const l=document.getElementById(d.container);if(!l)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=l}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&s.X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),s.aR(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new zm,this._tp=d.devtools?new dm(this):new dm,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,l=>{this.repaint=l}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Lm(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||s.cM.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new xm(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const l=d.bounds;l&&(this.resize(),this.fitBounds(l,s.ak({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Lf({customAttribution:d.customAttribution})),this._logoControl=new Df,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.a8(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.a8(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(d,o){if(o===void 0&&(o=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new s.a7(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const _=this._controlPositions[o];return o.indexOf("bottom")!==-1?_.insertBefore(l,_.firstChild):_.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new s.a7(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(d);return o>-1&&this._controls.splice(o,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new s.a8("movestart",d)).fire(new s.a8("move",d)),this.fire(new s.a8("resize",d)),o&&this.fire(new s.a8("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(s.D.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(o=>o==="auto"?navigator.language:o):d}setLanguage(d){const o=this._parseLanguage(d);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,o=d.projection.name;let l;o==="globe"&&d.zoom>=s.G?(d.setMercatorFromTransition(),l=!0):o==="mercator"&&d.zoom<s.G&&(d.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,o){return this._updateProjection(d||o||{name:"mercator"})}_updateProjection(d){let o;return o=d.name==="globe"&&this.transform.zoom>=s.G?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(s.L.convert(d))}unproject(d){return this.transform.pointLocation3D(s.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,o,l){if(d==="mouseenter"||d==="mouseover"){let _=!1;const v=I=>{const C=o.filter(D=>this.getLayer(D)),P=C.length?this.queryRenderedFeatures(I.point,{layers:C}):[];P.length?_||(_=!0,l.call(this,new vo(d,this,I.originalEvent,{features:P}))):_=!1},w=()=>{_=!1};return{layers:new Set(o),listener:l,delegates:{mousemove:v,mouseout:w}}}if(d==="mouseleave"||d==="mouseout"){let _=!1;const v=I=>{const C=o.filter(P=>this.getLayer(P));(C.length?this.queryRenderedFeatures(I.point,{layers:C}):[]).length?_=!0:_&&(_=!1,l.call(this,new vo(d,this,I.originalEvent)))},w=I=>{_&&(_=!1,l.call(this,new vo(d,this,I.originalEvent)))};return{layers:new Set(o),listener:l,delegates:{mousemove:v,mouseout:w}}}{const _=v=>{const w=o.filter(C=>this.getLayer(C)),I=w.length?this.queryRenderedFeatures(v.point,{layers:w}):[];I.length&&(v.features=I,l.call(this,v),delete v.features)};return{layers:new Set(o),listener:l,delegates:{[d]:_}}}}on(d,o,l){if(l===void 0)return super.on(d,o);if(Array.isArray(o)||(o=[o]),o){for(const v of o)if(!this._isValidId(v))return this}const _=this._createDelegatedListener(d,o,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(_);for(const v in _.delegates)this.on(v,_.delegates[v]);return this}once(d,o,l){if(l===void 0)return super.once(d,o);if(Array.isArray(o)||(o=[o]),o){for(const v of o)if(!this._isValidId(v))return this}const _=this._createDelegatedListener(d,o,l);for(const v in _.delegates)this.once(v,_.delegates[v]);return this}off(d,o,l){if(l===void 0)return super.off(d,o);o=new Set(Array.isArray(o)?o:[o]);for(const w of o)if(!this._isValidId(w))return this;const _=(w,I)=>{if(w.size!==I.size)return!1;for(const C of w)if(!I.has(C))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[d]:void 0;return v&&(w=>{for(let I=0;I<w.length;I++){const C=w[I];if(C.listener===l&&_(C.layers,o)){for(const P in C.delegates)this.off(P,C.delegates[P]);return w.splice(I,1),this}}})(v),this}queryRenderedFeatures(d,o){if(!this.style)return[];if(o!==void 0||d===void 0||d instanceof s.P||Array.isArray(d)||(o=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],(o=o||{}).layers&&Array.isArray(o.layers)){for(const l of o.layers)if(!this._isValidId(l))return[]}return this.style.queryRenderedFeatures(d,o,this.transform)}querySourceFeatures(d,o){return this._isValidId(d)?this.style.querySourceFeatures(d,o):[]}isPointOnSurface(d){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&s.X(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(d))}setStyle(d,o){return(o=s.ak({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(d,o))}_getUIString(d){const o=this._locale[d];if(o==null)throw new Error(`Missing UI string '${d}'`);return o}_updateStyle(d,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Ro(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ro(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,o){if(typeof d=="string"){const l=this._requestManager.normalizeStyleURL(d),_=this._requestManager.transformRequest(l,s.a2.Style);s.a1(_,(v,w)=>{v?this.fire(new s.a7(v)):w&&this._updateDiff(w,o)})}else typeof d=="object"&&this._updateDiff(d,o)}_updateDiff(d,o){try{this.style.setState(d)&&this._update(!0)}catch(l){s.X(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.X("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new s.a7(new Error("IDs can't be empty."))),!1):!s.cu(d)||(this.fire(new s.a7(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}addSource(d,o){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,o),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,o,l){this._lazyInitEmptyStyle(),this.style.addSourceType(d,o,l)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,o,{pixelRatio:l=1,sdf:_=!1,stretchX:v,stretchY:w,content:I}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:C,height:P,data:D}=s.a4.getImageData(o);this.style.addImage(d,{data:new s.a5({width:C,height:P},D),pixelRatio:l,stretchX:v,stretchY:w,content:I,sdf:_,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new s.a7(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:P}=o,D=o;this.style.addImage(d,{data:new s.a5({width:C,height:P},new Uint8Array(D.data)),pixelRatio:l,stretchX:v,stretchY:w,content:I,sdf:_,version:0,userImage:D}),D.onAdd&&D.onAdd(this,d)}}updateImage(d,o){this._lazyInitEmptyStyle();const l=this.style.getImage(d);if(!l)return void this.fire(new s.a7(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?s.a4.getImageData(o):o,{width:v,height:w}=_,I=_.data;if(v===void 0||w===void 0)return void this.fire(new s.a7(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==l.data.width||w!==l.data.height)return void this.fire(new s.a7(new Error(`The width and height of the updated image (${v}, ${w})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));const C=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);l.data.replace(I,C),this.style.updateImage(d,l)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new s.a7(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,o){s.a3(this._requestManager.transformRequest(d,s.a2.Image),(l,_)=>{o(l,_ instanceof HTMLImageElement?s.a4.getImageData(_):_)})}listImages(){return this.style.listImages()}addModel(d,o){this._lazyInitEmptyStyle(),this.style.addModel(d,o)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new s.a7(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,o){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,o),this._update(!0)):this}moveLayer(d,o){return this._isValidId(d)?(this.style.moveLayer(d,o),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){return this._isValidId(d)?this.style.getOwnLayer(d):null}setLayerZoomRange(d,o,l){return this._isValidId(d)?(this.style.setLayerZoomRange(d,o,l),this._update(!0)):this}setFilter(d,o,l={}){return this._isValidId(d)?(this.style.setFilter(d,o,l),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,o,l,_={}){return this._isValidId(d)?(this.style.setPaintProperty(d,o,l,_),this._update(!0)):this}getPaintProperty(d,o){return this._isValidId(d)?this.style.getPaintProperty(d,o):null}setLayoutProperty(d,o,l,_={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,o,l,_),this._update(!0)):this}getLayoutProperty(d,o){return this._isValidId(d)?this.style.getLayoutProperty(d,o):null}getConfigProperty(d,o){return this.style.getConfigProperty(d,o)}setConfigProperty(d,o,l){return this.style.setConfigProperty(d,o,l),this._update(!0)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const o=d[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.L.convert(d),this.transform):0}setFeatureState(d,o){return this._isValidId(d.source)?(this.style.setFeatureState(d,o),this._update()):this}removeFeatureState(d,o){return this._isValidId(d.source)?(this.style.removeFeatureState(d,o),this._update()):this}getFeatureState(d){return this._isValidId(d.source)?this.style.getFeatureState(d):null}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let l,_,v,w=this._container;for(;w&&(!_||!v);){const I=window.getComputedStyle(w).transform;I&&I!=="none"&&(l=I.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(_=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(v=l[3])),w=w.parentElement}this._containerWidth=_?Math.abs(d/_):d,this._containerHeight=v?Math.abs(o/v):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ot("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=ot("div","mapboxgl-canvas-container",d);this._canvas=ot("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=ot("div","mapboxgl-control-container",d),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=ot("div",`mapboxgl-ctrl-${v}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,o){const l=s.a4.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(o),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${o}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const o=this._markers.indexOf(d);o!==-1&&this._markers.splice(o,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const o=this._popups.indexOf(d);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const d=s.ak({},V.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",d);o?(s.cT(o,!0),this.painter=new V_(o,this._contextCreateOptions,this.transform,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.cU.testSupport(o)):this.fire(new s.a7(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.a8("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new s.a8("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let o;this.fire(new s.a8("renderstart"));const l=this.painter.context.extTimerQuery,_=s.a4.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=v.createQuery(),v.beginQuery(l.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,D=this.transform.pitch,z=s.a4.now(),k=new s.al(P,{now:z,fadeDuration:w,pitch:D,transition:this.style.transition});this.style.update(k)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(_),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):I=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.a8("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.a8("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const P=s.a4.now()-_;v.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const D=v.getQueryParameter(o,v.QUERY_RESULT)/1e6;v.deleteQuery(o),this.fire(new s.a8("gpu-timing-frame",{cpuTime:P,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(P);this.fire(new s.a8("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(P);this.fire(new s.a8("gpu-timing-deferred-render",{gpuTime:D}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(C||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(I=this._updateAverageElevation(_,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new s.a8("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new s.a8("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,this._performanceMetricsCollection&&s.cV(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const o of this._markers)d&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!d||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(d,o=!1){const l=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(o||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=d;const I=Math.abs(v-w);if(I>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(w),l(w);this._averageElevation.easeTo(w,d,300)}else if(I>1e-4)return this._averageElevation.jumpTo(w),l(w)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){s.cW(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===s.cX||d.status===401)){const o=this.painter.context.gl;s.cT(o,!1),this._logoControl instanceof Df&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.a7(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.cY(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const l=this.painter.context.gl,_=l.createFramebuffer();function v(w){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,w,0);const I=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,I),I}return l.bindFramebuffer(l.FRAMEBUFFER,_),this._canvasPixelComparison(v(d),o.canvasCopies.map(v),o.timeStamps)}_canvasPixelComparison(d,o,l){let _=l[1]-l[0];const v=d.length/4;for(let w=0;w<o.length;w++){const I=o[w];let C=0;for(let P=0;P<I.length;P+=4)I[P]===d[P]&&I[P+1]===d[P+1]&&I[P+2]===d[P+2]&&I[P+3]===d[P+3]&&(C+=1);_+=(l[w+2]-l[w+1])*(1-C/v)}return _}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.cZ(this.painter.context.gl),this._removed=!0,this.fire(new s.a8("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=s.a4.frame(o=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(o)}))}_preloadTiles(d){const o=this.style?Object.values(this.style._sourceCaches):[];return s.c_(o,(l,_)=>l._preloadTiles(d,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,o){s.d0(d,o)}get version(){return s.c$}},NavigationControl:class{constructor(d){this.options=s.ak({},Y_,d),this._container=ot("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(s.aR(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),ot("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),ot("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aR(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:o}):l.resetNorth({},{originalEvent:o}))}),this._compassIcon=ot("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const o=d.getZoom(),l=o===d.getMaxZoom(),_=o===d.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ba(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,o){const l=ot("button",d,this._container);return l.type="button",l.addEventListener("click",o),l}_setButtonTitle(d,o){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${o}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends s.a6{constructor(d){super();const o=navigator.geolocation;this.options=s.ak({geolocation:o},Is,d),s.aR(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=za(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=ot("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const o=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,d(l)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>o(l.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(d){const o=this._map.getMaxBounds(),l=d.coords;return!!o&&(l.longitude<o.getWest()||l.longitude>o.getEast()||l.latitude<o.getSouth()||l.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new s.a8("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("geolocate",d)),this._finish()}}_updateCamera(d){const o=new s.L(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,_=this._map.getBearing(),v=s.ak({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(l),v,{geolocateSource:!0})}_updateMarker(d){if(d){const o=new s.L(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,o=s.b(1,d._center.lat)*d.worldSize,l=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=ot("button","mapboxgl-ctrl-geolocate",this._container),ot("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){s.X("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ot("div","mapboxgl-user-location"),this._dotElement.appendChild(ot("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ot("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ot("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.a8("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.a8("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.a8("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.a8("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lf,ScaleControl:class{constructor(d){this.options=s.ak({},mu,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aR(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,o=this._map,l=o._containerHeight/2,_=o._containerWidth/2-d/2,v=o.unproject([_,l]),w=o.unproject([_+d,l]),I=v.distanceTo(w);if(this.options.unit==="imperial"){const C=3.2808*I;C>5280?this._setScale(d,C/5280,"mile"):this._setScale(d,C,"foot")}else this.options.unit==="nautical"?this._setScale(d,I/1852,"nautical-mile"):I>=1e3?this._setScale(d,I/1e3,"kilometer"):this._setScale(d,I,"meter")}_setScale(d,o,l){this._map._requestDomTask(()=>{const _=function(w){const I=Math.pow(10,`${Math.floor(w)}`.length-1);let C=w/I;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(P){const D=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*D)/D}(C),I*C}(o),v=_/o;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(_):`${_}&nbsp;${jh[l]}`,this._container.style.width=d*v+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=ot("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:s.X("Full screen control 'container' must be a DOM element.")),s.aR(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ot("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ot("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ot("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.a6{constructor(d){super(),this.options=s.ak(Object.create(X_),d),s.aR(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new s.a8("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new s.a8("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=s.L.convert(d),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const o=document.createDocumentFragment(),l=document.createElement("body");let _;for(l.innerHTML=d;_=l.firstChild,_;)o.appendChild(_);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=ot("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(d),this.options.closeButton){const l=this._closeButton=ot("button","mapboxgl-popup-close-button",o);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let o;return this._classList.delete(d)?o=!1:(this._classList.add(d),o=!0),this._updateClassList(),o}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const o=this._map,l=this._container,_=this._pos;if(!o||!l||!_)return"bottom";const v=l.offsetWidth,w=l.offsetHeight,I=_.x<v/2,C=_.x>o.transform.width-v/2;if(_.y+d<w)return I?"top-left":C?"top-right":"top";if(_.y>o.transform.height-w){if(I)return"bottom-left";if(C)return"bottom-right"}return I?"left":C?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),d.className=o.join(" ")}_update(d){const o=this._map,l=this._content;if(!o||!this._lngLat&&!this._trackPointer||!l)return;let _=this._container;if(_||(_=this._container=ot("div","mapboxgl-popup",o.getContainer()),this._tip=ot("div","mapboxgl-popup-tip",_),_.appendChild(l)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Of(this._lngLat,this._pos,o.transform)),!this._trackPointer||d){const v=this._pos=this._trackPointer&&d?d:o.project(this._lngLat),w=zf(this.options.offset),I=this._anchor=this._getAnchor(w.y),C=zf(this.options.offset,I),P=v.add(C).round();o._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${Gh[I]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&o._showingGlobe()){const v=s.cN(o.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Om);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Xn,Style:Ro,LngLat:s.L,LngLatBounds:s.D,Point:s.P,MercatorCoordinate:s.M,FreeCameraOptions:ui,Evented:s.a6,config:s.cM,prewarm:s.d3,clearPrewarmedResources:s.d4,get accessToken(){return s.cM.ACCESS_TOKEN},set accessToken(d){s.cM.ACCESS_TOKEN=d},get baseApiUrl(){return s.cM.API_URL},set baseApiUrl(d){s.cM.API_URL=d},get workerCount(){return s.d5.workerCount},set workerCount(d){s.d5.workerCount=d},get maxParallelImageRequests(){return s.cM.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){s.cM.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){s.d6(d)},get workerUrl(){return s.d7.workerUrl},set workerUrl(d){s.d7.workerUrl=d},get workerClass(){return s.d7.workerClass},set workerClass(d){s.d7.workerClass=d},get workerParams(){return s.d7.workerParams},set workerParams(d){s.d7.workerParams=d},get dracoUrl(){return s.d8()},set dracoUrl(d){s.d9(d)},setNow:s.a4.setNow,restoreNow:s.a4.restoreNow}});var T=m;return T})})(EE);var aC=EE.exports;const s_=tC(aC);function TE(h,n,u){if(h!==null)for(var p,m,b,T,s,O,V,G=0,it=0,ot,dt=h.type,xt=dt==="FeatureCollection",Wt=dt==="Feature",Vt=xt?h.features.length:1,ie=0;ie<Vt;ie++){V=xt?h.features[ie].geometry:Wt?h.geometry:h,ot=V?V.type==="GeometryCollection":!1,s=ot?V.geometries.length:1;for(var he=0;he<s;he++){var ue=0,Ne=0;if(T=ot?V.geometries[he]:V,T!==null){O=T.coordinates;var je=T.type;switch(G=u&&(je==="Polygon"||je==="MultiPolygon")?1:0,je){case null:break;case"Point":if(n(O,it,ie,ue,Ne)===!1)return!1;it++,ue++;break;case"LineString":case"MultiPoint":for(p=0;p<O.length;p++){if(n(O[p],it,ie,ue,Ne)===!1)return!1;it++,je==="MultiPoint"&&ue++}je==="LineString"&&ue++;break;case"Polygon":case"MultiLineString":for(p=0;p<O.length;p++){for(m=0;m<O[p].length-G;m++){if(n(O[p][m],it,ie,ue,Ne)===!1)return!1;it++}je==="MultiLineString"&&ue++,je==="Polygon"&&Ne++}je==="Polygon"&&ue++;break;case"MultiPolygon":for(p=0;p<O.length;p++){for(Ne=0,m=0;m<O[p].length;m++){for(b=0;b<O[p][m].length-G;b++){if(n(O[p][m][b],it,ie,ue,Ne)===!1)return!1;it++}Ne++}ue++}break;case"GeometryCollection":for(p=0;p<T.geometries.length;p++)if(TE(T.geometries[p],n,u)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $w(h,n){if(h.type==="Feature")n(h,0);else if(h.type==="FeatureCollection")for(var u=0;u<h.features.length&&n(h.features[u],u)!==!1;u++);}function t0(h,n){var u,p,m,b,T,s,O,V,G,it,ot=0,dt=h.type==="FeatureCollection",xt=h.type==="Feature",Wt=dt?h.features.length:1;for(u=0;u<Wt;u++){for(s=dt?h.features[u].geometry:xt?h.geometry:h,V=dt?h.features[u].properties:xt?h.properties:{},G=dt?h.features[u].bbox:xt?h.bbox:void 0,it=dt?h.features[u].id:xt?h.id:void 0,O=s?s.type==="GeometryCollection":!1,T=O?s.geometries.length:1,m=0;m<T;m++){if(b=O?s.geometries[m]:s,b===null){if(n(null,ot,V,G,it)===!1)return!1;continue}switch(b.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(b,ot,V,G,it)===!1)return!1;break}case"GeometryCollection":{for(p=0;p<b.geometries.length;p++)if(n(b.geometries[p],ot,V,G,it)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ot++}}function Hg(h){var n=[1/0,1/0,-1/0,-1/0];return TE(h,function(u){n[0]>u[0]&&(n[0]=u[0]),n[1]>u[1]&&(n[1]=u[1]),n[2]<u[0]&&(n[2]=u[0]),n[3]<u[1]&&(n[3]=u[1])}),n}Hg.default=Hg;function lC(h){if(!h)throw new Error("geojson is required");switch(h.type){case"Feature":return SE(h);case"FeatureCollection":return uC(h);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return e0(h);default:throw new Error("unknown GeoJSON type")}}function SE(h){var n={type:"Feature"};return Object.keys(h).forEach(function(u){switch(u){case"type":case"properties":case"geometry":return;default:n[u]=h[u]}}),n.properties=CE(h.properties),n.geometry=e0(h.geometry),n}function CE(h){var n={};return h&&Object.keys(h).forEach(function(u){var p=h[u];typeof p=="object"?p===null?n[u]=null:Array.isArray(p)?n[u]=p.map(function(m){return m}):n[u]=CE(p):n[u]=p}),n}function uC(h){var n={type:"FeatureCollection"};return Object.keys(h).forEach(function(u){switch(u){case"type":case"features":return;default:n[u]=h[u]}}),n.features=h.features.map(function(u){return SE(u)}),n}function e0(h){var n={type:h.type};return h.bbox&&(n.bbox=h.bbox),h.type==="GeometryCollection"?(n.geometries=h.geometries.map(function(u){return e0(u)}),n):(n.coordinates=ME(h.coordinates),n)}function ME(h){var n=h;return typeof n[0]!="object"?n.slice():n.map(function(u){return ME(u)})}function cC(h,n){n===void 0&&(n={});var u=typeof n=="object"?n.mutate:n;if(!h)throw new Error("geojson is required");var p=eC(h),m=[];switch(p){case"LineString":m=Bv(h);break;case"MultiLineString":case"Polygon":Zg(h).forEach(function(T){m.push(Bv(T))});break;case"MultiPolygon":Zg(h).forEach(function(T){var s=[];T.forEach(function(O){s.push(Bv(O))}),m.push(s)});break;case"Point":return h;case"MultiPoint":var b={};Zg(h).forEach(function(T){var s=T.join("-");Object.prototype.hasOwnProperty.call(b,s)||(m.push(T),b[s]=!0)});break;default:throw new Error(p+" geometry not supported")}return h.coordinates?u===!0?(h.coordinates=m,h):{type:p,coordinates:m}:u===!0?(h.geometry.coordinates=m,h):wE({type:p,coordinates:m},h.properties,{bbox:h.bbox,id:h.id})}function Bv(h){var n=Zg(h);if(n.length===2&&!Jw(n[0],n[1]))return n;var u=[],p=n.length-1,m=u.length;u.push(n[0]);for(var b=1;b<p;b++){var T=u[u.length-1];n[b][0]===T[0]&&n[b][1]===T[1]||(u.push(n[b]),m=u.length,m>2&&Kw(u[m-3],u[m-1],u[m-2])&&u.splice(u.length-2,1))}if(u.push(n[n.length-1]),m=u.length,Jw(n[0],n[n.length-1])&&m<4)throw new Error("invalid polygon");return Kw(u[m-3],u[m-1],u[m-2])&&u.splice(u.length-2,1),u}function Jw(h,n){return h[0]===n[0]&&h[1]===n[1]}function Kw(h,n,u){var p=u[0],m=u[1],b=h[0],T=h[1],s=n[0],O=n[1],V=p-b,G=m-T,it=s-b,ot=O-T,dt=V*ot-G*it;return dt!==0?!1:Math.abs(it)>=Math.abs(ot)?it>0?b<=p&&p<=s:s<=p&&p<=b:ot>0?T<=m&&m<=O:O<=m&&m<=T}function hC(h,n){var u=h.x-n.x,p=h.y-n.y;return u*u+p*p}function pC(h,n,u){var p=n.x,m=n.y,b=u.x-p,T=u.y-m;if(b!==0||T!==0){var s=((h.x-p)*b+(h.y-m)*T)/(b*b+T*T);s>1?(p=u.x,m=u.y):s>0&&(p+=b*s,m+=T*s)}return b=h.x-p,T=h.y-m,b*b+T*T}function fC(h,n){for(var u=h[0],p=[u],m,b=1,T=h.length;b<T;b++)m=h[b],hC(m,u)>n&&(p.push(m),u=m);return u!==m&&p.push(m),p}function qv(h,n,u,p,m){for(var b=p,T,s=n+1;s<u;s++){var O=pC(h[s],h[n],h[u]);O>b&&(T=s,b=O)}b>p&&(T-n>1&&qv(h,n,T,p,m),m.push(h[T]),u-T>1&&qv(h,T,u,p,m))}function dC(h,n){var u=h.length-1,p=[h[0]];return qv(h,0,u,n,p),p.push(h[u]),p}function Zv(h,n,u){if(h.length<=2)return h;var p=n!==void 0?n*n:1;return h=u?h:fC(h,p),h=dC(h,p),h}function mC(h,n){if(n=n||{},!rC(n))throw new Error("options is invalid");var u=n.tolerance!==void 0?n.tolerance:1,p=n.highQuality||!1,m=n.mutate||!1;if(!h)throw new Error("geojson is required");if(u&&u<0)throw new Error("invalid tolerance");return m!==!0&&(h=lC(h)),t0(h,function(b){gC(b,u,p)}),h}function gC(h,n,u){var p=h.type;if(p==="Point"||p==="MultiPoint")return h;cC(h,!0);var m=h.coordinates;switch(p){case"LineString":h.coordinates=Qw(m,n,u);break;case"MultiLineString":h.coordinates=m.map(function(b){return Qw(b,n,u)});break;case"Polygon":h.coordinates=tE(m,n,u);break;case"MultiPolygon":h.coordinates=m.map(function(b){return tE(b,n,u)})}return h}function Qw(h,n,u){return Zv(h.map(function(p){return{x:p[0],y:p[1],z:p[2]}}),n,u).map(function(p){return p.z?[p.x,p.y,p.z]:[p.x,p.y]})}function tE(h,n,u){return h.map(function(p){var m=p.map(function(T){return{x:T[0],y:T[1]}});if(m.length<4)throw new Error("invalid polygon");for(var b=Zv(m,n,u).map(function(T){return[T.x,T.y]});!_C(b);)n-=n*.01,b=Zv(m,n,u).map(function(T){return[T.x,T.y]});return(b[b.length-1][0]!==b[0][0]||b[b.length-1][1]!==b[0][1])&&b.push(b[0]),b})}function _C(h){return h.length<3?!1:!(h.length===3&&h[2][0]===h[0][0]&&h[2][1]===h[0][1])}function yC(h,n){n===void 0&&(n={});var u=Hg(h),p=(u[0]+u[2])/2,m=(u[1]+u[3])/2;return nC([p,m],n.properties,n)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(n){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var u=Object(this),p=Math.max(Math.min(u.length,9007199254740991),0)||0,m=1 in arguments&&parseInt(Number(arguments[1]),10)||0;m=m<0?Math.max(p+m,0):Math.min(m,p);var b=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:p;for(b=b<0?Math.max(p+arguments[2],0):Math.min(b,p);m<b;)u[m]=n,++m;return u},writable:!0});Number.isFinite=Number.isFinite||function(h){return typeof h=="number"&&isFinite(h)};Number.isInteger=Number.isInteger||function(h){return typeof h=="number"&&isFinite(h)&&Math.floor(h)===h};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(h){return h!==h};Math.trunc=Math.trunc||function(h){return h<0?Math.ceil(h):Math.floor(h)};var Bc=function(){};Bc.prototype.interfaces_=function(){return[]};Bc.prototype.getClass=function(){return Bc};Bc.prototype.equalsWithTolerance=function(n,u,p){return Math.abs(n-u)<=p};var vn=function(h){function n(u){h.call(this,u),this.name="IllegalArgumentException",this.message=u,this.stack=new h().stack}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n}(Error),or=function(){},AE={MAX_VALUE:{configurable:!0}};or.isNaN=function(n){return Number.isNaN(n)};or.doubleToLongBits=function(n){return n};or.longBitsToDouble=function(n){return n};or.isInfinite=function(n){return!Number.isFinite(n)};AE.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(or,AE);var Xo=function(){},a_=function(){},hp=function(){};function Wo(){}var It=function h(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=h.NULL_ORDINATE;else if(arguments.length===1){var n=arguments[0];this.x=n.x,this.y=n.y,this.z=n.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=h.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Kc={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};It.prototype.setOrdinate=function(n,u){switch(n){case It.X:this.x=u;break;case It.Y:this.y=u;break;case It.Z:this.z=u;break;default:throw new vn("Invalid ordinate index: "+n)}};It.prototype.equals2D=function(){if(arguments.length===1){var n=arguments[0];return!(this.x!==n.x||this.y!==n.y)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];return!(!Bc.equalsWithTolerance(this.x,u.x,p)||!Bc.equalsWithTolerance(this.y,u.y,p))}};It.prototype.getOrdinate=function(n){switch(n){case It.X:return this.x;case It.Y:return this.y;case It.Z:return this.z}throw new vn("Invalid ordinate index: "+n)};It.prototype.equals3D=function(n){return this.x===n.x&&this.y===n.y&&(this.z===n.z||or.isNaN(this.z))&&or.isNaN(n.z)};It.prototype.equals=function(n){return n instanceof It?this.equals2D(n):!1};It.prototype.equalInZ=function(n,u){return Bc.equalsWithTolerance(this.z,n.z,u)};It.prototype.compareTo=function(n){var u=n;return this.x<u.x?-1:this.x>u.x?1:this.y<u.y?-1:this.y>u.y?1:0};It.prototype.clone=function(){};It.prototype.copy=function(){return new It(this)};It.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};It.prototype.distance3D=function(n){var u=this.x-n.x,p=this.y-n.y,m=this.z-n.z;return Math.sqrt(u*u+p*p+m*m)};It.prototype.distance=function(n){var u=this.x-n.x,p=this.y-n.y;return Math.sqrt(u*u+p*p)};It.prototype.hashCode=function(){var n=17;return n=37*n+It.hashCode(this.x),n=37*n+It.hashCode(this.y),n};It.prototype.setCoordinate=function(n){this.x=n.x,this.y=n.y,this.z=n.z};It.prototype.interfaces_=function(){return[Xo,a_,Wo]};It.prototype.getClass=function(){return It};It.hashCode=function(){if(arguments.length===1){var n=arguments[0],u=or.doubleToLongBits(n);return Math.trunc((u^u)>>>32)}};Kc.DimensionalComparator.get=function(){return jl};Kc.serialVersionUID.get=function(){return 6683108902428367e3};Kc.NULL_ORDINATE.get=function(){return or.NaN};Kc.X.get=function(){return 0};Kc.Y.get=function(){return 1};Kc.Z.get=function(){return 2};Object.defineProperties(It,Kc);var jl=function(n){if(this._dimensionsToTest=2,arguments.length!==0){if(arguments.length===1){var u=arguments[0];if(u!==2&&u!==3)throw new vn("only 2 or 3 dimensions may be specified");this._dimensionsToTest=u}}};jl.prototype.compare=function(n,u){var p=n,m=u,b=jl.compare(p.x,m.x);if(b!==0)return b;var T=jl.compare(p.y,m.y);if(T!==0)return T;if(this._dimensionsToTest<=2)return 0;var s=jl.compare(p.z,m.z);return s};jl.prototype.interfaces_=function(){return[hp]};jl.prototype.getClass=function(){return jl};jl.compare=function(n,u){return n<u?-1:n>u?1:or.isNaN(n)?or.isNaN(u)?0:-1:or.isNaN(u)?1:0};var pp=function(){};pp.prototype.create=function(){};pp.prototype.interfaces_=function(){return[]};pp.prototype.getClass=function(){return pp};var Ct=function(){},Fd={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Ct.prototype.interfaces_=function(){return[]};Ct.prototype.getClass=function(){return Ct};Ct.toLocationSymbol=function(n){switch(n){case Ct.EXTERIOR:return"e";case Ct.BOUNDARY:return"b";case Ct.INTERIOR:return"i";case Ct.NONE:return"-"}throw new vn("Unknown location value: "+n)};Fd.INTERIOR.get=function(){return 0};Fd.BOUNDARY.get=function(){return 1};Fd.EXTERIOR.get=function(){return 2};Fd.NONE.get=function(){return-1};Object.defineProperties(Ct,Fd);var Ke=function(h,n){return h.interfaces_&&h.interfaces_().indexOf(n)>-1},Eo=function(){},PE={LOG_10:{configurable:!0}};Eo.prototype.interfaces_=function(){return[]};Eo.prototype.getClass=function(){return Eo};Eo.log10=function(n){var u=Math.log(n);return or.isInfinite(u)||or.isNaN(u)?u:u/Eo.LOG_10};Eo.min=function(n,u,p,m){var b=n;return u<b&&(b=u),p<b&&(b=p),m<b&&(b=m),b};Eo.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],u=arguments[1],p=arguments[2];return n<u?u:n>p?p:n}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var m=arguments[0],b=arguments[1],T=arguments[2];return m<b?b:m>T?T:m}};Eo.wrap=function(n,u){return n<0?u- -n%u:n%u};Eo.max=function(){if(arguments.length===3){var n=arguments[0],u=arguments[1],p=arguments[2],m=n;return u>m&&(m=u),p>m&&(m=p),m}else if(arguments.length===4){var b=arguments[0],T=arguments[1],s=arguments[2],O=arguments[3],V=b;return T>V&&(V=T),s>V&&(V=s),O>V&&(V=O),V}};Eo.average=function(n,u){return(n+u)/2};PE.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Eo,PE);var Ws=function(n){this.str=n};Ws.prototype.append=function(n){this.str+=n};Ws.prototype.setCharAt=function(n,u){this.str=this.str.substr(0,n)+u+this.str.substr(n+1)};Ws.prototype.toString=function(n){return this.str};var ks=function(n){this.value=n};ks.prototype.intValue=function(){return this.value};ks.prototype.compareTo=function(n){return this.value<n?-1:this.value>n?1:0};ks.isNaN=function(n){return Number.isNaN(n)};var wd=function(){};wd.isWhitespace=function(n){return n<=32&&n>=0||n===127};wd.toUpperCase=function(n){return n.toUpperCase()};var Nt=function h(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var n=arguments[0];this.init(n)}else if(arguments[0]instanceof h){var u=arguments[0];this.init(u)}else if(typeof arguments[0]=="string"){var p=arguments[0];h.call(this,h.parse(p))}}else if(arguments.length===2){var m=arguments[0],b=arguments[1];this.init(m,b)}},ys={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Nt.prototype.le=function(n){return(this._hi<n._hi||this._hi===n._hi)&&this._lo<=n._lo};Nt.prototype.extractSignificantDigits=function(n,u){var p=this.abs(),m=Nt.magnitude(p._hi),b=Nt.TEN.pow(m);p=p.divide(b),p.gt(Nt.TEN)?(p=p.divide(Nt.TEN),m+=1):p.lt(Nt.ONE)&&(p=p.multiply(Nt.TEN),m-=1);for(var T=m+1,s=new Ws,O=Nt.MAX_PRINT_DIGITS-1,V=0;V<=O;V++){n&&V===T&&s.append(".");var G=Math.trunc(p._hi);if(G<0)break;var it=!1,ot=0;G>9?(it=!0,ot="9"):ot="0"+G,s.append(ot),p=p.subtract(Nt.valueOf(G)).multiply(Nt.TEN),it&&p.selfAdd(Nt.TEN);var dt=!0,xt=Nt.magnitude(p._hi);if(xt<0&&Math.abs(xt)>=O-V&&(dt=!1),!dt)break}return u[0]=m,s.toString()};Nt.prototype.sqr=function(){return this.multiply(this)};Nt.prototype.doubleValue=function(){return this._hi+this._lo};Nt.prototype.subtract=function(){if(arguments[0]instanceof Nt){var n=arguments[0];return this.add(n.negate())}else if(typeof arguments[0]=="number"){var u=arguments[0];return this.add(-u)}};Nt.prototype.equals=function(){if(arguments.length===1){var n=arguments[0];return this._hi===n._hi&&this._lo===n._lo}};Nt.prototype.isZero=function(){return this._hi===0&&this._lo===0};Nt.prototype.selfSubtract=function(){if(arguments[0]instanceof Nt){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n._hi,-n._lo)}else if(typeof arguments[0]=="number"){var u=arguments[0];return this.isNaN()?this:this.selfAdd(-u,0)}};Nt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Nt.prototype.min=function(n){return this.le(n)?this:n};Nt.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Nt){var n=arguments[0];return this.selfDivide(n._hi,n._lo)}else if(typeof arguments[0]=="number"){var u=arguments[0];return this.selfDivide(u,0)}}else if(arguments.length===2){var p=arguments[0],m=arguments[1],b=null,T=null,s=null,O=null,V=null,G=null,it=null,ot=null;return V=this._hi/p,G=Nt.SPLIT*V,b=G-V,ot=Nt.SPLIT*p,b=G-b,T=V-b,s=ot-p,it=V*p,s=ot-s,O=p-s,ot=b*s-it+b*O+T*s+T*O,G=(this._hi-it-ot+this._lo-V*m)/p,ot=V+G,this._hi=ot,this._lo=V-ot+G,this}};Nt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Nt.prototype.divide=function(){if(arguments[0]instanceof Nt){var n=arguments[0],u=null,p=null,m=null,b=null,T=null,s=null,O=null,V=null;T=this._hi/n._hi,s=Nt.SPLIT*T,u=s-T,V=Nt.SPLIT*n._hi,u=s-u,p=T-u,m=V-n._hi,O=T*n._hi,m=V-m,b=n._hi-m,V=u*m-O+u*b+p*m+p*b,s=(this._hi-O-V+this._lo-T*n._lo)/n._hi,V=T+s;var G=V,it=T-V+s;return new Nt(G,it)}else if(typeof arguments[0]=="number"){var ot=arguments[0];return or.isNaN(ot)?Nt.createNaN():Nt.copy(this).selfDivide(ot,0)}};Nt.prototype.ge=function(n){return(this._hi>n._hi||this._hi===n._hi)&&this._lo>=n._lo};Nt.prototype.pow=function(n){if(n===0)return Nt.valueOf(1);var u=new Nt(this),p=Nt.valueOf(1),m=Math.abs(n);if(m>1)for(;m>0;)m%2===1&&p.selfMultiply(u),m/=2,m>0&&(u=u.sqr());else p=u;return n<0?p.reciprocal():p};Nt.prototype.ceil=function(){if(this.isNaN())return Nt.NaN;var n=Math.ceil(this._hi),u=0;return n===this._hi&&(u=Math.ceil(this._lo)),new Nt(n,u)};Nt.prototype.compareTo=function(n){var u=n;return this._hi<u._hi?-1:this._hi>u._hi?1:this._lo<u._lo?-1:this._lo>u._lo?1:0};Nt.prototype.rint=function(){if(this.isNaN())return this;var n=this.add(.5);return n.floor()};Nt.prototype.setValue=function(){if(arguments[0]instanceof Nt){var n=arguments[0];return this.init(n),this}else if(typeof arguments[0]=="number"){var u=arguments[0];return this.init(u),this}};Nt.prototype.max=function(n){return this.ge(n)?this:n};Nt.prototype.sqrt=function(){if(this.isZero())return Nt.valueOf(0);if(this.isNegative())return Nt.NaN;var n=1/Math.sqrt(this._hi),u=this._hi*n,p=Nt.valueOf(u),m=this.subtract(p.sqr()),b=m._hi*(n*.5);return p.add(b)};Nt.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Nt){var n=arguments[0];return this.selfAdd(n._hi,n._lo)}else if(typeof arguments[0]=="number"){var u=arguments[0],p=null,m=null,b=null,T=null,s=null,O=null;return b=this._hi+u,s=b-this._hi,T=b-s,T=u-s+(this._hi-T),O=T+this._lo,p=b+O,m=O+(b-p),this._hi=p+m,this._lo=m+(p-this._hi),this}}else if(arguments.length===2){var V=arguments[0],G=arguments[1],it=null,ot=null,dt=null,xt=null,Wt=null,Vt=null,ie=null,he=null;Wt=this._hi+V,dt=this._lo+G,ie=Wt-this._hi,he=dt-this._lo,Vt=Wt-ie,xt=dt-he,Vt=V-ie+(this._hi-Vt),xt=G-he+(this._lo-xt),ie=Vt+dt,it=Wt+ie,ot=ie+(Wt-it),ie=xt+ot;var ue=it+ie,Ne=ie+(it-ue);return this._hi=ue,this._lo=Ne,this}};Nt.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Nt){var n=arguments[0];return this.selfMultiply(n._hi,n._lo)}else if(typeof arguments[0]=="number"){var u=arguments[0];return this.selfMultiply(u,0)}}else if(arguments.length===2){var p=arguments[0],m=arguments[1],b=null,T=null,s=null,O=null,V=null,G=null;V=Nt.SPLIT*this._hi,b=V-this._hi,G=Nt.SPLIT*p,b=V-b,T=this._hi-b,s=G-p,V=this._hi*p,s=G-s,O=p-s,G=b*s-V+b*O+T*s+T*O+(this._hi*m+this._lo*p);var it=V+G;b=V-it;var ot=G+b;return this._hi=it,this._lo=ot,this}};Nt.prototype.selfSqr=function(){return this.selfMultiply(this)};Nt.prototype.floor=function(){if(this.isNaN())return Nt.NaN;var n=Math.floor(this._hi),u=0;return n===this._hi&&(u=Math.floor(this._lo)),new Nt(n,u)};Nt.prototype.negate=function(){return this.isNaN()?this:new Nt(-this._hi,-this._lo)};Nt.prototype.clone=function(){};Nt.prototype.multiply=function(){if(arguments[0]instanceof Nt){var n=arguments[0];return n.isNaN()?Nt.createNaN():Nt.copy(this).selfMultiply(n)}else if(typeof arguments[0]=="number"){var u=arguments[0];return or.isNaN(u)?Nt.createNaN():Nt.copy(this).selfMultiply(u,0)}};Nt.prototype.isNaN=function(){return or.isNaN(this._hi)};Nt.prototype.intValue=function(){return Math.trunc(this._hi)};Nt.prototype.toString=function(){var n=Nt.magnitude(this._hi);return n>=-3&&n<=20?this.toStandardNotation():this.toSciNotation()};Nt.prototype.toStandardNotation=function(){var n=this.getSpecialNumberString();if(n!==null)return n;var u=new Array(1).fill(null),p=this.extractSignificantDigits(!0,u),m=u[0]+1,b=p;if(p.charAt(0)===".")b="0"+p;else if(m<0)b="0."+Nt.stringOfChar("0",-m)+p;else if(p.indexOf(".")===-1){var T=m-p.length,s=Nt.stringOfChar("0",T);b=p+s+".0"}return this.isNegative()?"-"+b:b};Nt.prototype.reciprocal=function(){var n=null,u=null,p=null,m=null,b=null,T=null,s=null,O=null;b=1/this._hi,T=Nt.SPLIT*b,n=T-b,O=Nt.SPLIT*this._hi,n=T-n,u=b-n,p=O-this._hi,s=b*this._hi,p=O-p,m=this._hi-p,O=n*p-s+n*m+u*p+u*m,T=(1-s-O-b*this._lo)/this._hi;var V=b+T,G=b-V+T;return new Nt(V,G)};Nt.prototype.toSciNotation=function(){if(this.isZero())return Nt.SCI_NOT_ZERO;var n=this.getSpecialNumberString();if(n!==null)return n;var u=new Array(1).fill(null),p=this.extractSignificantDigits(!1,u),m=Nt.SCI_NOT_EXPONENT_CHAR+u[0];if(p.charAt(0)==="0")throw new Error("Found leading zero: "+p);var b="";p.length>1&&(b=p.substring(1));var T=p.charAt(0)+"."+b;return this.isNegative()?"-"+T+m:T+m};Nt.prototype.abs=function(){return this.isNaN()?Nt.NaN:this.isNegative()?this.negate():new Nt(this)};Nt.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Nt.prototype.lt=function(n){return(this._hi<n._hi||this._hi===n._hi)&&this._lo<n._lo};Nt.prototype.add=function(){if(arguments[0]instanceof Nt){var n=arguments[0];return Nt.copy(this).selfAdd(n)}else if(typeof arguments[0]=="number"){var u=arguments[0];return Nt.copy(this).selfAdd(u)}};Nt.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var n=arguments[0];this._hi=n,this._lo=0}else if(arguments[0]instanceof Nt){var u=arguments[0];this._hi=u._hi,this._lo=u._lo}}else if(arguments.length===2){var p=arguments[0],m=arguments[1];this._hi=p,this._lo=m}};Nt.prototype.gt=function(n){return(this._hi>n._hi||this._hi===n._hi)&&this._lo>n._lo};Nt.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Nt.prototype.trunc=function(){return this.isNaN()?Nt.NaN:this.isPositive()?this.floor():this.ceil()};Nt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Nt.prototype.interfaces_=function(){return[Wo,Xo,a_]};Nt.prototype.getClass=function(){return Nt};Nt.sqr=function(n){return Nt.valueOf(n).selfMultiply(n)};Nt.valueOf=function(){if(typeof arguments[0]=="string"){var n=arguments[0];return Nt.parse(n)}else if(typeof arguments[0]=="number"){var u=arguments[0];return new Nt(u)}};Nt.sqrt=function(n){return Nt.valueOf(n).sqrt()};Nt.parse=function(n){for(var u=0,p=n.length;wd.isWhitespace(n.charAt(u));)u++;var m=!1;if(u<p){var b=n.charAt(u);(b==="-"||b==="+")&&(u++,b==="-"&&(m=!0))}for(var T=new Nt,s=0,O=0,V=0;!(u>=p);){var G=n.charAt(u);if(u++,wd.isDigit(G)){var it=G-"0";T.selfMultiply(Nt.TEN),T.selfAdd(it),s++;continue}if(G==="."){O=s;continue}if(G==="e"||G==="E"){var ot=n.substring(u);try{V=ks.parseInt(ot)}catch(ie){throw ie instanceof Error?new Error("Invalid exponent "+ot+" in string "+n):ie}finally{}break}throw new Error("Unexpected character '"+G+"' at position "+u+" in string "+n)}var dt=T,xt=s-O-V;if(xt===0)dt=T;else if(xt>0){var Wt=Nt.TEN.pow(xt);dt=T.divide(Wt)}else if(xt<0){var Vt=Nt.TEN.pow(-xt);dt=T.multiply(Vt)}return m?dt.negate():dt};Nt.createNaN=function(){return new Nt(or.NaN,or.NaN)};Nt.copy=function(n){return new Nt(n)};Nt.magnitude=function(n){var u=Math.abs(n),p=Math.log(u)/Math.log(10),m=Math.trunc(Math.floor(p)),b=Math.pow(10,m);return b*10<=u&&(m+=1),m};Nt.stringOfChar=function(n,u){for(var p=new Ws,m=0;m<u;m++)p.append(n);return p.toString()};ys.PI.get=function(){return new Nt(3.141592653589793,12246467991473532e-32)};ys.TWO_PI.get=function(){return new Nt(6.283185307179586,24492935982947064e-32)};ys.PI_2.get=function(){return new Nt(1.5707963267948966,6123233995736766e-32)};ys.E.get=function(){return new Nt(2.718281828459045,14456468917292502e-32)};ys.NaN.get=function(){return new Nt(or.NaN,or.NaN)};ys.EPS.get=function(){return 123259516440783e-46};ys.SPLIT.get=function(){return 134217729};ys.MAX_PRINT_DIGITS.get=function(){return 32};ys.TEN.get=function(){return Nt.valueOf(10)};ys.ONE.get=function(){return Nt.valueOf(1)};ys.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};ys.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Nt,ys);var Ki=function(){},LE={DP_SAFE_EPSILON:{configurable:!0}};Ki.prototype.interfaces_=function(){return[]};Ki.prototype.getClass=function(){return Ki};Ki.orientationIndex=function(n,u,p){var m=Ki.orientationIndexFilter(n,u,p);if(m<=1)return m;var b=Nt.valueOf(u.x).selfAdd(-n.x),T=Nt.valueOf(u.y).selfAdd(-n.y),s=Nt.valueOf(p.x).selfAdd(-u.x),O=Nt.valueOf(p.y).selfAdd(-u.y);return b.selfMultiply(O).selfSubtract(T.selfMultiply(s)).signum()};Ki.signOfDet2x2=function(n,u,p,m){var b=n.multiply(m).selfSubtract(u.multiply(p));return b.signum()};Ki.intersection=function(n,u,p,m){var b=Nt.valueOf(m.y).selfSubtract(p.y).selfMultiply(Nt.valueOf(u.x).selfSubtract(n.x)),T=Nt.valueOf(m.x).selfSubtract(p.x).selfMultiply(Nt.valueOf(u.y).selfSubtract(n.y)),s=b.subtract(T),O=Nt.valueOf(m.x).selfSubtract(p.x).selfMultiply(Nt.valueOf(n.y).selfSubtract(p.y)),V=Nt.valueOf(m.y).selfSubtract(p.y).selfMultiply(Nt.valueOf(n.x).selfSubtract(p.x)),G=O.subtract(V),it=G.selfDivide(s).doubleValue(),ot=Nt.valueOf(n.x).selfAdd(Nt.valueOf(u.x).selfSubtract(n.x).selfMultiply(it)).doubleValue(),dt=Nt.valueOf(u.x).selfSubtract(n.x).selfMultiply(Nt.valueOf(n.y).selfSubtract(p.y)),xt=Nt.valueOf(u.y).selfSubtract(n.y).selfMultiply(Nt.valueOf(n.x).selfSubtract(p.x)),Wt=dt.subtract(xt),Vt=Wt.selfDivide(s).doubleValue(),ie=Nt.valueOf(p.y).selfAdd(Nt.valueOf(m.y).selfSubtract(p.y).selfMultiply(Vt)).doubleValue();return new It(ot,ie)};Ki.orientationIndexFilter=function(n,u,p){var m=null,b=(n.x-p.x)*(u.y-p.y),T=(n.y-p.y)*(u.x-p.x),s=b-T;if(b>0){if(T<=0)return Ki.signum(s);m=b+T}else if(b<0){if(T>=0)return Ki.signum(s);m=-b-T}else return Ki.signum(s);var O=Ki.DP_SAFE_EPSILON*m;return s>=O||-s>=O?Ki.signum(s):2};Ki.signum=function(n){return n>0?1:n<0?-1:0};LE.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(Ki,LE);var Cr=function(){},Bd={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Bd.X.get=function(){return 0};Bd.Y.get=function(){return 1};Bd.Z.get=function(){return 2};Bd.M.get=function(){return 3};Cr.prototype.setOrdinate=function(n,u,p){};Cr.prototype.size=function(){};Cr.prototype.getOrdinate=function(n,u){};Cr.prototype.getCoordinate=function(){};Cr.prototype.getCoordinateCopy=function(n){};Cr.prototype.getDimension=function(){};Cr.prototype.getX=function(n){};Cr.prototype.clone=function(){};Cr.prototype.expandEnvelope=function(n){};Cr.prototype.copy=function(){};Cr.prototype.getY=function(n){};Cr.prototype.toCoordinateArray=function(){};Cr.prototype.interfaces_=function(){return[a_]};Cr.prototype.getClass=function(){return Cr};Object.defineProperties(Cr,Bd);var DE=function(){},Dp=function(h){function n(){h.call(this,"Projective point not representable on the Cartesian plane.")}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(DE),_i=function(){};_i.arraycopy=function(n,u,p,m,b){for(var T=0,s=u;s<u+b;s++)p[m+T]=n[s],T++};_i.getProperty=function(n){return{"line.separator":`
`}[n]};var us=function h(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var n=arguments[0];this.x=n.x,this.y=n.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var u=arguments[0],p=arguments[1];this.x=u,this.y=p,this.w=1}else if(arguments[0]instanceof h&&arguments[1]instanceof h){var m=arguments[0],b=arguments[1];this.x=m.y*b.w-b.y*m.w,this.y=b.x*m.w-m.x*b.w,this.w=m.x*b.y-b.x*m.y}else if(arguments[0]instanceof It&&arguments[1]instanceof It){var T=arguments[0],s=arguments[1];this.x=T.y-s.y,this.y=s.x-T.x,this.w=T.x*s.y-s.x*T.y}}else if(arguments.length===3){var O=arguments[0],V=arguments[1],G=arguments[2];this.x=O,this.y=V,this.w=G}else if(arguments.length===4){var it=arguments[0],ot=arguments[1],dt=arguments[2],xt=arguments[3],Wt=it.y-ot.y,Vt=ot.x-it.x,ie=it.x*ot.y-ot.x*it.y,he=dt.y-xt.y,ue=xt.x-dt.x,Ne=dt.x*xt.y-xt.x*dt.y;this.x=Vt*Ne-ue*ie,this.y=he*ie-Wt*Ne,this.w=Wt*ue-he*Vt}};us.prototype.getY=function(){var n=this.y/this.w;if(or.isNaN(n)||or.isInfinite(n))throw new Dp;return n};us.prototype.getX=function(){var n=this.x/this.w;if(or.isNaN(n)||or.isInfinite(n))throw new Dp;return n};us.prototype.getCoordinate=function(){var n=new It;return n.x=this.getX(),n.y=this.getY(),n};us.prototype.interfaces_=function(){return[]};us.prototype.getClass=function(){return us};us.intersection=function(n,u,p,m){var b=n.y-u.y,T=u.x-n.x,s=n.x*u.y-u.x*n.y,O=p.y-m.y,V=m.x-p.x,G=p.x*m.y-m.x*p.y,it=T*G-V*s,ot=O*s-b*G,dt=b*V-O*T,xt=it/dt,Wt=ot/dt;if(or.isNaN(xt)||or.isInfinite(xt)||or.isNaN(Wt)||or.isInfinite(Wt))throw new Dp;return new It(xt,Wt)};var Be=function h(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof It){var n=arguments[0];this.init(n.x,n.x,n.y,n.y)}else if(arguments[0]instanceof h){var u=arguments[0];this.init(u)}}else if(arguments.length===2){var p=arguments[0],m=arguments[1];this.init(p.x,m.x,p.y,m.y)}else if(arguments.length===4){var b=arguments[0],T=arguments[1],s=arguments[2],O=arguments[3];this.init(b,T,s,O)}},RE={serialVersionUID:{configurable:!0}};Be.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Be.prototype.equals=function(n){if(!(n instanceof Be))return!1;var u=n;return this.isNull()?u.isNull():this._maxx===u.getMaxX()&&this._maxy===u.getMaxY()&&this._minx===u.getMinX()&&this._miny===u.getMinY()};Be.prototype.intersection=function(n){if(this.isNull()||n.isNull()||!this.intersects(n))return new Be;var u=this._minx>n._minx?this._minx:n._minx,p=this._miny>n._miny?this._miny:n._miny,m=this._maxx<n._maxx?this._maxx:n._maxx,b=this._maxy<n._maxy?this._maxy:n._maxy;return new Be(u,m,p,b)};Be.prototype.isNull=function(){return this._maxx<this._minx};Be.prototype.getMaxX=function(){return this._maxx};Be.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof It){var n=arguments[0];return this.covers(n.x,n.y)}else if(arguments[0]instanceof Be){var u=arguments[0];return this.isNull()||u.isNull()?!1:u.getMinX()>=this._minx&&u.getMaxX()<=this._maxx&&u.getMinY()>=this._miny&&u.getMaxY()<=this._maxy}}else if(arguments.length===2){var p=arguments[0],m=arguments[1];return this.isNull()?!1:p>=this._minx&&p<=this._maxx&&m>=this._miny&&m<=this._maxy}};Be.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Be){var n=arguments[0];return this.isNull()||n.isNull()?!1:!(n._minx>this._maxx||n._maxx<this._minx||n._miny>this._maxy||n._maxy<this._miny)}else if(arguments[0]instanceof It){var u=arguments[0];return this.intersects(u.x,u.y)}}else if(arguments.length===2){var p=arguments[0],m=arguments[1];return this.isNull()?!1:!(p>this._maxx||p<this._minx||m>this._maxy||m<this._miny)}};Be.prototype.getMinY=function(){return this._miny};Be.prototype.getMinX=function(){return this._minx};Be.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof It){var n=arguments[0];this.expandToInclude(n.x,n.y)}else if(arguments[0]instanceof Be){var u=arguments[0];if(u.isNull())return null;this.isNull()?(this._minx=u.getMinX(),this._maxx=u.getMaxX(),this._miny=u.getMinY(),this._maxy=u.getMaxY()):(u._minx<this._minx&&(this._minx=u._minx),u._maxx>this._maxx&&(this._maxx=u._maxx),u._miny<this._miny&&(this._miny=u._miny),u._maxy>this._maxy&&(this._maxy=u._maxy))}}else if(arguments.length===2){var p=arguments[0],m=arguments[1];this.isNull()?(this._minx=p,this._maxx=p,this._miny=m,this._maxy=m):(p<this._minx&&(this._minx=p),p>this._maxx&&(this._maxx=p),m<this._miny&&(this._miny=m),m>this._maxy&&(this._maxy=m))}};Be.prototype.minExtent=function(){if(this.isNull())return 0;var n=this.getWidth(),u=this.getHeight();return n<u?n:u};Be.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Be.prototype.compareTo=function(n){var u=n;return this.isNull()?u.isNull()?0:-1:u.isNull()?1:this._minx<u._minx?-1:this._minx>u._minx?1:this._miny<u._miny?-1:this._miny>u._miny?1:this._maxx<u._maxx?-1:this._maxx>u._maxx?1:this._maxy<u._maxy?-1:this._maxy>u._maxy?1:0};Be.prototype.translate=function(n,u){if(this.isNull())return null;this.init(this.getMinX()+n,this.getMaxX()+n,this.getMinY()+u,this.getMaxY()+u)};Be.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Be.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Be.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Be.prototype.maxExtent=function(){if(this.isNull())return 0;var n=this.getWidth(),u=this.getHeight();return n>u?n:u};Be.prototype.expandBy=function(){if(arguments.length===1){var n=arguments[0];this.expandBy(n,n)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];if(this.isNull())return null;this._minx-=u,this._maxx+=u,this._miny-=p,this._maxy+=p,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Be.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Be){var n=arguments[0];return this.covers(n)}else if(arguments[0]instanceof It){var u=arguments[0];return this.covers(u)}}else if(arguments.length===2){var p=arguments[0],m=arguments[1];return this.covers(p,m)}};Be.prototype.centre=function(){return this.isNull()?null:new It((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Be.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof It){var n=arguments[0];this.init(n.x,n.x,n.y,n.y)}else if(arguments[0]instanceof Be){var u=arguments[0];this._minx=u._minx,this._maxx=u._maxx,this._miny=u._miny,this._maxy=u._maxy}}else if(arguments.length===2){var p=arguments[0],m=arguments[1];this.init(p.x,m.x,p.y,m.y)}else if(arguments.length===4){var b=arguments[0],T=arguments[1],s=arguments[2],O=arguments[3];b<T?(this._minx=b,this._maxx=T):(this._minx=T,this._maxx=b),s<O?(this._miny=s,this._maxy=O):(this._miny=O,this._maxy=s)}};Be.prototype.getMaxY=function(){return this._maxy};Be.prototype.distance=function(n){if(this.intersects(n))return 0;var u=0;this._maxx<n._minx?u=n._minx-this._maxx:this._minx>n._maxx&&(u=this._minx-n._maxx);var p=0;return this._maxy<n._miny?p=n._miny-this._maxy:this._miny>n._maxy&&(p=this._miny-n._maxy),u===0?p:p===0?u:Math.sqrt(u*u+p*p)};Be.prototype.hashCode=function(){var n=17;return n=37*n+It.hashCode(this._minx),n=37*n+It.hashCode(this._maxx),n=37*n+It.hashCode(this._miny),n=37*n+It.hashCode(this._maxy),n};Be.prototype.interfaces_=function(){return[Xo,Wo]};Be.prototype.getClass=function(){return Be};Be.intersects=function(){if(arguments.length===3){var n=arguments[0],u=arguments[1],p=arguments[2];return p.x>=(n.x<u.x?n.x:u.x)&&p.x<=(n.x>u.x?n.x:u.x)&&p.y>=(n.y<u.y?n.y:u.y)&&p.y<=(n.y>u.y?n.y:u.y)}else if(arguments.length===4){var m=arguments[0],b=arguments[1],T=arguments[2],s=arguments[3],O=Math.min(T.x,s.x),V=Math.max(T.x,s.x),G=Math.min(m.x,b.x),it=Math.max(m.x,b.x);return!(G>V||it<O||(O=Math.min(T.y,s.y),V=Math.max(T.y,s.y),G=Math.min(m.y,b.y),it=Math.max(m.y,b.y),G>V)||it<O)}};RE.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Be,RE);var Ls={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},l_=function(n){this.geometryFactory=n||new _r};l_.prototype.read=function(n){var u,p,m;n=n.replace(/[\n\r]/g," ");var b=Ls.typeStr.exec(n);if(n.search("EMPTY")!==-1&&(b=Ls.emptyTypeStr.exec(n),b[2]=void 0),b&&(p=b[1].toLowerCase(),m=b[2],cp[p]&&(u=cp[p].apply(this,[m]))),u===void 0)throw new Error("Could not parse WKT "+n);return u};l_.prototype.write=function(n){return this.extractGeometry(n)};l_.prototype.extractGeometry=function(n){var u=n.getGeometryType().toLowerCase();if(!$a[u])return null;var p=u.toUpperCase(),m;return n.isEmpty()?m=p+" EMPTY":m=p+"("+$a[u].apply(this,[n])+")",m};var $a={coordinate:function(n){return n.x+" "+n.y},point:function(n){return $a.coordinate.call(this,n._coordinates._coordinates[0])},multipoint:function(n){for(var u=this,p=[],m=0,b=n._geometries.length;m<b;++m)p.push("("+$a.point.apply(u,[n._geometries[m]])+")");return p.join(",")},linestring:function(n){for(var u=this,p=[],m=0,b=n._points._coordinates.length;m<b;++m)p.push($a.coordinate.apply(u,[n._points._coordinates[m]]));return p.join(",")},linearring:function(n){for(var u=this,p=[],m=0,b=n._points._coordinates.length;m<b;++m)p.push($a.coordinate.apply(u,[n._points._coordinates[m]]));return p.join(",")},multilinestring:function(n){for(var u=this,p=[],m=0,b=n._geometries.length;m<b;++m)p.push("("+$a.linestring.apply(u,[n._geometries[m]])+")");return p.join(",")},polygon:function(n){var u=this,p=[];p.push("("+$a.linestring.apply(this,[n._shell])+")");for(var m=0,b=n._holes.length;m<b;++m)p.push("("+$a.linestring.apply(u,[n._holes[m]])+")");return p.join(",")},multipolygon:function(n){for(var u=this,p=[],m=0,b=n._geometries.length;m<b;++m)p.push("("+$a.polygon.apply(u,[n._geometries[m]])+")");return p.join(",")},geometrycollection:function(n){for(var u=this,p=[],m=0,b=n._geometries.length;m<b;++m)p.push(u.extractGeometry(n._geometries[m]));return p.join(",")}},cp={point:function(n){if(n===void 0)return this.geometryFactory.createPoint();var u=n.trim().split(Ls.spaces);return this.geometryFactory.createPoint(new It(Number.parseFloat(u[0]),Number.parseFloat(u[1])))},multipoint:function(n){var u=this;if(n===void 0)return this.geometryFactory.createMultiPoint();for(var p,m=n.trim().split(","),b=[],T=0,s=m.length;T<s;++T)p=m[T].replace(Ls.trimParens,"$1"),b.push(cp.point.apply(u,[p]));return this.geometryFactory.createMultiPoint(b)},linestring:function(n){if(n===void 0)return this.geometryFactory.createLineString();for(var u=n.trim().split(","),p=[],m,b=0,T=u.length;b<T;++b)m=u[b].trim().split(Ls.spaces),p.push(new It(Number.parseFloat(m[0]),Number.parseFloat(m[1])));return this.geometryFactory.createLineString(p)},linearring:function(n){if(n===void 0)return this.geometryFactory.createLinearRing();for(var u=n.trim().split(","),p=[],m,b=0,T=u.length;b<T;++b)m=u[b].trim().split(Ls.spaces),p.push(new It(Number.parseFloat(m[0]),Number.parseFloat(m[1])));return this.geometryFactory.createLinearRing(p)},multilinestring:function(n){var u=this;if(n===void 0)return this.geometryFactory.createMultiLineString();for(var p,m=n.trim().split(Ls.parenComma),b=[],T=0,s=m.length;T<s;++T)p=m[T].replace(Ls.trimParens,"$1"),b.push(cp.linestring.apply(u,[p]));return this.geometryFactory.createMultiLineString(b)},polygon:function(n){var u=this;if(n===void 0)return this.geometryFactory.createPolygon();for(var p,m,b,T=n.trim().split(Ls.parenComma),s,O=[],V=0,G=T.length;V<G;++V)p=T[V].replace(Ls.trimParens,"$1"),m=cp.linestring.apply(u,[p]),b=u.geometryFactory.createLinearRing(m._points),V===0?s=b:O.push(b);return this.geometryFactory.createPolygon(s,O)},multipolygon:function(n){var u=this;if(n===void 0)return this.geometryFactory.createMultiPolygon();for(var p,m=n.trim().split(Ls.doubleParenComma),b=[],T=0,s=m.length;T<s;++T)p=m[T].replace(Ls.trimParens,"$1"),b.push(cp.polygon.apply(u,[p]));return this.geometryFactory.createMultiPolygon(b)},geometrycollection:function(n){var u=this;if(n===void 0)return this.geometryFactory.createGeometryCollection();n=n.replace(/,\s*([A-Za-z])/g,"|$1");for(var p=n.trim().split("|"),m=[],b=0,T=p.length;b<T;++b)m.push(u.read(p[b]));return this.geometryFactory.createGeometryCollection(m)}},hs=function(n){this.parser=new l_(n)};hs.prototype.write=function(n){return this.parser.write(n)};hs.toLineString=function(n,u){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+n.x+" "+n.y+", "+u.x+" "+u.y+" )"};var el=function(h){function n(u){h.call(this,u),this.name="RuntimeException",this.message=u,this.stack=new h().stack}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n}(Error),Yg=function(h){function n(){if(h.call(this),arguments.length===0)h.call(this);else if(arguments.length===1){var u=arguments[0];h.call(this,u)}}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(el),pr=function(){};pr.prototype.interfaces_=function(){return[]};pr.prototype.getClass=function(){return pr};pr.shouldNeverReachHere=function(){if(arguments.length===0)pr.shouldNeverReachHere(null);else if(arguments.length===1){var n=arguments[0];throw new Yg("Should never reach here"+(n!==null?": "+n:""))}};pr.isTrue=function(){var n,u;if(arguments.length===1)n=arguments[0],pr.isTrue(n,null);else if(arguments.length===2&&(n=arguments[0],u=arguments[1],!n))throw u===null?new Yg:new Yg(u)};pr.equals=function(){var n,u,p;if(arguments.length===2)n=arguments[0],u=arguments[1],pr.equals(n,u,null);else if(arguments.length===3&&(n=arguments[0],u=arguments[1],p=arguments[2],!u.equals(n)))throw new Yg("Expected "+n+" but encountered "+u+(p!==null?": "+p:""))};var En=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new It,this._intPt[1]=new It,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Qc={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};En.prototype.getIndexAlongSegment=function(n,u){return this.computeIntLineIndex(),this._intLineIndex[n][u]};En.prototype.getTopologySummary=function(){var n=new Ws;return this.isEndPoint()&&n.append(" endpoint"),this._isProper&&n.append(" proper"),this.isCollinear()&&n.append(" collinear"),n.toString()};En.prototype.computeIntersection=function(n,u,p,m){this._inputLines[0][0]=n,this._inputLines[0][1]=u,this._inputLines[1][0]=p,this._inputLines[1][1]=m,this._result=this.computeIntersect(n,u,p,m)};En.prototype.getIntersectionNum=function(){return this._result};En.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var n=arguments[0],u=this.getEdgeDistance(n,0),p=this.getEdgeDistance(n,1);u>p?(this._intLineIndex[n][0]=0,this._intLineIndex[n][1]=1):(this._intLineIndex[n][0]=1,this._intLineIndex[n][1]=0)}};En.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};En.prototype.setPrecisionModel=function(n){this._precisionModel=n};En.prototype.isInteriorIntersection=function(){var n=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var u=arguments[0],p=0;p<this._result;p++)if(!(n._intPt[p].equals2D(n._inputLines[u][0])||n._intPt[p].equals2D(n._inputLines[u][1])))return!0;return!1}};En.prototype.getIntersection=function(n){return this._intPt[n]};En.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};En.prototype.hasIntersection=function(){return this._result!==En.NO_INTERSECTION};En.prototype.getEdgeDistance=function(n,u){var p=En.computeEdgeDistance(this._intPt[u],this._inputLines[n][0],this._inputLines[n][1]);return p};En.prototype.isCollinear=function(){return this._result===En.COLLINEAR_INTERSECTION};En.prototype.toString=function(){return hs.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+hs.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};En.prototype.getEndpoint=function(n,u){return this._inputLines[n][u]};En.prototype.isIntersection=function(n){for(var u=this,p=0;p<this._result;p++)if(u._intPt[p].equals2D(n))return!0;return!1};En.prototype.getIntersectionAlongSegment=function(n,u){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[n][u]]};En.prototype.interfaces_=function(){return[]};En.prototype.getClass=function(){return En};En.computeEdgeDistance=function(n,u,p){var m=Math.abs(p.x-u.x),b=Math.abs(p.y-u.y),T=-1;if(n.equals(u))T=0;else if(n.equals(p))m>b?T=m:T=b;else{var s=Math.abs(n.x-u.x),O=Math.abs(n.y-u.y);m>b?T=s:T=O,T===0&&!n.equals(u)&&(T=Math.max(s,O))}return pr.isTrue(!(T===0&&!n.equals(u)),"Bad distance calculation"),T};En.nonRobustComputeEdgeDistance=function(n,u,p){var m=n.x-u.x,b=n.y-u.y,T=Math.sqrt(m*m+b*b);return pr.isTrue(!(T===0&&!n.equals(u)),"Invalid distance calculation"),T};Qc.DONT_INTERSECT.get=function(){return 0};Qc.DO_INTERSECT.get=function(){return 1};Qc.COLLINEAR.get=function(){return 2};Qc.NO_INTERSECTION.get=function(){return 0};Qc.POINT_INTERSECTION.get=function(){return 1};Qc.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(En,Qc);var Xu=function(h){function n(){h.apply(this,arguments)}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.isInSegmentEnvelopes=function(p){var m=new Be(this._inputLines[0][0],this._inputLines[0][1]),b=new Be(this._inputLines[1][0],this._inputLines[1][1]);return m.contains(p)&&b.contains(p)},n.prototype.computeIntersection=function(){if(arguments.length===3){var p=arguments[0],m=arguments[1],b=arguments[2];if(this._isProper=!1,Be.intersects(m,b,p)&&Ce.orientationIndex(m,b,p)===0&&Ce.orientationIndex(b,m,p)===0)return this._isProper=!0,(p.equals(m)||p.equals(b))&&(this._isProper=!1),this._result=h.POINT_INTERSECTION,null;this._result=h.NO_INTERSECTION}else return h.prototype.computeIntersection.apply(this,arguments)},n.prototype.normalizeToMinimum=function(p,m,b,T,s){s.x=this.smallestInAbsValue(p.x,m.x,b.x,T.x),s.y=this.smallestInAbsValue(p.y,m.y,b.y,T.y),p.x-=s.x,p.y-=s.y,m.x-=s.x,m.y-=s.y,b.x-=s.x,b.y-=s.y,T.x-=s.x,T.y-=s.y},n.prototype.safeHCoordinateIntersection=function(p,m,b,T){var s=null;try{s=us.intersection(p,m,b,T)}catch(O){if(O instanceof Dp)s=n.nearestEndpoint(p,m,b,T);else throw O}finally{}return s},n.prototype.intersection=function(p,m,b,T){var s=this.intersectionWithNormalization(p,m,b,T);return this.isInSegmentEnvelopes(s)||(s=new It(n.nearestEndpoint(p,m,b,T))),this._precisionModel!==null&&this._precisionModel.makePrecise(s),s},n.prototype.smallestInAbsValue=function(p,m,b,T){var s=p,O=Math.abs(s);return Math.abs(m)<O&&(s=m,O=Math.abs(m)),Math.abs(b)<O&&(s=b,O=Math.abs(b)),Math.abs(T)<O&&(s=T),s},n.prototype.checkDD=function(p,m,b,T,s){var O=Ki.intersection(p,m,b,T),V=this.isInSegmentEnvelopes(O);_i.out.println("DD in env = "+V+"  --------------------- "+O),s.distance(O)>1e-4&&_i.out.println("Distance = "+s.distance(O))},n.prototype.intersectionWithNormalization=function(p,m,b,T){var s=new It(p),O=new It(m),V=new It(b),G=new It(T),it=new It;this.normalizeToEnvCentre(s,O,V,G,it);var ot=this.safeHCoordinateIntersection(s,O,V,G);return ot.x+=it.x,ot.y+=it.y,ot},n.prototype.computeCollinearIntersection=function(p,m,b,T){var s=Be.intersects(p,m,b),O=Be.intersects(p,m,T),V=Be.intersects(b,T,p),G=Be.intersects(b,T,m);return s&&O?(this._intPt[0]=b,this._intPt[1]=T,h.COLLINEAR_INTERSECTION):V&&G?(this._intPt[0]=p,this._intPt[1]=m,h.COLLINEAR_INTERSECTION):s&&V?(this._intPt[0]=b,this._intPt[1]=p,b.equals(p)&&!O&&!G?h.POINT_INTERSECTION:h.COLLINEAR_INTERSECTION):s&&G?(this._intPt[0]=b,this._intPt[1]=m,b.equals(m)&&!O&&!V?h.POINT_INTERSECTION:h.COLLINEAR_INTERSECTION):O&&V?(this._intPt[0]=T,this._intPt[1]=p,T.equals(p)&&!s&&!G?h.POINT_INTERSECTION:h.COLLINEAR_INTERSECTION):O&&G?(this._intPt[0]=T,this._intPt[1]=m,T.equals(m)&&!s&&!V?h.POINT_INTERSECTION:h.COLLINEAR_INTERSECTION):h.NO_INTERSECTION},n.prototype.normalizeToEnvCentre=function(p,m,b,T,s){var O=p.x<m.x?p.x:m.x,V=p.y<m.y?p.y:m.y,G=p.x>m.x?p.x:m.x,it=p.y>m.y?p.y:m.y,ot=b.x<T.x?b.x:T.x,dt=b.y<T.y?b.y:T.y,xt=b.x>T.x?b.x:T.x,Wt=b.y>T.y?b.y:T.y,Vt=O>ot?O:ot,ie=G<xt?G:xt,he=V>dt?V:dt,ue=it<Wt?it:Wt,Ne=(Vt+ie)/2,je=(he+ue)/2;s.x=Ne,s.y=je,p.x-=s.x,p.y-=s.y,m.x-=s.x,m.y-=s.y,b.x-=s.x,b.y-=s.y,T.x-=s.x,T.y-=s.y},n.prototype.computeIntersect=function(p,m,b,T){if(this._isProper=!1,!Be.intersects(p,m,b,T))return h.NO_INTERSECTION;var s=Ce.orientationIndex(p,m,b),O=Ce.orientationIndex(p,m,T);if(s>0&&O>0||s<0&&O<0)return h.NO_INTERSECTION;var V=Ce.orientationIndex(b,T,p),G=Ce.orientationIndex(b,T,m);if(V>0&&G>0||V<0&&G<0)return h.NO_INTERSECTION;var it=s===0&&O===0&&V===0&&G===0;return it?this.computeCollinearIntersection(p,m,b,T):(s===0||O===0||V===0||G===0?(this._isProper=!1,p.equals2D(b)||p.equals2D(T)?this._intPt[0]=p:m.equals2D(b)||m.equals2D(T)?this._intPt[0]=m:s===0?this._intPt[0]=new It(b):O===0?this._intPt[0]=new It(T):V===0?this._intPt[0]=new It(p):G===0&&(this._intPt[0]=new It(m))):(this._isProper=!0,this._intPt[0]=this.intersection(p,m,b,T)),h.POINT_INTERSECTION)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.nearestEndpoint=function(p,m,b,T){var s=p,O=Ce.distancePointLine(p,b,T),V=Ce.distancePointLine(m,b,T);return V<O&&(O=V,s=m),V=Ce.distancePointLine(b,p,m),V<O&&(O=V,s=b),V=Ce.distancePointLine(T,p,m),V<O&&(O=V,s=T),s},n}(En),Vc=function(){};Vc.prototype.interfaces_=function(){return[]};Vc.prototype.getClass=function(){return Vc};Vc.orientationIndex=function(n,u,p){var m=u.x-n.x,b=u.y-n.y,T=p.x-u.x,s=p.y-u.y;return Vc.signOfDet2x2(m,b,T,s)};Vc.signOfDet2x2=function(n,u,p,m){var b=null,T=null,s=null;if(b=1,n===0||m===0)return u===0||p===0?0:u>0?p>0?-b:b:p>0?b:-b;if(u===0||p===0)return m>0?n>0?b:-b:n>0?-b:b;if(u>0?m>0?u<=m||(b=-b,T=n,n=p,p=T,T=u,u=m,m=T):u<=-m?(b=-b,p=-p,m=-m):(T=n,n=-p,p=T,T=u,u=-m,m=T):m>0?-u<=m?(b=-b,n=-n,u=-u):(T=-n,n=p,p=T,T=-u,u=m,m=T):u>=m?(n=-n,u=-u,p=-p,m=-m):(b=-b,T=-n,n=-p,p=T,T=-u,u=-m,m=T),n>0)if(p>0){if(!(n<=p))return b}else return b;else{if(p>0)return-b;if(n>=p)b=-b,n=-n,p=-p;else return-b}for(;;){if(s=Math.floor(p/n),p=p-s*n,m=m-s*u,m<0)return-b;if(m>u)return b;if(n>p+p){if(u<m+m)return b}else{if(u>m+m)return-b;p=n-p,m=u-m,b=-b}if(m===0)return p===0?0:-b;if(p===0||(s=Math.floor(n/p),n=n-s*p,u=u-s*m,u<0))return b;if(u>m)return-b;if(p>n+n){if(m<u+u)return-b}else{if(m>u+u)return b;n=p-n,u=m-u,b=-b}if(u===0)return n===0?0:b;if(n===0)return-b}};var zs=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var n=arguments[0];this._p=n};zs.prototype.countSegment=function(n,u){if(n.x<this._p.x&&u.x<this._p.x)return null;if(this._p.x===u.x&&this._p.y===u.y)return this._isPointOnSegment=!0,null;if(n.y===this._p.y&&u.y===this._p.y){var p=n.x,m=u.x;return p>m&&(p=u.x,m=n.x),this._p.x>=p&&this._p.x<=m&&(this._isPointOnSegment=!0),null}if(n.y>this._p.y&&u.y<=this._p.y||u.y>this._p.y&&n.y<=this._p.y){var b=n.x-this._p.x,T=n.y-this._p.y,s=u.x-this._p.x,O=u.y-this._p.y,V=Vc.signOfDet2x2(b,T,s,O);if(V===0)return this._isPointOnSegment=!0,null;O<T&&(V=-V),V>0&&this._crossingCount++}};zs.prototype.isPointInPolygon=function(){return this.getLocation()!==Ct.EXTERIOR};zs.prototype.getLocation=function(){return this._isPointOnSegment?Ct.BOUNDARY:this._crossingCount%2===1?Ct.INTERIOR:Ct.EXTERIOR};zs.prototype.isOnSegment=function(){return this._isPointOnSegment};zs.prototype.interfaces_=function(){return[]};zs.prototype.getClass=function(){return zs};zs.locatePointInRing=function(){if(arguments[0]instanceof It&&Ke(arguments[1],Cr)){for(var n=arguments[0],u=arguments[1],p=new zs(n),m=new It,b=new It,T=1;T<u.size();T++)if(u.getCoordinate(T,m),u.getCoordinate(T-1,b),p.countSegment(m,b),p.isOnSegment())return p.getLocation();return p.getLocation()}else if(arguments[0]instanceof It&&arguments[1]instanceof Array){for(var s=arguments[0],O=arguments[1],V=new zs(s),G=1;G<O.length;G++){var it=O[G],ot=O[G-1];if(V.countSegment(it,ot),V.isOnSegment())return V.getLocation()}return V.getLocation()}};var Ce=function(){},th={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Ce.prototype.interfaces_=function(){return[]};Ce.prototype.getClass=function(){return Ce};Ce.orientationIndex=function(n,u,p){return Ki.orientationIndex(n,u,p)};Ce.signedArea=function(){if(arguments[0]instanceof Array){var n=arguments[0];if(n.length<3)return 0;for(var u=0,p=n[0].x,m=1;m<n.length-1;m++){var b=n[m].x-p,T=n[m+1].y,s=n[m-1].y;u+=b*(s-T)}return u/2}else if(Ke(arguments[0],Cr)){var O=arguments[0],V=O.size();if(V<3)return 0;var G=new It,it=new It,ot=new It;O.getCoordinate(0,it),O.getCoordinate(1,ot);var dt=it.x;ot.x-=dt;for(var xt=0,Wt=1;Wt<V-1;Wt++)G.y=it.y,it.x=ot.x,it.y=ot.y,O.getCoordinate(Wt+1,ot),ot.x-=dt,xt+=it.x*(G.y-ot.y);return xt/2}};Ce.distanceLineLine=function(n,u,p,m){if(n.equals(u))return Ce.distancePointLine(n,p,m);if(p.equals(m))return Ce.distancePointLine(m,n,u);var b=!1;if(!Be.intersects(n,u,p,m))b=!0;else{var T=(u.x-n.x)*(m.y-p.y)-(u.y-n.y)*(m.x-p.x);if(T===0)b=!0;else{var s=(n.y-p.y)*(m.x-p.x)-(n.x-p.x)*(m.y-p.y),O=(n.y-p.y)*(u.x-n.x)-(n.x-p.x)*(u.y-n.y),V=O/T,G=s/T;(G<0||G>1||V<0||V>1)&&(b=!0)}}return b?Eo.min(Ce.distancePointLine(n,p,m),Ce.distancePointLine(u,p,m),Ce.distancePointLine(p,n,u),Ce.distancePointLine(m,n,u)):0};Ce.isPointInRing=function(n,u){return Ce.locatePointInRing(n,u)!==Ct.EXTERIOR};Ce.computeLength=function(n){var u=n.size();if(u<=1)return 0;var p=0,m=new It;n.getCoordinate(0,m);for(var b=m.x,T=m.y,s=1;s<u;s++){n.getCoordinate(s,m);var O=m.x,V=m.y,G=O-b,it=V-T;p+=Math.sqrt(G*G+it*it),b=O,T=V}return p};Ce.isCCW=function(n){var u=n.length-1;if(u<3)throw new vn("Ring has fewer than 4 points, so orientation cannot be determined");for(var p=n[0],m=0,b=1;b<=u;b++){var T=n[b];T.y>p.y&&(p=T,m=b)}var s=m;do s=s-1,s<0&&(s=u);while(n[s].equals2D(p)&&s!==m);var O=m;do O=(O+1)%u;while(n[O].equals2D(p)&&O!==m);var V=n[s],G=n[O];if(V.equals2D(p)||G.equals2D(p)||V.equals2D(G))return!1;var it=Ce.computeOrientation(V,p,G),ot=!1;return it===0?ot=V.x>G.x:ot=it>0,ot};Ce.locatePointInRing=function(n,u){return zs.locatePointInRing(n,u)};Ce.distancePointLinePerpendicular=function(n,u,p){var m=(p.x-u.x)*(p.x-u.x)+(p.y-u.y)*(p.y-u.y),b=((u.y-n.y)*(p.x-u.x)-(u.x-n.x)*(p.y-u.y))/m;return Math.abs(b)*Math.sqrt(m)};Ce.computeOrientation=function(n,u,p){return Ce.orientationIndex(n,u,p)};Ce.distancePointLine=function(){if(arguments.length===2){var n=arguments[0],u=arguments[1];if(u.length===0)throw new vn("Line array must contain at least one vertex");for(var p=n.distance(u[0]),m=0;m<u.length-1;m++){var b=Ce.distancePointLine(n,u[m],u[m+1]);b<p&&(p=b)}return p}else if(arguments.length===3){var T=arguments[0],s=arguments[1],O=arguments[2];if(s.x===O.x&&s.y===O.y)return T.distance(s);var V=(O.x-s.x)*(O.x-s.x)+(O.y-s.y)*(O.y-s.y),G=((T.x-s.x)*(O.x-s.x)+(T.y-s.y)*(O.y-s.y))/V;if(G<=0)return T.distance(s);if(G>=1)return T.distance(O);var it=((s.y-T.y)*(O.x-s.x)-(s.x-T.x)*(O.y-s.y))/V;return Math.abs(it)*Math.sqrt(V)}};Ce.isOnLine=function(n,u){for(var p=new Xu,m=1;m<u.length;m++){var b=u[m-1],T=u[m];if(p.computeIntersection(n,b,T),p.hasIntersection())return!0}return!1};th.CLOCKWISE.get=function(){return-1};th.RIGHT.get=function(){return Ce.CLOCKWISE};th.COUNTERCLOCKWISE.get=function(){return 1};th.LEFT.get=function(){return Ce.COUNTERCLOCKWISE};th.COLLINEAR.get=function(){return 0};th.STRAIGHT.get=function(){return Ce.COLLINEAR};Object.defineProperties(Ce,th);var rl=function(){};rl.prototype.filter=function(n){};rl.prototype.interfaces_=function(){return[]};rl.prototype.getClass=function(){return rl};var Je=function(){var n=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=n,this._SRID=n.getSRID()},Ia={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Je.prototype.isGeometryCollection=function(){return this.getSortIndex()===Je.SORTINDEX_GEOMETRYCOLLECTION};Je.prototype.getFactory=function(){return this._factory};Je.prototype.getGeometryN=function(n){return this};Je.prototype.getArea=function(){return 0};Je.prototype.isRectangle=function(){return!1};Je.prototype.equals=function(){if(arguments[0]instanceof Je){var n=arguments[0];return n===null?!1:this.equalsTopo(n)}else if(arguments[0]instanceof Object){var u=arguments[0];if(!(u instanceof Je))return!1;var p=u;return this.equalsExact(p)}};Je.prototype.equalsExact=function(n){return this===n||this.equalsExact(n,0)};Je.prototype.geometryChanged=function(){this.apply(Je.geometryChangedFilter)};Je.prototype.geometryChangedAction=function(){this._envelope=null};Je.prototype.equalsNorm=function(n){return n===null?!1:this.norm().equalsExact(n.norm())};Je.prototype.getLength=function(){return 0};Je.prototype.getNumGeometries=function(){return 1};Je.prototype.compareTo=function(){if(arguments.length===1){var n=arguments[0],u=n;return this.getSortIndex()!==u.getSortIndex()?this.getSortIndex()-u.getSortIndex():this.isEmpty()&&u.isEmpty()?0:this.isEmpty()?-1:u.isEmpty()?1:this.compareToSameClass(n)}else if(arguments.length===2){var p=arguments[0],m=arguments[1];return this.getSortIndex()!==p.getSortIndex()?this.getSortIndex()-p.getSortIndex():this.isEmpty()&&p.isEmpty()?0:this.isEmpty()?-1:p.isEmpty()?1:this.compareToSameClass(p,m)}};Je.prototype.getUserData=function(){return this._userData};Je.prototype.getSRID=function(){return this._SRID};Je.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Je.prototype.checkNotGeometryCollection=function(n){if(n.getSortIndex()===Je.SORTINDEX_GEOMETRYCOLLECTION)throw new vn("This method does not support GeometryCollection arguments")};Je.prototype.equal=function(n,u,p){return p===0?n.equals(u):n.distance(u)<=p};Je.prototype.norm=function(){var n=this.copy();return n.normalize(),n};Je.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Je.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Be(this._envelope)};Je.prototype.setSRID=function(n){this._SRID=n};Je.prototype.setUserData=function(n){this._userData=n};Je.prototype.compare=function(n,u){for(var p=n.iterator(),m=u.iterator();p.hasNext()&&m.hasNext();){var b=p.next(),T=m.next(),s=b.compareTo(T);if(s!==0)return s}return p.hasNext()?1:m.hasNext()?-1:0};Je.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Je.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Je.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Je.SORTINDEX_MULTIPOINT||this.getSortIndex()===Je.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Je.SORTINDEX_MULTIPOLYGON};Je.prototype.interfaces_=function(){return[a_,Xo,Wo]};Je.prototype.getClass=function(){return Je};Je.hasNonEmptyElements=function(n){for(var u=0;u<n.length;u++)if(!n[u].isEmpty())return!0;return!1};Je.hasNullElements=function(n){for(var u=0;u<n.length;u++)if(n[u]===null)return!0;return!1};Ia.serialVersionUID.get=function(){return 8763622679187377e3};Ia.SORTINDEX_POINT.get=function(){return 0};Ia.SORTINDEX_MULTIPOINT.get=function(){return 1};Ia.SORTINDEX_LINESTRING.get=function(){return 2};Ia.SORTINDEX_LINEARRING.get=function(){return 3};Ia.SORTINDEX_MULTILINESTRING.get=function(){return 4};Ia.SORTINDEX_POLYGON.get=function(){return 5};Ia.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Ia.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Ia.geometryChangedFilter.get=function(){return r0};Object.defineProperties(Je,Ia);var r0=function(){};r0.interfaces_=function(){return[rl]};r0.filter=function(n){n.geometryChangedAction()};var ma=function(){};ma.prototype.filter=function(n){};ma.prototype.interfaces_=function(){return[]};ma.prototype.getClass=function(){return ma};var jo=function(){},al={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};jo.prototype.isInBoundary=function(n){};jo.prototype.interfaces_=function(){return[]};jo.prototype.getClass=function(){return jo};al.Mod2BoundaryNodeRule.get=function(){return fp};al.EndPointBoundaryNodeRule.get=function(){return dp};al.MultiValentEndPointBoundaryNodeRule.get=function(){return mp};al.MonoValentEndPointBoundaryNodeRule.get=function(){return gp};al.MOD2_BOUNDARY_RULE.get=function(){return new fp};al.ENDPOINT_BOUNDARY_RULE.get=function(){return new dp};al.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new mp};al.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new gp};al.OGC_SFS_BOUNDARY_RULE.get=function(){return jo.MOD2_BOUNDARY_RULE};Object.defineProperties(jo,al);var fp=function(){};fp.prototype.isInBoundary=function(n){return n%2===1};fp.prototype.interfaces_=function(){return[jo]};fp.prototype.getClass=function(){return fp};var dp=function(){};dp.prototype.isInBoundary=function(n){return n>0};dp.prototype.interfaces_=function(){return[jo]};dp.prototype.getClass=function(){return dp};var mp=function(){};mp.prototype.isInBoundary=function(n){return n>1};mp.prototype.interfaces_=function(){return[jo]};mp.prototype.getClass=function(){return mp};var gp=function(){};gp.prototype.isInBoundary=function(n){return n===1};gp.prototype.interfaces_=function(){return[jo]};gp.prototype.getClass=function(){return gp};var Hn=function(){};Hn.prototype.add=function(){};Hn.prototype.addAll=function(){};Hn.prototype.isEmpty=function(){};Hn.prototype.iterator=function(){};Hn.prototype.size=function(){};Hn.prototype.toArray=function(){};Hn.prototype.remove=function(){};function n0(h){this.message=h||""}n0.prototype=new Error;n0.prototype.name="IndexOutOfBoundsException";var Rp=function(){};Rp.prototype.hasNext=function(){};Rp.prototype.next=function(){};Rp.prototype.remove=function(){};var cs=function(h){function n(){h.apply(this,arguments)}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.get=function(){},n.prototype.set=function(){},n.prototype.isEmpty=function(){},n}(Hn);function Op(h){this.message=h||""}Op.prototype=new Error;Op.prototype.name="NoSuchElementException";var be=function(h){function n(){h.call(this),this.array_=[],arguments[0]instanceof Hn&&this.addAll(arguments[0])}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.ensureCapacity=function(){},n.prototype.interfaces_=function(){return[h,Hn]},n.prototype.add=function(p){return arguments.length===1?this.array_.push(p):this.array_.splice(arguments[0],arguments[1]),!0},n.prototype.clear=function(){this.array_=[]},n.prototype.addAll=function(p){for(var m=this,b=p.iterator();b.hasNext();)m.add(b.next());return!0},n.prototype.set=function(p,m){var b=this.array_[p];return this.array_[p]=m,b},n.prototype.iterator=function(){return new vC(this)},n.prototype.get=function(p){if(p<0||p>=this.size())throw new n0;return this.array_[p]},n.prototype.isEmpty=function(){return this.array_.length===0},n.prototype.size=function(){return this.array_.length},n.prototype.toArray=function(){for(var p=this,m=[],b=0,T=this.array_.length;b<T;b++)m.push(p.array_[b]);return m},n.prototype.remove=function(p){for(var m=this,b=!1,T=0,s=this.array_.length;T<s;T++)if(m.array_[T]===p){m.array_.splice(T,1),b=!0;break}return b},n}(cs),vC=function(h){function n(u){h.call(this),this.arrayList_=u,this.position_=0}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Op;return this.arrayList_.get(this.position_++)},n.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},n.prototype.set=function(p){return this.arrayList_.set(this.position_-1,p)},n.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},n}(Rp),Vd=function(h){function n(){if(h.call(this),arguments.length!==0){if(arguments.length===1){var p=arguments[0];this.ensureCapacity(p.length),this.add(p,!0)}else if(arguments.length===2){var m=arguments[0],b=arguments[1];this.ensureCapacity(m.length),this.add(m,b)}}}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={coordArrayType:{configurable:!0}};return u.coordArrayType.get=function(){return new Array(0).fill(null)},n.prototype.getCoordinate=function(m){return this.get(m)},n.prototype.addAll=function(){var m=this;if(arguments.length===2){for(var b=arguments[0],T=arguments[1],s=!1,O=b.iterator();O.hasNext();)m.add(O.next(),T),s=!0;return s}else return h.prototype.addAll.apply(this,arguments)},n.prototype.clone=function(){for(var m=this,b=h.prototype.clone.call(this),T=0;T<this.size();T++)b.add(T,m.get(T).copy());return b},n.prototype.toCoordinateArray=function(){return this.toArray(n.coordArrayType)},n.prototype.add=function(){var m=this;if(arguments.length===1){var b=arguments[0];h.prototype.add.call(this,b)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var T=arguments[0],s=arguments[1];return this.add(T,s,!0),!0}else if(arguments[0]instanceof It&&typeof arguments[1]=="boolean"){var O=arguments[0],V=arguments[1];if(!V&&this.size()>=1){var G=this.get(this.size()-1);if(G.equals2D(O))return null}h.prototype.add.call(this,O)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var it=arguments[0],ot=arguments[1];return this.add(it,ot),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var dt=arguments[0],xt=arguments[1],Wt=arguments[2];if(Wt)for(var Vt=0;Vt<dt.length;Vt++)m.add(dt[Vt],xt);else for(var ie=dt.length-1;ie>=0;ie--)m.add(dt[ie],xt);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof It){var he=arguments[0],ue=arguments[1],Ne=arguments[2];if(!Ne){var je=this.size();if(je>0){if(he>0){var qe=this.get(he-1);if(qe.equals2D(ue))return null}if(he<je){var rr=this.get(he);if(rr.equals2D(ue))return null}}}h.prototype.add.call(this,he,ue)}}else if(arguments.length===4){var tr=arguments[0],At=arguments[1],hn=arguments[2],Vr=arguments[3],ae=1;hn>Vr&&(ae=-1);for(var Tr=hn;Tr!==Vr;Tr+=ae)m.add(tr[Tr],At);return!0}},n.prototype.closeRing=function(){this.size()>0&&this.add(new It(this.get(0)),!1)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},Object.defineProperties(n,u),n}(be),yr=function(){},u_={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};u_.ForwardComparator.get=function(){return Ed};u_.BidirectionalComparator.get=function(){return _p};u_.coordArrayType.get=function(){return new Array(0).fill(null)};yr.prototype.interfaces_=function(){return[]};yr.prototype.getClass=function(){return yr};yr.isRing=function(n){return!(n.length<4||!n[0].equals2D(n[n.length-1]))};yr.ptNotInList=function(n,u){for(var p=0;p<n.length;p++){var m=n[p];if(yr.indexOf(m,u)<0)return m}return null};yr.scroll=function(n,u){var p=yr.indexOf(u,n);if(p<0)return null;var m=new Array(n.length).fill(null);_i.arraycopy(n,p,m,0,n.length-p),_i.arraycopy(n,0,m,n.length-p,p),_i.arraycopy(m,0,n,0,n.length)};yr.equals=function(){if(arguments.length===2){var n=arguments[0],u=arguments[1];if(n===u)return!0;if(n===null||u===null||n.length!==u.length)return!1;for(var p=0;p<n.length;p++)if(!n[p].equals(u[p]))return!1;return!0}else if(arguments.length===3){var m=arguments[0],b=arguments[1],T=arguments[2];if(m===b)return!0;if(m===null||b===null||m.length!==b.length)return!1;for(var s=0;s<m.length;s++)if(T.compare(m[s],b[s])!==0)return!1;return!0}};yr.intersection=function(n,u){for(var p=new Vd,m=0;m<n.length;m++)u.intersects(n[m])&&p.add(n[m],!0);return p.toCoordinateArray()};yr.hasRepeatedPoints=function(n){for(var u=1;u<n.length;u++)if(n[u-1].equals(n[u]))return!0;return!1};yr.removeRepeatedPoints=function(n){if(!yr.hasRepeatedPoints(n))return n;var u=new Vd(n,!1);return u.toCoordinateArray()};yr.reverse=function(n){for(var u=n.length-1,p=Math.trunc(u/2),m=0;m<=p;m++){var b=n[m];n[m]=n[u-m],n[u-m]=b}};yr.removeNull=function(n){for(var u=0,p=0;p<n.length;p++)n[p]!==null&&u++;var m=new Array(u).fill(null);if(u===0)return m;for(var b=0,T=0;T<n.length;T++)n[T]!==null&&(m[b++]=n[T]);return m};yr.copyDeep=function(){if(arguments.length===1){for(var n=arguments[0],u=new Array(n.length).fill(null),p=0;p<n.length;p++)u[p]=new It(n[p]);return u}else if(arguments.length===5)for(var m=arguments[0],b=arguments[1],T=arguments[2],s=arguments[3],O=arguments[4],V=0;V<O;V++)T[s+V]=new It(m[b+V])};yr.isEqualReversed=function(n,u){for(var p=0;p<n.length;p++){var m=n[p],b=u[n.length-p-1];if(m.compareTo(b)!==0)return!1}return!0};yr.envelope=function(n){for(var u=new Be,p=0;p<n.length;p++)u.expandToInclude(n[p]);return u};yr.toCoordinateArray=function(n){return n.toArray(yr.coordArrayType)};yr.atLeastNCoordinatesOrNothing=function(n,u){return u.length>=n?u:[]};yr.indexOf=function(n,u){for(var p=0;p<u.length;p++)if(n.equals(u[p]))return p;return-1};yr.increasingDirection=function(n){for(var u=0;u<Math.trunc(n.length/2);u++){var p=n.length-1-u,m=n[u].compareTo(n[p]);if(m!==0)return m}return 1};yr.compare=function(n,u){for(var p=0;p<n.length&&p<u.length;){var m=n[p].compareTo(u[p]);if(m!==0)return m;p++}return p<u.length?-1:p<n.length?1:0};yr.minCoordinate=function(n){for(var u=null,p=0;p<n.length;p++)(u===null||u.compareTo(n[p])>0)&&(u=n[p]);return u};yr.extract=function(n,u,p){u=Eo.clamp(u,0,n.length),p=Eo.clamp(p,-1,n.length);var m=p-u+1;p<0&&(m=0),u>=n.length&&(m=0),p<u&&(m=0);var b=new Array(m).fill(null);if(m===0)return b;for(var T=0,s=u;s<=p;s++)b[T++]=n[s];return b};Object.defineProperties(yr,u_);var Ed=function(){};Ed.prototype.compare=function(n,u){var p=n,m=u;return yr.compare(p,m)};Ed.prototype.interfaces_=function(){return[hp]};Ed.prototype.getClass=function(){return Ed};var _p=function(){};_p.prototype.compare=function(n,u){var p=n,m=u;if(p.length<m.length)return-1;if(p.length>m.length)return 1;if(p.length===0)return 0;var b=yr.compare(p,m),T=yr.isEqualReversed(p,m);return T?0:b};_p.prototype.OLDcompare=function(n,u){var p=n,m=u;if(p.length<m.length)return-1;if(p.length>m.length)return 1;if(p.length===0)return 0;for(var b=yr.increasingDirection(p),T=yr.increasingDirection(m),s=b>0?0:p.length-1,O=T>0?0:p.length-1,V=0;V<p.length;V++){var G=p[s].compareTo(m[O]);if(G!==0)return G;s+=b,O+=T}return 0};_p.prototype.interfaces_=function(){return[hp]};_p.prototype.getClass=function(){return _p};var eh=function(){};eh.prototype.get=function(){};eh.prototype.put=function(){};eh.prototype.size=function(){};eh.prototype.values=function(){};eh.prototype.entrySet=function(){};var xC=function(h){function n(){h.apply(this,arguments)}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n}(eh);function Ud(h){this.message=h||""}Ud.prototype=new Error;Ud.prototype.name="OperationNotSupported";function c_(){}c_.prototype=new Hn;c_.prototype.contains=function(){};var i0=function(h){function n(){h.call(this),this.array_=[],arguments[0]instanceof Hn&&this.addAll(arguments[0])}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.contains=function(p){for(var m=this,b=0,T=this.array_.length;b<T;b++){var s=m.array_[b];if(s===p)return!0}return!1},n.prototype.add=function(p){return this.contains(p)?!1:(this.array_.push(p),!0)},n.prototype.addAll=function(p){for(var m=this,b=p.iterator();b.hasNext();)m.add(b.next());return!0},n.prototype.remove=function(p){throw new Error},n.prototype.size=function(){return this.array_.length},n.prototype.isEmpty=function(){return this.array_.length===0},n.prototype.toArray=function(){for(var p=this,m=[],b=0,T=this.array_.length;b<T;b++)m.push(p.array_[b]);return m},n.prototype.iterator=function(){return new bC(this)},n}(c_),bC=function(h){function n(u){h.call(this),this.hashSet_=u,this.position_=0}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Op;return this.hashSet_.array_[this.position_++]},n.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},n.prototype.remove=function(){throw new Ud},n}(Rp),Ka=0,Ru=1;function eE(h){return h===null?Ka:h.color}function un(h){return h===null?null:h.parent}function Ya(h,n){h!==null&&(h.color=n)}function Vv(h){return h===null?null:h.left}function rE(h){return h===null?null:h.right}function Mi(){this.root_=null,this.size_=0}Mi.prototype=new xC;Mi.prototype.get=function(h){for(var n=this.root_;n!==null;){var u=h.compareTo(n.key);if(u<0)n=n.left;else if(u>0)n=n.right;else return n.value}return null};Mi.prototype.put=function(h,n){if(this.root_===null)return this.root_={key:h,value:n,left:null,right:null,parent:null,color:Ka,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var u=this.root_,p,m;do if(p=u,m=h.compareTo(u.key),m<0)u=u.left;else if(m>0)u=u.right;else{var b=u.value;return u.value=n,b}while(u!==null);var T={key:h,left:null,right:null,value:n,parent:p,color:Ka,getValue:function(){return this.value},getKey:function(){return this.key}};return m<0?p.left=T:p.right=T,this.fixAfterInsertion(T),this.size_++,null};Mi.prototype.fixAfterInsertion=function(h){var n=this;for(h.color=Ru;h!=null&&h!==this.root_&&h.parent.color===Ru;)if(un(h)===Vv(un(un(h)))){var u=rE(un(un(h)));eE(u)===Ru?(Ya(un(h),Ka),Ya(u,Ka),Ya(un(un(h)),Ru),h=un(un(h))):(h===rE(un(h))&&(h=un(h),n.rotateLeft(h)),Ya(un(h),Ka),Ya(un(un(h)),Ru),n.rotateRight(un(un(h))))}else{var p=Vv(un(un(h)));eE(p)===Ru?(Ya(un(h),Ka),Ya(p,Ka),Ya(un(un(h)),Ru),h=un(un(h))):(h===Vv(un(h))&&(h=un(h),n.rotateRight(h)),Ya(un(h),Ka),Ya(un(un(h)),Ru),n.rotateLeft(un(un(h))))}this.root_.color=Ka};Mi.prototype.values=function(){var h=new be,n=this.getFirstEntry();if(n!==null)for(h.add(n.value);(n=Mi.successor(n))!==null;)h.add(n.value);return h};Mi.prototype.entrySet=function(){var h=new i0,n=this.getFirstEntry();if(n!==null)for(h.add(n);(n=Mi.successor(n))!==null;)h.add(n);return h};Mi.prototype.rotateLeft=function(h){if(h!=null){var n=h.right;h.right=n.left,n.left!=null&&(n.left.parent=h),n.parent=h.parent,h.parent===null?this.root_=n:h.parent.left===h?h.parent.left=n:h.parent.right=n,n.left=h,h.parent=n}};Mi.prototype.rotateRight=function(h){if(h!=null){var n=h.left;h.left=n.right,n.right!=null&&(n.right.parent=h),n.parent=h.parent,h.parent===null?this.root_=n:h.parent.right===h?h.parent.right=n:h.parent.left=n,n.right=h,h.parent=n}};Mi.prototype.getFirstEntry=function(){var h=this.root_;if(h!=null)for(;h.left!=null;)h=h.left;return h};Mi.successor=function(h){if(h===null)return null;if(h.right!==null){for(var n=h.right;n.left!==null;)n=n.left;return n}else{for(var u=h.parent,p=h;u!==null&&p===u.right;)p=u,u=u.parent;return u}};Mi.prototype.size=function(){return this.size_};var Id=function(){};Id.prototype.interfaces_=function(){return[]};Id.prototype.getClass=function(){return Id};function OE(){}OE.prototype=new c_;function Fs(){this.array_=[],arguments[0]instanceof Hn&&this.addAll(arguments[0])}Fs.prototype=new OE;Fs.prototype.contains=function(h){for(var n=this,u=0,p=this.array_.length;u<p;u++){var m=n.array_[u];if(m.compareTo(h)===0)return!0}return!1};Fs.prototype.add=function(h){var n=this;if(this.contains(h))return!1;for(var u=0,p=this.array_.length;u<p;u++){var m=n.array_[u];if(m.compareTo(h)===1)return n.array_.splice(u,0,h),!0}return this.array_.push(h),!0};Fs.prototype.addAll=function(h){for(var n=this,u=h.iterator();u.hasNext();)n.add(u.next());return!0};Fs.prototype.remove=function(h){throw new Ud};Fs.prototype.size=function(){return this.array_.length};Fs.prototype.isEmpty=function(){return this.array_.length===0};Fs.prototype.toArray=function(){for(var h=this,n=[],u=0,p=this.array_.length;u<p;u++)n.push(h.array_[u]);return n};Fs.prototype.iterator=function(){return new h_(this)};var h_=function(h){this.treeSet_=h,this.position_=0};h_.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Op;return this.treeSet_.array_[this.position_++]};h_.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};h_.prototype.remove=function(){throw new Ud};var zu=function(){};zu.sort=function(){var n=arguments[0],u,p,m,b;if(arguments.length===1)b=function(s,O){return s.compareTo(O)},n.sort(b);else if(arguments.length===2)m=arguments[1],b=function(s,O){return m.compare(s,O)},n.sort(b);else if(arguments.length===3){p=n.slice(arguments[1],arguments[2]),p.sort();var T=n.slice(0,arguments[1]).concat(p,n.slice(arguments[2],n.length));for(n.splice(0,n.length),u=0;u<T.length;u++)n.push(T[u])}else if(arguments.length===4)for(p=n.slice(arguments[1],arguments[2]),m=arguments[3],b=function(s,O){return m.compare(s,O)},p.sort(b),T=n.slice(0,arguments[1]).concat(p,n.slice(arguments[2],n.length)),n.splice(0,n.length),u=0;u<T.length;u++)n.push(T[u])};zu.asList=function(n){for(var u=new be,p=0,m=n.length;p<m;p++)u.add(n[p]);return u};var Nr=function(){},vs={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};vs.P.get=function(){return 0};vs.L.get=function(){return 1};vs.A.get=function(){return 2};vs.FALSE.get=function(){return-1};vs.TRUE.get=function(){return-2};vs.DONTCARE.get=function(){return-3};vs.SYM_FALSE.get=function(){return"F"};vs.SYM_TRUE.get=function(){return"T"};vs.SYM_DONTCARE.get=function(){return"*"};vs.SYM_P.get=function(){return"0"};vs.SYM_L.get=function(){return"1"};vs.SYM_A.get=function(){return"2"};Nr.prototype.interfaces_=function(){return[]};Nr.prototype.getClass=function(){return Nr};Nr.toDimensionSymbol=function(n){switch(n){case Nr.FALSE:return Nr.SYM_FALSE;case Nr.TRUE:return Nr.SYM_TRUE;case Nr.DONTCARE:return Nr.SYM_DONTCARE;case Nr.P:return Nr.SYM_P;case Nr.L:return Nr.SYM_L;case Nr.A:return Nr.SYM_A}throw new vn("Unknown dimension value: "+n)};Nr.toDimensionValue=function(n){switch(wd.toUpperCase(n)){case Nr.SYM_FALSE:return Nr.FALSE;case Nr.SYM_TRUE:return Nr.TRUE;case Nr.SYM_DONTCARE:return Nr.DONTCARE;case Nr.SYM_P:return Nr.P;case Nr.SYM_L:return Nr.L;case Nr.SYM_A:return Nr.A}throw new vn("Unknown dimension symbol: "+n)};Object.defineProperties(Nr,vs);var Bs=function(){};Bs.prototype.filter=function(n){};Bs.prototype.interfaces_=function(){return[]};Bs.prototype.getClass=function(){return Bs};var ps=function(){};ps.prototype.filter=function(n,u){};ps.prototype.isDone=function(){};ps.prototype.isGeometryChanged=function(){};ps.prototype.interfaces_=function(){return[]};ps.prototype.getClass=function(){return ps};var ki=function(h){function n(p,m){if(h.call(this,m),this._geometries=p||[],h.hasNullElements(this._geometries))throw new vn("geometries must not contain null elements")}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={serialVersionUID:{configurable:!0}};return n.prototype.computeEnvelopeInternal=function(){for(var m=this,b=new Be,T=0;T<this._geometries.length;T++)b.expandToInclude(m._geometries[T].getEnvelopeInternal());return b},n.prototype.getGeometryN=function(m){return this._geometries[m]},n.prototype.getSortIndex=function(){return h.SORTINDEX_GEOMETRYCOLLECTION},n.prototype.getCoordinates=function(){for(var m=this,b=new Array(this.getNumPoints()).fill(null),T=-1,s=0;s<this._geometries.length;s++)for(var O=m._geometries[s].getCoordinates(),V=0;V<O.length;V++)T++,b[T]=O[V];return b},n.prototype.getArea=function(){for(var m=this,b=0,T=0;T<this._geometries.length;T++)b+=m._geometries[T].getArea();return b},n.prototype.equalsExact=function(){var m=this;if(arguments.length===2){var b=arguments[0],T=arguments[1];if(!this.isEquivalentClass(b))return!1;var s=b;if(this._geometries.length!==s._geometries.length)return!1;for(var O=0;O<this._geometries.length;O++)if(!m._geometries[O].equalsExact(s._geometries[O],T))return!1;return!0}else return h.prototype.equalsExact.apply(this,arguments)},n.prototype.normalize=function(){for(var m=this,b=0;b<this._geometries.length;b++)m._geometries[b].normalize();zu.sort(this._geometries)},n.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},n.prototype.getBoundaryDimension=function(){for(var m=this,b=Nr.FALSE,T=0;T<this._geometries.length;T++)b=Math.max(b,m._geometries[T].getBoundaryDimension());return b},n.prototype.getDimension=function(){for(var m=this,b=Nr.FALSE,T=0;T<this._geometries.length;T++)b=Math.max(b,m._geometries[T].getDimension());return b},n.prototype.getLength=function(){for(var m=this,b=0,T=0;T<this._geometries.length;T++)b+=m._geometries[T].getLength();return b},n.prototype.getNumPoints=function(){for(var m=this,b=0,T=0;T<this._geometries.length;T++)b+=m._geometries[T].getNumPoints();return b},n.prototype.getNumGeometries=function(){return this._geometries.length},n.prototype.reverse=function(){for(var m=this,b=this._geometries.length,T=new Array(b).fill(null),s=0;s<this._geometries.length;s++)T[s]=m._geometries[s].reverse();return this.getFactory().createGeometryCollection(T)},n.prototype.compareToSameClass=function(){var m=this;if(arguments.length===1){var b=arguments[0],T=new Fs(zu.asList(this._geometries)),s=new Fs(zu.asList(b._geometries));return this.compare(T,s)}else if(arguments.length===2){for(var O=arguments[0],V=arguments[1],G=O,it=this.getNumGeometries(),ot=G.getNumGeometries(),dt=0;dt<it&&dt<ot;){var xt=m.getGeometryN(dt),Wt=G.getGeometryN(dt),Vt=xt.compareToSameClass(Wt,V);if(Vt!==0)return Vt;dt++}return dt<it?1:dt<ot?-1:0}},n.prototype.apply=function(){var m=this;if(Ke(arguments[0],ma))for(var b=arguments[0],T=0;T<this._geometries.length;T++)m._geometries[T].apply(b);else if(Ke(arguments[0],ps)){var s=arguments[0];if(this._geometries.length===0)return null;for(var O=0;O<this._geometries.length&&(m._geometries[O].apply(s),!s.isDone());O++);s.isGeometryChanged()&&this.geometryChanged()}else if(Ke(arguments[0],Bs)){var V=arguments[0];V.filter(this);for(var G=0;G<this._geometries.length;G++)m._geometries[G].apply(V)}else if(Ke(arguments[0],rl)){var it=arguments[0];it.filter(this);for(var ot=0;ot<this._geometries.length;ot++)m._geometries[ot].apply(it)}},n.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),pr.shouldNeverReachHere(),null},n.prototype.clone=function(){var m=this,b=h.prototype.clone.call(this);b._geometries=new Array(this._geometries.length).fill(null);for(var T=0;T<this._geometries.length;T++)b._geometries[T]=m._geometries[T].clone();return b},n.prototype.getGeometryType=function(){return"GeometryCollection"},n.prototype.copy=function(){for(var m=this,b=new Array(this._geometries.length).fill(null),T=0;T<b.length;T++)b[T]=m._geometries[T].copy();return new n(b,this._factory)},n.prototype.isEmpty=function(){for(var m=this,b=0;b<this._geometries.length;b++)if(!m._geometries[b].isEmpty())return!1;return!0},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},u.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(n,u),n}(Je),ku=function(h){function n(){h.apply(this,arguments)}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={serialVersionUID:{configurable:!0}};return n.prototype.getSortIndex=function(){return Je.SORTINDEX_MULTILINESTRING},n.prototype.equalsExact=function(){if(arguments.length===2){var m=arguments[0],b=arguments[1];return this.isEquivalentClass(m)?h.prototype.equalsExact.call(this,m,b):!1}else return h.prototype.equalsExact.apply(this,arguments)},n.prototype.getBoundaryDimension=function(){return this.isClosed()?Nr.FALSE:0},n.prototype.isClosed=function(){var m=this;if(this.isEmpty())return!1;for(var b=0;b<this._geometries.length;b++)if(!m._geometries[b].isClosed())return!1;return!0},n.prototype.getDimension=function(){return 1},n.prototype.reverse=function(){for(var m=this,b=this._geometries.length,T=new Array(b).fill(null),s=0;s<this._geometries.length;s++)T[b-1-s]=m._geometries[s].reverse();return this.getFactory().createMultiLineString(T)},n.prototype.getBoundary=function(){return new Vo(this).getBoundary()},n.prototype.getGeometryType=function(){return"MultiLineString"},n.prototype.copy=function(){for(var m=this,b=new Array(this._geometries.length).fill(null),T=0;T<b.length;T++)b[T]=m._geometries[T].copy();return new n(b,this._factory)},n.prototype.interfaces_=function(){return[Id]},n.prototype.getClass=function(){return n},u.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(n,u),n}(ki),Vo=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var n=arguments[0],u=jo.MOD2_BOUNDARY_RULE;this._geom=n,this._geomFact=n.getFactory(),this._bnRule=u}else if(arguments.length===2){var p=arguments[0],m=arguments[1];this._geom=p,this._geomFact=p.getFactory(),this._bnRule=m}};Vo.prototype.boundaryMultiLineString=function(n){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var u=this.computeBoundaryCoordinates(n);return u.length===1?this._geomFact.createPoint(u[0]):this._geomFact.createMultiPointFromCoords(u)};Vo.prototype.getBoundary=function(){return this._geom instanceof Mn?this.boundaryLineString(this._geom):this._geom instanceof ku?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Vo.prototype.boundaryLineString=function(n){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(n.isClosed()){var u=this._bnRule.isInBoundary(2);return u?n.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([n.getStartPoint(),n.getEndPoint()])};Vo.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Vo.prototype.computeBoundaryCoordinates=function(n){var u=this,p=new be;this._endpointMap=new Mi;for(var m=0;m<n.getNumGeometries();m++){var b=n.getGeometryN(m);b.getNumPoints()!==0&&(u.addEndpoint(b.getCoordinateN(0)),u.addEndpoint(b.getCoordinateN(b.getNumPoints()-1)))}for(var T=this._endpointMap.entrySet().iterator();T.hasNext();){var s=T.next(),O=s.getValue(),V=O.count;u._bnRule.isInBoundary(V)&&p.add(s.getKey())}return yr.toCoordinateArray(p)};Vo.prototype.addEndpoint=function(n){var u=this._endpointMap.get(n);u===null&&(u=new $g,this._endpointMap.put(n,u)),u.count++};Vo.prototype.interfaces_=function(){return[]};Vo.prototype.getClass=function(){return Vo};Vo.getBoundary=function(){if(arguments.length===1){var n=arguments[0],u=new Vo(n);return u.getBoundary()}else if(arguments.length===2){var p=arguments[0],m=arguments[1],b=new Vo(p,m);return b.getBoundary()}};var $g=function(){this.count=null};$g.prototype.interfaces_=function(){return[]};$g.prototype.getClass=function(){return $g};function wC(){}function EC(){}var IC=function(){};function TC(){}function SC(){}function CC(){}var Uo=function(){},o0={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Uo.prototype.interfaces_=function(){return[]};Uo.prototype.getClass=function(){return Uo};Uo.chars=function(n,u){for(var p=new Array(u).fill(null),m=0;m<u;m++)p[m]=n;return String(p)};Uo.getStackTrace=function(){if(arguments.length===1){var n=arguments[0],u=new TC,p=new wC;return n.printStackTrace(p),u.toString()}else if(arguments.length===2){var m=arguments[0],b=arguments[1],T="";new EC(Uo.getStackTrace(m));for(var s=new CC,O=0;O<b;O++)try{T+=s.readLine()+Uo.NEWLINE}catch(V){if(V instanceof SC)pr.shouldNeverReachHere();else throw V}finally{}return T}};Uo.split=function(n,u){for(var p=u.length,m=new be,b=""+n,T=b.indexOf(u);T>=0;){var s=b.substring(0,T);m.add(s),b=b.substring(T+p),T=b.indexOf(u)}b.length>0&&m.add(b);for(var O=new Array(m.size()).fill(null),V=0;V<O.length;V++)O[V]=m.get(V);return O};Uo.toString=function(){if(arguments.length===1){var n=arguments[0];return Uo.SIMPLE_ORDINATE_FORMAT.format(n)}};Uo.spaces=function(n){return Uo.chars(" ",n)};o0.NEWLINE.get=function(){return _i.getProperty("line.separator")};o0.SIMPLE_ORDINATE_FORMAT.get=function(){return new IC};Object.defineProperties(Uo,o0);var Fn=function(){};Fn.prototype.interfaces_=function(){return[]};Fn.prototype.getClass=function(){return Fn};Fn.copyCoord=function(n,u,p,m){for(var b=Math.min(n.getDimension(),p.getDimension()),T=0;T<b;T++)p.setOrdinate(m,T,n.getOrdinate(u,T))};Fn.isRing=function(n){var u=n.size();return u===0?!0:u<=3?!1:n.getOrdinate(0,Cr.X)===n.getOrdinate(u-1,Cr.X)&&n.getOrdinate(0,Cr.Y)===n.getOrdinate(u-1,Cr.Y)};Fn.isEqual=function(n,u){var p=n.size(),m=u.size();if(p!==m)return!1;for(var b=Math.min(n.getDimension(),u.getDimension()),T=0;T<p;T++)for(var s=0;s<b;s++){var O=n.getOrdinate(T,s),V=u.getOrdinate(T,s);if(n.getOrdinate(T,s)!==u.getOrdinate(T,s)&&!(or.isNaN(O)&&or.isNaN(V)))return!1}return!0};Fn.extend=function(n,u,p){var m=n.create(p,u.getDimension()),b=u.size();if(Fn.copy(u,0,m,0,b),b>0)for(var T=b;T<p;T++)Fn.copy(u,b-1,m,T,1);return m};Fn.reverse=function(n){for(var u=n.size()-1,p=Math.trunc(u/2),m=0;m<=p;m++)Fn.swap(n,m,u-m)};Fn.swap=function(n,u,p){if(u===p)return null;for(var m=0;m<n.getDimension();m++){var b=n.getOrdinate(u,m);n.setOrdinate(u,m,n.getOrdinate(p,m)),n.setOrdinate(p,m,b)}};Fn.copy=function(n,u,p,m,b){for(var T=0;T<b;T++)Fn.copyCoord(n,u+T,p,m+T)};Fn.toString=function(){if(arguments.length===1){var n=arguments[0],u=n.size();if(u===0)return"()";var p=n.getDimension(),m=new Ws;m.append("(");for(var b=0;b<u;b++){b>0&&m.append(" ");for(var T=0;T<p;T++)T>0&&m.append(","),m.append(Uo.toString(n.getOrdinate(b,T)))}return m.append(")"),m.toString()}};Fn.ensureValidRing=function(n,u){var p=u.size();if(p===0)return u;if(p<=3)return Fn.createClosedRing(n,u,4);var m=u.getOrdinate(0,Cr.X)===u.getOrdinate(p-1,Cr.X)&&u.getOrdinate(0,Cr.Y)===u.getOrdinate(p-1,Cr.Y);return m?u:Fn.createClosedRing(n,u,p+1)};Fn.createClosedRing=function(n,u,p){var m=n.create(p,u.getDimension()),b=u.size();Fn.copy(u,0,m,0,b);for(var T=b;T<p;T++)Fn.copy(u,0,m,T,1);return m};var Mn=function(h){function n(p,m){h.call(this,m),this._points=null,this.init(p)}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={serialVersionUID:{configurable:!0}};return n.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Be:this._points.expandEnvelope(new Be)},n.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},n.prototype.getSortIndex=function(){return h.SORTINDEX_LINESTRING},n.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},n.prototype.equalsExact=function(){var m=this;if(arguments.length===2){var b=arguments[0],T=arguments[1];if(!this.isEquivalentClass(b))return!1;var s=b;if(this._points.size()!==s._points.size())return!1;for(var O=0;O<this._points.size();O++)if(!m.equal(m._points.getCoordinate(O),s._points.getCoordinate(O),T))return!1;return!0}else return h.prototype.equalsExact.apply(this,arguments)},n.prototype.normalize=function(){for(var m=this,b=0;b<Math.trunc(this._points.size()/2);b++){var T=m._points.size()-1-b;if(!m._points.getCoordinate(b).equals(m._points.getCoordinate(T)))return m._points.getCoordinate(b).compareTo(m._points.getCoordinate(T))>0&&Fn.reverse(m._points),null}},n.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},n.prototype.getBoundaryDimension=function(){return this.isClosed()?Nr.FALSE:0},n.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},n.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},n.prototype.getDimension=function(){return 1},n.prototype.getLength=function(){return Ce.computeLength(this._points)},n.prototype.getNumPoints=function(){return this._points.size()},n.prototype.reverse=function(){var m=this._points.copy();Fn.reverse(m);var b=this.getFactory().createLineString(m);return b},n.prototype.compareToSameClass=function(){var m=this;if(arguments.length===1){for(var b=arguments[0],T=b,s=0,O=0;s<this._points.size()&&O<T._points.size();){var V=m._points.getCoordinate(s).compareTo(T._points.getCoordinate(O));if(V!==0)return V;s++,O++}return s<this._points.size()?1:O<T._points.size()?-1:0}else if(arguments.length===2){var G=arguments[0],it=arguments[1],ot=G;return it.compare(this._points,ot._points)}},n.prototype.apply=function(){var m=this;if(Ke(arguments[0],ma))for(var b=arguments[0],T=0;T<this._points.size();T++)b.filter(m._points.getCoordinate(T));else if(Ke(arguments[0],ps)){var s=arguments[0];if(this._points.size()===0)return null;for(var O=0;O<this._points.size()&&(s.filter(m._points,O),!s.isDone());O++);s.isGeometryChanged()&&this.geometryChanged()}else if(Ke(arguments[0],Bs)){var V=arguments[0];V.filter(this)}else if(Ke(arguments[0],rl)){var G=arguments[0];G.filter(this)}},n.prototype.getBoundary=function(){return new Vo(this).getBoundary()},n.prototype.isEquivalentClass=function(m){return m instanceof n},n.prototype.clone=function(){var m=h.prototype.clone.call(this);return m._points=this._points.clone(),m},n.prototype.getCoordinateN=function(m){return this._points.getCoordinate(m)},n.prototype.getGeometryType=function(){return"LineString"},n.prototype.copy=function(){return new n(this._points.copy(),this._factory)},n.prototype.getCoordinateSequence=function(){return this._points},n.prototype.isEmpty=function(){return this._points.size()===0},n.prototype.init=function(m){if(m===null&&(m=this.getFactory().getCoordinateSequenceFactory().create([])),m.size()===1)throw new vn("Invalid number of points in LineString (found "+m.size()+" - must be 0 or >= 2)");this._points=m},n.prototype.isCoordinate=function(m){for(var b=this,T=0;T<this._points.size();T++)if(b._points.getCoordinate(T).equals(m))return!0;return!1},n.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},n.prototype.getPointN=function(m){return this.getFactory().createPoint(this._points.getCoordinate(m))},n.prototype.interfaces_=function(){return[Id]},n.prototype.getClass=function(){return n},u.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(n,u),n}(Je),Td=function(){};Td.prototype.interfaces_=function(){return[]};Td.prototype.getClass=function(){return Td};var ho=function(h){function n(p,m){h.call(this,m),this._coordinates=p||null,this.init(this._coordinates)}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={serialVersionUID:{configurable:!0}};return n.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Be;var m=new Be;return m.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),m},n.prototype.getSortIndex=function(){return h.SORTINDEX_POINT},n.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},n.prototype.equalsExact=function(){if(arguments.length===2){var m=arguments[0],b=arguments[1];return this.isEquivalentClass(m)?this.isEmpty()&&m.isEmpty()?!0:this.isEmpty()!==m.isEmpty()?!1:this.equal(m.getCoordinate(),this.getCoordinate(),b):!1}else return h.prototype.equalsExact.apply(this,arguments)},n.prototype.normalize=function(){},n.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},n.prototype.getBoundaryDimension=function(){return Nr.FALSE},n.prototype.getDimension=function(){return 0},n.prototype.getNumPoints=function(){return this.isEmpty()?0:1},n.prototype.reverse=function(){return this.copy()},n.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},n.prototype.compareToSameClass=function(){if(arguments.length===1){var m=arguments[0],b=m;return this.getCoordinate().compareTo(b.getCoordinate())}else if(arguments.length===2){var T=arguments[0],s=arguments[1],O=T;return s.compare(this._coordinates,O._coordinates)}},n.prototype.apply=function(){if(Ke(arguments[0],ma)){var m=arguments[0];if(this.isEmpty())return null;m.filter(this.getCoordinate())}else if(Ke(arguments[0],ps)){var b=arguments[0];if(this.isEmpty())return null;b.filter(this._coordinates,0),b.isGeometryChanged()&&this.geometryChanged()}else if(Ke(arguments[0],Bs)){var T=arguments[0];T.filter(this)}else if(Ke(arguments[0],rl)){var s=arguments[0];s.filter(this)}},n.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},n.prototype.clone=function(){var m=h.prototype.clone.call(this);return m._coordinates=this._coordinates.clone(),m},n.prototype.getGeometryType=function(){return"Point"},n.prototype.copy=function(){return new n(this._coordinates.copy(),this._factory)},n.prototype.getCoordinateSequence=function(){return this._coordinates},n.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},n.prototype.isEmpty=function(){return this._coordinates.size()===0},n.prototype.init=function(m){m===null&&(m=this.getFactory().getCoordinateSequenceFactory().create([])),pr.isTrue(m.size()<=1),this._coordinates=m},n.prototype.isSimple=function(){return!0},n.prototype.interfaces_=function(){return[Td]},n.prototype.getClass=function(){return n},u.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(n,u),n}(Je),Xl=function(){};Xl.prototype.interfaces_=function(){return[]};Xl.prototype.getClass=function(){return Xl};var Kn=function(h){function n(p,m,b){if(h.call(this,b),this._shell=null,this._holes=null,p===null&&(p=this.getFactory().createLinearRing()),m===null&&(m=[]),h.hasNullElements(m))throw new vn("holes must not contain null elements");if(p.isEmpty()&&h.hasNonEmptyElements(m))throw new vn("shell is empty but holes are not");this._shell=p,this._holes=m}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={serialVersionUID:{configurable:!0}};return n.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},n.prototype.getSortIndex=function(){return h.SORTINDEX_POLYGON},n.prototype.getCoordinates=function(){var m=this;if(this.isEmpty())return[];for(var b=new Array(this.getNumPoints()).fill(null),T=-1,s=this._shell.getCoordinates(),O=0;O<s.length;O++)T++,b[T]=s[O];for(var V=0;V<this._holes.length;V++)for(var G=m._holes[V].getCoordinates(),it=0;it<G.length;it++)T++,b[T]=G[it];return b},n.prototype.getArea=function(){var m=this,b=0;b+=Math.abs(Ce.signedArea(this._shell.getCoordinateSequence()));for(var T=0;T<this._holes.length;T++)b-=Math.abs(Ce.signedArea(m._holes[T].getCoordinateSequence()));return b},n.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var m=this._shell.getCoordinateSequence(),b=this.getEnvelopeInternal(),T=0;T<5;T++){var s=m.getX(T);if(!(s===b.getMinX()||s===b.getMaxX()))return!1;var O=m.getY(T);if(!(O===b.getMinY()||O===b.getMaxY()))return!1}for(var V=m.getX(0),G=m.getY(0),it=1;it<=4;it++){var ot=m.getX(it),dt=m.getY(it),xt=ot!==V,Wt=dt!==G;if(xt===Wt)return!1;V=ot,G=dt}return!0},n.prototype.equalsExact=function(){var m=this;if(arguments.length===2){var b=arguments[0],T=arguments[1];if(!this.isEquivalentClass(b))return!1;var s=b,O=this._shell,V=s._shell;if(!O.equalsExact(V,T)||this._holes.length!==s._holes.length)return!1;for(var G=0;G<this._holes.length;G++)if(!m._holes[G].equalsExact(s._holes[G],T))return!1;return!0}else return h.prototype.equalsExact.apply(this,arguments)},n.prototype.normalize=function(){var m=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var b=0;b<this._holes.length;b++)m.normalize(m._holes[b],!1);zu.sort(this._holes)}else if(arguments.length===2){var T=arguments[0],s=arguments[1];if(T.isEmpty())return null;var O=new Array(T.getCoordinates().length-1).fill(null);_i.arraycopy(T.getCoordinates(),0,O,0,O.length);var V=yr.minCoordinate(T.getCoordinates());yr.scroll(O,V),_i.arraycopy(O,0,T.getCoordinates(),0,O.length),T.getCoordinates()[O.length]=O[0],Ce.isCCW(T.getCoordinates())===s&&yr.reverse(T.getCoordinates())}},n.prototype.getCoordinate=function(){return this._shell.getCoordinate()},n.prototype.getNumInteriorRing=function(){return this._holes.length},n.prototype.getBoundaryDimension=function(){return 1},n.prototype.getDimension=function(){return 2},n.prototype.getLength=function(){var m=this,b=0;b+=this._shell.getLength();for(var T=0;T<this._holes.length;T++)b+=m._holes[T].getLength();return b},n.prototype.getNumPoints=function(){for(var m=this,b=this._shell.getNumPoints(),T=0;T<this._holes.length;T++)b+=m._holes[T].getNumPoints();return b},n.prototype.reverse=function(){var m=this,b=this.copy();b._shell=this._shell.copy().reverse(),b._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)b._holes[T]=m._holes[T].copy().reverse();return b},n.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},n.prototype.compareToSameClass=function(){var m=this;if(arguments.length===1){var b=arguments[0],T=this._shell,s=b._shell;return T.compareToSameClass(s)}else if(arguments.length===2){var O=arguments[0],V=arguments[1],G=O,it=this._shell,ot=G._shell,dt=it.compareToSameClass(ot,V);if(dt!==0)return dt;for(var xt=this.getNumInteriorRing(),Wt=G.getNumInteriorRing(),Vt=0;Vt<xt&&Vt<Wt;){var ie=m.getInteriorRingN(Vt),he=G.getInteriorRingN(Vt),ue=ie.compareToSameClass(he,V);if(ue!==0)return ue;Vt++}return Vt<xt?1:Vt<Wt?-1:0}},n.prototype.apply=function(m){var b=this;if(Ke(m,ma)){this._shell.apply(m);for(var T=0;T<this._holes.length;T++)b._holes[T].apply(m)}else if(Ke(m,ps)){if(this._shell.apply(m),!m.isDone())for(var s=0;s<this._holes.length&&(b._holes[s].apply(m),!m.isDone());s++);m.isGeometryChanged()&&this.geometryChanged()}else if(Ke(m,Bs))m.filter(this);else if(Ke(m,rl)){m.filter(this),this._shell.apply(m);for(var O=0;O<this._holes.length;O++)b._holes[O].apply(m)}},n.prototype.getBoundary=function(){var m=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var b=new Array(this._holes.length+1).fill(null);b[0]=this._shell;for(var T=0;T<this._holes.length;T++)b[T+1]=m._holes[T];return b.length<=1?this.getFactory().createLinearRing(b[0].getCoordinateSequence()):this.getFactory().createMultiLineString(b)},n.prototype.clone=function(){var m=this,b=h.prototype.clone.call(this);b._shell=this._shell.clone(),b._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)b._holes[T]=m._holes[T].clone();return b},n.prototype.getGeometryType=function(){return"Polygon"},n.prototype.copy=function(){for(var m=this,b=this._shell.copy(),T=new Array(this._holes.length).fill(null),s=0;s<T.length;s++)T[s]=m._holes[s].copy();return new n(b,T,this._factory)},n.prototype.getExteriorRing=function(){return this._shell},n.prototype.isEmpty=function(){return this._shell.isEmpty()},n.prototype.getInteriorRingN=function(m){return this._holes[m]},n.prototype.interfaces_=function(){return[Xl]},n.prototype.getClass=function(){return n},u.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(n,u),n}(Je),yp=function(h){function n(){h.apply(this,arguments)}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={serialVersionUID:{configurable:!0}};return n.prototype.getSortIndex=function(){return Je.SORTINDEX_MULTIPOINT},n.prototype.isValid=function(){return!0},n.prototype.equalsExact=function(){if(arguments.length===2){var m=arguments[0],b=arguments[1];return this.isEquivalentClass(m)?h.prototype.equalsExact.call(this,m,b):!1}else return h.prototype.equalsExact.apply(this,arguments)},n.prototype.getCoordinate=function(){if(arguments.length===1){var m=arguments[0];return this._geometries[m].getCoordinate()}else return h.prototype.getCoordinate.apply(this,arguments)},n.prototype.getBoundaryDimension=function(){return Nr.FALSE},n.prototype.getDimension=function(){return 0},n.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},n.prototype.getGeometryType=function(){return"MultiPoint"},n.prototype.copy=function(){for(var m=this,b=new Array(this._geometries.length).fill(null),T=0;T<b.length;T++)b[T]=m._geometries[T].copy();return new n(b,this._factory)},n.prototype.interfaces_=function(){return[Td]},n.prototype.getClass=function(){return n},u.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(n,u),n}(ki),ga=function(h){function n(p,m){p instanceof It&&m instanceof _r&&(p=m.getCoordinateSequenceFactory().create(p)),h.call(this,p,m),this.validateConstruction()}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return n.prototype.getSortIndex=function(){return Je.SORTINDEX_LINEARRING},n.prototype.getBoundaryDimension=function(){return Nr.FALSE},n.prototype.isClosed=function(){return this.isEmpty()?!0:h.prototype.isClosed.call(this)},n.prototype.reverse=function(){var m=this._points.copy();Fn.reverse(m);var b=this.getFactory().createLinearRing(m);return b},n.prototype.validateConstruction=function(){if(!this.isEmpty()&&!h.prototype.isClosed.call(this))throw new vn("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<n.MINIMUM_VALID_SIZE)throw new vn("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},n.prototype.getGeometryType=function(){return"LinearRing"},n.prototype.copy=function(){return new n(this._points.copy(),this._factory)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},u.MINIMUM_VALID_SIZE.get=function(){return 4},u.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(n,u),n}(Mn),fa=function(h){function n(){h.apply(this,arguments)}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={serialVersionUID:{configurable:!0}};return n.prototype.getSortIndex=function(){return Je.SORTINDEX_MULTIPOLYGON},n.prototype.equalsExact=function(){if(arguments.length===2){var m=arguments[0],b=arguments[1];return this.isEquivalentClass(m)?h.prototype.equalsExact.call(this,m,b):!1}else return h.prototype.equalsExact.apply(this,arguments)},n.prototype.getBoundaryDimension=function(){return 1},n.prototype.getDimension=function(){return 2},n.prototype.reverse=function(){for(var m=this,b=this._geometries.length,T=new Array(b).fill(null),s=0;s<this._geometries.length;s++)T[s]=m._geometries[s].reverse();return this.getFactory().createMultiPolygon(T)},n.prototype.getBoundary=function(){var m=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var b=new be,T=0;T<this._geometries.length;T++)for(var s=m._geometries[T],O=s.getBoundary(),V=0;V<O.getNumGeometries();V++)b.add(O.getGeometryN(V));var G=new Array(b.size()).fill(null);return this.getFactory().createMultiLineString(b.toArray(G))},n.prototype.getGeometryType=function(){return"MultiPolygon"},n.prototype.copy=function(){for(var m=this,b=new Array(this._geometries.length).fill(null),T=0;T<b.length;T++)b[T]=m._geometries[T].copy();return new n(b,this._factory)},n.prototype.interfaces_=function(){return[Xl]},n.prototype.getClass=function(){return n},u.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(n,u),n}(ki),qo=function(n){this._factory=n||null,this._isUserDataCopied=!1},p_={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};qo.prototype.setCopyUserData=function(n){this._isUserDataCopied=n};qo.prototype.edit=function(n,u){if(n===null)return null;var p=this.editInternal(n,u);return this._isUserDataCopied&&p.setUserData(n.getUserData()),p};qo.prototype.editInternal=function(n,u){return this._factory===null&&(this._factory=n.getFactory()),n instanceof ki?this.editGeometryCollection(n,u):n instanceof Kn?this.editPolygon(n,u):n instanceof ho?u.edit(n,this._factory):n instanceof Mn?u.edit(n,this._factory):(pr.shouldNeverReachHere("Unsupported Geometry class: "+n.getClass().getName()),null)};qo.prototype.editGeometryCollection=function(n,u){for(var p=this,m=u.edit(n,this._factory),b=new be,T=0;T<m.getNumGeometries();T++){var s=p.edit(m.getGeometryN(T),u);s===null||s.isEmpty()||b.add(s)}return m.getClass()===yp?this._factory.createMultiPoint(b.toArray([])):m.getClass()===ku?this._factory.createMultiLineString(b.toArray([])):m.getClass()===fa?this._factory.createMultiPolygon(b.toArray([])):this._factory.createGeometryCollection(b.toArray([]))};qo.prototype.editPolygon=function(n,u){var p=this,m=u.edit(n,this._factory);if(m===null&&(m=this._factory.createPolygon(null)),m.isEmpty())return m;var b=this.edit(m.getExteriorRing(),u);if(b===null||b.isEmpty())return this._factory.createPolygon();for(var T=new be,s=0;s<m.getNumInteriorRing();s++){var O=p.edit(m.getInteriorRingN(s),u);O===null||O.isEmpty()||T.add(O)}return this._factory.createPolygon(b,T.toArray([]))};qo.prototype.interfaces_=function(){return[]};qo.prototype.getClass=function(){return qo};qo.GeometryEditorOperation=function(){};p_.NoOpGeometryOperation.get=function(){return Sd};p_.CoordinateOperation.get=function(){return Cd};p_.CoordinateSequenceOperation.get=function(){return Md};Object.defineProperties(qo,p_);var Sd=function(){};Sd.prototype.edit=function(n,u){return n};Sd.prototype.interfaces_=function(){return[qo.GeometryEditorOperation]};Sd.prototype.getClass=function(){return Sd};var Cd=function(){};Cd.prototype.edit=function(n,u){var p=this.editCoordinates(n.getCoordinates(),n);return p===null?n:n instanceof ga?u.createLinearRing(p):n instanceof Mn?u.createLineString(p):n instanceof ho?p.length>0?u.createPoint(p[0]):u.createPoint():n};Cd.prototype.interfaces_=function(){return[qo.GeometryEditorOperation]};Cd.prototype.getClass=function(){return Cd};var Md=function(){};Md.prototype.edit=function(n,u){return n instanceof ga?u.createLinearRing(this.edit(n.getCoordinateSequence(),n)):n instanceof Mn?u.createLineString(this.edit(n.getCoordinateSequence(),n)):n instanceof ho?u.createPoint(this.edit(n.getCoordinateSequence(),n)):n};Md.prototype.interfaces_=function(){return[qo.GeometryEditorOperation]};Md.prototype.getClass=function(){return Md};var Nn=function(){var n=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var u=arguments[0];this._coordinates=new Array(u).fill(null);for(var p=0;p<u;p++)n._coordinates[p]=new It}else if(Ke(arguments[0],Cr)){var m=arguments[0];if(m===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=m.getDimension(),this._coordinates=new Array(m.size()).fill(null);for(var b=0;b<this._coordinates.length;b++)n._coordinates[b]=m.getCoordinateCopy(b)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var T=arguments[0],s=arguments[1];this._coordinates=T,this._dimension=s,T===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var O=arguments[0],V=arguments[1];this._coordinates=new Array(O).fill(null),this._dimension=V;for(var G=0;G<O;G++)n._coordinates[G]=new It}}},zE={serialVersionUID:{configurable:!0}};Nn.prototype.setOrdinate=function(n,u,p){switch(u){case Cr.X:this._coordinates[n].x=p;break;case Cr.Y:this._coordinates[n].y=p;break;case Cr.Z:this._coordinates[n].z=p;break;default:throw new vn("invalid ordinateIndex")}};Nn.prototype.size=function(){return this._coordinates.length};Nn.prototype.getOrdinate=function(n,u){switch(u){case Cr.X:return this._coordinates[n].x;case Cr.Y:return this._coordinates[n].y;case Cr.Z:return this._coordinates[n].z}return or.NaN};Nn.prototype.getCoordinate=function(){if(arguments.length===1){var n=arguments[0];return this._coordinates[n]}else if(arguments.length===2){var u=arguments[0],p=arguments[1];p.x=this._coordinates[u].x,p.y=this._coordinates[u].y,p.z=this._coordinates[u].z}};Nn.prototype.getCoordinateCopy=function(n){return new It(this._coordinates[n])};Nn.prototype.getDimension=function(){return this._dimension};Nn.prototype.getX=function(n){return this._coordinates[n].x};Nn.prototype.clone=function(){for(var n=this,u=new Array(this.size()).fill(null),p=0;p<this._coordinates.length;p++)u[p]=n._coordinates[p].clone();return new Nn(u,this._dimension)};Nn.prototype.expandEnvelope=function(n){for(var u=this,p=0;p<this._coordinates.length;p++)n.expandToInclude(u._coordinates[p]);return n};Nn.prototype.copy=function(){for(var n=this,u=new Array(this.size()).fill(null),p=0;p<this._coordinates.length;p++)u[p]=n._coordinates[p].copy();return new Nn(u,this._dimension)};Nn.prototype.toString=function(){var n=this;if(this._coordinates.length>0){var u=new Ws(17*this._coordinates.length);u.append("("),u.append(this._coordinates[0]);for(var p=1;p<this._coordinates.length;p++)u.append(", "),u.append(n._coordinates[p]);return u.append(")"),u.toString()}else return"()"};Nn.prototype.getY=function(n){return this._coordinates[n].y};Nn.prototype.toCoordinateArray=function(){return this._coordinates};Nn.prototype.interfaces_=function(){return[Cr,Wo]};Nn.prototype.getClass=function(){return Nn};zE.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Nn,zE);var _a=function(){},s0={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};_a.prototype.readResolve=function(){return _a.instance()};_a.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return new Nn(n)}else if(Ke(arguments[0],Cr)){var u=arguments[0];return new Nn(u)}}else if(arguments.length===2){var p=arguments[0],m=arguments[1];return m>3&&(m=3),m<2?new Nn(p):new Nn(p,m)}};_a.prototype.interfaces_=function(){return[pp,Wo]};_a.prototype.getClass=function(){return _a};_a.instance=function(){return _a.instanceObject};s0.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};s0.instanceObject.get=function(){return new _a};Object.defineProperties(_a,s0);var NE=function(h){function n(){h.call(this),this.map_=new Map}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.get=function(p){return this.map_.get(p)||null},n.prototype.put=function(p,m){return this.map_.set(p,m),m},n.prototype.values=function(){for(var p=new be,m=this.map_.values(),b=m.next();!b.done;)p.add(b.value),b=m.next();return p},n.prototype.entrySet=function(){var p=new i0;return this.map_.entries().forEach(function(m){return p.add(m)}),p},n.prototype.size=function(){return this.map_.size()},n}(eh),Fr=function h(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=h.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Vs){var n=arguments[0];this._modelType=n,n===h.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var u=arguments[0];this._modelType=h.FIXED,this.setScale(u)}else if(arguments[0]instanceof h){var p=arguments[0];this._modelType=p._modelType,this._scale=p._scale}}},a0={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Fr.prototype.equals=function(n){if(!(n instanceof Fr))return!1;var u=n;return this._modelType===u._modelType&&this._scale===u._scale};Fr.prototype.compareTo=function(n){var u=n,p=this.getMaximumSignificantDigits(),m=u.getMaximumSignificantDigits();return new ks(p).compareTo(new ks(m))};Fr.prototype.getScale=function(){return this._scale};Fr.prototype.isFloating=function(){return this._modelType===Fr.FLOATING||this._modelType===Fr.FLOATING_SINGLE};Fr.prototype.getType=function(){return this._modelType};Fr.prototype.toString=function(){var n="UNKNOWN";return this._modelType===Fr.FLOATING?n="Floating":this._modelType===Fr.FLOATING_SINGLE?n="Floating-Single":this._modelType===Fr.FIXED&&(n="Fixed (Scale="+this.getScale()+")"),n};Fr.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var n=arguments[0];if(or.isNaN(n))return n;if(this._modelType===Fr.FLOATING_SINGLE){var u=n;return u}return this._modelType===Fr.FIXED?Math.round(n*this._scale)/this._scale:n}else if(arguments[0]instanceof It){var p=arguments[0];if(this._modelType===Fr.FLOATING)return null;p.x=this.makePrecise(p.x),p.y=this.makePrecise(p.y)}};Fr.prototype.getMaximumSignificantDigits=function(){var n=16;return this._modelType===Fr.FLOATING?n=16:this._modelType===Fr.FLOATING_SINGLE?n=6:this._modelType===Fr.FIXED&&(n=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),n};Fr.prototype.setScale=function(n){this._scale=Math.abs(n)};Fr.prototype.interfaces_=function(){return[Wo,Xo]};Fr.prototype.getClass=function(){return Fr};Fr.mostPrecise=function(n,u){return n.compareTo(u)>=0?n:u};a0.serialVersionUID.get=function(){return 7777263578777804e3};a0.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Fr,a0);var Vs=function h(n){this._name=n||null,h.nameToTypeMap.put(n,this)},l0={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Vs.prototype.readResolve=function(){return Vs.nameToTypeMap.get(this._name)};Vs.prototype.toString=function(){return this._name};Vs.prototype.interfaces_=function(){return[Wo]};Vs.prototype.getClass=function(){return Vs};l0.serialVersionUID.get=function(){return-552860263173159e4};l0.nameToTypeMap.get=function(){return new NE};Object.defineProperties(Vs,l0);Fr.Type=Vs;Fr.FIXED=new Vs("FIXED");Fr.FLOATING=new Vs("FLOATING");Fr.FLOATING_SINGLE=new Vs("FLOATING SINGLE");var _r=function h(){this._precisionModel=new Fr,this._SRID=0,this._coordinateSequenceFactory=h.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?Ke(arguments[0],pp)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Fr&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},kE={serialVersionUID:{configurable:!0}};_r.prototype.toGeometry=function(n){return n.isNull()?this.createPoint(null):n.getMinX()===n.getMaxX()&&n.getMinY()===n.getMaxY()?this.createPoint(new It(n.getMinX(),n.getMinY())):n.getMinX()===n.getMaxX()||n.getMinY()===n.getMaxY()?this.createLineString([new It(n.getMinX(),n.getMinY()),new It(n.getMaxX(),n.getMaxY())]):this.createPolygon(this.createLinearRing([new It(n.getMinX(),n.getMinY()),new It(n.getMinX(),n.getMaxY()),new It(n.getMaxX(),n.getMaxY()),new It(n.getMaxX(),n.getMinY()),new It(n.getMinX(),n.getMinY())]),null)};_r.prototype.createLineString=function(n){if(n){if(n instanceof Array)return new Mn(this.getCoordinateSequenceFactory().create(n),this);if(Ke(n,Cr))return new Mn(n,this)}else return new Mn(this.getCoordinateSequenceFactory().create([]),this)};_r.prototype.createMultiLineString=function(){if(arguments.length===0)return new ku(null,this);if(arguments.length===1){var n=arguments[0];return new ku(n,this)}};_r.prototype.buildGeometry=function(n){for(var u=null,p=!1,m=!1,b=n.iterator();b.hasNext();){var T=b.next(),s=T.getClass();u===null&&(u=s),s!==u&&(p=!0),T.isGeometryCollectionOrDerived()&&(m=!0)}if(u===null)return this.createGeometryCollection();if(p||m)return this.createGeometryCollection(_r.toGeometryArray(n));var O=n.iterator().next(),V=n.size()>1;if(V){if(O instanceof Kn)return this.createMultiPolygon(_r.toPolygonArray(n));if(O instanceof Mn)return this.createMultiLineString(_r.toLineStringArray(n));if(O instanceof ho)return this.createMultiPoint(_r.toPointArray(n));pr.shouldNeverReachHere("Unhandled class: "+O.getClass().getName())}return O};_r.prototype.createMultiPointFromCoords=function(n){return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)};_r.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof It){var n=arguments[0];return this.createPoint(n!==null?this.getCoordinateSequenceFactory().create([n]):null)}else if(Ke(arguments[0],Cr)){var u=arguments[0];return new ho(u,this)}}};_r.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};_r.prototype.createPolygon=function(){if(arguments.length===0)return new Kn(null,null,this);if(arguments.length===1){if(Ke(arguments[0],Cr)){var n=arguments[0];return this.createPolygon(this.createLinearRing(n))}else if(arguments[0]instanceof Array){var u=arguments[0];return this.createPolygon(this.createLinearRing(u))}else if(arguments[0]instanceof ga){var p=arguments[0];return this.createPolygon(p,null)}}else if(arguments.length===2){var m=arguments[0],b=arguments[1];return new Kn(m,b,this)}};_r.prototype.getSRID=function(){return this._SRID};_r.prototype.createGeometryCollection=function(){if(arguments.length===0)return new ki(null,this);if(arguments.length===1){var n=arguments[0];return new ki(n,this)}};_r.prototype.createGeometry=function(n){var u=new qo(this);return u.edit(n,{edit:function(){if(arguments.length===2){var p=arguments[0];return this._coordinateSequenceFactory.create(p)}}})};_r.prototype.getPrecisionModel=function(){return this._precisionModel};_r.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return this.createLinearRing(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(Ke(arguments[0],Cr)){var u=arguments[0];return new ga(u,this)}}};_r.prototype.createMultiPolygon=function(){if(arguments.length===0)return new fa(null,this);if(arguments.length===1){var n=arguments[0];return new fa(n,this)}};_r.prototype.createMultiPoint=function(){var n=this;if(arguments.length===0)return new yp(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var u=arguments[0];return new yp(u,this)}else if(arguments[0]instanceof Array){var p=arguments[0];return this.createMultiPoint(p!==null?this.getCoordinateSequenceFactory().create(p):null)}else if(Ke(arguments[0],Cr)){var m=arguments[0];if(m===null)return this.createMultiPoint(new Array(0).fill(null));for(var b=new Array(m.size()).fill(null),T=0;T<m.size();T++){var s=n.getCoordinateSequenceFactory().create(1,m.getDimension());Fn.copy(m,T,s,0,1),b[T]=n.createPoint(s)}return this.createMultiPoint(b)}}};_r.prototype.interfaces_=function(){return[Wo]};_r.prototype.getClass=function(){return _r};_r.toMultiPolygonArray=function(n){var u=new Array(n.size()).fill(null);return n.toArray(u)};_r.toGeometryArray=function(n){if(n===null)return null;var u=new Array(n.size()).fill(null);return n.toArray(u)};_r.getDefaultCoordinateSequenceFactory=function(){return _a.instance()};_r.toMultiLineStringArray=function(n){var u=new Array(n.size()).fill(null);return n.toArray(u)};_r.toLineStringArray=function(n){var u=new Array(n.size()).fill(null);return n.toArray(u)};_r.toMultiPointArray=function(n){var u=new Array(n.size()).fill(null);return n.toArray(u)};_r.toLinearRingArray=function(n){var u=new Array(n.size()).fill(null);return n.toArray(u)};_r.toPointArray=function(n){var u=new Array(n.size()).fill(null);return n.toArray(u)};_r.toPolygonArray=function(n){var u=new Array(n.size()).fill(null);return n.toArray(u)};_r.createPointFromInternalCoord=function(n,u){return u.getPrecisionModel().makePrecise(n),u.getFactory().createPoint(n)};kE.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(_r,kE);var MC=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],f_=function(n){this.geometryFactory=n||new _r};f_.prototype.read=function(n){var u;typeof n=="string"?u=JSON.parse(n):u=n;var p=u.type;if(!Rs[p])throw new Error("Unknown GeoJSON type: "+u.type);return MC.indexOf(p)!==-1?Rs[p].apply(this,[u.coordinates]):p==="GeometryCollection"?Rs[p].apply(this,[u.geometries]):Rs[p].apply(this,[u])};f_.prototype.write=function(n){var u=n.getGeometryType();if(!Ja[u])throw new Error("Geometry is not supported");return Ja[u].apply(this,[n])};var Rs={Feature:function(h){var n={};for(var u in h)n[u]=h[u];if(h.geometry){var p=h.geometry.type;if(!Rs[p])throw new Error("Unknown GeoJSON type: "+h.type);n.geometry=this.read(h.geometry)}return h.bbox&&(n.bbox=Rs.bbox.apply(this,[h.bbox])),n},FeatureCollection:function(h){var n=this,u={};if(h.features){u.features=[];for(var p=0;p<h.features.length;++p)u.features.push(n.read(h.features[p]))}return h.bbox&&(u.bbox=this.parse.bbox.apply(this,[h.bbox])),u},coordinates:function(h){for(var n=[],u=0;u<h.length;++u){var p=h[u];n.push(new It(p[0],p[1]))}return n},bbox:function(h){return this.geometryFactory.createLinearRing([new It(h[0],h[1]),new It(h[2],h[1]),new It(h[2],h[3]),new It(h[0],h[3]),new It(h[0],h[1])])},Point:function(h){var n=new It(h[0],h[1]);return this.geometryFactory.createPoint(n)},MultiPoint:function(h){for(var n=this,u=[],p=0;p<h.length;++p)u.push(Rs.Point.apply(n,[h[p]]));return this.geometryFactory.createMultiPoint(u)},LineString:function(h){var n=Rs.coordinates.apply(this,[h]);return this.geometryFactory.createLineString(n)},MultiLineString:function(h){for(var n=this,u=[],p=0;p<h.length;++p)u.push(Rs.LineString.apply(n,[h[p]]));return this.geometryFactory.createMultiLineString(u)},Polygon:function(h){for(var n=this,u=Rs.coordinates.apply(this,[h[0]]),p=this.geometryFactory.createLinearRing(u),m=[],b=1;b<h.length;++b){var T=h[b],s=Rs.coordinates.apply(n,[T]),O=n.geometryFactory.createLinearRing(s);m.push(O)}return this.geometryFactory.createPolygon(p,m)},MultiPolygon:function(h){for(var n=this,u=[],p=0;p<h.length;++p){var m=h[p];u.push(Rs.Polygon.apply(n,[m]))}return this.geometryFactory.createMultiPolygon(u)},GeometryCollection:function(h){for(var n=this,u=[],p=0;p<h.length;++p){var m=h[p];u.push(n.read(m))}return this.geometryFactory.createGeometryCollection(u)}},Ja={coordinate:function(h){return[h.x,h.y]},Point:function(h){var n=Ja.coordinate.apply(this,[h.getCoordinate()]);return{type:"Point",coordinates:n}},MultiPoint:function(h){for(var n=this,u=[],p=0;p<h._geometries.length;++p){var m=h._geometries[p],b=Ja.Point.apply(n,[m]);u.push(b.coordinates)}return{type:"MultiPoint",coordinates:u}},LineString:function(h){for(var n=this,u=[],p=h.getCoordinates(),m=0;m<p.length;++m){var b=p[m];u.push(Ja.coordinate.apply(n,[b]))}return{type:"LineString",coordinates:u}},MultiLineString:function(h){for(var n=this,u=[],p=0;p<h._geometries.length;++p){var m=h._geometries[p],b=Ja.LineString.apply(n,[m]);u.push(b.coordinates)}return{type:"MultiLineString",coordinates:u}},Polygon:function(h){var n=this,u=[],p=Ja.LineString.apply(this,[h._shell]);u.push(p.coordinates);for(var m=0;m<h._holes.length;++m){var b=h._holes[m],T=Ja.LineString.apply(n,[b]);u.push(T.coordinates)}return{type:"Polygon",coordinates:u}},MultiPolygon:function(h){for(var n=this,u=[],p=0;p<h._geometries.length;++p){var m=h._geometries[p],b=Ja.Polygon.apply(n,[m]);u.push(b.coordinates)}return{type:"MultiPolygon",coordinates:u}},GeometryCollection:function(h){for(var n=this,u=[],p=0;p<h._geometries.length;++p){var m=h._geometries[p],b=m.getGeometryType();u.push(Ja[b].apply(n,[m]))}return{type:"GeometryCollection",geometries:u}}},u0=function(n){this.geometryFactory=n||new _r,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new f_(this.geometryFactory)};u0.prototype.read=function(n){var u=this.parser.read(n);return this.precisionModel.getType()===Fr.FIXED&&this.reducePrecision(u),u};u0.prototype.reducePrecision=function(n){var u=this,p,m;if(n.coordinate)this.precisionModel.makePrecise(n.coordinate);else if(n.points)for(p=0,m=n.points.length;p<m;p++)u.precisionModel.makePrecise(n.points[p]);else if(n.geometries)for(p=0,m=n.geometries.length;p<m;p++)u.reducePrecision(n.geometries[p])};var FE=function(){this.parser=new f_(this.geometryFactory)};FE.prototype.write=function(n){return this.parser.write(n)};var pe=function(){},d_={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};pe.prototype.interfaces_=function(){return[]};pe.prototype.getClass=function(){return pe};pe.opposite=function(n){return n===pe.LEFT?pe.RIGHT:n===pe.RIGHT?pe.LEFT:n};d_.ON.get=function(){return 0};d_.LEFT.get=function(){return 1};d_.RIGHT.get=function(){return 2};Object.defineProperties(pe,d_);function m_(h){this.message=h||""}m_.prototype=new Error;m_.prototype.name="EmptyStackException";function Hs(){this.array_=[]}Hs.prototype=new cs;Hs.prototype.add=function(h){return this.array_.push(h),!0};Hs.prototype.get=function(h){if(h<0||h>=this.size())throw new Error;return this.array_[h]};Hs.prototype.push=function(h){return this.array_.push(h),h};Hs.prototype.pop=function(h){if(this.array_.length===0)throw new m_;return this.array_.pop()};Hs.prototype.peek=function(){if(this.array_.length===0)throw new m_;return this.array_[this.array_.length-1]};Hs.prototype.empty=function(){return this.array_.length===0};Hs.prototype.isEmpty=function(){return this.empty()};Hs.prototype.search=function(h){return this.array_.indexOf(h)};Hs.prototype.size=function(){return this.array_.length};Hs.prototype.toArray=function(){for(var h=this,n=[],u=0,p=this.array_.length;u<p;u++)n.push(h.array_[u]);return n};var Us=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Us.prototype.getCoordinate=function(){return this._minCoord};Us.prototype.getRightmostSide=function(n,u){var p=this.getRightmostSideOfSegment(n,u);return p<0&&(p=this.getRightmostSideOfSegment(n,u-1)),p<0&&(this._minCoord=null,this.checkForRightmostCoordinate(n)),p};Us.prototype.findRightmostEdgeAtVertex=function(){var n=this._minDe.getEdge().getCoordinates();pr.isTrue(this._minIndex>0&&this._minIndex<n.length,"rightmost point expected to be interior vertex of edge");var u=n[this._minIndex-1],p=n[this._minIndex+1],m=Ce.computeOrientation(this._minCoord,p,u),b=!1;(u.y<this._minCoord.y&&p.y<this._minCoord.y&&m===Ce.COUNTERCLOCKWISE||u.y>this._minCoord.y&&p.y>this._minCoord.y&&m===Ce.CLOCKWISE)&&(b=!0),b&&(this._minIndex=this._minIndex-1)};Us.prototype.getRightmostSideOfSegment=function(n,u){var p=n.getEdge(),m=p.getCoordinates();if(u<0||u+1>=m.length||m[u].y===m[u+1].y)return-1;var b=pe.LEFT;return m[u].y<m[u+1].y&&(b=pe.RIGHT),b};Us.prototype.getEdge=function(){return this._orientedDe};Us.prototype.checkForRightmostCoordinate=function(n){for(var u=this,p=n.getEdge().getCoordinates(),m=0;m<p.length-1;m++)(u._minCoord===null||p[m].x>u._minCoord.x)&&(u._minDe=n,u._minIndex=m,u._minCoord=p[m])};Us.prototype.findRightmostEdgeAtNode=function(){var n=this._minDe.getNode(),u=n.getEdges();this._minDe=u.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};Us.prototype.findEdge=function(n){for(var u=this,p=n.iterator();p.hasNext();){var m=p.next();m.isForward()&&u.checkForRightmostCoordinate(m)}pr.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var b=this.getRightmostSide(this._minDe,this._minIndex);b===pe.LEFT&&(this._orientedDe=this._minDe.getSym())};Us.prototype.interfaces_=function(){return[]};Us.prototype.getClass=function(){return Us};var nl=function(h){function n(u,p){h.call(this,n.msgWithCoord(u,p)),this.pt=p?new It(p):null,this.name="TopologyException"}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.getCoordinate=function(){return this.pt},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.msgWithCoord=function(p,m){return m?p:p+" [ "+m+" ]"},n}(el),g_=function(){this.array_=[]};g_.prototype.addLast=function(n){this.array_.push(n)};g_.prototype.removeFirst=function(){return this.array_.shift()};g_.prototype.isEmpty=function(){return this.array_.length===0};var Fi=function(){this._finder=null,this._dirEdgeList=new be,this._nodes=new be,this._rightMostCoord=null,this._env=null,this._finder=new Us};Fi.prototype.clearVisitedEdges=function(){for(var n=this._dirEdgeList.iterator();n.hasNext();){var u=n.next();u.setVisited(!1)}};Fi.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Fi.prototype.computeNodeDepth=function(n){for(var u=this,p=null,m=n.getEdges().iterator();m.hasNext();){var b=m.next();if(b.isVisited()||b.getSym().isVisited()){p=b;break}}if(p===null)throw new nl("unable to find edge to compute depths at "+n.getCoordinate());n.getEdges().computeDepths(p);for(var T=n.getEdges().iterator();T.hasNext();){var s=T.next();s.setVisited(!0),u.copySymDepths(s)}};Fi.prototype.computeDepth=function(n){this.clearVisitedEdges();var u=this._finder.getEdge();u.setEdgeDepths(pe.RIGHT,n),this.copySymDepths(u),this.computeDepths(u)};Fi.prototype.create=function(n){this.addReachable(n),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Fi.prototype.findResultEdges=function(){for(var n=this._dirEdgeList.iterator();n.hasNext();){var u=n.next();u.getDepth(pe.RIGHT)>=1&&u.getDepth(pe.LEFT)<=0&&!u.isInteriorAreaEdge()&&u.setInResult(!0)}};Fi.prototype.computeDepths=function(n){var u=this,p=new i0,m=new g_,b=n.getNode();for(m.addLast(b),p.add(b),n.setVisited(!0);!m.isEmpty();){var T=m.removeFirst();p.add(T),u.computeNodeDepth(T);for(var s=T.getEdges().iterator();s.hasNext();){var O=s.next(),V=O.getSym();if(!V.isVisited()){var G=V.getNode();p.contains(G)||(m.addLast(G),p.add(G))}}}};Fi.prototype.compareTo=function(n){var u=n;return this._rightMostCoord.x<u._rightMostCoord.x?-1:this._rightMostCoord.x>u._rightMostCoord.x?1:0};Fi.prototype.getEnvelope=function(){if(this._env===null){for(var n=new Be,u=this._dirEdgeList.iterator();u.hasNext();)for(var p=u.next(),m=p.getEdge().getCoordinates(),b=0;b<m.length-1;b++)n.expandToInclude(m[b]);this._env=n}return this._env};Fi.prototype.addReachable=function(n){var u=this,p=new Hs;for(p.add(n);!p.empty();){var m=p.pop();u.add(m,p)}};Fi.prototype.copySymDepths=function(n){var u=n.getSym();u.setDepth(pe.LEFT,n.getDepth(pe.RIGHT)),u.setDepth(pe.RIGHT,n.getDepth(pe.LEFT))};Fi.prototype.add=function(n,u){var p=this;n.setVisited(!0),this._nodes.add(n);for(var m=n.getEdges().iterator();m.hasNext();){var b=m.next();p._dirEdgeList.add(b);var T=b.getSym(),s=T.getNode();s.isVisited()||u.push(s)}};Fi.prototype.getNodes=function(){return this._nodes};Fi.prototype.getDirectedEdges=function(){return this._dirEdgeList};Fi.prototype.interfaces_=function(){return[Xo]};Fi.prototype.getClass=function(){return Fi};var cn=function h(){var n=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var u=arguments[0];this.init(u.length)}else if(Number.isInteger(arguments[0])){var p=arguments[0];this.init(1),this.location[pe.ON]=p}else if(arguments[0]instanceof h){var m=arguments[0];if(this.init(m.location.length),m!==null)for(var b=0;b<this.location.length;b++)n.location[b]=m.location[b]}}else if(arguments.length===3){var T=arguments[0],s=arguments[1],O=arguments[2];this.init(3),this.location[pe.ON]=T,this.location[pe.LEFT]=s,this.location[pe.RIGHT]=O}};cn.prototype.setAllLocations=function(n){for(var u=this,p=0;p<this.location.length;p++)u.location[p]=n};cn.prototype.isNull=function(){for(var n=this,u=0;u<this.location.length;u++)if(n.location[u]!==Ct.NONE)return!1;return!0};cn.prototype.setAllLocationsIfNull=function(n){for(var u=this,p=0;p<this.location.length;p++)u.location[p]===Ct.NONE&&(u.location[p]=n)};cn.prototype.isLine=function(){return this.location.length===1};cn.prototype.merge=function(n){var u=this;if(n.location.length>this.location.length){var p=new Array(3).fill(null);p[pe.ON]=this.location[pe.ON],p[pe.LEFT]=Ct.NONE,p[pe.RIGHT]=Ct.NONE,this.location=p}for(var m=0;m<this.location.length;m++)u.location[m]===Ct.NONE&&m<n.location.length&&(u.location[m]=n.location[m])};cn.prototype.getLocations=function(){return this.location};cn.prototype.flip=function(){if(this.location.length<=1)return null;var n=this.location[pe.LEFT];this.location[pe.LEFT]=this.location[pe.RIGHT],this.location[pe.RIGHT]=n};cn.prototype.toString=function(){var n=new Ws;return this.location.length>1&&n.append(Ct.toLocationSymbol(this.location[pe.LEFT])),n.append(Ct.toLocationSymbol(this.location[pe.ON])),this.location.length>1&&n.append(Ct.toLocationSymbol(this.location[pe.RIGHT])),n.toString()};cn.prototype.setLocations=function(n,u,p){this.location[pe.ON]=n,this.location[pe.LEFT]=u,this.location[pe.RIGHT]=p};cn.prototype.get=function(n){return n<this.location.length?this.location[n]:Ct.NONE};cn.prototype.isArea=function(){return this.location.length>1};cn.prototype.isAnyNull=function(){for(var n=this,u=0;u<this.location.length;u++)if(n.location[u]===Ct.NONE)return!0;return!1};cn.prototype.setLocation=function(){if(arguments.length===1){var n=arguments[0];this.setLocation(pe.ON,n)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];this.location[u]=p}};cn.prototype.init=function(n){this.location=new Array(n).fill(null),this.setAllLocations(Ct.NONE)};cn.prototype.isEqualOnSide=function(n,u){return this.location[u]===n.location[u]};cn.prototype.allPositionsEqual=function(n){for(var u=this,p=0;p<this.location.length;p++)if(u.location[p]!==n)return!1;return!0};cn.prototype.interfaces_=function(){return[]};cn.prototype.getClass=function(){return cn};var qr=function h(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var n=arguments[0];this.elt[0]=new cn(n),this.elt[1]=new cn(n)}else if(arguments[0]instanceof h){var u=arguments[0];this.elt[0]=new cn(u.elt[0]),this.elt[1]=new cn(u.elt[1])}}else if(arguments.length===2){var p=arguments[0],m=arguments[1];this.elt[0]=new cn(Ct.NONE),this.elt[1]=new cn(Ct.NONE),this.elt[p].setLocation(m)}else if(arguments.length===3){var b=arguments[0],T=arguments[1],s=arguments[2];this.elt[0]=new cn(b,T,s),this.elt[1]=new cn(b,T,s)}else if(arguments.length===4){var O=arguments[0],V=arguments[1],G=arguments[2],it=arguments[3];this.elt[0]=new cn(Ct.NONE,Ct.NONE,Ct.NONE),this.elt[1]=new cn(Ct.NONE,Ct.NONE,Ct.NONE),this.elt[O].setLocations(V,G,it)}};qr.prototype.getGeometryCount=function(){var n=0;return this.elt[0].isNull()||n++,this.elt[1].isNull()||n++,n};qr.prototype.setAllLocations=function(n,u){this.elt[n].setAllLocations(u)};qr.prototype.isNull=function(n){return this.elt[n].isNull()};qr.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var n=arguments[0];this.setAllLocationsIfNull(0,n),this.setAllLocationsIfNull(1,n)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];this.elt[u].setAllLocationsIfNull(p)}};qr.prototype.isLine=function(n){return this.elt[n].isLine()};qr.prototype.merge=function(n){for(var u=this,p=0;p<2;p++)u.elt[p]===null&&n.elt[p]!==null?u.elt[p]=new cn(n.elt[p]):u.elt[p].merge(n.elt[p])};qr.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};qr.prototype.getLocation=function(){if(arguments.length===1){var n=arguments[0];return this.elt[n].get(pe.ON)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];return this.elt[u].get(p)}};qr.prototype.toString=function(){var n=new Ws;return this.elt[0]!==null&&(n.append("A:"),n.append(this.elt[0].toString())),this.elt[1]!==null&&(n.append(" B:"),n.append(this.elt[1].toString())),n.toString()};qr.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var n=arguments[0];return this.elt[n].isArea()}};qr.prototype.isAnyNull=function(n){return this.elt[n].isAnyNull()};qr.prototype.setLocation=function(){if(arguments.length===2){var n=arguments[0],u=arguments[1];this.elt[n].setLocation(pe.ON,u)}else if(arguments.length===3){var p=arguments[0],m=arguments[1],b=arguments[2];this.elt[p].setLocation(m,b)}};qr.prototype.isEqualOnSide=function(n,u){return this.elt[0].isEqualOnSide(n.elt[0],u)&&this.elt[1].isEqualOnSide(n.elt[1],u)};qr.prototype.allPositionsEqual=function(n,u){return this.elt[n].allPositionsEqual(u)};qr.prototype.toLine=function(n){this.elt[n].isArea()&&(this.elt[n]=new cn(this.elt[n].location[0]))};qr.prototype.interfaces_=function(){return[]};qr.prototype.getClass=function(){return qr};qr.toLineLabel=function(n){for(var u=new qr(Ct.NONE),p=0;p<2;p++)u.setLocation(p,n.getLocation(p));return u};var qn=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new be,this._pts=new be,this._label=new qr(Ct.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new be,this._geometryFactory=null;var n=arguments[0],u=arguments[1];this._geometryFactory=u,this.computePoints(n),this.computeRing()};qn.prototype.computeRing=function(){var n=this;if(this._ring!==null)return null;for(var u=new Array(this._pts.size()).fill(null),p=0;p<this._pts.size();p++)u[p]=n._pts.get(p);this._ring=this._geometryFactory.createLinearRing(u),this._isHole=Ce.isCCW(this._ring.getCoordinates())};qn.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};qn.prototype.computePoints=function(n){var u=this;this._startDe=n;var p=n,m=!0;do{if(p===null)throw new nl("Found null DirectedEdge");if(p.getEdgeRing()===u)throw new nl("Directed Edge visited twice during ring-building at "+p.getCoordinate());u._edges.add(p);var b=p.getLabel();pr.isTrue(b.isArea()),u.mergeLabel(b),u.addPoints(p.getEdge(),p.isForward(),m),m=!1,u.setEdgeRing(p,u),p=u.getNext(p)}while(p!==this._startDe)};qn.prototype.getLinearRing=function(){return this._ring};qn.prototype.getCoordinate=function(n){return this._pts.get(n)};qn.prototype.computeMaxNodeDegree=function(){var n=this;this._maxNodeDegree=0;var u=this._startDe;do{var p=u.getNode(),m=p.getEdges().getOutgoingDegree(n);m>n._maxNodeDegree&&(n._maxNodeDegree=m),u=n.getNext(u)}while(u!==this._startDe);this._maxNodeDegree*=2};qn.prototype.addPoints=function(n,u,p){var m=this,b=n.getCoordinates();if(u){var T=1;p&&(T=0);for(var s=T;s<b.length;s++)m._pts.add(b[s])}else{var O=b.length-2;p&&(O=b.length-1);for(var V=O;V>=0;V--)m._pts.add(b[V])}};qn.prototype.isHole=function(){return this._isHole};qn.prototype.setInResult=function(){var n=this._startDe;do n.getEdge().setInResult(!0),n=n.getNext();while(n!==this._startDe)};qn.prototype.containsPoint=function(n){var u=this.getLinearRing(),p=u.getEnvelopeInternal();if(!p.contains(n)||!Ce.isPointInRing(n,u.getCoordinates()))return!1;for(var m=this._holes.iterator();m.hasNext();){var b=m.next();if(b.containsPoint(n))return!1}return!0};qn.prototype.addHole=function(n){this._holes.add(n)};qn.prototype.isShell=function(){return this._shell===null};qn.prototype.getLabel=function(){return this._label};qn.prototype.getEdges=function(){return this._edges};qn.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};qn.prototype.getShell=function(){return this._shell};qn.prototype.mergeLabel=function(){if(arguments.length===1){var n=arguments[0];this.mergeLabel(n,0),this.mergeLabel(n,1)}else if(arguments.length===2){var u=arguments[0],p=arguments[1],m=u.getLocation(p,pe.RIGHT);if(m===Ct.NONE)return null;if(this._label.getLocation(p)===Ct.NONE)return this._label.setLocation(p,m),null}};qn.prototype.setShell=function(n){this._shell=n,n!==null&&n.addHole(this)};qn.prototype.toPolygon=function(n){for(var u=this,p=new Array(this._holes.size()).fill(null),m=0;m<this._holes.size();m++)p[m]=u._holes.get(m).getLinearRing();var b=n.createPolygon(this.getLinearRing(),p);return b};qn.prototype.interfaces_=function(){return[]};qn.prototype.getClass=function(){return qn};var AC=function(h){function n(){var u=arguments[0],p=arguments[1];h.call(this,u,p)}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.setEdgeRing=function(p,m){p.setMinEdgeRing(m)},n.prototype.getNext=function(p){return p.getNextMin()},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(qn),PC=function(h){function n(){var u=arguments[0],p=arguments[1];h.call(this,u,p)}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.buildMinimalRings=function(){var p=this,m=new be,b=this._startDe;do{if(b.getMinEdgeRing()===null){var T=new AC(b,p._geometryFactory);m.add(T)}b=b.getNext()}while(b!==this._startDe);return m},n.prototype.setEdgeRing=function(p,m){p.setEdgeRing(m)},n.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var p=this,m=this._startDe;do{var b=m.getNode();b.getEdges().linkMinimalDirectedEdges(p),m=m.getNext()}while(m!==this._startDe)},n.prototype.getNext=function(p){return p.getNext()},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(qn),Io=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var n=arguments[0];this._label=n}}};Io.prototype.setVisited=function(n){this._isVisited=n};Io.prototype.setInResult=function(n){this._isInResult=n};Io.prototype.isCovered=function(){return this._isCovered};Io.prototype.isCoveredSet=function(){return this._isCoveredSet};Io.prototype.setLabel=function(n){this._label=n};Io.prototype.getLabel=function(){return this._label};Io.prototype.setCovered=function(n){this._isCovered=n,this._isCoveredSet=!0};Io.prototype.updateIM=function(n){pr.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(n)};Io.prototype.isInResult=function(){return this._isInResult};Io.prototype.isVisited=function(){return this._isVisited};Io.prototype.interfaces_=function(){return[]};Io.prototype.getClass=function(){return Io};var __=function(h){function n(){h.call(this),this._coord=null,this._edges=null;var u=arguments[0],p=arguments[1];this._coord=u,this._edges=p,this._label=new qr(0,Ct.NONE)}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.isIncidentEdgeInResult=function(){for(var p=this.getEdges().getEdges().iterator();p.hasNext();){var m=p.next();if(m.getEdge().isInResult())return!0}return!1},n.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},n.prototype.getCoordinate=function(){return this._coord},n.prototype.print=function(p){p.println("node "+this._coord+" lbl: "+this._label)},n.prototype.computeIM=function(p){},n.prototype.computeMergedLocation=function(p,m){var b=Ct.NONE;if(b=this._label.getLocation(m),!p.isNull(m)){var T=p.getLocation(m);b!==Ct.BOUNDARY&&(b=T)}return b},n.prototype.setLabel=function(){if(arguments.length===2){var p=arguments[0],m=arguments[1];this._label===null?this._label=new qr(p,m):this._label.setLocation(p,m)}else return h.prototype.setLabel.apply(this,arguments)},n.prototype.getEdges=function(){return this._edges},n.prototype.mergeLabel=function(){var p=this;if(arguments[0]instanceof n){var m=arguments[0];this.mergeLabel(m._label)}else if(arguments[0]instanceof qr)for(var b=arguments[0],T=0;T<2;T++){var s=p.computeMergedLocation(b,T),O=p._label.getLocation(T);O===Ct.NONE&&p._label.setLocation(T,s)}},n.prototype.add=function(p){this._edges.insert(p),p.setNode(this)},n.prototype.setLabelBoundary=function(p){if(this._label===null)return null;var m=Ct.NONE;this._label!==null&&(m=this._label.getLocation(p));var b=null;switch(m){case Ct.BOUNDARY:b=Ct.INTERIOR;break;case Ct.INTERIOR:b=Ct.BOUNDARY;break;default:b=Ct.BOUNDARY;break}this._label.setLocation(p,b)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Io),Gs=function(){this.nodeMap=new Mi,this.nodeFact=null;var n=arguments[0];this.nodeFact=n};Gs.prototype.find=function(n){return this.nodeMap.get(n)};Gs.prototype.addNode=function(){if(arguments[0]instanceof It){var n=arguments[0],u=this.nodeMap.get(n);return u===null&&(u=this.nodeFact.createNode(n),this.nodeMap.put(n,u)),u}else if(arguments[0]instanceof __){var p=arguments[0],m=this.nodeMap.get(p.getCoordinate());return m===null?(this.nodeMap.put(p.getCoordinate(),p),p):(m.mergeLabel(p),m)}};Gs.prototype.print=function(n){for(var u=this.iterator();u.hasNext();){var p=u.next();p.print(n)}};Gs.prototype.iterator=function(){return this.nodeMap.values().iterator()};Gs.prototype.values=function(){return this.nodeMap.values()};Gs.prototype.getBoundaryNodes=function(n){for(var u=new be,p=this.iterator();p.hasNext();){var m=p.next();m.getLabel().getLocation(n)===Ct.BOUNDARY&&u.add(m)}return u};Gs.prototype.add=function(n){var u=n.getCoordinate(),p=this.addNode(u);p.add(n)};Gs.prototype.interfaces_=function(){return[]};Gs.prototype.getClass=function(){return Gs};var Yr=function(){},Gd={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Yr.prototype.interfaces_=function(){return[]};Yr.prototype.getClass=function(){return Yr};Yr.isNorthern=function(n){return n===Yr.NE||n===Yr.NW};Yr.isOpposite=function(n,u){if(n===u)return!1;var p=(n-u+4)%4;return p===2};Yr.commonHalfPlane=function(n,u){if(n===u)return n;var p=(n-u+4)%4;if(p===2)return-1;var m=n<u?n:u,b=n>u?n:u;return m===0&&b===3?3:m};Yr.isInHalfPlane=function(n,u){return u===Yr.SE?n===Yr.SE||n===Yr.SW:n===u||n===u+1};Yr.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],u=arguments[1];if(n===0&&u===0)throw new vn("Cannot compute the quadrant for point ( "+n+", "+u+" )");return n>=0?u>=0?Yr.NE:Yr.SE:u>=0?Yr.NW:Yr.SW}else if(arguments[0]instanceof It&&arguments[1]instanceof It){var p=arguments[0],m=arguments[1];if(m.x===p.x&&m.y===p.y)throw new vn("Cannot compute the quadrant for two identical points "+p);return m.x>=p.x?m.y>=p.y?Yr.NE:Yr.SE:m.y>=p.y?Yr.NW:Yr.SW}};Gd.NE.get=function(){return 0};Gd.NW.get=function(){return 1};Gd.SW.get=function(){return 2};Gd.SE.get=function(){return 3};Object.defineProperties(Yr,Gd);var Ai=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var n=arguments[0];this._edge=n}else if(arguments.length===3){var u=arguments[0],p=arguments[1],m=arguments[2],b=null;this._edge=u,this.init(p,m),this._label=b}else if(arguments.length===4){var T=arguments[0],s=arguments[1],O=arguments[2],V=arguments[3];this._edge=T,this.init(s,O),this._label=V}};Ai.prototype.compareDirection=function(n){return this._dx===n._dx&&this._dy===n._dy?0:this._quadrant>n._quadrant?1:this._quadrant<n._quadrant?-1:Ce.computeOrientation(n._p0,n._p1,this._p1)};Ai.prototype.getDy=function(){return this._dy};Ai.prototype.getCoordinate=function(){return this._p0};Ai.prototype.setNode=function(n){this._node=n};Ai.prototype.print=function(n){var u=Math.atan2(this._dy,this._dx),p=this.getClass().getName(),m=p.lastIndexOf("."),b=p.substring(m+1);n.print("  "+b+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+u+"   "+this._label)};Ai.prototype.compareTo=function(n){var u=n;return this.compareDirection(u)};Ai.prototype.getDirectedCoordinate=function(){return this._p1};Ai.prototype.getDx=function(){return this._dx};Ai.prototype.getLabel=function(){return this._label};Ai.prototype.getEdge=function(){return this._edge};Ai.prototype.getQuadrant=function(){return this._quadrant};Ai.prototype.getNode=function(){return this._node};Ai.prototype.toString=function(){var n=Math.atan2(this._dy,this._dx),u=this.getClass().getName(),p=u.lastIndexOf("."),m=u.substring(p+1);return"  "+m+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+n+"   "+this._label};Ai.prototype.computeLabel=function(n){};Ai.prototype.init=function(n,u){this._p0=n,this._p1=u,this._dx=u.x-n.x,this._dy=u.y-n.y,this._quadrant=Yr.quadrant(this._dx,this._dy),pr.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Ai.prototype.interfaces_=function(){return[Xo]};Ai.prototype.getClass=function(){return Ai};var Xv=function(h){function n(){var u=arguments[0],p=arguments[1];if(h.call(this,u),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=p,p)this.init(u.getCoordinate(0),u.getCoordinate(1));else{var m=u.getNumPoints()-1;this.init(u.getCoordinate(m),u.getCoordinate(m-1))}this.computeDirectedLabel()}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.getNextMin=function(){return this._nextMin},n.prototype.getDepth=function(p){return this._depth[p]},n.prototype.setVisited=function(p){this._isVisited=p},n.prototype.computeDirectedLabel=function(){this._label=new qr(this._edge.getLabel()),this._isForward||this._label.flip()},n.prototype.getNext=function(){return this._next},n.prototype.setDepth=function(p,m){if(this._depth[p]!==-999&&this._depth[p]!==m)throw new nl("assigned depths do not match",this.getCoordinate());this._depth[p]=m},n.prototype.isInteriorAreaEdge=function(){for(var p=this,m=!0,b=0;b<2;b++)p._label.isArea(b)&&p._label.getLocation(b,pe.LEFT)===Ct.INTERIOR&&p._label.getLocation(b,pe.RIGHT)===Ct.INTERIOR||(m=!1);return m},n.prototype.setNextMin=function(p){this._nextMin=p},n.prototype.print=function(p){h.prototype.print.call(this,p),p.print(" "+this._depth[pe.LEFT]+"/"+this._depth[pe.RIGHT]),p.print(" ("+this.getDepthDelta()+")"),this._isInResult&&p.print(" inResult")},n.prototype.setMinEdgeRing=function(p){this._minEdgeRing=p},n.prototype.isLineEdge=function(){var p=this._label.isLine(0)||this._label.isLine(1),m=!this._label.isArea(0)||this._label.allPositionsEqual(0,Ct.EXTERIOR),b=!this._label.isArea(1)||this._label.allPositionsEqual(1,Ct.EXTERIOR);return p&&m&&b},n.prototype.setEdgeRing=function(p){this._edgeRing=p},n.prototype.getMinEdgeRing=function(){return this._minEdgeRing},n.prototype.getDepthDelta=function(){var p=this._edge.getDepthDelta();return this._isForward||(p=-p),p},n.prototype.setInResult=function(p){this._isInResult=p},n.prototype.getSym=function(){return this._sym},n.prototype.isForward=function(){return this._isForward},n.prototype.getEdge=function(){return this._edge},n.prototype.printEdge=function(p){this.print(p),p.print(" "),this._isForward?this._edge.print(p):this._edge.printReverse(p)},n.prototype.setSym=function(p){this._sym=p},n.prototype.setVisitedEdge=function(p){this.setVisited(p),this._sym.setVisited(p)},n.prototype.setEdgeDepths=function(p,m){var b=this.getEdge().getDepthDelta();this._isForward||(b=-b);var T=1;p===pe.LEFT&&(T=-1);var s=pe.opposite(p),O=b*T,V=m+O;this.setDepth(p,m),this.setDepth(s,V)},n.prototype.getEdgeRing=function(){return this._edgeRing},n.prototype.isInResult=function(){return this._isInResult},n.prototype.setNext=function(p){this._next=p},n.prototype.isVisited=function(){return this._isVisited},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.depthFactor=function(p,m){return p===Ct.EXTERIOR&&m===Ct.INTERIOR?1:p===Ct.INTERIOR&&m===Ct.EXTERIOR?-1:0},n}(Ai),vp=function(){};vp.prototype.createNode=function(n){return new __(n,null)};vp.prototype.interfaces_=function(){return[]};vp.prototype.getClass=function(){return vp};var In=function(){if(this._edges=new be,this._nodes=null,this._edgeEndList=new be,arguments.length===0)this._nodes=new Gs(new vp);else if(arguments.length===1){var n=arguments[0];this._nodes=new Gs(n)}};In.prototype.printEdges=function(n){var u=this;n.println("Edges:");for(var p=0;p<this._edges.size();p++){n.println("edge "+p+":");var m=u._edges.get(p);m.print(n),m.eiList.print(n)}};In.prototype.find=function(n){return this._nodes.find(n)};In.prototype.addNode=function(){if(arguments[0]instanceof __){var n=arguments[0];return this._nodes.addNode(n)}else if(arguments[0]instanceof It){var u=arguments[0];return this._nodes.addNode(u)}};In.prototype.getNodeIterator=function(){return this._nodes.iterator()};In.prototype.linkResultDirectedEdges=function(){for(var n=this._nodes.iterator();n.hasNext();){var u=n.next();u.getEdges().linkResultDirectedEdges()}};In.prototype.debugPrintln=function(n){_i.out.println(n)};In.prototype.isBoundaryNode=function(n,u){var p=this._nodes.find(u);if(p===null)return!1;var m=p.getLabel();return m!==null&&m.getLocation(n)===Ct.BOUNDARY};In.prototype.linkAllDirectedEdges=function(){for(var n=this._nodes.iterator();n.hasNext();){var u=n.next();u.getEdges().linkAllDirectedEdges()}};In.prototype.matchInSameDirection=function(n,u,p,m){return n.equals(p)?Ce.computeOrientation(n,u,m)===Ce.COLLINEAR&&Yr.quadrant(n,u)===Yr.quadrant(p,m):!1};In.prototype.getEdgeEnds=function(){return this._edgeEndList};In.prototype.debugPrint=function(n){_i.out.print(n)};In.prototype.getEdgeIterator=function(){return this._edges.iterator()};In.prototype.findEdgeInSameDirection=function(n,u){for(var p=this,m=0;m<this._edges.size();m++){var b=p._edges.get(m),T=b.getCoordinates();if(p.matchInSameDirection(n,u,T[0],T[1])||p.matchInSameDirection(n,u,T[T.length-1],T[T.length-2]))return b}return null};In.prototype.insertEdge=function(n){this._edges.add(n)};In.prototype.findEdgeEnd=function(n){for(var u=this.getEdgeEnds().iterator();u.hasNext();){var p=u.next();if(p.getEdge()===n)return p}return null};In.prototype.addEdges=function(n){for(var u=this,p=n.iterator();p.hasNext();){var m=p.next();u._edges.add(m);var b=new Xv(m,!0),T=new Xv(m,!1);b.setSym(T),T.setSym(b),u.add(b),u.add(T)}};In.prototype.add=function(n){this._nodes.add(n),this._edgeEndList.add(n)};In.prototype.getNodes=function(){return this._nodes.values()};In.prototype.findEdge=function(n,u){for(var p=this,m=0;m<this._edges.size();m++){var b=p._edges.get(m),T=b.getCoordinates();if(n.equals(T[0])&&u.equals(T[1]))return b}return null};In.prototype.interfaces_=function(){return[]};In.prototype.getClass=function(){return In};In.linkResultDirectedEdges=function(n){for(var u=n.iterator();u.hasNext();){var p=u.next();p.getEdges().linkResultDirectedEdges()}};var po=function(){this._geometryFactory=null,this._shellList=new be;var n=arguments[0];this._geometryFactory=n};po.prototype.sortShellsAndHoles=function(n,u,p){for(var m=n.iterator();m.hasNext();){var b=m.next();b.isHole()?p.add(b):u.add(b)}};po.prototype.computePolygons=function(n){for(var u=this,p=new be,m=n.iterator();m.hasNext();){var b=m.next(),T=b.toPolygon(u._geometryFactory);p.add(T)}return p};po.prototype.placeFreeHoles=function(n,u){for(var p=this,m=u.iterator();m.hasNext();){var b=m.next();if(b.getShell()===null){var T=p.findEdgeRingContaining(b,n);if(T===null)throw new nl("unable to assign hole to a shell",b.getCoordinate(0));b.setShell(T)}}};po.prototype.buildMinimalEdgeRings=function(n,u,p){for(var m=this,b=new be,T=n.iterator();T.hasNext();){var s=T.next();if(s.getMaxNodeDegree()>2){s.linkDirectedEdgesForMinimalEdgeRings();var O=s.buildMinimalRings(),V=m.findShell(O);V!==null?(m.placePolygonHoles(V,O),u.add(V)):p.addAll(O)}else b.add(s)}return b};po.prototype.containsPoint=function(n){for(var u=this._shellList.iterator();u.hasNext();){var p=u.next();if(p.containsPoint(n))return!0}return!1};po.prototype.buildMaximalEdgeRings=function(n){for(var u=this,p=new be,m=n.iterator();m.hasNext();){var b=m.next();if(b.isInResult()&&b.getLabel().isArea()&&b.getEdgeRing()===null){var T=new PC(b,u._geometryFactory);p.add(T),T.setInResult()}}return p};po.prototype.placePolygonHoles=function(n,u){for(var p=u.iterator();p.hasNext();){var m=p.next();m.isHole()&&m.setShell(n)}};po.prototype.getPolygons=function(){var n=this.computePolygons(this._shellList);return n};po.prototype.findEdgeRingContaining=function(n,u){for(var p=n.getLinearRing(),m=p.getEnvelopeInternal(),b=p.getCoordinateN(0),T=null,s=null,O=u.iterator();O.hasNext();){var V=O.next(),G=V.getLinearRing(),it=G.getEnvelopeInternal();T!==null&&(s=T.getLinearRing().getEnvelopeInternal());var ot=!1;it.contains(m)&&Ce.isPointInRing(b,G.getCoordinates())&&(ot=!0),ot&&(T===null||s.contains(it))&&(T=V)}return T};po.prototype.findShell=function(n){for(var u=0,p=null,m=n.iterator();m.hasNext();){var b=m.next();b.isHole()||(p=b,u++)}return pr.isTrue(u<=1,"found two shells in MinimalEdgeRing list"),p};po.prototype.add=function(){if(arguments.length===1){var n=arguments[0];this.add(n.getEdgeEnds(),n.getNodes())}else if(arguments.length===2){var u=arguments[0],p=arguments[1];In.linkResultDirectedEdges(p);var m=this.buildMaximalEdgeRings(u),b=new be,T=this.buildMinimalEdgeRings(m,this._shellList,b);this.sortShellsAndHoles(T,this._shellList,b),this.placeFreeHoles(this._shellList,b)}};po.prototype.interfaces_=function(){return[]};po.prototype.getClass=function(){return po};var xp=function(){};xp.prototype.getBounds=function(){};xp.prototype.interfaces_=function(){return[]};xp.prototype.getClass=function(){return xp};var fs=function(){this._bounds=null,this._item=null;var n=arguments[0],u=arguments[1];this._bounds=n,this._item=u};fs.prototype.getItem=function(){return this._item};fs.prototype.getBounds=function(){return this._bounds};fs.prototype.interfaces_=function(){return[xp,Wo]};fs.prototype.getClass=function(){return fs};var il=function(){this._size=null,this._items=null,this._size=0,this._items=new be,this._items.add(null)};il.prototype.poll=function(){if(this.isEmpty())return null;var n=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),n};il.prototype.size=function(){return this._size};il.prototype.reorder=function(n){for(var u=this,p=null,m=this._items.get(n);n*2<=this._size&&(p=n*2,p!==u._size&&u._items.get(p+1).compareTo(u._items.get(p))<0&&p++,u._items.get(p).compareTo(m)<0);n=p)u._items.set(n,u._items.get(p));this._items.set(n,m)};il.prototype.clear=function(){this._size=0,this._items.clear()};il.prototype.isEmpty=function(){return this._size===0};il.prototype.add=function(n){var u=this;this._items.add(null),this._size+=1;var p=this._size;for(this._items.set(0,n);n.compareTo(this._items.get(Math.trunc(p/2)))<0;p/=2)u._items.set(p,u._items.get(Math.trunc(p/2)));this._items.set(p,n)};il.prototype.interfaces_=function(){return[]};il.prototype.getClass=function(){return il};var Wl=function(){};Wl.prototype.visitItem=function(n){};Wl.prototype.interfaces_=function(){return[]};Wl.prototype.getClass=function(){return Wl};var Uc=function(){};Uc.prototype.insert=function(n,u){};Uc.prototype.remove=function(n,u){};Uc.prototype.query=function(){};Uc.prototype.interfaces_=function(){return[]};Uc.prototype.getClass=function(){return Uc};var Jn=function(){if(this._childBoundables=new be,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var n=arguments[0];this._level=n}}},BE={serialVersionUID:{configurable:!0}};Jn.prototype.getLevel=function(){return this._level};Jn.prototype.size=function(){return this._childBoundables.size()};Jn.prototype.getChildBoundables=function(){return this._childBoundables};Jn.prototype.addChildBoundable=function(n){pr.isTrue(this._bounds===null),this._childBoundables.add(n)};Jn.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Jn.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Jn.prototype.interfaces_=function(){return[xp,Wo]};Jn.prototype.getClass=function(){return Jn};BE.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Jn,BE);var ds=function(){};ds.reverseOrder=function(){return{compare:function(u,p){return p.compareTo(u)}}};ds.min=function(n){return ds.sort(n),n.get(0)};ds.sort=function(n,u){var p=n.toArray();u?zu.sort(p,u):zu.sort(p);for(var m=n.iterator(),b=0,T=p.length;b<T;b++)m.next(),m.set(p[b])};ds.singletonList=function(n){var u=new be;return u.add(n),u};var Gn=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var n=arguments[0],u=arguments[1],p=arguments[2];this._boundable1=n,this._boundable2=u,this._itemDistance=p,this._distance=this.distance()};Gn.prototype.expandToQueue=function(n,u){var p=Gn.isComposite(this._boundable1),m=Gn.isComposite(this._boundable2);if(p&&m)return Gn.area(this._boundable1)>Gn.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,n,u),null):(this.expand(this._boundable2,this._boundable1,n,u),null);if(p)return this.expand(this._boundable1,this._boundable2,n,u),null;if(m)return this.expand(this._boundable2,this._boundable1,n,u),null;throw new vn("neither boundable is composite")};Gn.prototype.isLeaves=function(){return!(Gn.isComposite(this._boundable1)||Gn.isComposite(this._boundable2))};Gn.prototype.compareTo=function(n){var u=n;return this._distance<u._distance?-1:this._distance>u._distance?1:0};Gn.prototype.expand=function(n,u,p,m){for(var b=this,T=n.getChildBoundables(),s=T.iterator();s.hasNext();){var O=s.next(),V=new Gn(O,u,b._itemDistance);V.getDistance()<m&&p.add(V)}};Gn.prototype.getBoundable=function(n){return n===0?this._boundable1:this._boundable2};Gn.prototype.getDistance=function(){return this._distance};Gn.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Gn.prototype.interfaces_=function(){return[Xo]};Gn.prototype.getClass=function(){return Gn};Gn.area=function(n){return n.getBounds().getArea()};Gn.isComposite=function(n){return n instanceof Jn};var si=function h(){if(this._root=null,this._built=!1,this._itemBoundables=new be,this._nodeCapacity=null,arguments.length===0){var n=h.DEFAULT_NODE_CAPACITY;this._nodeCapacity=n}else if(arguments.length===1){var u=arguments[0];pr.isTrue(u>1,"Node capacity must be greater than 1"),this._nodeCapacity=u}},y_={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};si.prototype.getNodeCapacity=function(){return this._nodeCapacity};si.prototype.lastNode=function(n){return n.get(n.size()-1)};si.prototype.size=function(){var n=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var u=arguments[0],p=0,m=u.getChildBoundables().iterator();m.hasNext();){var b=m.next();b instanceof Jn?p+=n.size(b):b instanceof fs&&(p+=1)}return p}};si.prototype.removeItem=function(n,u){for(var p=null,m=n.getChildBoundables().iterator();m.hasNext();){var b=m.next();b instanceof fs&&b.getItem()===u&&(p=b)}return p!==null?(n.getChildBoundables().remove(p),!0):!1};si.prototype.itemsTree=function(){var n=this;if(arguments.length===0){this.build();var u=this.itemsTree(this._root);return u===null?new be:u}else if(arguments.length===1){for(var p=arguments[0],m=new be,b=p.getChildBoundables().iterator();b.hasNext();){var T=b.next();if(T instanceof Jn){var s=n.itemsTree(T);s!==null&&m.add(s)}else T instanceof fs?m.add(T.getItem()):pr.shouldNeverReachHere()}return m.size()<=0?null:m}};si.prototype.insert=function(n,u){pr.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new fs(n,u))};si.prototype.boundablesAtLevel=function(){var n=this;if(arguments.length===1){var u=arguments[0],p=new be;return this.boundablesAtLevel(u,this._root,p),p}else if(arguments.length===3){var m=arguments[0],b=arguments[1],T=arguments[2];if(pr.isTrue(m>-2),b.getLevel()===m)return T.add(b),null;for(var s=b.getChildBoundables().iterator();s.hasNext();){var O=s.next();O instanceof Jn?n.boundablesAtLevel(m,O,T):(pr.isTrue(O instanceof fs),m===-1&&T.add(O))}return null}};si.prototype.query=function(){var n=this;if(arguments.length===1){var u=arguments[0];this.build();var p=new be;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),u)&&this.query(u,this._root,p),p}else if(arguments.length===2){var m=arguments[0],b=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),m)&&this.query(m,this._root,b)}else if(arguments.length===3){if(Ke(arguments[2],Wl)&&arguments[0]instanceof Object&&arguments[1]instanceof Jn)for(var T=arguments[0],s=arguments[1],O=arguments[2],V=s.getChildBoundables(),G=0;G<V.size();G++){var it=V.get(G);n.getIntersectsOp().intersects(it.getBounds(),T)&&(it instanceof Jn?n.query(T,it,O):it instanceof fs?O.visitItem(it.getItem()):pr.shouldNeverReachHere())}else if(Ke(arguments[2],cs)&&arguments[0]instanceof Object&&arguments[1]instanceof Jn)for(var ot=arguments[0],dt=arguments[1],xt=arguments[2],Wt=dt.getChildBoundables(),Vt=0;Vt<Wt.size();Vt++){var ie=Wt.get(Vt);n.getIntersectsOp().intersects(ie.getBounds(),ot)&&(ie instanceof Jn?n.query(ot,ie,xt):ie instanceof fs?xt.add(ie.getItem()):pr.shouldNeverReachHere())}}};si.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};si.prototype.getRoot=function(){return this.build(),this._root};si.prototype.remove=function(){var n=this;if(arguments.length===2){var u=arguments[0],p=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),u)?this.remove(u,this._root,p):!1}else if(arguments.length===3){var m=arguments[0],b=arguments[1],T=arguments[2],s=this.removeItem(b,T);if(s)return!0;for(var O=null,V=b.getChildBoundables().iterator();V.hasNext();){var G=V.next();if(n.getIntersectsOp().intersects(G.getBounds(),m)&&G instanceof Jn&&(s=n.remove(m,G,T),s)){O=G;break}}return O!==null&&O.getChildBoundables().isEmpty()&&b.getChildBoundables().remove(O),s}};si.prototype.createHigherLevels=function(n,u){pr.isTrue(!n.isEmpty());var p=this.createParentBoundables(n,u+1);return p.size()===1?p.get(0):this.createHigherLevels(p,u+1)};si.prototype.depth=function(){var n=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var u=arguments[0],p=0,m=u.getChildBoundables().iterator();m.hasNext();){var b=m.next();if(b instanceof Jn){var T=n.depth(b);T>p&&(p=T)}}return p+1}};si.prototype.createParentBoundables=function(n,u){var p=this;pr.isTrue(!n.isEmpty());var m=new be;m.add(this.createNode(u));var b=new be(n);ds.sort(b,this.getComparator());for(var T=b.iterator();T.hasNext();){var s=T.next();p.lastNode(m).getChildBoundables().size()===p.getNodeCapacity()&&m.add(p.createNode(u)),p.lastNode(m).addChildBoundable(s)}return m};si.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};si.prototype.interfaces_=function(){return[Wo]};si.prototype.getClass=function(){return si};si.compareDoubles=function(n,u){return n>u?1:n<u?-1:0};y_.IntersectsOp.get=function(){return LC};y_.serialVersionUID.get=function(){return-3886435814360241e3};y_.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(si,y_);var LC=function(){},bp=function(){};bp.prototype.distance=function(n,u){};bp.prototype.interfaces_=function(){return[]};bp.prototype.getClass=function(){return bp};var VE=function(h){function n(p){p=p||n.DEFAULT_NODE_CAPACITY,h.call(this,p)}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return n.prototype.createParentBoundablesFromVerticalSlices=function(m,b){var T=this;pr.isTrue(m.length>0);for(var s=new be,O=0;O<m.length;O++)s.addAll(T.createParentBoundablesFromVerticalSlice(m[O],b));return s},n.prototype.createNode=function(m){return new nE(m)},n.prototype.size=function(){return arguments.length===0?h.prototype.size.call(this):h.prototype.size.apply(this,arguments)},n.prototype.insert=function(){if(arguments.length===2){var m=arguments[0],b=arguments[1];if(m.isNull())return null;h.prototype.insert.call(this,m,b)}else return h.prototype.insert.apply(this,arguments)},n.prototype.getIntersectsOp=function(){return n.intersectsOp},n.prototype.verticalSlices=function(m,b){for(var T=Math.trunc(Math.ceil(m.size()/b)),s=new Array(b).fill(null),O=m.iterator(),V=0;V<b;V++){s[V]=new be;for(var G=0;O.hasNext()&&G<T;){var it=O.next();s[V].add(it),G++}}return s},n.prototype.query=function(){if(arguments.length===1){var m=arguments[0];return h.prototype.query.call(this,m)}else if(arguments.length===2){var b=arguments[0],T=arguments[1];h.prototype.query.call(this,b,T)}else if(arguments.length===3){if(Ke(arguments[2],Wl)&&arguments[0]instanceof Object&&arguments[1]instanceof Jn){var s=arguments[0],O=arguments[1],V=arguments[2];h.prototype.query.call(this,s,O,V)}else if(Ke(arguments[2],cs)&&arguments[0]instanceof Object&&arguments[1]instanceof Jn){var G=arguments[0],it=arguments[1],ot=arguments[2];h.prototype.query.call(this,G,it,ot)}}},n.prototype.getComparator=function(){return n.yComparator},n.prototype.createParentBoundablesFromVerticalSlice=function(m,b){return h.prototype.createParentBoundables.call(this,m,b)},n.prototype.remove=function(){if(arguments.length===2){var m=arguments[0],b=arguments[1];return h.prototype.remove.call(this,m,b)}else return h.prototype.remove.apply(this,arguments)},n.prototype.depth=function(){return arguments.length===0?h.prototype.depth.call(this):h.prototype.depth.apply(this,arguments)},n.prototype.createParentBoundables=function(m,b){pr.isTrue(!m.isEmpty());var T=Math.trunc(Math.ceil(m.size()/this.getNodeCapacity())),s=new be(m);ds.sort(s,n.xComparator);var O=this.verticalSlices(s,Math.trunc(Math.ceil(Math.sqrt(T))));return this.createParentBoundablesFromVerticalSlices(O,b)},n.prototype.nearestNeighbour=function(){if(arguments.length===1){if(Ke(arguments[0],bp)){var m=arguments[0],b=new Gn(this.getRoot(),this.getRoot(),m);return this.nearestNeighbour(b)}else if(arguments[0]instanceof Gn){var T=arguments[0];return this.nearestNeighbour(T,or.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof n&&Ke(arguments[1],bp)){var s=arguments[0],O=arguments[1],V=new Gn(this.getRoot(),s.getRoot(),O);return this.nearestNeighbour(V)}else if(arguments[0]instanceof Gn&&typeof arguments[1]=="number"){var G=arguments[0],it=arguments[1],ot=it,dt=null,xt=new il;for(xt.add(G);!xt.isEmpty()&&ot>0;){var Wt=xt.poll(),Vt=Wt.getDistance();if(Vt>=ot)break;Wt.isLeaves()?(ot=Vt,dt=Wt):Wt.expandToQueue(xt,ot)}return[dt.getBoundable(0).getItem(),dt.getBoundable(1).getItem()]}}else if(arguments.length===3){var ie=arguments[0],he=arguments[1],ue=arguments[2],Ne=new fs(ie,he),je=new Gn(this.getRoot(),Ne,ue);return this.nearestNeighbour(je)[0]}},n.prototype.interfaces_=function(){return[Uc,Wo]},n.prototype.getClass=function(){return n},n.centreX=function(m){return n.avg(m.getMinX(),m.getMaxX())},n.avg=function(m,b){return(m+b)/2},n.centreY=function(m){return n.avg(m.getMinY(),m.getMaxY())},u.STRtreeNode.get=function(){return nE},u.serialVersionUID.get=function(){return 0x39920f7d5f261e0},u.xComparator.get=function(){return{interfaces_:function(){return[hp]},compare:function(p,m){return h.compareDoubles(n.centreX(p.getBounds()),n.centreX(m.getBounds()))}}},u.yComparator.get=function(){return{interfaces_:function(){return[hp]},compare:function(p,m){return h.compareDoubles(n.centreY(p.getBounds()),n.centreY(m.getBounds()))}}},u.intersectsOp.get=function(){return{interfaces_:function(){return[h.IntersectsOp]},intersects:function(p,m){return p.intersects(m)}}},u.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(n,u),n}(si),nE=function(h){function n(){var u=arguments[0];h.call(this,u)}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.computeBounds=function(){for(var p=null,m=this.getChildBoundables().iterator();m.hasNext();){var b=m.next();p===null?p=new Be(b.getBounds()):p.expandToInclude(b.getBounds())}return p},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Jn),Ji=function(){};Ji.prototype.interfaces_=function(){return[]};Ji.prototype.getClass=function(){return Ji};Ji.relativeSign=function(n,u){return n<u?-1:n>u?1:0};Ji.compare=function(n,u,p){if(u.equals2D(p))return 0;var m=Ji.relativeSign(u.x,p.x),b=Ji.relativeSign(u.y,p.y);switch(n){case 0:return Ji.compareValue(m,b);case 1:return Ji.compareValue(b,m);case 2:return Ji.compareValue(b,-m);case 3:return Ji.compareValue(-m,b);case 4:return Ji.compareValue(-m,-b);case 5:return Ji.compareValue(-b,-m);case 6:return Ji.compareValue(-b,m);case 7:return Ji.compareValue(m,-b)}return pr.shouldNeverReachHere("invalid octant value"),0};Ji.compareValue=function(n,u){return n<0?-1:n>0?1:u<0?-1:u>0?1:0};var Hl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var n=arguments[0],u=arguments[1],p=arguments[2],m=arguments[3];this._segString=n,this.coord=new It(u),this.segmentIndex=p,this._segmentOctant=m,this._isInterior=!u.equals2D(n.getCoordinate(p))};Hl.prototype.getCoordinate=function(){return this.coord};Hl.prototype.print=function(n){n.print(this.coord),n.print(" seg # = "+this.segmentIndex)};Hl.prototype.compareTo=function(n){var u=n;return this.segmentIndex<u.segmentIndex?-1:this.segmentIndex>u.segmentIndex?1:this.coord.equals2D(u.coord)?0:Ji.compare(this._segmentOctant,this.coord,u.coord)};Hl.prototype.isEndPoint=function(n){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===n};Hl.prototype.isInterior=function(){return this._isInterior};Hl.prototype.interfaces_=function(){return[Xo]};Hl.prototype.getClass=function(){return Hl};var Bi=function(){this._nodeMap=new Mi,this._edge=null;var n=arguments[0];this._edge=n};Bi.prototype.getSplitCoordinates=function(){var n=this,u=new Vd;this.addEndpoints();for(var p=this.iterator(),m=p.next();p.hasNext();){var b=p.next();n.addEdgeCoordinates(m,b,u),m=b}return u.toCoordinateArray()};Bi.prototype.addCollapsedNodes=function(){var n=this,u=new be;this.findCollapsesFromInsertedNodes(u),this.findCollapsesFromExistingVertices(u);for(var p=u.iterator();p.hasNext();){var m=p.next().intValue();n.add(n._edge.getCoordinate(m),m)}};Bi.prototype.print=function(n){n.println("Intersections:");for(var u=this.iterator();u.hasNext();){var p=u.next();p.print(n)}};Bi.prototype.findCollapsesFromExistingVertices=function(n){for(var u=this,p=0;p<this._edge.size()-2;p++){var m=u._edge.getCoordinate(p),b=u._edge.getCoordinate(p+2);m.equals2D(b)&&n.add(new ks(p+1))}};Bi.prototype.addEdgeCoordinates=function(n,u,p){var m=this,b=this._edge.getCoordinate(u.segmentIndex),T=u.isInterior()||!u.coord.equals2D(b);p.add(new It(n.coord),!1);for(var s=n.segmentIndex+1;s<=u.segmentIndex;s++)p.add(m._edge.getCoordinate(s));T&&p.add(new It(u.coord))};Bi.prototype.iterator=function(){return this._nodeMap.values().iterator()};Bi.prototype.addSplitEdges=function(n){var u=this;this.addEndpoints(),this.addCollapsedNodes();for(var p=this.iterator(),m=p.next();p.hasNext();){var b=p.next(),T=u.createSplitEdge(m,b);n.add(T),m=b}};Bi.prototype.findCollapseIndex=function(n,u,p){if(!n.coord.equals2D(u.coord))return!1;var m=u.segmentIndex-n.segmentIndex;return u.isInterior()||m--,m===1?(p[0]=n.segmentIndex+1,!0):!1};Bi.prototype.findCollapsesFromInsertedNodes=function(n){for(var u=this,p=new Array(1).fill(null),m=this.iterator(),b=m.next();m.hasNext();){var T=m.next(),s=u.findCollapseIndex(b,T,p);s&&n.add(new ks(p[0])),b=T}};Bi.prototype.getEdge=function(){return this._edge};Bi.prototype.addEndpoints=function(){var n=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(n),n)};Bi.prototype.createSplitEdge=function(n,u){var p=this,m=u.segmentIndex-n.segmentIndex+2,b=this._edge.getCoordinate(u.segmentIndex),T=u.isInterior()||!u.coord.equals2D(b);T||m--;var s=new Array(m).fill(null),O=0;s[O++]=new It(n.coord);for(var V=n.segmentIndex+1;V<=u.segmentIndex;V++)s[O++]=p._edge.getCoordinate(V);return T&&(s[O]=new It(u.coord)),new Bn(s,this._edge.getData())};Bi.prototype.add=function(n,u){var p=new Hl(this._edge,n,u,this._edge.getSegmentOctant(u)),m=this._nodeMap.get(p);return m!==null?(pr.isTrue(m.coord.equals2D(n),"Found equal nodes with different coordinates"),m):(this._nodeMap.put(p,p),p)};Bi.prototype.checkSplitEdgesCorrectness=function(n){var u=this._edge.getCoordinates(),p=n.get(0),m=p.getCoordinate(0);if(!m.equals2D(u[0]))throw new el("bad split edge start point at "+m);var b=n.get(n.size()-1),T=b.getCoordinates(),s=T[T.length-1];if(!s.equals2D(u[u.length-1]))throw new el("bad split edge end point at "+s)};Bi.prototype.interfaces_=function(){return[]};Bi.prototype.getClass=function(){return Bi};var Gc=function(){};Gc.prototype.interfaces_=function(){return[]};Gc.prototype.getClass=function(){return Gc};Gc.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],u=arguments[1];if(n===0&&u===0)throw new vn("Cannot compute the octant for point ( "+n+", "+u+" )");var p=Math.abs(n),m=Math.abs(u);return n>=0?u>=0?p>=m?0:1:p>=m?7:6:u>=0?p>=m?3:2:p>=m?4:5}else if(arguments[0]instanceof It&&arguments[1]instanceof It){var b=arguments[0],T=arguments[1],s=T.x-b.x,O=T.y-b.y;if(s===0&&O===0)throw new vn("Cannot compute the octant for two identical points "+b);return Gc.octant(s,O)}};var ya=function(){};ya.prototype.getCoordinates=function(){};ya.prototype.size=function(){};ya.prototype.getCoordinate=function(n){};ya.prototype.isClosed=function(){};ya.prototype.setData=function(n){};ya.prototype.getData=function(){};ya.prototype.interfaces_=function(){return[]};ya.prototype.getClass=function(){return ya};var Ad=function(){};Ad.prototype.addIntersection=function(n,u){};Ad.prototype.interfaces_=function(){return[ya]};Ad.prototype.getClass=function(){return Ad};var Bn=function(){this._nodeList=new Bi(this),this._pts=null,this._data=null;var n=arguments[0],u=arguments[1];this._pts=n,this._data=u};Bn.prototype.getCoordinates=function(){return this._pts};Bn.prototype.size=function(){return this._pts.length};Bn.prototype.getCoordinate=function(n){return this._pts[n]};Bn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Bn.prototype.getSegmentOctant=function(n){return n===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(n),this.getCoordinate(n+1))};Bn.prototype.setData=function(n){this._data=n};Bn.prototype.safeOctant=function(n,u){return n.equals2D(u)?0:Gc.octant(n,u)};Bn.prototype.getData=function(){return this._data};Bn.prototype.addIntersection=function(){if(arguments.length===2){var n=arguments[0],u=arguments[1];this.addIntersectionNode(n,u)}else if(arguments.length===4){var p=arguments[0],m=arguments[1],b=arguments[3],T=new It(p.getIntersection(b));this.addIntersection(T,m)}};Bn.prototype.toString=function(){return hs.toLineString(new Nn(this._pts))};Bn.prototype.getNodeList=function(){return this._nodeList};Bn.prototype.addIntersectionNode=function(n,u){var p=u,m=p+1;if(m<this._pts.length){var b=this._pts[m];n.equals2D(b)&&(p=m)}var T=this._nodeList.add(n,p);return T};Bn.prototype.addIntersections=function(n,u,p){for(var m=this,b=0;b<n.getIntersectionNum();b++)m.addIntersection(n,u,p,b)};Bn.prototype.interfaces_=function(){return[Ad]};Bn.prototype.getClass=function(){return Bn};Bn.getNodedSubstrings=function(){if(arguments.length===1){var n=arguments[0],u=new be;return Bn.getNodedSubstrings(n,u),u}else if(arguments.length===2)for(var p=arguments[0],m=arguments[1],b=p.iterator();b.hasNext();){var T=b.next();T.getNodeList().addSplitEdges(m)}};var Ge=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new It,this.p1=new It;else if(arguments.length===1){var n=arguments[0];this.p0=new It(n.p0),this.p1=new It(n.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var u=arguments[0],p=arguments[1],m=arguments[2],b=arguments[3];this.p0=new It(u,p),this.p1=new It(m,b)}},UE={serialVersionUID:{configurable:!0}};Ge.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Ge.prototype.orientationIndex=function(){if(arguments[0]instanceof Ge){var n=arguments[0],u=Ce.orientationIndex(this.p0,this.p1,n.p0),p=Ce.orientationIndex(this.p0,this.p1,n.p1);return u>=0&&p>=0||u<=0&&p<=0?Math.max(u,p):0}else if(arguments[0]instanceof It){var m=arguments[0];return Ce.orientationIndex(this.p0,this.p1,m)}};Ge.prototype.toGeometry=function(n){return n.createLineString([this.p0,this.p1])};Ge.prototype.isVertical=function(){return this.p0.x===this.p1.x};Ge.prototype.equals=function(n){if(!(n instanceof Ge))return!1;var u=n;return this.p0.equals(u.p0)&&this.p1.equals(u.p1)};Ge.prototype.intersection=function(n){var u=new Xu;return u.computeIntersection(this.p0,this.p1,n.p0,n.p1),u.hasIntersection()?u.getIntersection(0):null};Ge.prototype.project=function(){if(arguments[0]instanceof It){var n=arguments[0];if(n.equals(this.p0)||n.equals(this.p1))return new It(n);var u=this.projectionFactor(n),p=new It;return p.x=this.p0.x+u*(this.p1.x-this.p0.x),p.y=this.p0.y+u*(this.p1.y-this.p0.y),p}else if(arguments[0]instanceof Ge){var m=arguments[0],b=this.projectionFactor(m.p0),T=this.projectionFactor(m.p1);if(b>=1&&T>=1||b<=0&&T<=0)return null;var s=this.project(m.p0);b<0&&(s=this.p0),b>1&&(s=this.p1);var O=this.project(m.p1);return T<0&&(O=this.p0),T>1&&(O=this.p1),new Ge(s,O)}};Ge.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Ge.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Ge.prototype.getCoordinate=function(n){return n===0?this.p0:this.p1};Ge.prototype.distancePerpendicular=function(n){return Ce.distancePointLinePerpendicular(n,this.p0,this.p1)};Ge.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Ge.prototype.midPoint=function(){return Ge.midPoint(this.p0,this.p1)};Ge.prototype.projectionFactor=function(n){if(n.equals(this.p0))return 0;if(n.equals(this.p1))return 1;var u=this.p1.x-this.p0.x,p=this.p1.y-this.p0.y,m=u*u+p*p;if(m<=0)return or.NaN;var b=((n.x-this.p0.x)*u+(n.y-this.p0.y)*p)/m;return b};Ge.prototype.closestPoints=function(n){var u=this.intersection(n);if(u!==null)return[u,u];var p=new Array(2).fill(null),m=or.MAX_VALUE,b=null,T=this.closestPoint(n.p0);m=T.distance(n.p0),p[0]=T,p[1]=n.p0;var s=this.closestPoint(n.p1);b=s.distance(n.p1),b<m&&(m=b,p[0]=s,p[1]=n.p1);var O=n.closestPoint(this.p0);b=O.distance(this.p0),b<m&&(m=b,p[0]=this.p0,p[1]=O);var V=n.closestPoint(this.p1);return b=V.distance(this.p1),b<m&&(m=b,p[0]=this.p1,p[1]=V),p};Ge.prototype.closestPoint=function(n){var u=this.projectionFactor(n);if(u>0&&u<1)return this.project(n);var p=this.p0.distance(n),m=this.p1.distance(n);return p<m?this.p0:this.p1};Ge.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Ge.prototype.getLength=function(){return this.p0.distance(this.p1)};Ge.prototype.compareTo=function(n){var u=n,p=this.p0.compareTo(u.p0);return p!==0?p:this.p1.compareTo(u.p1)};Ge.prototype.reverse=function(){var n=this.p0;this.p0=this.p1,this.p1=n};Ge.prototype.equalsTopo=function(n){return this.p0.equals(n.p0)&&(this.p1.equals(n.p1)||this.p0.equals(n.p1))&&this.p1.equals(n.p0)};Ge.prototype.lineIntersection=function(n){try{var u=us.intersection(this.p0,this.p1,n.p0,n.p1);return u}catch(p){if(!(p instanceof Dp))throw p}finally{}return null};Ge.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Ge.prototype.pointAlongOffset=function(n,u){var p=this.p0.x+n*(this.p1.x-this.p0.x),m=this.p0.y+n*(this.p1.y-this.p0.y),b=this.p1.x-this.p0.x,T=this.p1.y-this.p0.y,s=Math.sqrt(b*b+T*T),O=0,V=0;if(u!==0){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");O=u*b/s,V=u*T/s}var G=p-V,it=m+O,ot=new It(G,it);return ot};Ge.prototype.setCoordinates=function(){if(arguments.length===1){var n=arguments[0];this.setCoordinates(n.p0,n.p1)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];this.p0.x=u.x,this.p0.y=u.y,this.p1.x=p.x,this.p1.y=p.y}};Ge.prototype.segmentFraction=function(n){var u=this.projectionFactor(n);return u<0?u=0:(u>1||or.isNaN(u))&&(u=1),u};Ge.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Ge.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Ge.prototype.distance=function(){if(arguments[0]instanceof Ge){var n=arguments[0];return Ce.distanceLineLine(this.p0,this.p1,n.p0,n.p1)}else if(arguments[0]instanceof It){var u=arguments[0];return Ce.distancePointLine(u,this.p0,this.p1)}};Ge.prototype.pointAlong=function(n){var u=new It;return u.x=this.p0.x+n*(this.p1.x-this.p0.x),u.y=this.p0.y+n*(this.p1.y-this.p0.y),u};Ge.prototype.hashCode=function(){var n=or.doubleToLongBits(this.p0.x);n^=or.doubleToLongBits(this.p0.y)*31;var u=Math.trunc(n)^Math.trunc(n>>32),p=or.doubleToLongBits(this.p1.x);p^=or.doubleToLongBits(this.p1.y)*31;var m=Math.trunc(p)^Math.trunc(p>>32);return u^m};Ge.prototype.interfaces_=function(){return[Xo,Wo]};Ge.prototype.getClass=function(){return Ge};Ge.midPoint=function(n,u){return new It((n.x+u.x)/2,(n.y+u.y)/2)};UE.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Ge,UE);var Pd=function(){this.tempEnv1=new Be,this.tempEnv2=new Be,this._overlapSeg1=new Ge,this._overlapSeg2=new Ge};Pd.prototype.overlap=function(){if(arguments.length!==2){if(arguments.length===4){var n=arguments[0],u=arguments[1],p=arguments[2],m=arguments[3];n.getLineSegment(u,this._overlapSeg1),p.getLineSegment(m,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}};Pd.prototype.interfaces_=function(){return[]};Pd.prototype.getClass=function(){return Pd};var fo=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var n=arguments[0],u=arguments[1],p=arguments[2],m=arguments[3];this._pts=n,this._start=u,this._end=p,this._context=m};fo.prototype.getLineSegment=function(n,u){u.p0=this._pts[n],u.p1=this._pts[n+1]};fo.prototype.computeSelect=function(n,u,p,m){var b=this._pts[u],T=this._pts[p];if(m.tempEnv1.init(b,T),p-u===1)return m.select(this,u),null;if(!n.intersects(m.tempEnv1))return null;var s=Math.trunc((u+p)/2);u<s&&this.computeSelect(n,u,s,m),s<p&&this.computeSelect(n,s,p,m)};fo.prototype.getCoordinates=function(){for(var n=this,u=new Array(this._end-this._start+1).fill(null),p=0,m=this._start;m<=this._end;m++)u[p++]=n._pts[m];return u};fo.prototype.computeOverlaps=function(n,u){this.computeOverlapsInternal(this._start,this._end,n,n._start,n._end,u)};fo.prototype.setId=function(n){this._id=n};fo.prototype.select=function(n,u){this.computeSelect(n,this._start,this._end,u)};fo.prototype.getEnvelope=function(){if(this._env===null){var n=this._pts[this._start],u=this._pts[this._end];this._env=new Be(n,u)}return this._env};fo.prototype.getEndIndex=function(){return this._end};fo.prototype.getStartIndex=function(){return this._start};fo.prototype.getContext=function(){return this._context};fo.prototype.getId=function(){return this._id};fo.prototype.computeOverlapsInternal=function(n,u,p,m,b,T){var s=this._pts[n],O=this._pts[u],V=p._pts[m],G=p._pts[b];if(u-n===1&&b-m===1)return T.overlap(this,n,p,m),null;if(T.tempEnv1.init(s,O),T.tempEnv2.init(V,G),!T.tempEnv1.intersects(T.tempEnv2))return null;var it=Math.trunc((n+u)/2),ot=Math.trunc((m+b)/2);n<it&&(m<ot&&this.computeOverlapsInternal(n,it,p,m,ot,T),ot<b&&this.computeOverlapsInternal(n,it,p,ot,b,T)),it<u&&(m<ot&&this.computeOverlapsInternal(it,u,p,m,ot,T),ot<b&&this.computeOverlapsInternal(it,u,p,ot,b,T))};fo.prototype.interfaces_=function(){return[]};fo.prototype.getClass=function(){return fo};var Ns=function(){};Ns.prototype.interfaces_=function(){return[]};Ns.prototype.getClass=function(){return Ns};Ns.getChainStartIndices=function(n){var u=0,p=new be;p.add(new ks(u));do{var m=Ns.findChainEnd(n,u);p.add(new ks(m)),u=m}while(u<n.length-1);var b=Ns.toIntArray(p);return b};Ns.findChainEnd=function(n,u){for(var p=u;p<n.length-1&&n[p].equals2D(n[p+1]);)p++;if(p>=n.length-1)return n.length-1;for(var m=Yr.quadrant(n[p],n[p+1]),b=u+1;b<n.length;){if(!n[b-1].equals2D(n[b])){var T=Yr.quadrant(n[b-1],n[b]);if(T!==m)break}b++}return b-1};Ns.getChains=function(){if(arguments.length===1){var n=arguments[0];return Ns.getChains(n,null)}else if(arguments.length===2){for(var u=arguments[0],p=arguments[1],m=new be,b=Ns.getChainStartIndices(u),T=0;T<b.length-1;T++){var s=new fo(u,b[T],b[T+1],p);m.add(s)}return m}};Ns.toIntArray=function(n){for(var u=new Array(n.size()).fill(null),p=0;p<u.length;p++)u[p]=n.get(p).intValue();return u};var Fu=function(){};Fu.prototype.computeNodes=function(n){};Fu.prototype.getNodedSubstrings=function(){};Fu.prototype.interfaces_=function(){return[]};Fu.prototype.getClass=function(){return Fu};var Ld=function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.setSegmentIntersector(n)}}};Ld.prototype.setSegmentIntersector=function(n){this._segInt=n};Ld.prototype.interfaces_=function(){return[Fu]};Ld.prototype.getClass=function(){return Ld};var c0=function(h){function n(p){p?h.call(this,p):h.call(this),this._monoChains=new be,this._index=new VE,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n;var u={SegmentOverlapAction:{configurable:!0}};return n.prototype.getMonotoneChains=function(){return this._monoChains},n.prototype.getNodedSubstrings=function(){return Bn.getNodedSubstrings(this._nodedSegStrings)},n.prototype.getIndex=function(){return this._index},n.prototype.add=function(m){for(var b=this,T=Ns.getChains(m.getCoordinates(),m),s=T.iterator();s.hasNext();){var O=s.next();O.setId(b._idCounter++),b._index.insert(O.getEnvelope(),O),b._monoChains.add(O)}},n.prototype.computeNodes=function(m){var b=this;this._nodedSegStrings=m;for(var T=m.iterator();T.hasNext();)b.add(T.next());this.intersectChains()},n.prototype.intersectChains=function(){for(var m=this,b=new iE(this._segInt),T=this._monoChains.iterator();T.hasNext();)for(var s=T.next(),O=m._index.query(s.getEnvelope()),V=O.iterator();V.hasNext();){var G=V.next();if(G.getId()>s.getId()&&(s.computeOverlaps(G,b),m._nOverlaps++),m._segInt.isDone())return null}},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},u.SegmentOverlapAction.get=function(){return iE},Object.defineProperties(n,u),n}(Ld),iE=function(h){function n(){h.call(this),this._si=null;var u=arguments[0];this._si=u}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.overlap=function(){if(arguments.length===4){var p=arguments[0],m=arguments[1],b=arguments[2],T=arguments[3],s=p.getContext(),O=b.getContext();this._si.processIntersections(s,m,O,T)}else return h.prototype.overlap.apply(this,arguments)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Pd),kr=function h(){if(this._quadrantSegments=h.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=h.CAP_ROUND,this._joinStyle=h.JOIN_ROUND,this._mitreLimit=h.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=h.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.setQuadrantSegments(n)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];this.setQuadrantSegments(u),this.setEndCapStyle(p)}else if(arguments.length===4){var m=arguments[0],b=arguments[1],T=arguments[2],s=arguments[3];this.setQuadrantSegments(m),this.setEndCapStyle(b),this.setJoinStyle(T),this.setMitreLimit(s)}}},ll={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};kr.prototype.getEndCapStyle=function(){return this._endCapStyle};kr.prototype.isSingleSided=function(){return this._isSingleSided};kr.prototype.setQuadrantSegments=function(n){this._quadrantSegments=n,this._quadrantSegments===0&&(this._joinStyle=kr.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=kr.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),n<=0&&(this._quadrantSegments=1),this._joinStyle!==kr.JOIN_ROUND&&(this._quadrantSegments=kr.DEFAULT_QUADRANT_SEGMENTS)};kr.prototype.getJoinStyle=function(){return this._joinStyle};kr.prototype.setJoinStyle=function(n){this._joinStyle=n};kr.prototype.setSimplifyFactor=function(n){this._simplifyFactor=n<0?0:n};kr.prototype.getSimplifyFactor=function(){return this._simplifyFactor};kr.prototype.getQuadrantSegments=function(){return this._quadrantSegments};kr.prototype.setEndCapStyle=function(n){this._endCapStyle=n};kr.prototype.getMitreLimit=function(){return this._mitreLimit};kr.prototype.setMitreLimit=function(n){this._mitreLimit=n};kr.prototype.setSingleSided=function(n){this._isSingleSided=n};kr.prototype.interfaces_=function(){return[]};kr.prototype.getClass=function(){return kr};kr.bufferDistanceError=function(n){var u=Math.PI/2/n;return 1-Math.cos(u/2)};ll.CAP_ROUND.get=function(){return 1};ll.CAP_FLAT.get=function(){return 2};ll.CAP_SQUARE.get=function(){return 3};ll.JOIN_ROUND.get=function(){return 1};ll.JOIN_MITRE.get=function(){return 2};ll.JOIN_BEVEL.get=function(){return 3};ll.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};ll.DEFAULT_MITRE_LIMIT.get=function(){return 5};ll.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(kr,ll);var An=function(n){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ce.COUNTERCLOCKWISE,this._inputLine=n||null},jd={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};An.prototype.isDeletable=function(n,u,p,m){var b=this._inputLine[n],T=this._inputLine[u],s=this._inputLine[p];return!this.isConcave(b,T,s)||!this.isShallow(b,T,s,m)?!1:this.isShallowSampled(b,T,n,p,m)};An.prototype.deleteShallowConcavities=function(){for(var n=this,u=1,p=this.findNextNonDeletedIndex(u),m=this.findNextNonDeletedIndex(p),b=!1;m<this._inputLine.length;){var T=!1;n.isDeletable(u,p,m,n._distanceTol)&&(n._isDeleted[p]=An.DELETE,T=!0,b=!0),T?u=m:u=p,p=n.findNextNonDeletedIndex(u),m=n.findNextNonDeletedIndex(p)}return b};An.prototype.isShallowConcavity=function(n,u,p,m){var b=Ce.computeOrientation(n,u,p),T=b===this._angleOrientation;if(!T)return!1;var s=Ce.distancePointLine(u,n,p);return s<m};An.prototype.isShallowSampled=function(n,u,p,m,b){var T=this,s=Math.trunc((m-p)/An.NUM_PTS_TO_CHECK);s<=0&&(s=1);for(var O=p;O<m;O+=s)if(!T.isShallow(n,u,T._inputLine[O],b))return!1;return!0};An.prototype.isConcave=function(n,u,p){var m=Ce.computeOrientation(n,u,p),b=m===this._angleOrientation;return b};An.prototype.simplify=function(n){var u=this;this._distanceTol=Math.abs(n),n<0&&(this._angleOrientation=Ce.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var p=!1;do p=u.deleteShallowConcavities();while(p);return this.collapseLine()};An.prototype.findNextNonDeletedIndex=function(n){for(var u=n+1;u<this._inputLine.length&&this._isDeleted[u]===An.DELETE;)u++;return u};An.prototype.isShallow=function(n,u,p,m){var b=Ce.distancePointLine(u,n,p);return b<m};An.prototype.collapseLine=function(){for(var n=this,u=new Vd,p=0;p<this._inputLine.length;p++)n._isDeleted[p]!==An.DELETE&&u.add(n._inputLine[p]);return u.toCoordinateArray()};An.prototype.interfaces_=function(){return[]};An.prototype.getClass=function(){return An};An.simplify=function(n,u){var p=new An(n);return p.simplify(u)};jd.INIT.get=function(){return 0};jd.DELETE.get=function(){return 1};jd.KEEP.get=function(){return 1};jd.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(An,jd);var To=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new be},GE={COORDINATE_ARRAY_TYPE:{configurable:!0}};To.prototype.getCoordinates=function(){var n=this._ptList.toArray(To.COORDINATE_ARRAY_TYPE);return n};To.prototype.setPrecisionModel=function(n){this._precisionModel=n};To.prototype.addPt=function(n){var u=new It(n);if(this._precisionModel.makePrecise(u),this.isRedundant(u))return null;this._ptList.add(u)};To.prototype.revere=function(){};To.prototype.addPts=function(n,u){var p=this;if(u)for(var m=0;m<n.length;m++)p.addPt(n[m]);else for(var b=n.length-1;b>=0;b--)p.addPt(n[b])};To.prototype.isRedundant=function(n){if(this._ptList.size()<1)return!1;var u=this._ptList.get(this._ptList.size()-1),p=n.distance(u);return p<this._minimimVertexDistance};To.prototype.toString=function(){var n=new _r,u=n.createLineString(this.getCoordinates());return u.toString()};To.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var n=new It(this._ptList.get(0)),u=this._ptList.get(this._ptList.size()-1);if(n.equals(u))return null;this._ptList.add(n)};To.prototype.setMinimumVertexDistance=function(n){this._minimimVertexDistance=n};To.prototype.interfaces_=function(){return[]};To.prototype.getClass=function(){return To};GE.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(To,GE);var Ir=function(){},rh={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Ir.prototype.interfaces_=function(){return[]};Ir.prototype.getClass=function(){return Ir};Ir.toDegrees=function(n){return n*180/Math.PI};Ir.normalize=function(n){for(;n>Math.PI;)n-=Ir.PI_TIMES_2;for(;n<=-Math.PI;)n+=Ir.PI_TIMES_2;return n};Ir.angle=function(){if(arguments.length===1){var n=arguments[0];return Math.atan2(n.y,n.x)}else if(arguments.length===2){var u=arguments[0],p=arguments[1],m=p.x-u.x,b=p.y-u.y;return Math.atan2(b,m)}};Ir.isAcute=function(n,u,p){var m=n.x-u.x,b=n.y-u.y,T=p.x-u.x,s=p.y-u.y,O=m*T+b*s;return O>0};Ir.isObtuse=function(n,u,p){var m=n.x-u.x,b=n.y-u.y,T=p.x-u.x,s=p.y-u.y,O=m*T+b*s;return O<0};Ir.interiorAngle=function(n,u,p){var m=Ir.angle(u,n),b=Ir.angle(u,p);return Math.abs(b-m)};Ir.normalizePositive=function(n){if(n<0){for(;n<0;)n+=Ir.PI_TIMES_2;n>=Ir.PI_TIMES_2&&(n=0)}else{for(;n>=Ir.PI_TIMES_2;)n-=Ir.PI_TIMES_2;n<0&&(n=0)}return n};Ir.angleBetween=function(n,u,p){var m=Ir.angle(u,n),b=Ir.angle(u,p);return Ir.diff(m,b)};Ir.diff=function(n,u){var p=null;return n<u?p=u-n:p=n-u,p>Math.PI&&(p=2*Math.PI-p),p};Ir.toRadians=function(n){return n*Math.PI/180};Ir.getTurn=function(n,u){var p=Math.sin(u-n);return p>0?Ir.COUNTERCLOCKWISE:p<0?Ir.CLOCKWISE:Ir.NONE};Ir.angleBetweenOriented=function(n,u,p){var m=Ir.angle(u,n),b=Ir.angle(u,p),T=b-m;return T<=-Math.PI?T+Ir.PI_TIMES_2:T>Math.PI?T-Ir.PI_TIMES_2:T};rh.PI_TIMES_2.get=function(){return 2*Math.PI};rh.PI_OVER_2.get=function(){return Math.PI/2};rh.PI_OVER_4.get=function(){return Math.PI/4};rh.COUNTERCLOCKWISE.get=function(){return Ce.COUNTERCLOCKWISE};rh.CLOCKWISE.get=function(){return Ce.CLOCKWISE};rh.NONE.get=function(){return Ce.COLLINEAR};Object.defineProperties(Ir,rh);var gn=function h(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Ge,this._seg1=new Ge,this._offset0=new Ge,this._offset1=new Ge,this._side=0,this._hasNarrowConcaveAngle=!1;var n=arguments[0],u=arguments[1],p=arguments[2];this._precisionModel=n,this._bufParams=u,this._li=new Xu,this._filletAngleQuantum=Math.PI/2/u.getQuadrantSegments(),u.getQuadrantSegments()>=8&&u.getJoinStyle()===kr.JOIN_ROUND&&(this._closingSegLengthFactor=h.MAX_CLOSING_SEG_LEN_FACTOR),this.init(p)},qd={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};gn.prototype.addNextSegment=function(n,u){if(this._s0=this._s1,this._s1=this._s2,this._s2=n,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var p=Ce.computeOrientation(this._s0,this._s1,this._s2),m=p===Ce.CLOCKWISE&&this._side===pe.LEFT||p===Ce.COUNTERCLOCKWISE&&this._side===pe.RIGHT;p===0?this.addCollinear(u):m?this.addOutsideTurn(p,u):this.addInsideTurn(p,u)};gn.prototype.addLineEndCap=function(n,u){var p=new Ge(n,u),m=new Ge;this.computeOffsetSegment(p,pe.LEFT,this._distance,m);var b=new Ge;this.computeOffsetSegment(p,pe.RIGHT,this._distance,b);var T=u.x-n.x,s=u.y-n.y,O=Math.atan2(s,T);switch(this._bufParams.getEndCapStyle()){case kr.CAP_ROUND:this._segList.addPt(m.p1),this.addFilletArc(u,O+Math.PI/2,O-Math.PI/2,Ce.CLOCKWISE,this._distance),this._segList.addPt(b.p1);break;case kr.CAP_FLAT:this._segList.addPt(m.p1),this._segList.addPt(b.p1);break;case kr.CAP_SQUARE:var V=new It;V.x=Math.abs(this._distance)*Math.cos(O),V.y=Math.abs(this._distance)*Math.sin(O);var G=new It(m.p1.x+V.x,m.p1.y+V.y),it=new It(b.p1.x+V.x,b.p1.y+V.y);this._segList.addPt(G),this._segList.addPt(it);break}};gn.prototype.getCoordinates=function(){var n=this._segList.getCoordinates();return n};gn.prototype.addMitreJoin=function(n,u,p,m){var b=!0,T=null;try{T=us.intersection(u.p0,u.p1,p.p0,p.p1);var s=m<=0?1:T.distance(n)/Math.abs(m);s>this._bufParams.getMitreLimit()&&(b=!1)}catch(O){if(O instanceof Dp)T=new It(0,0),b=!1;else throw O}finally{}b?this._segList.addPt(T):this.addLimitedMitreJoin(u,p,m,this._bufParams.getMitreLimit())};gn.prototype.addFilletCorner=function(n,u,p,m,b){var T=u.x-n.x,s=u.y-n.y,O=Math.atan2(s,T),V=p.x-n.x,G=p.y-n.y,it=Math.atan2(G,V);m===Ce.CLOCKWISE?O<=it&&(O+=2*Math.PI):O>=it&&(O-=2*Math.PI),this._segList.addPt(u),this.addFilletArc(n,O,it,m,b),this._segList.addPt(p)};gn.prototype.addOutsideTurn=function(n,u){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*gn.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===kr.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===kr.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(u&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,n,this._distance),this._segList.addPt(this._offset1.p0))};gn.prototype.createSquare=function(n){this._segList.addPt(new It(n.x+this._distance,n.y+this._distance)),this._segList.addPt(new It(n.x+this._distance,n.y-this._distance)),this._segList.addPt(new It(n.x-this._distance,n.y-this._distance)),this._segList.addPt(new It(n.x-this._distance,n.y+this._distance)),this._segList.closeRing()};gn.prototype.addSegments=function(n,u){this._segList.addPts(n,u)};gn.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};gn.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};gn.prototype.initSideSegments=function(n,u,p){this._s1=n,this._s2=u,this._side=p,this._seg1.setCoordinates(n,u),this.computeOffsetSegment(this._seg1,p,this._distance,this._offset1)};gn.prototype.addLimitedMitreJoin=function(n,u,p,m){var b=this._seg0.p1,T=Ir.angle(b,this._seg0.p0),s=Ir.angleBetweenOriented(this._seg0.p0,b,this._seg1.p1),O=s/2,V=Ir.normalize(T+O),G=Ir.normalize(V+Math.PI),it=m*p,ot=it*Math.abs(Math.sin(O)),dt=p-ot,xt=b.x+it*Math.cos(G),Wt=b.y+it*Math.sin(G),Vt=new It(xt,Wt),ie=new Ge(b,Vt),he=ie.pointAlongOffset(1,dt),ue=ie.pointAlongOffset(1,-dt);this._side===pe.LEFT?(this._segList.addPt(he),this._segList.addPt(ue)):(this._segList.addPt(ue),this._segList.addPt(he))};gn.prototype.computeOffsetSegment=function(n,u,p,m){var b=u===pe.LEFT?1:-1,T=n.p1.x-n.p0.x,s=n.p1.y-n.p0.y,O=Math.sqrt(T*T+s*s),V=b*p*T/O,G=b*p*s/O;m.p0.x=n.p0.x-G,m.p0.y=n.p0.y+V,m.p1.x=n.p1.x-G,m.p1.y=n.p1.y+V};gn.prototype.addFilletArc=function(n,u,p,m,b){var T=this,s=m===Ce.CLOCKWISE?-1:1,O=Math.abs(u-p),V=Math.trunc(O/this._filletAngleQuantum+.5);if(V<1)return null;for(var G=0,it=O/V,ot=G,dt=new It;ot<O;){var xt=u+s*ot;dt.x=n.x+b*Math.cos(xt),dt.y=n.y+b*Math.sin(xt),T._segList.addPt(dt),ot+=it}};gn.prototype.addInsideTurn=function(n,u){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*gn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var p=new It((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(p);var m=new It((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(m)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};gn.prototype.createCircle=function(n){var u=new It(n.x+this._distance,n.y);this._segList.addPt(u),this.addFilletArc(n,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};gn.prototype.addBevelJoin=function(n,u){this._segList.addPt(n.p1),this._segList.addPt(u.p0)};gn.prototype.init=function(n){this._distance=n,this._maxCurveSegmentError=n*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new To,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(n*gn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};gn.prototype.addCollinear=function(n){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var u=this._li.getIntersectionNum();u>=2&&(this._bufParams.getJoinStyle()===kr.JOIN_BEVEL||this._bufParams.getJoinStyle()===kr.JOIN_MITRE?(n&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Ce.CLOCKWISE,this._distance))};gn.prototype.closeRing=function(){this._segList.closeRing()};gn.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};gn.prototype.interfaces_=function(){return[]};gn.prototype.getClass=function(){return gn};qd.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};qd.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};qd.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};qd.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(gn,qd);var Qi=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var n=arguments[0],u=arguments[1];this._precisionModel=n,this._bufParams=u};Qi.prototype.getOffsetCurve=function(n,u){if(this._distance=u,u===0)return null;var p=u<0,m=Math.abs(u),b=this.getSegGen(m);n.length<=1?this.computePointCurve(n[0],b):this.computeOffsetCurve(n,p,b);var T=b.getCoordinates();return p&&yr.reverse(T),T};Qi.prototype.computeSingleSidedBufferCurve=function(n,u,p){var m=this.simplifyTolerance(this._distance);if(u){p.addSegments(n,!0);var b=An.simplify(n,-m),T=b.length-1;p.initSideSegments(b[T],b[T-1],pe.LEFT),p.addFirstSegment();for(var s=T-2;s>=0;s--)p.addNextSegment(b[s],!0)}else{p.addSegments(n,!1);var O=An.simplify(n,m),V=O.length-1;p.initSideSegments(O[0],O[1],pe.LEFT),p.addFirstSegment();for(var G=2;G<=V;G++)p.addNextSegment(O[G],!0)}p.addLastSegment(),p.closeRing()};Qi.prototype.computeRingBufferCurve=function(n,u,p){var m=this.simplifyTolerance(this._distance);u===pe.RIGHT&&(m=-m);var b=An.simplify(n,m),T=b.length-1;p.initSideSegments(b[T-1],b[0],u);for(var s=1;s<=T;s++){var O=s!==1;p.addNextSegment(b[s],O)}p.closeRing()};Qi.prototype.computeLineBufferCurve=function(n,u){var p=this.simplifyTolerance(this._distance),m=An.simplify(n,p),b=m.length-1;u.initSideSegments(m[0],m[1],pe.LEFT);for(var T=2;T<=b;T++)u.addNextSegment(m[T],!0);u.addLastSegment(),u.addLineEndCap(m[b-1],m[b]);var s=An.simplify(n,-p),O=s.length-1;u.initSideSegments(s[O],s[O-1],pe.LEFT);for(var V=O-2;V>=0;V--)u.addNextSegment(s[V],!0);u.addLastSegment(),u.addLineEndCap(s[1],s[0]),u.closeRing()};Qi.prototype.computePointCurve=function(n,u){switch(this._bufParams.getEndCapStyle()){case kr.CAP_ROUND:u.createCircle(n);break;case kr.CAP_SQUARE:u.createSquare(n);break}};Qi.prototype.getLineCurve=function(n,u){if(this._distance=u,u<0&&!this._bufParams.isSingleSided()||u===0)return null;var p=Math.abs(u),m=this.getSegGen(p);if(n.length<=1)this.computePointCurve(n[0],m);else if(this._bufParams.isSingleSided()){var b=u<0;this.computeSingleSidedBufferCurve(n,b,m)}else this.computeLineBufferCurve(n,m);var T=m.getCoordinates();return T};Qi.prototype.getBufferParameters=function(){return this._bufParams};Qi.prototype.simplifyTolerance=function(n){return n*this._bufParams.getSimplifyFactor()};Qi.prototype.getRingCurve=function(n,u,p){if(this._distance=p,n.length<=2)return this.getLineCurve(n,p);if(p===0)return Qi.copyCoordinates(n);var m=this.getSegGen(p);return this.computeRingBufferCurve(n,u,m),m.getCoordinates()};Qi.prototype.computeOffsetCurve=function(n,u,p){var m=this.simplifyTolerance(this._distance);if(u){var b=An.simplify(n,-m),T=b.length-1;p.initSideSegments(b[T],b[T-1],pe.LEFT),p.addFirstSegment();for(var s=T-2;s>=0;s--)p.addNextSegment(b[s],!0)}else{var O=An.simplify(n,m),V=O.length-1;p.initSideSegments(O[0],O[1],pe.LEFT),p.addFirstSegment();for(var G=2;G<=V;G++)p.addNextSegment(O[G],!0)}p.addLastSegment()};Qi.prototype.getSegGen=function(n){return new gn(this._precisionModel,this._bufParams,n)};Qi.prototype.interfaces_=function(){return[]};Qi.prototype.getClass=function(){return Qi};Qi.copyCoordinates=function(n){for(var u=new Array(n.length).fill(null),p=0;p<u.length;p++)u[p]=new It(n[p]);return u};var jc=function(){this._subgraphs=null,this._seg=new Ge,this._cga=new Ce;var n=arguments[0];this._subgraphs=n},jE={DepthSegment:{configurable:!0}};jc.prototype.findStabbedSegments=function(){var n=this;if(arguments.length===1){for(var u=arguments[0],p=new be,m=this._subgraphs.iterator();m.hasNext();){var b=m.next(),T=b.getEnvelope();u.y<T.getMinY()||u.y>T.getMaxY()||n.findStabbedSegments(u,b.getDirectedEdges(),p)}return p}else if(arguments.length===3){if(Ke(arguments[2],cs)&&arguments[0]instanceof It&&arguments[1]instanceof Xv)for(var s=arguments[0],O=arguments[1],V=arguments[2],G=O.getEdge().getCoordinates(),it=0;it<G.length-1;it++){n._seg.p0=G[it],n._seg.p1=G[it+1],n._seg.p0.y>n._seg.p1.y&&n._seg.reverse();var ot=Math.max(n._seg.p0.x,n._seg.p1.x);if(!(ot<s.x)&&!n._seg.isHorizontal()&&!(s.y<n._seg.p0.y||s.y>n._seg.p1.y)&&Ce.computeOrientation(n._seg.p0,n._seg.p1,s)!==Ce.RIGHT){var dt=O.getDepth(pe.LEFT);n._seg.p0.equals(G[it])||(dt=O.getDepth(pe.RIGHT));var xt=new Bu(n._seg,dt);V.add(xt)}}else if(Ke(arguments[2],cs)&&arguments[0]instanceof It&&Ke(arguments[1],cs))for(var Wt=arguments[0],Vt=arguments[1],ie=arguments[2],he=Vt.iterator();he.hasNext();){var ue=he.next();ue.isForward()&&n.findStabbedSegments(Wt,ue,ie)}}};jc.prototype.getDepth=function(n){var u=this.findStabbedSegments(n);if(u.size()===0)return 0;var p=ds.min(u);return p._leftDepth};jc.prototype.interfaces_=function(){return[]};jc.prototype.getClass=function(){return jc};jE.DepthSegment.get=function(){return Bu};Object.defineProperties(jc,jE);var Bu=function(){this._upwardSeg=null,this._leftDepth=null;var n=arguments[0],u=arguments[1];this._upwardSeg=new Ge(n),this._leftDepth=u};Bu.prototype.compareTo=function(n){var u=n;if(this._upwardSeg.minX()>=u._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=u._upwardSeg.minX())return-1;var p=this._upwardSeg.orientationIndex(u._upwardSeg);return p!==0||(p=-1*u._upwardSeg.orientationIndex(this._upwardSeg),p!==0)?p:this._upwardSeg.compareTo(u._upwardSeg)};Bu.prototype.compareX=function(n,u){var p=n.p0.compareTo(u.p0);return p!==0?p:n.p1.compareTo(u.p1)};Bu.prototype.toString=function(){return this._upwardSeg.toString()};Bu.prototype.interfaces_=function(){return[Xo]};Bu.prototype.getClass=function(){return Bu};var Br=function(n,u,p){this.p0=n||null,this.p1=u||null,this.p2=p||null};Br.prototype.area=function(){return Br.area(this.p0,this.p1,this.p2)};Br.prototype.signedArea=function(){return Br.signedArea(this.p0,this.p1,this.p2)};Br.prototype.interpolateZ=function(n){if(n===null)throw new vn("Supplied point is null.");return Br.interpolateZ(n,this.p0,this.p1,this.p2)};Br.prototype.longestSideLength=function(){return Br.longestSideLength(this.p0,this.p1,this.p2)};Br.prototype.isAcute=function(){return Br.isAcute(this.p0,this.p1,this.p2)};Br.prototype.circumcentre=function(){return Br.circumcentre(this.p0,this.p1,this.p2)};Br.prototype.area3D=function(){return Br.area3D(this.p0,this.p1,this.p2)};Br.prototype.centroid=function(){return Br.centroid(this.p0,this.p1,this.p2)};Br.prototype.inCentre=function(){return Br.inCentre(this.p0,this.p1,this.p2)};Br.prototype.interfaces_=function(){return[]};Br.prototype.getClass=function(){return Br};Br.area=function(n,u,p){return Math.abs(((p.x-n.x)*(u.y-n.y)-(u.x-n.x)*(p.y-n.y))/2)};Br.signedArea=function(n,u,p){return((p.x-n.x)*(u.y-n.y)-(u.x-n.x)*(p.y-n.y))/2};Br.det=function(n,u,p,m){return n*m-u*p};Br.interpolateZ=function(n,u,p,m){var b=u.x,T=u.y,s=p.x-b,O=m.x-b,V=p.y-T,G=m.y-T,it=s*G-O*V,ot=n.x-b,dt=n.y-T,xt=(G*ot-O*dt)/it,Wt=(-V*ot+s*dt)/it,Vt=u.z+xt*(p.z-u.z)+Wt*(m.z-u.z);return Vt};Br.longestSideLength=function(n,u,p){var m=n.distance(u),b=u.distance(p),T=p.distance(n),s=m;return b>s&&(s=b),T>s&&(s=T),s};Br.isAcute=function(n,u,p){return!(!Ir.isAcute(n,u,p)||!Ir.isAcute(u,p,n)||!Ir.isAcute(p,n,u))};Br.circumcentre=function(n,u,p){var m=p.x,b=p.y,T=n.x-m,s=n.y-b,O=u.x-m,V=u.y-b,G=2*Br.det(T,s,O,V),it=Br.det(s,T*T+s*s,V,O*O+V*V),ot=Br.det(T,T*T+s*s,O,O*O+V*V),dt=m-it/G,xt=b+ot/G;return new It(dt,xt)};Br.perpendicularBisector=function(n,u){var p=u.x-n.x,m=u.y-n.y,b=new us(n.x+p/2,n.y+m/2,1),T=new us(n.x-m+p/2,n.y+p+m/2,1);return new us(b,T)};Br.angleBisector=function(n,u,p){var m=u.distance(n),b=u.distance(p),T=m/(m+b),s=p.x-n.x,O=p.y-n.y,V=new It(n.x+T*s,n.y+T*O);return V};Br.area3D=function(n,u,p){var m=u.x-n.x,b=u.y-n.y,T=u.z-n.z,s=p.x-n.x,O=p.y-n.y,V=p.z-n.z,G=b*V-T*O,it=T*s-m*V,ot=m*O-b*s,dt=G*G+it*it+ot*ot,xt=Math.sqrt(dt)/2;return xt};Br.centroid=function(n,u,p){var m=(n.x+u.x+p.x)/3,b=(n.y+u.y+p.y)/3;return new It(m,b)};Br.inCentre=function(n,u,p){var m=u.distance(p),b=n.distance(p),T=n.distance(u),s=m+b+T,O=(m*n.x+b*u.x+T*p.x)/s,V=(m*n.y+b*u.y+T*p.y)/s;return new It(O,V)};var Zo=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new be;var n=arguments[0],u=arguments[1],p=arguments[2];this._inputGeom=n,this._distance=u,this._curveBuilder=p};Zo.prototype.addPoint=function(n){if(this._distance<=0)return null;var u=n.getCoordinates(),p=this._curveBuilder.getLineCurve(u,this._distance);this.addCurve(p,Ct.EXTERIOR,Ct.INTERIOR)};Zo.prototype.addPolygon=function(n){var u=this,p=this._distance,m=pe.LEFT;this._distance<0&&(p=-this._distance,m=pe.RIGHT);var b=n.getExteriorRing(),T=yr.removeRepeatedPoints(b.getCoordinates());if(this._distance<0&&this.isErodedCompletely(b,this._distance)||this._distance<=0&&T.length<3)return null;this.addPolygonRing(T,p,m,Ct.EXTERIOR,Ct.INTERIOR);for(var s=0;s<n.getNumInteriorRing();s++){var O=n.getInteriorRingN(s),V=yr.removeRepeatedPoints(O.getCoordinates());u._distance>0&&u.isErodedCompletely(O,-u._distance)||u.addPolygonRing(V,p,pe.opposite(m),Ct.INTERIOR,Ct.EXTERIOR)}};Zo.prototype.isTriangleErodedCompletely=function(n,u){var p=new Br(n[0],n[1],n[2]),m=p.inCentre(),b=Ce.distancePointLine(m,p.p0,p.p1);return b<Math.abs(u)};Zo.prototype.addLineString=function(n){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var u=yr.removeRepeatedPoints(n.getCoordinates()),p=this._curveBuilder.getLineCurve(u,this._distance);this.addCurve(p,Ct.EXTERIOR,Ct.INTERIOR)};Zo.prototype.addCurve=function(n,u,p){if(n===null||n.length<2)return null;var m=new Bn(n,new qr(0,Ct.BOUNDARY,u,p));this._curveList.add(m)};Zo.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Zo.prototype.addPolygonRing=function(n,u,p,m,b){if(u===0&&n.length<ga.MINIMUM_VALID_SIZE)return null;var T=m,s=b;n.length>=ga.MINIMUM_VALID_SIZE&&Ce.isCCW(n)&&(T=b,s=m,p=pe.opposite(p));var O=this._curveBuilder.getRingCurve(n,p,u);this.addCurve(O,T,s)};Zo.prototype.add=function(n){if(n.isEmpty())return null;n instanceof Kn?this.addPolygon(n):n instanceof Mn?this.addLineString(n):n instanceof ho?this.addPoint(n):n instanceof yp?this.addCollection(n):n instanceof ku?this.addCollection(n):n instanceof fa?this.addCollection(n):n instanceof ki&&this.addCollection(n)};Zo.prototype.isErodedCompletely=function(n,u){var p=n.getCoordinates();if(p.length<4)return u<0;if(p.length===4)return this.isTriangleErodedCompletely(p,u);var m=n.getEnvelopeInternal(),b=Math.min(m.getHeight(),m.getWidth());return u<0&&2*Math.abs(u)>b};Zo.prototype.addCollection=function(n){for(var u=this,p=0;p<n.getNumGeometries();p++){var m=n.getGeometryN(p);u.add(m)}};Zo.prototype.interfaces_=function(){return[]};Zo.prototype.getClass=function(){return Zo};var wp=function(){};wp.prototype.locate=function(n){};wp.prototype.interfaces_=function(){return[]};wp.prototype.getClass=function(){return wp};var da=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var n=arguments[0];this._parent=n,this._atStart=!0,this._index=0,this._max=n.getNumGeometries()};da.prototype.next=function(){if(this._atStart)return this._atStart=!1,da.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Op;var n=this._parent.getGeometryN(this._index++);return n instanceof ki?(this._subcollectionIterator=new da(n),this._subcollectionIterator.next()):n};da.prototype.remove=function(){throw new Error(this.getClass().getName())};da.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};da.prototype.interfaces_=function(){return[Rp]};da.prototype.getClass=function(){return da};da.isAtomic=function(n){return!(n instanceof ki)};var wo=function(){this._geom=null;var n=arguments[0];this._geom=n};wo.prototype.locate=function(n){return wo.locate(n,this._geom)};wo.prototype.interfaces_=function(){return[wp]};wo.prototype.getClass=function(){return wo};wo.isPointInRing=function(n,u){return u.getEnvelopeInternal().intersects(n)?Ce.isPointInRing(n,u.getCoordinates()):!1};wo.containsPointInPolygon=function(n,u){if(u.isEmpty())return!1;var p=u.getExteriorRing();if(!wo.isPointInRing(n,p))return!1;for(var m=0;m<u.getNumInteriorRing();m++){var b=u.getInteriorRingN(m);if(wo.isPointInRing(n,b))return!1}return!0};wo.containsPoint=function(n,u){if(u instanceof Kn)return wo.containsPointInPolygon(n,u);if(u instanceof ki)for(var p=new da(u);p.hasNext();){var m=p.next();if(m!==u&&wo.containsPoint(n,m))return!0}return!1};wo.locate=function(n,u){return u.isEmpty()?Ct.EXTERIOR:wo.containsPoint(n,u)?Ct.INTERIOR:Ct.EXTERIOR};var Pi=function(){this._edgeMap=new Mi,this._edgeList=null,this._ptInAreaLocation=[Ct.NONE,Ct.NONE]};Pi.prototype.getNextCW=function(n){this.getEdges();var u=this._edgeList.indexOf(n),p=u-1;return u===0&&(p=this._edgeList.size()-1),this._edgeList.get(p)};Pi.prototype.propagateSideLabels=function(n){for(var u=Ct.NONE,p=this.iterator();p.hasNext();){var m=p.next(),b=m.getLabel();b.isArea(n)&&b.getLocation(n,pe.LEFT)!==Ct.NONE&&(u=b.getLocation(n,pe.LEFT))}if(u===Ct.NONE)return null;for(var T=u,s=this.iterator();s.hasNext();){var O=s.next(),V=O.getLabel();if(V.getLocation(n,pe.ON)===Ct.NONE&&V.setLocation(n,pe.ON,T),V.isArea(n)){var G=V.getLocation(n,pe.LEFT),it=V.getLocation(n,pe.RIGHT);if(it!==Ct.NONE){if(it!==T)throw new nl("side location conflict",O.getCoordinate());G===Ct.NONE&&pr.shouldNeverReachHere("found single null side (at "+O.getCoordinate()+")"),T=G}else pr.isTrue(V.getLocation(n,pe.LEFT)===Ct.NONE,"found single null side"),V.setLocation(n,pe.RIGHT,T),V.setLocation(n,pe.LEFT,T)}}};Pi.prototype.getCoordinate=function(){var n=this.iterator();if(!n.hasNext())return null;var u=n.next();return u.getCoordinate()};Pi.prototype.print=function(n){_i.out.println("EdgeEndStar:   "+this.getCoordinate());for(var u=this.iterator();u.hasNext();){var p=u.next();p.print(n)}};Pi.prototype.isAreaLabelsConsistent=function(n){return this.computeEdgeEndLabels(n.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Pi.prototype.checkAreaLabelsConsistent=function(n){var u=this.getEdges();if(u.size()<=0)return!0;var p=u.size()-1,m=u.get(p).getLabel(),b=m.getLocation(n,pe.LEFT);pr.isTrue(b!==Ct.NONE,"Found unlabelled area edge");for(var T=b,s=this.iterator();s.hasNext();){var O=s.next(),V=O.getLabel();pr.isTrue(V.isArea(n),"Found non-area edge");var G=V.getLocation(n,pe.LEFT),it=V.getLocation(n,pe.RIGHT);if(G===it||it!==T)return!1;T=G}return!0};Pi.prototype.findIndex=function(n){var u=this;this.iterator();for(var p=0;p<this._edgeList.size();p++){var m=u._edgeList.get(p);if(m===n)return p}return-1};Pi.prototype.iterator=function(){return this.getEdges().iterator()};Pi.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new be(this._edgeMap.values())),this._edgeList};Pi.prototype.getLocation=function(n,u,p){return this._ptInAreaLocation[n]===Ct.NONE&&(this._ptInAreaLocation[n]=wo.locate(u,p[n].getGeometry())),this._ptInAreaLocation[n]};Pi.prototype.toString=function(){var n=new Ws;n.append("EdgeEndStar:   "+this.getCoordinate()),n.append(`
`);for(var u=this.iterator();u.hasNext();){var p=u.next();n.append(p),n.append(`
`)}return n.toString()};Pi.prototype.computeEdgeEndLabels=function(n){for(var u=this.iterator();u.hasNext();){var p=u.next();p.computeLabel(n)}};Pi.prototype.computeLabelling=function(n){var u=this;this.computeEdgeEndLabels(n[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var p=[!1,!1],m=this.iterator();m.hasNext();)for(var b=m.next(),T=b.getLabel(),s=0;s<2;s++)T.isLine(s)&&T.getLocation(s)===Ct.BOUNDARY&&(p[s]=!0);for(var O=this.iterator();O.hasNext();)for(var V=O.next(),G=V.getLabel(),it=0;it<2;it++)if(G.isAnyNull(it)){var ot=Ct.NONE;if(p[it])ot=Ct.EXTERIOR;else{var dt=V.getCoordinate();ot=u.getLocation(it,dt,n)}G.setAllLocationsIfNull(it,ot)}};Pi.prototype.getDegree=function(){return this._edgeMap.size()};Pi.prototype.insertEdgeEnd=function(n,u){this._edgeMap.put(n,u),this._edgeList=null};Pi.prototype.interfaces_=function(){return[]};Pi.prototype.getClass=function(){return Pi};var DC=function(h){function n(){h.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.linkResultDirectedEdges=function(){var p=this;this.getResultAreaEdges();for(var m=null,b=null,T=this._SCANNING_FOR_INCOMING,s=0;s<this._resultAreaEdgeList.size();s++){var O=p._resultAreaEdgeList.get(s),V=O.getSym();if(O.getLabel().isArea())switch(m===null&&O.isInResult()&&(m=O),T){case p._SCANNING_FOR_INCOMING:if(!V.isInResult())continue;b=V,T=p._LINKING_TO_OUTGOING;break;case p._LINKING_TO_OUTGOING:if(!O.isInResult())continue;b.setNext(O),T=p._SCANNING_FOR_INCOMING;break}}if(T===this._LINKING_TO_OUTGOING){if(m===null)throw new nl("no outgoing dirEdge found",this.getCoordinate());pr.isTrue(m.isInResult(),"unable to link last incoming dirEdge"),b.setNext(m)}},n.prototype.insert=function(p){var m=p;this.insertEdgeEnd(m,m)},n.prototype.getRightmostEdge=function(){var p=this.getEdges(),m=p.size();if(m<1)return null;var b=p.get(0);if(m===1)return b;var T=p.get(m-1),s=b.getQuadrant(),O=T.getQuadrant();return Yr.isNorthern(s)&&Yr.isNorthern(O)?b:!Yr.isNorthern(s)&&!Yr.isNorthern(O)?T:b.getDy()!==0?b:T.getDy()!==0?T:(pr.shouldNeverReachHere("found two horizontal edges incident on node"),null)},n.prototype.print=function(p){_i.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var m=this.iterator();m.hasNext();){var b=m.next();p.print("out "),b.print(p),p.println(),p.print("in "),b.getSym().print(p),p.println()}},n.prototype.getResultAreaEdges=function(){var p=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new be;for(var m=this.iterator();m.hasNext();){var b=m.next();(b.isInResult()||b.getSym().isInResult())&&p._resultAreaEdgeList.add(b)}return this._resultAreaEdgeList},n.prototype.updateLabelling=function(p){for(var m=this.iterator();m.hasNext();){var b=m.next(),T=b.getLabel();T.setAllLocationsIfNull(0,p.getLocation(0)),T.setAllLocationsIfNull(1,p.getLocation(1))}},n.prototype.linkAllDirectedEdges=function(){var p=this;this.getEdges();for(var m=null,b=null,T=this._edgeList.size()-1;T>=0;T--){var s=p._edgeList.get(T),O=s.getSym();b===null&&(b=O),m!==null&&O.setNext(m),m=s}b.setNext(m)},n.prototype.computeDepths=function(){var p=this;if(arguments.length===1){var m=arguments[0],b=this.findIndex(m),T=m.getDepth(pe.LEFT),s=m.getDepth(pe.RIGHT),O=this.computeDepths(b+1,this._edgeList.size(),T),V=this.computeDepths(0,b,O);if(V!==s)throw new nl("depth mismatch at "+m.getCoordinate())}else if(arguments.length===3){for(var G=arguments[0],it=arguments[1],ot=arguments[2],dt=ot,xt=G;xt<it;xt++){var Wt=p._edgeList.get(xt);Wt.setEdgeDepths(pe.RIGHT,dt),dt=Wt.getDepth(pe.LEFT)}return dt}},n.prototype.mergeSymLabels=function(){for(var p=this.iterator();p.hasNext();){var m=p.next(),b=m.getLabel();b.merge(m.getSym().getLabel())}},n.prototype.linkMinimalDirectedEdges=function(p){for(var m=this,b=null,T=null,s=this._SCANNING_FOR_INCOMING,O=this._resultAreaEdgeList.size()-1;O>=0;O--){var V=m._resultAreaEdgeList.get(O),G=V.getSym();switch(b===null&&V.getEdgeRing()===p&&(b=V),s){case m._SCANNING_FOR_INCOMING:if(G.getEdgeRing()!==p)continue;T=G,s=m._LINKING_TO_OUTGOING;break;case m._LINKING_TO_OUTGOING:if(V.getEdgeRing()!==p)continue;T.setNextMin(V),s=m._SCANNING_FOR_INCOMING;break}}s===this._LINKING_TO_OUTGOING&&(pr.isTrue(b!==null,"found null for first outgoing dirEdge"),pr.isTrue(b.getEdgeRing()===p,"unable to link last incoming dirEdge"),T.setNextMin(b))},n.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var p=0,m=this.iterator();m.hasNext();){var b=m.next();b.isInResult()&&p++}return p}else if(arguments.length===1){for(var T=arguments[0],s=0,O=this.iterator();O.hasNext();){var V=O.next();V.getEdgeRing()===T&&s++}return s}},n.prototype.getLabel=function(){return this._label},n.prototype.findCoveredLineEdges=function(){for(var p=Ct.NONE,m=this.iterator();m.hasNext();){var b=m.next(),T=b.getSym();if(!b.isLineEdge()){if(b.isInResult()){p=Ct.INTERIOR;break}if(T.isInResult()){p=Ct.EXTERIOR;break}}}if(p===Ct.NONE)return null;for(var s=p,O=this.iterator();O.hasNext();){var V=O.next(),G=V.getSym();V.isLineEdge()?V.getEdge().setCovered(s===Ct.INTERIOR):(V.isInResult()&&(s=Ct.EXTERIOR),G.isInResult()&&(s=Ct.INTERIOR))}},n.prototype.computeLabelling=function(p){var m=this;h.prototype.computeLabelling.call(this,p),this._label=new qr(Ct.NONE);for(var b=this.iterator();b.hasNext();)for(var T=b.next(),s=T.getEdge(),O=s.getLabel(),V=0;V<2;V++){var G=O.getLocation(V);(G===Ct.INTERIOR||G===Ct.BOUNDARY)&&m._label.setLocation(V,Ct.INTERIOR)}},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Pi),qE=function(h){function n(){h.apply(this,arguments)}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.createNode=function(p){return new __(p,new DC)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(vp),Yl=function h(){this._pts=null,this._orientation=null;var n=arguments[0];this._pts=n,this._orientation=h.orientation(n)};Yl.prototype.compareTo=function(n){var u=n,p=Yl.compareOriented(this._pts,this._orientation,u._pts,u._orientation);return p};Yl.prototype.interfaces_=function(){return[Xo]};Yl.prototype.getClass=function(){return Yl};Yl.orientation=function(n){return yr.increasingDirection(n)===1};Yl.compareOriented=function(n,u,p,m){for(var b=u?1:-1,T=m?1:-1,s=u?n.length:-1,O=m?p.length:-1,V=u?0:n.length-1,G=m?0:p.length-1;;){var it=n[V].compareTo(p[G]);if(it!==0)return it;V+=b,G+=T;var ot=V===s,dt=G===O;if(ot&&!dt)return-1;if(!ot&&dt)return 1;if(ot&&dt)return 0}};var ms=function(){this._edges=new be,this._ocaMap=new Mi};ms.prototype.print=function(n){var u=this;n.print("MULTILINESTRING ( ");for(var p=0;p<this._edges.size();p++){var m=u._edges.get(p);p>0&&n.print(","),n.print("(");for(var b=m.getCoordinates(),T=0;T<b.length;T++)T>0&&n.print(","),n.print(b[T].x+" "+b[T].y);n.println(")")}n.print(")  ")};ms.prototype.addAll=function(n){for(var u=this,p=n.iterator();p.hasNext();)u.add(p.next())};ms.prototype.findEdgeIndex=function(n){for(var u=this,p=0;p<this._edges.size();p++)if(u._edges.get(p).equals(n))return p;return-1};ms.prototype.iterator=function(){return this._edges.iterator()};ms.prototype.getEdges=function(){return this._edges};ms.prototype.get=function(n){return this._edges.get(n)};ms.prototype.findEqualEdge=function(n){var u=new Yl(n.getCoordinates()),p=this._ocaMap.get(u);return p};ms.prototype.add=function(n){this._edges.add(n);var u=new Yl(n.getCoordinates());this._ocaMap.put(u,n)};ms.prototype.interfaces_=function(){return[]};ms.prototype.getClass=function(){return ms};var Vu=function(){};Vu.prototype.processIntersections=function(n,u,p,m){};Vu.prototype.isDone=function(){};Vu.prototype.interfaces_=function(){return[]};Vu.prototype.getClass=function(){return Vu};var So=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var n=arguments[0];this._li=n};So.prototype.isTrivialIntersection=function(n,u,p,m){if(n===p&&this._li.getIntersectionNum()===1){if(So.isAdjacentSegments(u,m))return!0;if(n.isClosed()){var b=n.size()-1;if(u===0&&m===b||m===0&&u===b)return!0}}return!1};So.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};So.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};So.prototype.getLineIntersector=function(){return this._li};So.prototype.hasProperIntersection=function(){return this._hasProper};So.prototype.processIntersections=function(n,u,p,m){if(n===p&&u===m)return null;this.numTests++;var b=n.getCoordinates()[u],T=n.getCoordinates()[u+1],s=p.getCoordinates()[m],O=p.getCoordinates()[m+1];this._li.computeIntersection(b,T,s,O),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(n,u,p,m)||(this._hasIntersection=!0,n.addIntersections(this._li,u,0),p.addIntersections(this._li,m,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};So.prototype.hasIntersection=function(){return this._hasIntersection};So.prototype.isDone=function(){return!1};So.prototype.hasInteriorIntersection=function(){return this._hasInterior};So.prototype.interfaces_=function(){return[Vu]};So.prototype.getClass=function(){return So};So.isAdjacentSegments=function(n,u){return Math.abs(n-u)===1};var js=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var n=arguments[0],u=arguments[1],p=arguments[2];this.coord=new It(n),this.segmentIndex=u,this.dist=p};js.prototype.getSegmentIndex=function(){return this.segmentIndex};js.prototype.getCoordinate=function(){return this.coord};js.prototype.print=function(n){n.print(this.coord),n.print(" seg # = "+this.segmentIndex),n.println(" dist = "+this.dist)};js.prototype.compareTo=function(n){var u=n;return this.compare(u.segmentIndex,u.dist)};js.prototype.isEndPoint=function(n){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===n};js.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};js.prototype.getDistance=function(){return this.dist};js.prototype.compare=function(n,u){return this.segmentIndex<n?-1:this.segmentIndex>n?1:this.dist<u?-1:this.dist>u?1:0};js.prototype.interfaces_=function(){return[Xo]};js.prototype.getClass=function(){return js};var va=function(){this._nodeMap=new Mi,this.edge=null;var n=arguments[0];this.edge=n};va.prototype.print=function(n){n.println("Intersections:");for(var u=this.iterator();u.hasNext();){var p=u.next();p.print(n)}};va.prototype.iterator=function(){return this._nodeMap.values().iterator()};va.prototype.addSplitEdges=function(n){var u=this;this.addEndpoints();for(var p=this.iterator(),m=p.next();p.hasNext();){var b=p.next(),T=u.createSplitEdge(m,b);n.add(T),m=b}};va.prototype.addEndpoints=function(){var n=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[n],n,0)};va.prototype.createSplitEdge=function(n,u){var p=this,m=u.segmentIndex-n.segmentIndex+2,b=this.edge.pts[u.segmentIndex],T=u.dist>0||!u.coord.equals2D(b);T||m--;var s=new Array(m).fill(null),O=0;s[O++]=new It(n.coord);for(var V=n.segmentIndex+1;V<=u.segmentIndex;V++)s[O++]=p.edge.pts[V];return T&&(s[O]=u.coord),new Jg(s,new qr(this.edge._label))};va.prototype.add=function(n,u,p){var m=new js(n,u,p),b=this._nodeMap.get(m);return b!==null?b:(this._nodeMap.put(m,m),m)};va.prototype.isIntersection=function(n){for(var u=this.iterator();u.hasNext();){var p=u.next();if(p.coord.equals(n))return!0}return!1};va.prototype.interfaces_=function(){return[]};va.prototype.getClass=function(){return va};var Uu=function(){};Uu.prototype.getChainStartIndices=function(n){var u=this,p=0,m=new be;m.add(new ks(p));do{var b=u.findChainEnd(n,p);m.add(new ks(b)),p=b}while(p<n.length-1);var T=Uu.toIntArray(m);return T};Uu.prototype.findChainEnd=function(n,u){for(var p=Yr.quadrant(n[u],n[u+1]),m=u+1;m<n.length;){var b=Yr.quadrant(n[m-1],n[m]);if(b!==p)break;m++}return m-1};Uu.prototype.interfaces_=function(){return[]};Uu.prototype.getClass=function(){return Uu};Uu.toIntArray=function(n){for(var u=new Array(n.size()).fill(null),p=0;p<u.length;p++)u[p]=n.get(p).intValue();return u};var ol=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Be,this.env2=new Be;var n=arguments[0];this.e=n,this.pts=n.getCoordinates();var u=new Uu;this.startIndex=u.getChainStartIndices(this.pts)};ol.prototype.getCoordinates=function(){return this.pts};ol.prototype.getMaxX=function(n){var u=this.pts[this.startIndex[n]].x,p=this.pts[this.startIndex[n+1]].x;return u>p?u:p};ol.prototype.getMinX=function(n){var u=this.pts[this.startIndex[n]].x,p=this.pts[this.startIndex[n+1]].x;return u<p?u:p};ol.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var n=arguments[0],u=arguments[1],p=arguments[2],m=arguments[3];this.computeIntersectsForChain(this.startIndex[n],this.startIndex[n+1],u,u.startIndex[p],u.startIndex[p+1],m)}else if(arguments.length===6){var b=arguments[0],T=arguments[1],s=arguments[2],O=arguments[3],V=arguments[4],G=arguments[5],it=this.pts[b],ot=this.pts[T],dt=s.pts[O],xt=s.pts[V];if(T-b===1&&V-O===1)return G.addIntersections(this.e,b,s.e,O),null;if(this.env1.init(it,ot),this.env2.init(dt,xt),!this.env1.intersects(this.env2))return null;var Wt=Math.trunc((b+T)/2),Vt=Math.trunc((O+V)/2);b<Wt&&(O<Vt&&this.computeIntersectsForChain(b,Wt,s,O,Vt,G),Vt<V&&this.computeIntersectsForChain(b,Wt,s,Vt,V,G)),Wt<T&&(O<Vt&&this.computeIntersectsForChain(Wt,T,s,O,Vt,G),Vt<V&&this.computeIntersectsForChain(Wt,T,s,Vt,V,G))}};ol.prototype.getStartIndexes=function(){return this.startIndex};ol.prototype.computeIntersects=function(n,u){for(var p=this,m=0;m<this.startIndex.length-1;m++)for(var b=0;b<n.startIndex.length-1;b++)p.computeIntersectsForChain(m,n,b,u)};ol.prototype.interfaces_=function(){return[]};ol.prototype.getClass=function(){return ol};var gi=function h(){var n=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var u=0;u<2;u++)for(var p=0;p<3;p++)n._depth[u][p]=h.NULL_VALUE},ZE={NULL_VALUE:{configurable:!0}};gi.prototype.getDepth=function(n,u){return this._depth[n][u]};gi.prototype.setDepth=function(n,u,p){this._depth[n][u]=p};gi.prototype.isNull=function(){var n=this;if(arguments.length===0){for(var u=0;u<2;u++)for(var p=0;p<3;p++)if(n._depth[u][p]!==gi.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var m=arguments[0];return this._depth[m][1]===gi.NULL_VALUE}else if(arguments.length===2){var b=arguments[0],T=arguments[1];return this._depth[b][T]===gi.NULL_VALUE}};gi.prototype.normalize=function(){for(var n=this,u=0;u<2;u++)if(!n.isNull(u)){var p=n._depth[u][1];n._depth[u][2]<p&&(p=n._depth[u][2]),p<0&&(p=0);for(var m=1;m<3;m++){var b=0;n._depth[u][m]>p&&(b=1),n._depth[u][m]=b}}};gi.prototype.getDelta=function(n){return this._depth[n][pe.RIGHT]-this._depth[n][pe.LEFT]};gi.prototype.getLocation=function(n,u){return this._depth[n][u]<=0?Ct.EXTERIOR:Ct.INTERIOR};gi.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};gi.prototype.add=function(){var n=this;if(arguments.length===1)for(var u=arguments[0],p=0;p<2;p++)for(var m=1;m<3;m++){var b=u.getLocation(p,m);(b===Ct.EXTERIOR||b===Ct.INTERIOR)&&(n.isNull(p,m)?n._depth[p][m]=gi.depthAtLocation(b):n._depth[p][m]+=gi.depthAtLocation(b))}else if(arguments.length===3){var T=arguments[0],s=arguments[1],O=arguments[2];O===Ct.INTERIOR&&this._depth[T][s]++}};gi.prototype.interfaces_=function(){return[]};gi.prototype.getClass=function(){return gi};gi.depthAtLocation=function(n){return n===Ct.EXTERIOR?0:n===Ct.INTERIOR?1:gi.NULL_VALUE};ZE.NULL_VALUE.get=function(){return-1};Object.defineProperties(gi,ZE);var Jg=function(h){function n(){if(h.call(this),this.pts=null,this._env=null,this.eiList=new va(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new gi,this._depthDelta=0,arguments.length===1){var u=arguments[0];n.call(this,u,null)}else if(arguments.length===2){var p=arguments[0],m=arguments[1];this.pts=p,this._label=m}}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.getDepth=function(){return this._depth},n.prototype.getCollapsedEdge=function(){var p=new Array(2).fill(null);p[0]=this.pts[0],p[1]=this.pts[1];var m=new n(p,qr.toLineLabel(this._label));return m},n.prototype.isIsolated=function(){return this._isIsolated},n.prototype.getCoordinates=function(){return this.pts},n.prototype.setIsolated=function(p){this._isIsolated=p},n.prototype.setName=function(p){this._name=p},n.prototype.equals=function(p){var m=this;if(!(p instanceof n))return!1;var b=p;if(this.pts.length!==b.pts.length)return!1;for(var T=!0,s=!0,O=this.pts.length,V=0;V<this.pts.length;V++)if(m.pts[V].equals2D(b.pts[V])||(T=!1),m.pts[V].equals2D(b.pts[--O])||(s=!1),!T&&!s)return!1;return!0},n.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var p=arguments[0];return this.pts[p]}},n.prototype.print=function(p){var m=this;p.print("edge "+this._name+": "),p.print("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.print(","),p.print(m.pts[b].x+" "+m.pts[b].y);p.print(")  "+this._label+" "+this._depthDelta)},n.prototype.computeIM=function(p){n.updateIM(this._label,p)},n.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},n.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},n.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},n.prototype.getDepthDelta=function(){return this._depthDelta},n.prototype.getNumPoints=function(){return this.pts.length},n.prototype.printReverse=function(p){var m=this;p.print("edge "+this._name+": ");for(var b=this.pts.length-1;b>=0;b--)p.print(m.pts[b]+" ");p.println("")},n.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new ol(this)),this._mce},n.prototype.getEnvelope=function(){var p=this;if(this._env===null){this._env=new Be;for(var m=0;m<this.pts.length;m++)p._env.expandToInclude(p.pts[m])}return this._env},n.prototype.addIntersection=function(p,m,b,T){var s=new It(p.getIntersection(T)),O=m,V=p.getEdgeDistance(b,T),G=O+1;if(G<this.pts.length){var it=this.pts[G];s.equals2D(it)&&(O=G,V=0)}this.eiList.add(s,O,V)},n.prototype.toString=function(){var p=this,m=new Ws;m.append("edge "+this._name+": "),m.append("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&m.append(","),m.append(p.pts[b].x+" "+p.pts[b].y);return m.append(")  "+this._label+" "+this._depthDelta),m.toString()},n.prototype.isPointwiseEqual=function(p){var m=this;if(this.pts.length!==p.pts.length)return!1;for(var b=0;b<this.pts.length;b++)if(!m.pts[b].equals2D(p.pts[b]))return!1;return!0},n.prototype.setDepthDelta=function(p){this._depthDelta=p},n.prototype.getEdgeIntersectionList=function(){return this.eiList},n.prototype.addIntersections=function(p,m,b){for(var T=this,s=0;s<p.getIntersectionNum();s++)T.addIntersection(p,m,b,s)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.updateIM=function(){if(arguments.length===2){var p=arguments[0],m=arguments[1];m.setAtLeastIfValid(p.getLocation(0,pe.ON),p.getLocation(1,pe.ON),1),p.isArea()&&(m.setAtLeastIfValid(p.getLocation(0,pe.LEFT),p.getLocation(1,pe.LEFT),2),m.setAtLeastIfValid(p.getLocation(0,pe.RIGHT),p.getLocation(1,pe.RIGHT),2))}else return h.prototype.updateIM.apply(this,arguments)},n}(Io),Ni=function(n){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ms,this._bufParams=n||null};Ni.prototype.setWorkingPrecisionModel=function(n){this._workingPrecisionModel=n};Ni.prototype.insertUniqueEdge=function(n){var u=this._edgeList.findEqualEdge(n);if(u!==null){var p=u.getLabel(),m=n.getLabel();u.isPointwiseEqual(n)||(m=new qr(n.getLabel()),m.flip()),p.merge(m);var b=Ni.depthDelta(m),T=u.getDepthDelta(),s=T+b;u.setDepthDelta(s)}else this._edgeList.add(n),n.setDepthDelta(Ni.depthDelta(n.getLabel()))};Ni.prototype.buildSubgraphs=function(n,u){for(var p=new be,m=n.iterator();m.hasNext();){var b=m.next(),T=b.getRightmostCoordinate(),s=new jc(p),O=s.getDepth(T);b.computeDepth(O),b.findResultEdges(),p.add(b),u.add(b.getDirectedEdges(),b.getNodes())}};Ni.prototype.createSubgraphs=function(n){for(var u=new be,p=n.getNodes().iterator();p.hasNext();){var m=p.next();if(!m.isVisited()){var b=new Fi;b.create(m),u.add(b)}}return ds.sort(u,ds.reverseOrder()),u};Ni.prototype.createEmptyResultGeometry=function(){var n=this._geomFact.createPolygon();return n};Ni.prototype.getNoder=function(n){if(this._workingNoder!==null)return this._workingNoder;var u=new c0,p=new Xu;return p.setPrecisionModel(n),u.setSegmentIntersector(new So(p)),u};Ni.prototype.buffer=function(n,u){var p=this._workingPrecisionModel;p===null&&(p=n.getPrecisionModel()),this._geomFact=n.getFactory();var m=new Qi(p,this._bufParams),b=new Zo(n,u,m),T=b.getCurves();if(T.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(T,p),this._graph=new In(new qE),this._graph.addEdges(this._edgeList.getEdges());var s=this.createSubgraphs(this._graph),O=new po(this._geomFact);this.buildSubgraphs(s,O);var V=O.getPolygons();if(V.size()<=0)return this.createEmptyResultGeometry();var G=this._geomFact.buildGeometry(V);return G};Ni.prototype.computeNodedEdges=function(n,u){var p=this,m=this.getNoder(u);m.computeNodes(n);for(var b=m.getNodedSubstrings(),T=b.iterator();T.hasNext();){var s=T.next(),O=s.getCoordinates();if(!(O.length===2&&O[0].equals2D(O[1]))){var V=s.getData(),G=new Jg(s.getCoordinates(),new qr(V));p.insertUniqueEdge(G)}}};Ni.prototype.setNoder=function(n){this._workingNoder=n};Ni.prototype.interfaces_=function(){return[]};Ni.prototype.getClass=function(){return Ni};Ni.depthDelta=function(n){var u=n.getLocation(0,pe.LEFT),p=n.getLocation(0,pe.RIGHT);return u===Ct.INTERIOR&&p===Ct.EXTERIOR?1:u===Ct.EXTERIOR&&p===Ct.INTERIOR?-1:0};Ni.convertSegStrings=function(n){for(var u=new _r,p=new be;n.hasNext();){var m=n.next(),b=u.createLineString(m.getCoordinates());p.add(b)}return u.buildGeometry(p)};var $l=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var n=arguments[0],u=arguments[1];this._noder=n,this._scaleFactor=u,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var p=arguments[0],m=arguments[1],b=arguments[2],T=arguments[3];this._noder=p,this._scaleFactor=m,this._offsetX=b,this._offsetY=T,this._isScaled=!this.isIntegerPrecision()}};$l.prototype.rescale=function(){var n=this;if(Ke(arguments[0],Hn))for(var u=arguments[0],p=u.iterator();p.hasNext();){var m=p.next();n.rescale(m.getCoordinates())}else if(arguments[0]instanceof Array){for(var b=arguments[0],T=0;T<b.length;T++)b[T].x=b[T].x/n._scaleFactor+n._offsetX,b[T].y=b[T].y/n._scaleFactor+n._offsetY;b.length===2&&b[0].equals2D(b[1])&&_i.out.println(b)}};$l.prototype.scale=function(){var n=this;if(Ke(arguments[0],Hn)){for(var u=arguments[0],p=new be,m=u.iterator();m.hasNext();){var b=m.next();p.add(new Bn(n.scale(b.getCoordinates()),b.getData()))}return p}else if(arguments[0]instanceof Array){for(var T=arguments[0],s=new Array(T.length).fill(null),O=0;O<T.length;O++)s[O]=new It(Math.round((T[O].x-n._offsetX)*n._scaleFactor),Math.round((T[O].y-n._offsetY)*n._scaleFactor),T[O].z);var V=yr.removeRepeatedPoints(s);return V}};$l.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};$l.prototype.getNodedSubstrings=function(){var n=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(n),n};$l.prototype.computeNodes=function(n){var u=n;this._isScaled&&(u=this.scale(n)),this._noder.computeNodes(u)};$l.prototype.interfaces_=function(){return[Fu]};$l.prototype.getClass=function(){return $l};var qs=function(){this._li=new Xu,this._segStrings=null;var n=arguments[0];this._segStrings=n},XE={fact:{configurable:!0}};qs.prototype.checkEndPtVertexIntersections=function(){var n=this;if(arguments.length===0)for(var u=this._segStrings.iterator();u.hasNext();){var p=u.next(),m=p.getCoordinates();n.checkEndPtVertexIntersections(m[0],n._segStrings),n.checkEndPtVertexIntersections(m[m.length-1],n._segStrings)}else if(arguments.length===2){for(var b=arguments[0],T=arguments[1],s=T.iterator();s.hasNext();)for(var O=s.next(),V=O.getCoordinates(),G=1;G<V.length-1;G++)if(V[G].equals(b))throw new el("found endpt/interior pt intersection at index "+G+" :pt "+b)}};qs.prototype.checkInteriorIntersections=function(){var n=this;if(arguments.length===0)for(var u=this._segStrings.iterator();u.hasNext();)for(var p=u.next(),m=this._segStrings.iterator();m.hasNext();){var b=m.next();n.checkInteriorIntersections(p,b)}else if(arguments.length===2)for(var T=arguments[0],s=arguments[1],O=T.getCoordinates(),V=s.getCoordinates(),G=0;G<O.length-1;G++)for(var it=0;it<V.length-1;it++)n.checkInteriorIntersections(T,G,s,it);else if(arguments.length===4){var ot=arguments[0],dt=arguments[1],xt=arguments[2],Wt=arguments[3];if(ot===xt&&dt===Wt)return null;var Vt=ot.getCoordinates()[dt],ie=ot.getCoordinates()[dt+1],he=xt.getCoordinates()[Wt],ue=xt.getCoordinates()[Wt+1];if(this._li.computeIntersection(Vt,ie,he,ue),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Vt,ie)||this.hasInteriorIntersection(this._li,he,ue)))throw new el("found non-noded intersection at "+Vt+"-"+ie+" and "+he+"-"+ue)}};qs.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};qs.prototype.checkCollapses=function(){var n=this;if(arguments.length===0)for(var u=this._segStrings.iterator();u.hasNext();){var p=u.next();n.checkCollapses(p)}else if(arguments.length===1)for(var m=arguments[0],b=m.getCoordinates(),T=0;T<b.length-2;T++)n.checkCollapse(b[T],b[T+1],b[T+2])};qs.prototype.hasInteriorIntersection=function(n,u,p){for(var m=0;m<n.getIntersectionNum();m++){var b=n.getIntersection(m);if(!(b.equals(u)||b.equals(p)))return!0}return!1};qs.prototype.checkCollapse=function(n,u,p){if(n.equals(p))throw new el("found non-noded collapse at "+qs.fact.createLineString([n,u,p]))};qs.prototype.interfaces_=function(){return[]};qs.prototype.getClass=function(){return qs};XE.fact.get=function(){return new _r};Object.defineProperties(qs,XE);var to=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var n=arguments[0],u=arguments[1],p=arguments[2];if(this._originalPt=n,this._pt=n,this._scaleFactor=u,this._li=p,u<=0)throw new vn("Scale factor must be non-zero");u!==1&&(this._pt=new It(this.scale(n.x),this.scale(n.y)),this._p0Scaled=new It,this._p1Scaled=new It),this.initCorners(this._pt)},WE={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};to.prototype.intersectsScaled=function(n,u){var p=Math.min(n.x,u.x),m=Math.max(n.x,u.x),b=Math.min(n.y,u.y),T=Math.max(n.y,u.y),s=this._maxx<p||this._minx>m||this._maxy<b||this._miny>T;if(s)return!1;var O=this.intersectsToleranceSquare(n,u);return pr.isTrue(!(s&&O),"Found bad envelope test"),O};to.prototype.initCorners=function(n){var u=.5;this._minx=n.x-u,this._maxx=n.x+u,this._miny=n.y-u,this._maxy=n.y+u,this._corner[0]=new It(this._maxx,this._maxy),this._corner[1]=new It(this._minx,this._maxy),this._corner[2]=new It(this._minx,this._miny),this._corner[3]=new It(this._maxx,this._miny)};to.prototype.intersects=function(n,u){return this._scaleFactor===1?this.intersectsScaled(n,u):(this.copyScaled(n,this._p0Scaled),this.copyScaled(u,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};to.prototype.scale=function(n){return Math.round(n*this._scaleFactor)};to.prototype.getCoordinate=function(){return this._originalPt};to.prototype.copyScaled=function(n,u){u.x=this.scale(n.x),u.y=this.scale(n.y)};to.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var n=to.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Be(this._originalPt.x-n,this._originalPt.x+n,this._originalPt.y-n,this._originalPt.y+n)}return this._safeEnv};to.prototype.intersectsPixelClosure=function(n,u){return this._li.computeIntersection(n,u,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(n,u,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(n,u,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(n,u,this._corner[3],this._corner[0]),this._li.hasIntersection()))};to.prototype.intersectsToleranceSquare=function(n,u){var p=!1,m=!1;return this._li.computeIntersection(n,u,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(n,u,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(p=!0),this._li.computeIntersection(n,u,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(m=!0),this._li.computeIntersection(n,u,this._corner[3],this._corner[0]),this._li.isProper())||p&&m||n.equals(this._pt)||u.equals(this._pt))};to.prototype.addSnappedNode=function(n,u){var p=n.getCoordinate(u),m=n.getCoordinate(u+1);return this.intersects(p,m)?(n.addIntersection(this.getCoordinate(),u),!0):!1};to.prototype.interfaces_=function(){return[]};to.prototype.getClass=function(){return to};WE.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(to,WE);var Dd=function(){this.tempEnv1=new Be,this.selectedSegment=new Ge};Dd.prototype.select=function(){if(arguments.length!==1){if(arguments.length===2){var n=arguments[0],u=arguments[1];n.getLineSegment(u,this.selectedSegment),this.select(this.selectedSegment)}}};Dd.prototype.interfaces_=function(){return[]};Dd.prototype.getClass=function(){return Dd};var Ep=function(){this._index=null;var n=arguments[0];this._index=n},HE={HotPixelSnapAction:{configurable:!0}};Ep.prototype.snap=function(){if(arguments.length===1){var n=arguments[0];return this.snap(n,null,-1)}else if(arguments.length===3){var u=arguments[0],p=arguments[1],m=arguments[2],b=u.getSafeEnvelope(),T=new YE(u,p,m);return this._index.query(b,{interfaces_:function(){return[Wl]},visitItem:function(s){var O=s;O.select(b,T)}}),T.isNodeAdded()}};Ep.prototype.interfaces_=function(){return[]};Ep.prototype.getClass=function(){return Ep};HE.HotPixelSnapAction.get=function(){return YE};Object.defineProperties(Ep,HE);var YE=function(h){function n(){h.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var u=arguments[0],p=arguments[1],m=arguments[2];this._hotPixel=u,this._parentEdge=p,this._hotPixelVertexIndex=m}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.isNodeAdded=function(){return this._isNodeAdded},n.prototype.select=function(){if(arguments.length===2){var p=arguments[0],m=arguments[1],b=p.getContext();if(this._parentEdge!==null&&b===this._parentEdge&&m===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(b,m)}else return h.prototype.select.apply(this,arguments)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Dd),qc=function(){this._li=null,this._interiorIntersections=null;var n=arguments[0];this._li=n,this._interiorIntersections=new be};qc.prototype.processIntersections=function(n,u,p,m){var b=this;if(n===p&&u===m)return null;var T=n.getCoordinates()[u],s=n.getCoordinates()[u+1],O=p.getCoordinates()[m],V=p.getCoordinates()[m+1];if(this._li.computeIntersection(T,s,O,V),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var G=0;G<this._li.getIntersectionNum();G++)b._interiorIntersections.add(b._li.getIntersection(G));n.addIntersections(this._li,u,0),p.addIntersections(this._li,m,1)}};qc.prototype.isDone=function(){return!1};qc.prototype.getInteriorIntersections=function(){return this._interiorIntersections};qc.prototype.interfaces_=function(){return[Vu]};qc.prototype.getClass=function(){return qc};var xa=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var n=arguments[0];this._pm=n,this._li=new Xu,this._li.setPrecisionModel(n),this._scaleFactor=n.getScale()};xa.prototype.checkCorrectness=function(n){var u=Bn.getNodedSubstrings(n),p=new qs(u);try{p.checkValid()}catch(m){if(m instanceof DE)m.printStackTrace();else throw m}finally{}};xa.prototype.getNodedSubstrings=function(){return Bn.getNodedSubstrings(this._nodedSegStrings)};xa.prototype.snapRound=function(n,u){var p=this.findInteriorIntersections(n,u);this.computeIntersectionSnaps(p),this.computeVertexSnaps(n)};xa.prototype.findInteriorIntersections=function(n,u){var p=new qc(u);return this._noder.setSegmentIntersector(p),this._noder.computeNodes(n),p.getInteriorIntersections()};xa.prototype.computeVertexSnaps=function(){var n=this;if(Ke(arguments[0],Hn))for(var u=arguments[0],p=u.iterator();p.hasNext();){var m=p.next();n.computeVertexSnaps(m)}else if(arguments[0]instanceof Bn)for(var b=arguments[0],T=b.getCoordinates(),s=0;s<T.length;s++){var O=new to(T[s],n._scaleFactor,n._li),V=n._pointSnapper.snap(O,b,s);V&&b.addIntersection(T[s],s)}};xa.prototype.computeNodes=function(n){this._nodedSegStrings=n,this._noder=new c0,this._pointSnapper=new Ep(this._noder.getIndex()),this.snapRound(n,this._li)};xa.prototype.computeIntersectionSnaps=function(n){for(var u=this,p=n.iterator();p.hasNext();){var m=p.next(),b=new to(m,u._scaleFactor,u._li);u._pointSnapper.snap(b)}};xa.prototype.interfaces_=function(){return[Fu]};xa.prototype.getClass=function(){return xa};var mi=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new kr,this._resultGeometry=null,this._saveException=null,arguments.length===1){var n=arguments[0];this._argGeom=n}else if(arguments.length===2){var u=arguments[0],p=arguments[1];this._argGeom=u,this._bufParams=p}},zp={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};mi.prototype.bufferFixedPrecision=function(n){var u=new $l(new xa(new Fr(1)),n.getScale()),p=new Ni(this._bufParams);p.setWorkingPrecisionModel(n),p.setNoder(u),this._resultGeometry=p.buffer(this._argGeom,this._distance)};mi.prototype.bufferReducedPrecision=function(){var n=this;if(arguments.length===0){for(var u=mi.MAX_PRECISION_DIGITS;u>=0;u--){try{n.bufferReducedPrecision(u)}catch(T){if(T instanceof nl)n._saveException=T;else throw T}finally{}if(n._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var p=arguments[0],m=mi.precisionScaleFactor(this._argGeom,this._distance,p),b=new Fr(m);this.bufferFixedPrecision(b)}};mi.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var n=this._argGeom.getFactory().getPrecisionModel();n.getType()===Fr.FIXED?this.bufferFixedPrecision(n):this.bufferReducedPrecision()};mi.prototype.setQuadrantSegments=function(n){this._bufParams.setQuadrantSegments(n)};mi.prototype.bufferOriginalPrecision=function(){try{var n=new Ni(this._bufParams);this._resultGeometry=n.buffer(this._argGeom,this._distance)}catch(u){if(u instanceof el)this._saveException=u;else throw u}finally{}};mi.prototype.getResultGeometry=function(n){return this._distance=n,this.computeGeometry(),this._resultGeometry};mi.prototype.setEndCapStyle=function(n){this._bufParams.setEndCapStyle(n)};mi.prototype.interfaces_=function(){return[]};mi.prototype.getClass=function(){return mi};mi.bufferOp=function(){if(arguments.length===2){var n=arguments[0],u=arguments[1],p=new mi(n),m=p.getResultGeometry(u);return m}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Je&&typeof arguments[1]=="number"){var b=arguments[0],T=arguments[1],s=arguments[2],O=new mi(b);O.setQuadrantSegments(s);var V=O.getResultGeometry(T);return V}else if(arguments[2]instanceof kr&&arguments[0]instanceof Je&&typeof arguments[1]=="number"){var G=arguments[0],it=arguments[1],ot=arguments[2],dt=new mi(G,ot),xt=dt.getResultGeometry(it);return xt}}else if(arguments.length===4){var Wt=arguments[0],Vt=arguments[1],ie=arguments[2],he=arguments[3],ue=new mi(Wt);ue.setQuadrantSegments(ie),ue.setEndCapStyle(he);var Ne=ue.getResultGeometry(Vt);return Ne}};mi.precisionScaleFactor=function(n,u,p){var m=n.getEnvelopeInternal(),b=Eo.max(Math.abs(m.getMaxX()),Math.abs(m.getMaxY()),Math.abs(m.getMinX()),Math.abs(m.getMinY())),T=u>0?u:0,s=b+2*T,O=Math.trunc(Math.log(s)/Math.log(10)+1),V=p-O,G=Math.pow(10,V);return G};zp.CAP_ROUND.get=function(){return kr.CAP_ROUND};zp.CAP_BUTT.get=function(){return kr.CAP_FLAT};zp.CAP_FLAT.get=function(){return kr.CAP_FLAT};zp.CAP_SQUARE.get=function(){return kr.CAP_SQUARE};zp.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(mi,zp);var Ri=function(){this._pt=[new It,new It],this._distance=or.NaN,this._isNull=!0};Ri.prototype.getCoordinates=function(){return this._pt};Ri.prototype.getCoordinate=function(n){return this._pt[n]};Ri.prototype.setMinimum=function(){if(arguments.length===1){var n=arguments[0];this.setMinimum(n._pt[0],n._pt[1])}else if(arguments.length===2){var u=arguments[0],p=arguments[1];if(this._isNull)return this.initialize(u,p),null;var m=u.distance(p);m<this._distance&&this.initialize(u,p,m)}};Ri.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var n=arguments[0],u=arguments[1];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(u),this._distance=n.distance(u),this._isNull=!1}else if(arguments.length===3){var p=arguments[0],m=arguments[1],b=arguments[2];this._pt[0].setCoordinate(p),this._pt[1].setCoordinate(m),this._distance=b,this._isNull=!1}};Ri.prototype.getDistance=function(){return this._distance};Ri.prototype.setMaximum=function(){if(arguments.length===1){var n=arguments[0];this.setMaximum(n._pt[0],n._pt[1])}else if(arguments.length===2){var u=arguments[0],p=arguments[1];if(this._isNull)return this.initialize(u,p),null;var m=u.distance(p);m>this._distance&&this.initialize(u,p,m)}};Ri.prototype.interfaces_=function(){return[]};Ri.prototype.getClass=function(){return Ri};var pa=function(){};pa.prototype.interfaces_=function(){return[]};pa.prototype.getClass=function(){return pa};pa.computeDistance=function(){if(arguments[2]instanceof Ri&&arguments[0]instanceof Mn&&arguments[1]instanceof It)for(var n=arguments[0],u=arguments[1],p=arguments[2],m=n.getCoordinates(),b=new Ge,T=0;T<m.length-1;T++){b.setCoordinates(m[T],m[T+1]);var s=b.closestPoint(u);p.setMinimum(s,u)}else if(arguments[2]instanceof Ri&&arguments[0]instanceof Kn&&arguments[1]instanceof It){var O=arguments[0],V=arguments[1],G=arguments[2];pa.computeDistance(O.getExteriorRing(),V,G);for(var it=0;it<O.getNumInteriorRing();it++)pa.computeDistance(O.getInteriorRingN(it),V,G)}else if(arguments[2]instanceof Ri&&arguments[0]instanceof Je&&arguments[1]instanceof It){var ot=arguments[0],dt=arguments[1],xt=arguments[2];if(ot instanceof Mn)pa.computeDistance(ot,dt,xt);else if(ot instanceof Kn)pa.computeDistance(ot,dt,xt);else if(ot instanceof ki)for(var Wt=ot,Vt=0;Vt<Wt.getNumGeometries();Vt++){var ie=Wt.getGeometryN(Vt);pa.computeDistance(ie,dt,xt)}else xt.setMinimum(ot.getCoordinate(),dt)}else if(arguments[2]instanceof Ri&&arguments[0]instanceof Ge&&arguments[1]instanceof It){var he=arguments[0],ue=arguments[1],Ne=arguments[2],je=he.closestPoint(ue);Ne.setMinimum(je,ue)}};var Gu=function(n){this._maxPtDist=new Ri,this._inputGeom=n||null},h0={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Gu.prototype.computeMaxMidpointDistance=function(n){var u=new Jl(this._inputGeom);n.apply(u),this._maxPtDist.setMaximum(u.getMaxPointDistance())};Gu.prototype.computeMaxVertexDistance=function(n){var u=new Zc(this._inputGeom);n.apply(u),this._maxPtDist.setMaximum(u.getMaxPointDistance())};Gu.prototype.findDistance=function(n){return this.computeMaxVertexDistance(n),this.computeMaxMidpointDistance(n),this._maxPtDist.getDistance()};Gu.prototype.getDistancePoints=function(){return this._maxPtDist};Gu.prototype.interfaces_=function(){return[]};Gu.prototype.getClass=function(){return Gu};h0.MaxPointDistanceFilter.get=function(){return Zc};h0.MaxMidpointDistanceFilter.get=function(){return Jl};Object.defineProperties(Gu,h0);var Zc=function(n){this._maxPtDist=new Ri,this._minPtDist=new Ri,this._geom=n||null};Zc.prototype.filter=function(n){this._minPtDist.initialize(),pa.computeDistance(this._geom,n,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Zc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Zc.prototype.interfaces_=function(){return[ma]};Zc.prototype.getClass=function(){return Zc};var Jl=function(n){this._maxPtDist=new Ri,this._minPtDist=new Ri,this._geom=n||null};Jl.prototype.filter=function(n,u){if(u===0)return null;var p=n.getCoordinate(u-1),m=n.getCoordinate(u),b=new It((p.x+m.x)/2,(p.y+m.y)/2);this._minPtDist.initialize(),pa.computeDistance(this._geom,b,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Jl.prototype.isDone=function(){return!1};Jl.prototype.isGeometryChanged=function(){return!1};Jl.prototype.getMaxPointDistance=function(){return this._maxPtDist};Jl.prototype.interfaces_=function(){return[ps]};Jl.prototype.getClass=function(){return Jl};var tl=function(n){this._comps=n||null};tl.prototype.filter=function(n){n instanceof Kn&&this._comps.add(n)};tl.prototype.interfaces_=function(){return[Bs]};tl.prototype.getClass=function(){return tl};tl.getPolygons=function(){if(arguments.length===1){var n=arguments[0];return tl.getPolygons(n,new be)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];return u instanceof Kn?p.add(u):u instanceof ki&&u.apply(new tl(p)),p}};var di=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var n=arguments[0];this._lines=n}else if(arguments.length===2){var u=arguments[0],p=arguments[1];this._lines=u,this._isForcedToLineString=p}};di.prototype.filter=function(n){if(this._isForcedToLineString&&n instanceof ga){var u=n.getFactory().createLineString(n.getCoordinateSequence());return this._lines.add(u),null}n instanceof Mn&&this._lines.add(n)};di.prototype.setForceToLineString=function(n){this._isForcedToLineString=n};di.prototype.interfaces_=function(){return[rl]};di.prototype.getClass=function(){return di};di.getGeometry=function(){if(arguments.length===1){var n=arguments[0];return n.getFactory().buildGeometry(di.getLines(n))}else if(arguments.length===2){var u=arguments[0],p=arguments[1];return u.getFactory().buildGeometry(di.getLines(u,p))}};di.getLines=function(){if(arguments.length===1){var n=arguments[0];return di.getLines(n,!1)}else if(arguments.length===2){if(Ke(arguments[0],Hn)&&Ke(arguments[1],Hn)){for(var u=arguments[0],p=arguments[1],m=u.iterator();m.hasNext();){var b=m.next();di.getLines(b,p)}return p}else if(arguments[0]instanceof Je&&typeof arguments[1]=="boolean"){var T=arguments[0],s=arguments[1],O=new be;return T.apply(new di(O,s)),O}else if(arguments[0]instanceof Je&&Ke(arguments[1],Hn)){var V=arguments[0],G=arguments[1];return V instanceof Mn?G.add(V):V.apply(new di(G)),G}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&Ke(arguments[0],Hn)&&Ke(arguments[1],Hn)){for(var it=arguments[0],ot=arguments[1],dt=arguments[2],xt=it.iterator();xt.hasNext();){var Wt=xt.next();di.getLines(Wt,ot,dt)}return ot}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Je&&Ke(arguments[1],Hn)){var Vt=arguments[0],ie=arguments[1],he=arguments[2];return Vt.apply(new di(ie,he)),ie}}};var gs=function(){if(this._boundaryRule=jo.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){var n=arguments[0];if(n===null)throw new vn("Rule must be non-null");this._boundaryRule=n}}};gs.prototype.locateInternal=function(){var n=this;if(arguments[0]instanceof It&&arguments[1]instanceof Kn){var u=arguments[0],p=arguments[1];if(p.isEmpty())return Ct.EXTERIOR;var m=p.getExteriorRing(),b=this.locateInPolygonRing(u,m);if(b===Ct.EXTERIOR)return Ct.EXTERIOR;if(b===Ct.BOUNDARY)return Ct.BOUNDARY;for(var T=0;T<p.getNumInteriorRing();T++){var s=p.getInteriorRingN(T),O=n.locateInPolygonRing(u,s);if(O===Ct.INTERIOR)return Ct.EXTERIOR;if(O===Ct.BOUNDARY)return Ct.BOUNDARY}return Ct.INTERIOR}else if(arguments[0]instanceof It&&arguments[1]instanceof Mn){var V=arguments[0],G=arguments[1];if(!G.getEnvelopeInternal().intersects(V))return Ct.EXTERIOR;var it=G.getCoordinates();return!G.isClosed()&&(V.equals(it[0])||V.equals(it[it.length-1]))?Ct.BOUNDARY:Ce.isOnLine(V,it)?Ct.INTERIOR:Ct.EXTERIOR}else if(arguments[0]instanceof It&&arguments[1]instanceof ho){var ot=arguments[0],dt=arguments[1],xt=dt.getCoordinate();return xt.equals2D(ot)?Ct.INTERIOR:Ct.EXTERIOR}};gs.prototype.locateInPolygonRing=function(n,u){return u.getEnvelopeInternal().intersects(n)?Ce.locatePointInRing(n,u.getCoordinates()):Ct.EXTERIOR};gs.prototype.intersects=function(n,u){return this.locate(n,u)!==Ct.EXTERIOR};gs.prototype.updateLocationInfo=function(n){n===Ct.INTERIOR&&(this._isIn=!0),n===Ct.BOUNDARY&&this._numBoundaries++};gs.prototype.computeLocation=function(n,u){var p=this;if(u instanceof ho&&this.updateLocationInfo(this.locateInternal(n,u)),u instanceof Mn)this.updateLocationInfo(this.locateInternal(n,u));else if(u instanceof Kn)this.updateLocationInfo(this.locateInternal(n,u));else if(u instanceof ku)for(var m=u,b=0;b<m.getNumGeometries();b++){var T=m.getGeometryN(b);p.updateLocationInfo(p.locateInternal(n,T))}else if(u instanceof fa)for(var s=u,O=0;O<s.getNumGeometries();O++){var V=s.getGeometryN(O);p.updateLocationInfo(p.locateInternal(n,V))}else if(u instanceof ki)for(var G=new da(u);G.hasNext();){var it=G.next();it!==u&&p.computeLocation(n,it)}};gs.prototype.locate=function(n,u){return u.isEmpty()?Ct.EXTERIOR:u instanceof Mn?this.locateInternal(n,u):u instanceof Kn?this.locateInternal(n,u):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(n,u),this._boundaryRule.isInBoundary(this._numBoundaries)?Ct.BOUNDARY:this._numBoundaries>0||this._isIn?Ct.INTERIOR:Ct.EXTERIOR)};gs.prototype.interfaces_=function(){return[]};gs.prototype.getClass=function(){return gs};var Oi=function h(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var n=arguments[0],u=arguments[1];h.call(this,n,h.INSIDE_AREA,u)}else if(arguments.length===3){var p=arguments[0],m=arguments[1],b=arguments[2];this._component=p,this._segIndex=m,this._pt=b}},$E={INSIDE_AREA:{configurable:!0}};Oi.prototype.isInsideArea=function(){return this._segIndex===Oi.INSIDE_AREA};Oi.prototype.getCoordinate=function(){return this._pt};Oi.prototype.getGeometryComponent=function(){return this._component};Oi.prototype.getSegmentIndex=function(){return this._segIndex};Oi.prototype.interfaces_=function(){return[]};Oi.prototype.getClass=function(){return Oi};$E.INSIDE_AREA.get=function(){return-1};Object.defineProperties(Oi,$E);var ql=function(n){this._pts=n||null};ql.prototype.filter=function(n){n instanceof ho&&this._pts.add(n)};ql.prototype.interfaces_=function(){return[Bs]};ql.prototype.getClass=function(){return ql};ql.getPoints=function(){if(arguments.length===1){var n=arguments[0];return n instanceof ho?ds.singletonList(n):ql.getPoints(n,new be)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];return u instanceof ho?p.add(u):u instanceof ki&&u.apply(new ql(p)),p}};var Xc=function(){this._locations=null;var n=arguments[0];this._locations=n};Xc.prototype.filter=function(n){(n instanceof ho||n instanceof Mn||n instanceof Kn)&&this._locations.add(new Oi(n,0,n.getCoordinate()))};Xc.prototype.interfaces_=function(){return[Bs]};Xc.prototype.getClass=function(){return Xc};Xc.getLocations=function(n){var u=new be;return n.apply(new Xc(u)),u};var yi=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new gs,this._minDistanceLocation=null,this._minDistance=or.MAX_VALUE,arguments.length===2){var n=arguments[0],u=arguments[1];this._geom=[n,u],this._terminateDistance=0}else if(arguments.length===3){var p=arguments[0],m=arguments[1],b=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=p,this._geom[1]=m,this._terminateDistance=b}};yi.prototype.computeContainmentDistance=function(){var n=this;if(arguments.length===0){var u=new Array(2).fill(null);if(this.computeContainmentDistance(0,u),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,u)}else if(arguments.length===2){var p=arguments[0],m=arguments[1],b=1-p,T=tl.getPolygons(this._geom[p]);if(T.size()>0){var s=Xc.getLocations(this._geom[b]);if(this.computeContainmentDistance(s,T,m),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[b]=m[0],this._minDistanceLocation[p]=m[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&Ke(arguments[0],cs)&&Ke(arguments[1],cs)){for(var O=arguments[0],V=arguments[1],G=arguments[2],it=0;it<O.size();it++)for(var ot=O.get(it),dt=0;dt<V.size();dt++)if(n.computeContainmentDistance(ot,V.get(dt),G),n._minDistance<=n._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Oi&&arguments[1]instanceof Kn){var xt=arguments[0],Wt=arguments[1],Vt=arguments[2],ie=xt.getCoordinate();if(Ct.EXTERIOR!==this._ptLocator.locate(ie,Wt))return this._minDistance=0,Vt[0]=xt,Vt[1]=new Oi(Wt,ie),null}}};yi.prototype.computeMinDistanceLinesPoints=function(n,u,p){for(var m=this,b=0;b<n.size();b++)for(var T=n.get(b),s=0;s<u.size();s++){var O=u.get(s);if(m.computeMinDistance(T,O,p),m._minDistance<=m._terminateDistance)return null}};yi.prototype.computeFacetDistance=function(){var n=new Array(2).fill(null),u=di.getLines(this._geom[0]),p=di.getLines(this._geom[1]),m=ql.getPoints(this._geom[0]),b=ql.getPoints(this._geom[1]);if(this.computeMinDistanceLines(u,p,n),this.updateMinDistance(n,!1),this._minDistance<=this._terminateDistance||(n[0]=null,n[1]=null,this.computeMinDistanceLinesPoints(u,b,n),this.updateMinDistance(n,!1),this._minDistance<=this._terminateDistance)||(n[0]=null,n[1]=null,this.computeMinDistanceLinesPoints(p,m,n),this.updateMinDistance(n,!0),this._minDistance<=this._terminateDistance))return null;n[0]=null,n[1]=null,this.computeMinDistancePoints(m,b,n),this.updateMinDistance(n,!1)};yi.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};yi.prototype.updateMinDistance=function(n,u){if(n[0]===null)return null;u?(this._minDistanceLocation[0]=n[1],this._minDistanceLocation[1]=n[0]):(this._minDistanceLocation[0]=n[0],this._minDistanceLocation[1]=n[1])};yi.prototype.nearestPoints=function(){this.computeMinDistance();var n=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return n};yi.prototype.computeMinDistance=function(){var n=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Mn&&arguments[1]instanceof ho){var u=arguments[0],p=arguments[1],m=arguments[2];if(u.getEnvelopeInternal().distance(p.getEnvelopeInternal())>this._minDistance)return null;for(var b=u.getCoordinates(),T=p.getCoordinate(),s=0;s<b.length-1;s++){var O=Ce.distancePointLine(T,b[s],b[s+1]);if(O<n._minDistance){n._minDistance=O;var V=new Ge(b[s],b[s+1]),G=V.closestPoint(T);m[0]=new Oi(u,s,G),m[1]=new Oi(p,0,T)}if(n._minDistance<=n._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Mn&&arguments[1]instanceof Mn){var it=arguments[0],ot=arguments[1],dt=arguments[2];if(it.getEnvelopeInternal().distance(ot.getEnvelopeInternal())>this._minDistance)return null;for(var xt=it.getCoordinates(),Wt=ot.getCoordinates(),Vt=0;Vt<xt.length-1;Vt++)for(var ie=0;ie<Wt.length-1;ie++){var he=Ce.distanceLineLine(xt[Vt],xt[Vt+1],Wt[ie],Wt[ie+1]);if(he<n._minDistance){n._minDistance=he;var ue=new Ge(xt[Vt],xt[Vt+1]),Ne=new Ge(Wt[ie],Wt[ie+1]),je=ue.closestPoints(Ne);dt[0]=new Oi(it,Vt,je[0]),dt[1]=new Oi(ot,ie,je[1])}if(n._minDistance<=n._terminateDistance)return null}}}};yi.prototype.computeMinDistancePoints=function(n,u,p){for(var m=this,b=0;b<n.size();b++)for(var T=n.get(b),s=0;s<u.size();s++){var O=u.get(s),V=T.getCoordinate().distance(O.getCoordinate());if(V<m._minDistance&&(m._minDistance=V,p[0]=new Oi(T,0,T.getCoordinate()),p[1]=new Oi(O,0,O.getCoordinate())),m._minDistance<=m._terminateDistance)return null}};yi.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new vn("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};yi.prototype.computeMinDistanceLines=function(n,u,p){for(var m=this,b=0;b<n.size();b++)for(var T=n.get(b),s=0;s<u.size();s++){var O=u.get(s);if(m.computeMinDistance(T,O,p),m._minDistance<=m._terminateDistance)return null}};yi.prototype.interfaces_=function(){return[]};yi.prototype.getClass=function(){return yi};yi.distance=function(n,u){var p=new yi(n,u);return p.distance()};yi.isWithinDistance=function(n,u,p){var m=new yi(n,u,p);return m.distance()<=p};yi.nearestPoints=function(n,u){var p=new yi(n,u);return p.nearestPoints()};var Ci=function(){this._pt=[new It,new It],this._distance=or.NaN,this._isNull=!0};Ci.prototype.getCoordinates=function(){return this._pt};Ci.prototype.getCoordinate=function(n){return this._pt[n]};Ci.prototype.setMinimum=function(){if(arguments.length===1){var n=arguments[0];this.setMinimum(n._pt[0],n._pt[1])}else if(arguments.length===2){var u=arguments[0],p=arguments[1];if(this._isNull)return this.initialize(u,p),null;var m=u.distance(p);m<this._distance&&this.initialize(u,p,m)}};Ci.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var n=arguments[0],u=arguments[1];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(u),this._distance=n.distance(u),this._isNull=!1}else if(arguments.length===3){var p=arguments[0],m=arguments[1],b=arguments[2];this._pt[0].setCoordinate(p),this._pt[1].setCoordinate(m),this._distance=b,this._isNull=!1}};Ci.prototype.toString=function(){return hs.toLineString(this._pt[0],this._pt[1])};Ci.prototype.getDistance=function(){return this._distance};Ci.prototype.setMaximum=function(){if(arguments.length===1){var n=arguments[0];this.setMaximum(n._pt[0],n._pt[1])}else if(arguments.length===2){var u=arguments[0],p=arguments[1];if(this._isNull)return this.initialize(u,p),null;var m=u.distance(p);m>this._distance&&this.initialize(u,p,m)}};Ci.prototype.interfaces_=function(){return[]};Ci.prototype.getClass=function(){return Ci};var Os=function(){};Os.prototype.interfaces_=function(){return[]};Os.prototype.getClass=function(){return Os};Os.computeDistance=function(){if(arguments[2]instanceof Ci&&arguments[0]instanceof Mn&&arguments[1]instanceof It)for(var n=arguments[0],u=arguments[1],p=arguments[2],m=new Ge,b=n.getCoordinates(),T=0;T<b.length-1;T++){m.setCoordinates(b[T],b[T+1]);var s=m.closestPoint(u);p.setMinimum(s,u)}else if(arguments[2]instanceof Ci&&arguments[0]instanceof Kn&&arguments[1]instanceof It){var O=arguments[0],V=arguments[1],G=arguments[2];Os.computeDistance(O.getExteriorRing(),V,G);for(var it=0;it<O.getNumInteriorRing();it++)Os.computeDistance(O.getInteriorRingN(it),V,G)}else if(arguments[2]instanceof Ci&&arguments[0]instanceof Je&&arguments[1]instanceof It){var ot=arguments[0],dt=arguments[1],xt=arguments[2];if(ot instanceof Mn)Os.computeDistance(ot,dt,xt);else if(ot instanceof Kn)Os.computeDistance(ot,dt,xt);else if(ot instanceof ki)for(var Wt=ot,Vt=0;Vt<Wt.getNumGeometries();Vt++){var ie=Wt.getGeometryN(Vt);Os.computeDistance(ie,dt,xt)}else xt.setMinimum(ot.getCoordinate(),dt)}else if(arguments[2]instanceof Ci&&arguments[0]instanceof Ge&&arguments[1]instanceof It){var he=arguments[0],ue=arguments[1],Ne=arguments[2],je=he.closestPoint(ue);Ne.setMinimum(je,ue)}};var Go=function(){this._g0=null,this._g1=null,this._ptDist=new Ci,this._densifyFrac=0;var n=arguments[0],u=arguments[1];this._g0=n,this._g1=u},p0={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Go.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};Go.prototype.setDensifyFraction=function(n){if(n>1||n<=0)throw new vn("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=n};Go.prototype.compute=function(n,u){this.computeOrientedDistance(n,u,this._ptDist),this.computeOrientedDistance(u,n,this._ptDist)};Go.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};Go.prototype.computeOrientedDistance=function(n,u,p){var m=new Wc(u);if(n.apply(m),p.setMaximum(m.getMaxPointDistance()),this._densifyFrac>0){var b=new Kl(u,this._densifyFrac);n.apply(b),p.setMaximum(b.getMaxPointDistance())}};Go.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};Go.prototype.interfaces_=function(){return[]};Go.prototype.getClass=function(){return Go};Go.distance=function(){if(arguments.length===2){var n=arguments[0],u=arguments[1],p=new Go(n,u);return p.distance()}else if(arguments.length===3){var m=arguments[0],b=arguments[1],T=arguments[2],s=new Go(m,b);return s.setDensifyFraction(T),s.distance()}};p0.MaxPointDistanceFilter.get=function(){return Wc};p0.MaxDensifiedByFractionDistanceFilter.get=function(){return Kl};Object.defineProperties(Go,p0);var Wc=function(){this._maxPtDist=new Ci,this._minPtDist=new Ci,this._euclideanDist=new Os,this._geom=null;var n=arguments[0];this._geom=n};Wc.prototype.filter=function(n){this._minPtDist.initialize(),Os.computeDistance(this._geom,n,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Wc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Wc.prototype.interfaces_=function(){return[ma]};Wc.prototype.getClass=function(){return Wc};var Kl=function(){this._maxPtDist=new Ci,this._minPtDist=new Ci,this._geom=null,this._numSubSegs=0;var n=arguments[0],u=arguments[1];this._geom=n,this._numSubSegs=Math.trunc(Math.round(1/u))};Kl.prototype.filter=function(n,u){var p=this;if(u===0)return null;for(var m=n.getCoordinate(u-1),b=n.getCoordinate(u),T=(b.x-m.x)/this._numSubSegs,s=(b.y-m.y)/this._numSubSegs,O=0;O<this._numSubSegs;O++){var V=m.x+O*T,G=m.y+O*s,it=new It(V,G);p._minPtDist.initialize(),Os.computeDistance(p._geom,it,p._minPtDist),p._maxPtDist.setMaximum(p._minPtDist)}};Kl.prototype.isDone=function(){return!1};Kl.prototype.isGeometryChanged=function(){return!1};Kl.prototype.getMaxPointDistance=function(){return this._maxPtDist};Kl.prototype.interfaces_=function(){return[ps]};Kl.prototype.getClass=function(){return Kl};var co=function(n,u,p){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=n||null,this._bufDistance=u||null,this._result=p||null},f0={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};co.prototype.checkMaximumDistance=function(n,u,p){var m=new Go(u,n);if(m.setDensifyFraction(.25),this._maxDistanceFound=m.orientedDistance(),this._maxDistanceFound>p){this._isValid=!1;var b=m.getCoordinates();this._errorLocation=b[1],this._errorIndicator=n.getFactory().createLineString(b),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+hs.toLineString(b[0],b[1])+")"}};co.prototype.isValid=function(){var n=Math.abs(this._bufDistance),u=co.MAX_DISTANCE_DIFF_FRAC*n;return this._minValidDistance=n-u,this._maxValidDistance=n+u,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),co.VERBOSE&&_i.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};co.prototype.checkNegativeValid=function(){if(!(this._input instanceof Kn||this._input instanceof fa||this._input instanceof ki))return null;var n=this.getPolygonLines(this._input);if(this.checkMinimumDistance(n,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(n,this._result,this._maxValidDistance)};co.prototype.getErrorIndicator=function(){return this._errorIndicator};co.prototype.checkMinimumDistance=function(n,u,p){var m=new yi(n,u,p);if(this._minDistanceFound=m.distance(),this._minDistanceFound<p){this._isValid=!1;var b=m.nearestPoints();this._errorLocation=m.nearestPoints()[1],this._errorIndicator=n.getFactory().createLineString(b),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+hs.toLineString(b[0],b[1])+" )"}};co.prototype.checkPositiveValid=function(){var n=this._result.getBoundary();if(this.checkMinimumDistance(this._input,n,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,n,this._maxValidDistance)};co.prototype.getErrorLocation=function(){return this._errorLocation};co.prototype.getPolygonLines=function(n){for(var u=new be,p=new di(u),m=tl.getPolygons(n),b=m.iterator();b.hasNext();){var T=b.next();T.apply(p)}return n.getFactory().buildGeometry(u)};co.prototype.getErrorMessage=function(){return this._errMsg};co.prototype.interfaces_=function(){return[]};co.prototype.getClass=function(){return co};f0.VERBOSE.get=function(){return!1};f0.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(co,f0);var vi=function(n,u,p){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=n||null,this._distance=u||null,this._result=p||null},d0={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};vi.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};vi.prototype.checkEnvelope=function(){if(this._distance<0)return null;var n=this._distance*vi.MAX_ENV_DIFF_FRAC;n===0&&(n=.001);var u=new Be(this._input.getEnvelopeInternal());u.expandBy(this._distance);var p=new Be(this._result.getEnvelopeInternal());p.expandBy(n),p.contains(u)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(p)),this.report("Envelope")};vi.prototype.checkDistance=function(){var n=new co(this._input,this._distance,this._result);n.isValid()||(this._isValid=!1,this._errorMsg=n.getErrorMessage(),this._errorLocation=n.getErrorLocation(),this._errorIndicator=n.getErrorIndicator()),this.report("Distance")};vi.prototype.checkArea=function(){var n=this._input.getArea(),u=this._result.getArea();this._distance>0&&n>u&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&n<u&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};vi.prototype.checkPolygonal=function(){this._result instanceof Kn||this._result instanceof fa||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};vi.prototype.getErrorIndicator=function(){return this._errorIndicator};vi.prototype.getErrorLocation=function(){return this._errorLocation};vi.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};vi.prototype.report=function(n){if(!vi.VERBOSE)return null;_i.out.println("Check "+n+": "+(this._isValid?"passed":"FAILED"))};vi.prototype.getErrorMessage=function(){return this._errorMsg};vi.prototype.interfaces_=function(){return[]};vi.prototype.getClass=function(){return vi};vi.isValidMsg=function(n,u,p){var m=new vi(n,u,p);return m.isValid()?null:m.getErrorMessage()};vi.isValid=function(n,u,p){var m=new vi(n,u,p);return!!m.isValid()};d0.VERBOSE.get=function(){return!1};d0.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(vi,d0);var Zs=function(){this._pts=null,this._data=null;var n=arguments[0],u=arguments[1];this._pts=n,this._data=u};Zs.prototype.getCoordinates=function(){return this._pts};Zs.prototype.size=function(){return this._pts.length};Zs.prototype.getCoordinate=function(n){return this._pts[n]};Zs.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Zs.prototype.getSegmentOctant=function(n){return n===this._pts.length-1?-1:Gc.octant(this.getCoordinate(n),this.getCoordinate(n+1))};Zs.prototype.setData=function(n){this._data=n};Zs.prototype.getData=function(){return this._data};Zs.prototype.toString=function(){return hs.toLineString(new Nn(this._pts))};Zs.prototype.interfaces_=function(){return[ya]};Zs.prototype.getClass=function(){return Zs};var ai=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new be,this._intersectionCount=0,this._keepIntersections=!0;var n=arguments[0];this._li=n,this._interiorIntersection=null};ai.prototype.getInteriorIntersection=function(){return this._interiorIntersection};ai.prototype.setCheckEndSegmentsOnly=function(n){this._isCheckEndSegmentsOnly=n};ai.prototype.getIntersectionSegments=function(){return this._intSegments};ai.prototype.count=function(){return this._intersectionCount};ai.prototype.getIntersections=function(){return this._intersections};ai.prototype.setFindAllIntersections=function(n){this._findAllIntersections=n};ai.prototype.setKeepIntersections=function(n){this._keepIntersections=n};ai.prototype.processIntersections=function(n,u,p,m){if(!this._findAllIntersections&&this.hasIntersection()||n===p&&u===m)return null;if(this._isCheckEndSegmentsOnly){var b=this.isEndSegment(n,u)||this.isEndSegment(p,m);if(!b)return null}var T=n.getCoordinates()[u],s=n.getCoordinates()[u+1],O=p.getCoordinates()[m],V=p.getCoordinates()[m+1];this._li.computeIntersection(T,s,O,V),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=T,this._intSegments[1]=s,this._intSegments[2]=O,this._intSegments[3]=V,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};ai.prototype.isEndSegment=function(n,u){return u===0||u>=n.size()-2};ai.prototype.hasIntersection=function(){return this._interiorIntersection!==null};ai.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};ai.prototype.interfaces_=function(){return[Vu]};ai.prototype.getClass=function(){return ai};ai.createAllIntersectionsFinder=function(n){var u=new ai(n);return u.setFindAllIntersections(!0),u};ai.createAnyIntersectionFinder=function(n){return new ai(n)};ai.createIntersectionCounter=function(n){var u=new ai(n);return u.setFindAllIntersections(!0),u.setKeepIntersections(!1),u};var _s=function(){this._li=new Xu,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var n=arguments[0];this._segStrings=n};_s.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};_s.prototype.getIntersections=function(){return this._segInt.getIntersections()};_s.prototype.isValid=function(){return this.execute(),this._isValid};_s.prototype.setFindAllIntersections=function(n){this._findAllIntersections=n};_s.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new ai(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var n=new c0;if(n.setSegmentIntersector(this._segInt),n.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};_s.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new nl(this.getErrorMessage(),this._segInt.getInteriorIntersection())};_s.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var n=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+hs.toLineString(n[0],n[1])+" and "+hs.toLineString(n[2],n[3])};_s.prototype.interfaces_=function(){return[]};_s.prototype.getClass=function(){return _s};_s.computeIntersections=function(n){var u=new _s(n);return u.setFindAllIntersections(!0),u.isValid(),u.getIntersections()};var ju=function h(){this._nv=null;var n=arguments[0];this._nv=new _s(h.toSegmentStrings(n))};ju.prototype.checkValid=function(){this._nv.checkValid()};ju.prototype.interfaces_=function(){return[]};ju.prototype.getClass=function(){return ju};ju.toSegmentStrings=function(n){for(var u=new be,p=n.iterator();p.hasNext();){var m=p.next();u.add(new Zs(m.getCoordinates(),m))}return u};ju.checkValid=function(n){var u=new ju(n);u.checkValid()};var Hc=function(n){this._mapOp=n};Hc.prototype.map=function(n){for(var u=this,p=new be,m=0;m<n.getNumGeometries();m++){var b=u._mapOp.map(n.getGeometryN(m));b.isEmpty()||p.add(b)}return n.getFactory().createGeometryCollection(_r.toGeometryArray(p))};Hc.prototype.interfaces_=function(){return[]};Hc.prototype.getClass=function(){return Hc};Hc.map=function(n,u){var p=new Hc(u);return p.map(n)};var Xs=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new be,this._resultLineList=new be;var n=arguments[0],u=arguments[1],p=arguments[2];this._op=n,this._geometryFactory=u,this._ptLocator=p};Xs.prototype.collectLines=function(n){for(var u=this,p=this._op.getGraph().getEdgeEnds().iterator();p.hasNext();){var m=p.next();u.collectLineEdge(m,n,u._lineEdgesList),u.collectBoundaryTouchEdge(m,n,u._lineEdgesList)}};Xs.prototype.labelIsolatedLine=function(n,u){var p=this._ptLocator.locate(n.getCoordinate(),this._op.getArgGeometry(u));n.getLabel().setLocation(u,p)};Xs.prototype.build=function(n){return this.findCoveredLineEdges(),this.collectLines(n),this.buildLines(n),this._resultLineList};Xs.prototype.collectLineEdge=function(n,u,p){var m=n.getLabel(),b=n.getEdge();n.isLineEdge()&&!n.isVisited()&&lr.isResultOfOp(m,u)&&!b.isCovered()&&(p.add(b),n.setVisitedEdge(!0))};Xs.prototype.findCoveredLineEdges=function(){for(var n=this,u=this._op.getGraph().getNodes().iterator();u.hasNext();){var p=u.next();p.getEdges().findCoveredLineEdges()}for(var m=this._op.getGraph().getEdgeEnds().iterator();m.hasNext();){var b=m.next(),T=b.getEdge();if(b.isLineEdge()&&!T.isCoveredSet()){var s=n._op.isCoveredByA(b.getCoordinate());T.setCovered(s)}}};Xs.prototype.labelIsolatedLines=function(n){for(var u=this,p=n.iterator();p.hasNext();){var m=p.next(),b=m.getLabel();m.isIsolated()&&(b.isNull(0)?u.labelIsolatedLine(m,0):u.labelIsolatedLine(m,1))}};Xs.prototype.buildLines=function(n){for(var u=this,p=this._lineEdgesList.iterator();p.hasNext();){var m=p.next(),b=u._geometryFactory.createLineString(m.getCoordinates());u._resultLineList.add(b),m.setInResult(!0)}};Xs.prototype.collectBoundaryTouchEdge=function(n,u,p){var m=n.getLabel();if(n.isLineEdge()||n.isVisited()||n.isInteriorAreaEdge()||n.getEdge().isInResult())return null;pr.isTrue(!(n.isInResult()||n.getSym().isInResult())||!n.getEdge().isInResult()),lr.isResultOfOp(m,u)&&u===lr.INTERSECTION&&(p.add(n.getEdge()),n.setVisitedEdge(!0))};Xs.prototype.interfaces_=function(){return[]};Xs.prototype.getClass=function(){return Xs};var Yc=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new be;var n=arguments[0],u=arguments[1];this._op=n,this._geometryFactory=u};Yc.prototype.filterCoveredNodeToPoint=function(n){var u=n.getCoordinate();if(!this._op.isCoveredByLA(u)){var p=this._geometryFactory.createPoint(u);this._resultPointList.add(p)}};Yc.prototype.extractNonCoveredResultNodes=function(n){for(var u=this,p=this._op.getGraph().getNodes().iterator();p.hasNext();){var m=p.next();if(!m.isInResult()&&!m.isIncidentEdgeInResult()&&(m.getEdges().getDegree()===0||n===lr.INTERSECTION)){var b=m.getLabel();lr.isResultOfOp(b,n)&&u.filterCoveredNodeToPoint(m)}}};Yc.prototype.build=function(n){return this.extractNonCoveredResultNodes(n),this._resultPointList};Yc.prototype.interfaces_=function(){return[]};Yc.prototype.getClass=function(){return Yc};var eo=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};eo.prototype.transformPoint=function(n,u){return this._factory.createPoint(this.transformCoordinates(n.getCoordinateSequence(),n))};eo.prototype.transformPolygon=function(n,u){var p=this,m=!0,b=this.transformLinearRing(n.getExteriorRing(),n);(b===null||!(b instanceof ga)||b.isEmpty())&&(m=!1);for(var T=new be,s=0;s<n.getNumInteriorRing();s++){var O=p.transformLinearRing(n.getInteriorRingN(s),n);O===null||O.isEmpty()||(O instanceof ga||(m=!1),T.add(O))}if(m)return this._factory.createPolygon(b,T.toArray([]));var V=new be;return b!==null&&V.add(b),V.addAll(T),this._factory.buildGeometry(V)};eo.prototype.createCoordinateSequence=function(n){return this._factory.getCoordinateSequenceFactory().create(n)};eo.prototype.getInputGeometry=function(){return this._inputGeom};eo.prototype.transformMultiLineString=function(n,u){for(var p=this,m=new be,b=0;b<n.getNumGeometries();b++){var T=p.transformLineString(n.getGeometryN(b),n);T!==null&&(T.isEmpty()||m.add(T))}return this._factory.buildGeometry(m)};eo.prototype.transformCoordinates=function(n,u){return this.copy(n)};eo.prototype.transformLineString=function(n,u){return this._factory.createLineString(this.transformCoordinates(n.getCoordinateSequence(),n))};eo.prototype.transformMultiPoint=function(n,u){for(var p=this,m=new be,b=0;b<n.getNumGeometries();b++){var T=p.transformPoint(n.getGeometryN(b),n);T!==null&&(T.isEmpty()||m.add(T))}return this._factory.buildGeometry(m)};eo.prototype.transformMultiPolygon=function(n,u){for(var p=this,m=new be,b=0;b<n.getNumGeometries();b++){var T=p.transformPolygon(n.getGeometryN(b),n);T!==null&&(T.isEmpty()||m.add(T))}return this._factory.buildGeometry(m)};eo.prototype.copy=function(n){return n.copy()};eo.prototype.transformGeometryCollection=function(n,u){for(var p=this,m=new be,b=0;b<n.getNumGeometries();b++){var T=p.transform(n.getGeometryN(b));T!==null&&(p._pruneEmptyGeometry&&T.isEmpty()||m.add(T))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(_r.toGeometryArray(m)):this._factory.buildGeometry(m)};eo.prototype.transform=function(n){if(this._inputGeom=n,this._factory=n.getFactory(),n instanceof ho)return this.transformPoint(n,null);if(n instanceof yp)return this.transformMultiPoint(n,null);if(n instanceof ga)return this.transformLinearRing(n,null);if(n instanceof Mn)return this.transformLineString(n,null);if(n instanceof ku)return this.transformMultiLineString(n,null);if(n instanceof Kn)return this.transformPolygon(n,null);if(n instanceof fa)return this.transformMultiPolygon(n,null);if(n instanceof ki)return this.transformGeometryCollection(n,null);throw new vn("Unknown Geometry subtype: "+n.getClass().getName())};eo.prototype.transformLinearRing=function(n,u){var p=this.transformCoordinates(n.getCoordinateSequence(),n);if(p===null)return this._factory.createLinearRing(null);var m=p.size();return m>0&&m<4&&!this._preserveType?this._factory.createLineString(p):this._factory.createLinearRing(p)};eo.prototype.interfaces_=function(){return[]};eo.prototype.getClass=function(){return eo};var ba=function h(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Ge,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Mn&&typeof arguments[1]=="number"){var n=arguments[0],u=arguments[1];h.call(this,n.getCoordinates(),u)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var p=arguments[0],m=arguments[1];this._srcPts=p,this._isClosed=h.isClosed(p),this._snapTolerance=m}};ba.prototype.snapVertices=function(n,u){for(var p=this,m=this._isClosed?n.size()-1:n.size(),b=0;b<m;b++){var T=n.get(b),s=p.findSnapForVertex(T,u);s!==null&&(n.set(b,new It(s)),b===0&&p._isClosed&&n.set(n.size()-1,new It(s)))}};ba.prototype.findSnapForVertex=function(n,u){for(var p=this,m=0;m<u.length;m++){if(n.equals2D(u[m]))return null;if(n.distance(u[m])<p._snapTolerance)return u[m]}return null};ba.prototype.snapTo=function(n){var u=new Vd(this._srcPts);this.snapVertices(u,n),this.snapSegments(u,n);var p=u.toCoordinateArray();return p};ba.prototype.snapSegments=function(n,u){var p=this;if(u.length===0)return null;var m=u.length;u[0].equals2D(u[u.length-1])&&(m=u.length-1);for(var b=0;b<m;b++){var T=u[b],s=p.findSegmentIndexToSnap(T,n);s>=0&&n.add(s+1,new It(T),!1)}};ba.prototype.findSegmentIndexToSnap=function(n,u){for(var p=this,m=or.MAX_VALUE,b=-1,T=0;T<u.size()-1;T++){if(p._seg.p0=u.get(T),p._seg.p1=u.get(T+1),p._seg.p0.equals2D(n)||p._seg.p1.equals2D(n)){if(p._allowSnappingToSourceVertices)continue;return-1}var s=p._seg.distance(n);s<p._snapTolerance&&s<m&&(m=s,b=T)}return b};ba.prototype.setAllowSnappingToSourceVertices=function(n){this._allowSnappingToSourceVertices=n};ba.prototype.interfaces_=function(){return[]};ba.prototype.getClass=function(){return ba};ba.isClosed=function(n){return n.length<=1?!1:n[0].equals2D(n[n.length-1])};var kn=function(n){this._srcGeom=n||null},JE={SNAP_PRECISION_FACTOR:{configurable:!0}};kn.prototype.snapTo=function(n,u){var p=this.extractTargetCoordinates(n),m=new KE(u,p);return m.transform(this._srcGeom)};kn.prototype.snapToSelf=function(n,u){var p=this.extractTargetCoordinates(this._srcGeom),m=new KE(n,p,!0),b=m.transform(this._srcGeom),T=b;return u&&Ke(T,Xl)&&(T=b.buffer(0)),T};kn.prototype.computeSnapTolerance=function(n){var u=this.computeMinimumSegmentLength(n),p=u/10;return p};kn.prototype.extractTargetCoordinates=function(n){for(var u=new Fs,p=n.getCoordinates(),m=0;m<p.length;m++)u.add(p[m]);return u.toArray(new Array(0).fill(null))};kn.prototype.computeMinimumSegmentLength=function(n){for(var u=or.MAX_VALUE,p=0;p<n.length-1;p++){var m=n[p].distance(n[p+1]);m<u&&(u=m)}return u};kn.prototype.interfaces_=function(){return[]};kn.prototype.getClass=function(){return kn};kn.snap=function(n,u,p){var m=new Array(2).fill(null),b=new kn(n);m[0]=b.snapTo(u,p);var T=new kn(u);return m[1]=T.snapTo(m[0],p),m};kn.computeOverlaySnapTolerance=function(){if(arguments.length===1){var n=arguments[0],u=kn.computeSizeBasedSnapTolerance(n),p=n.getPrecisionModel();if(p.getType()===Fr.FIXED){var m=1/p.getScale()*2/1.415;m>u&&(u=m)}return u}else if(arguments.length===2){var b=arguments[0],T=arguments[1];return Math.min(kn.computeOverlaySnapTolerance(b),kn.computeOverlaySnapTolerance(T))}};kn.computeSizeBasedSnapTolerance=function(n){var u=n.getEnvelopeInternal(),p=Math.min(u.getHeight(),u.getWidth()),m=p*kn.SNAP_PRECISION_FACTOR;return m};kn.snapToSelf=function(n,u,p){var m=new kn(n);return m.snapToSelf(u,p)};JE.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(kn,JE);var KE=function(h){function n(u,p,m){h.call(this),this._snapTolerance=u||null,this._snapPts=p||null,this._isSelfSnap=m!==void 0?m:!1}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.snapLine=function(p,m){var b=new ba(p,this._snapTolerance);return b.setAllowSnappingToSourceVertices(this._isSelfSnap),b.snapTo(m)},n.prototype.transformCoordinates=function(p,m){var b=p.toCoordinateArray(),T=this.snapLine(b,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(T)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(eo),Di=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Di.prototype.getCommon=function(){return or.longBitsToDouble(this._commonBits)};Di.prototype.add=function(n){var u=or.doubleToLongBits(n);if(this._isFirst)return this._commonBits=u,this._commonSignExp=Di.signExpBits(this._commonBits),this._isFirst=!1,null;var p=Di.signExpBits(u);if(p!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Di.numCommonMostSigMantissaBits(this._commonBits,u),this._commonBits=Di.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Di.prototype.toString=function(){if(arguments.length===1){var n=arguments[0],u=or.longBitsToDouble(n),p=or.toBinaryString(n),m="0000000000000000000000000000000000000000000000000000000000000000"+p,b=m.substring(m.length-64),T=b.substring(0,1)+"  "+b.substring(1,12)+"(exp) "+b.substring(12)+" [ "+u+" ]";return T}};Di.prototype.interfaces_=function(){return[]};Di.prototype.getClass=function(){return Di};Di.getBit=function(n,u){var p=1<<u;return n&p?1:0};Di.signExpBits=function(n){return n>>52};Di.zeroLowerBits=function(n,u){var p=(1<<u)-1,m=~p,b=n&m;return b};Di.numCommonMostSigMantissaBits=function(n,u){for(var p=0,m=52;m>=0;m--){if(Di.getBit(n,m)!==Di.getBit(u,m))return p;p++}return 52};var Ql=function(){this._commonCoord=null,this._ccFilter=new $c},m0={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Ql.prototype.addCommonBits=function(n){var u=new tu(this._commonCoord);n.apply(u),n.geometryChanged()};Ql.prototype.removeCommonBits=function(n){if(this._commonCoord.x===0&&this._commonCoord.y===0)return n;var u=new It(this._commonCoord);u.x=-u.x,u.y=-u.y;var p=new tu(u);return n.apply(p),n.geometryChanged(),n};Ql.prototype.getCommonCoordinate=function(){return this._commonCoord};Ql.prototype.add=function(n){n.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Ql.prototype.interfaces_=function(){return[]};Ql.prototype.getClass=function(){return Ql};m0.CommonCoordinateFilter.get=function(){return $c};m0.Translater.get=function(){return tu};Object.defineProperties(Ql,m0);var $c=function(){this._commonBitsX=new Di,this._commonBitsY=new Di};$c.prototype.filter=function(n){this._commonBitsX.add(n.x),this._commonBitsY.add(n.y)};$c.prototype.getCommonCoordinate=function(){return new It(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};$c.prototype.interfaces_=function(){return[ma]};$c.prototype.getClass=function(){return $c};var tu=function(){this.trans=null;var n=arguments[0];this.trans=n};tu.prototype.filter=function(n,u){var p=n.getOrdinate(u,0)+this.trans.x,m=n.getOrdinate(u,1)+this.trans.y;n.setOrdinate(u,0,p),n.setOrdinate(u,1,m)};tu.prototype.isDone=function(){return!1};tu.prototype.isGeometryChanged=function(){return!0};tu.prototype.interfaces_=function(){return[ps]};tu.prototype.getClass=function(){return tu};var li=function(n,u){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=n,this._geom[1]=u,this.computeSnapTolerance()};li.prototype.selfSnap=function(n){var u=new kn(n),p=u.snapTo(n,this._snapTolerance);return p};li.prototype.removeCommonBits=function(n){this._cbr=new Ql,this._cbr.add(n[0]),this._cbr.add(n[1]);var u=new Array(2).fill(null);return u[0]=this._cbr.removeCommonBits(n[0].copy()),u[1]=this._cbr.removeCommonBits(n[1].copy()),u};li.prototype.prepareResult=function(n){return this._cbr.addCommonBits(n),n};li.prototype.getResultGeometry=function(n){var u=this.snap(this._geom),p=lr.overlayOp(u[0],u[1],n);return this.prepareResult(p)};li.prototype.checkValid=function(n){n.isValid()||_i.out.println("Snapped geometry is invalid")};li.prototype.computeSnapTolerance=function(){this._snapTolerance=kn.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};li.prototype.snap=function(n){var u=this.removeCommonBits(n),p=kn.snap(u[0],u[1],this._snapTolerance);return p};li.prototype.interfaces_=function(){return[]};li.prototype.getClass=function(){return li};li.overlayOp=function(n,u,p){var m=new li(n,u);return m.getResultGeometry(p)};li.union=function(n,u){return li.overlayOp(n,u,lr.UNION)};li.intersection=function(n,u){return li.overlayOp(n,u,lr.INTERSECTION)};li.symDifference=function(n,u){return li.overlayOp(n,u,lr.SYMDIFFERENCE)};li.difference=function(n,u){return li.overlayOp(n,u,lr.DIFFERENCE)};var Vi=function(n,u){this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=u};Vi.prototype.getResultGeometry=function(n){var u=null,p=!1,m=null;try{u=lr.overlayOp(this._geom[0],this._geom[1],n);var b=!0;b&&(p=!0)}catch(T){if(T instanceof el)m=T;else throw T}finally{}if(!p)try{u=li.overlayOp(this._geom[0],this._geom[1],n)}catch(T){throw T instanceof el?m:T}finally{}return u};Vi.prototype.interfaces_=function(){return[]};Vi.prototype.getClass=function(){return Vi};Vi.overlayOp=function(n,u,p){var m=new Vi(n,u);return m.getResultGeometry(p)};Vi.union=function(n,u){return Vi.overlayOp(n,u,lr.UNION)};Vi.intersection=function(n,u){return Vi.overlayOp(n,u,lr.INTERSECTION)};Vi.symDifference=function(n,u){return Vi.overlayOp(n,u,lr.SYMDIFFERENCE)};Vi.difference=function(n,u){return Vi.overlayOp(n,u,lr.DIFFERENCE)};var Rd=function(){this.mce=null,this.chainIndex=null;var n=arguments[0],u=arguments[1];this.mce=n,this.chainIndex=u};Rd.prototype.computeIntersections=function(n,u){this.mce.computeIntersectsForChain(this.chainIndex,n.mce,n.chainIndex,u)};Rd.prototype.interfaces_=function(){return[]};Rd.prototype.getClass=function(){return Rd};var mo=function h(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var n=arguments[0],u=arguments[1];this._eventType=h.DELETE,this._xValue=n,this._insertEvent=u}else if(arguments.length===3){var p=arguments[0],m=arguments[1],b=arguments[2];this._eventType=h.INSERT,this._label=p,this._xValue=m,this._obj=b}},g0={INSERT:{configurable:!0},DELETE:{configurable:!0}};mo.prototype.isDelete=function(){return this._eventType===mo.DELETE};mo.prototype.setDeleteEventIndex=function(n){this._deleteEventIndex=n};mo.prototype.getObject=function(){return this._obj};mo.prototype.compareTo=function(n){var u=n;return this._xValue<u._xValue?-1:this._xValue>u._xValue?1:this._eventType<u._eventType?-1:this._eventType>u._eventType?1:0};mo.prototype.getInsertEvent=function(){return this._insertEvent};mo.prototype.isInsert=function(){return this._eventType===mo.INSERT};mo.prototype.isSameLabel=function(n){return this._label===null?!1:this._label===n._label};mo.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};mo.prototype.interfaces_=function(){return[Xo]};mo.prototype.getClass=function(){return mo};g0.INSERT.get=function(){return 1};g0.DELETE.get=function(){return 2};Object.defineProperties(mo,g0);var Kg=function(){};Kg.prototype.interfaces_=function(){return[]};Kg.prototype.getClass=function(){return Kg};var xi=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var n=arguments[0],u=arguments[1],p=arguments[2];this._li=n,this._includeProper=u,this._recordIsolated=p};xi.prototype.isTrivialIntersection=function(n,u,p,m){if(n===p&&this._li.getIntersectionNum()===1){if(xi.isAdjacentSegments(u,m))return!0;if(n.isClosed()){var b=n.getNumPoints()-1;if(u===0&&m===b||m===0&&u===b)return!0}}return!1};xi.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};xi.prototype.setIsDoneIfProperInt=function(n){this._isDoneWhenProperInt=n};xi.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};xi.prototype.isBoundaryPointInternal=function(n,u){for(var p=u.iterator();p.hasNext();){var m=p.next(),b=m.getCoordinate();if(n.isIntersection(b))return!0}return!1};xi.prototype.hasProperIntersection=function(){return this._hasProper};xi.prototype.hasIntersection=function(){return this._hasIntersection};xi.prototype.isDone=function(){return this._isDone};xi.prototype.isBoundaryPoint=function(n,u){return u===null?!1:!!(this.isBoundaryPointInternal(n,u[0])||this.isBoundaryPointInternal(n,u[1]))};xi.prototype.setBoundaryNodes=function(n,u){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=n,this._bdyNodes[1]=u};xi.prototype.addIntersections=function(n,u,p,m){if(n===p&&u===m)return null;this.numTests++;var b=n.getCoordinates()[u],T=n.getCoordinates()[u+1],s=p.getCoordinates()[m],O=p.getCoordinates()[m+1];this._li.computeIntersection(b,T,s,O),this._li.hasIntersection()&&(this._recordIsolated&&(n.setIsolated(!1),p.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(n,u,p,m)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(n.addIntersections(this._li,u,0),p.addIntersections(this._li,m,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};xi.prototype.interfaces_=function(){return[]};xi.prototype.getClass=function(){return xi};xi.isAdjacentSegments=function(n,u){return Math.abs(n-u)===1};var RC=function(h){function n(){h.call(this),this.events=new be,this.nOverlaps=null}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.prepareEvents=function(){var p=this;ds.sort(this.events);for(var m=0;m<this.events.size();m++){var b=p.events.get(m);b.isDelete()&&b.getInsertEvent().setDeleteEventIndex(m)}},n.prototype.computeIntersections=function(){var p=this;if(arguments.length===1){var m=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var b=0;b<this.events.size();b++){var T=p.events.get(b);if(T.isInsert()&&p.processOverlaps(b,T.getDeleteEventIndex(),T,m),m.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof xi&&Ke(arguments[0],cs)&&Ke(arguments[1],cs)){var s=arguments[0],O=arguments[1],V=arguments[2];this.addEdges(s,s),this.addEdges(O,O),this.computeIntersections(V)}else if(typeof arguments[2]=="boolean"&&Ke(arguments[0],cs)&&arguments[1]instanceof xi){var G=arguments[0],it=arguments[1],ot=arguments[2];ot?this.addEdges(G,null):this.addEdges(G),this.computeIntersections(it)}}},n.prototype.addEdge=function(p,m){for(var b=this,T=p.getMonotoneChainEdge(),s=T.getStartIndexes(),O=0;O<s.length-1;O++){var V=new Rd(T,O),G=new mo(m,T.getMinX(O),V);b.events.add(G),b.events.add(new mo(T.getMaxX(O),G))}},n.prototype.processOverlaps=function(p,m,b,T){for(var s=this,O=b.getObject(),V=p;V<m;V++){var G=s.events.get(V);if(G.isInsert()){var it=G.getObject();b.isSameLabel(G)||(O.computeIntersections(it,T),s.nOverlaps++)}}},n.prototype.addEdges=function(){var p=this;if(arguments.length===1)for(var m=arguments[0],b=m.iterator();b.hasNext();){var T=b.next();p.addEdge(T,T)}else if(arguments.length===2)for(var s=arguments[0],O=arguments[1],V=s.iterator();V.hasNext();){var G=V.next();p.addEdge(G,O)}},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Kg),wa=function(){this._min=or.POSITIVE_INFINITY,this._max=or.NEGATIVE_INFINITY},QE={NodeComparator:{configurable:!0}};wa.prototype.getMin=function(){return this._min};wa.prototype.intersects=function(n,u){return!(this._min>u||this._max<n)};wa.prototype.getMax=function(){return this._max};wa.prototype.toString=function(){return hs.toLineString(new It(this._min,0),new It(this._max,0))};wa.prototype.interfaces_=function(){return[]};wa.prototype.getClass=function(){return wa};QE.NodeComparator.get=function(){return Od};Object.defineProperties(wa,QE);var Od=function(){};Od.prototype.compare=function(n,u){var p=n,m=u,b=(p._min+p._max)/2,T=(m._min+m._max)/2;return b<T?-1:b>T?1:0};Od.prototype.interfaces_=function(){return[hp]};Od.prototype.getClass=function(){return Od};var OC=function(h){function n(){h.call(this),this._item=null;var u=arguments[0],p=arguments[1],m=arguments[2];this._min=u,this._max=p,this._item=m}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.query=function(p,m,b){if(!this.intersects(p,m))return null;b.visitItem(this._item)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(wa),zC=function(h){function n(){h.call(this),this._node1=null,this._node2=null;var u=arguments[0],p=arguments[1];this._node1=u,this._node2=p,this.buildExtent(this._node1,this._node2)}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.buildExtent=function(p,m){this._min=Math.min(p._min,m._min),this._max=Math.max(p._max,m._max)},n.prototype.query=function(p,m,b){if(!this.intersects(p,m))return null;this._node1!==null&&this._node1.query(p,m,b),this._node2!==null&&this._node2.query(p,m,b)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(wa),Ea=function(){this._leaves=new be,this._root=null,this._level=0};Ea.prototype.buildTree=function(){var n=this;ds.sort(this._leaves,new wa.NodeComparator);for(var u=this._leaves,p=null,m=new be;;){if(n.buildLevel(u,m),m.size()===1)return m.get(0);p=u,u=m,m=p}};Ea.prototype.insert=function(n,u,p){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new OC(n,u,p))};Ea.prototype.query=function(n,u,p){this.init(),this._root.query(n,u,p)};Ea.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Ea.prototype.printNode=function(n){_i.out.println(hs.toLineString(new It(n._min,this._level),new It(n._max,this._level)))};Ea.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Ea.prototype.buildLevel=function(n,u){this._level++,u.clear();for(var p=0;p<n.size();p+=2){var m=n.get(p),b=p+1<n.size()?n.get(p):null;if(b===null)u.add(m);else{var T=new zC(n.get(p),n.get(p+1));u.add(T)}}};Ea.prototype.interfaces_=function(){return[]};Ea.prototype.getClass=function(){return Ea};var Ip=function(){this._items=new be};Ip.prototype.visitItem=function(n){this._items.add(n)};Ip.prototype.getItems=function(){return this._items};Ip.prototype.interfaces_=function(){return[Wl]};Ip.prototype.getClass=function(){return Ip};var Tp=function(){this._index=null;var n=arguments[0];if(!Ke(n,Xl))throw new vn("Argument must be Polygonal");this._index=new qu(n)},_0={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Tp.prototype.locate=function(n){var u=new zs(n),p=new Sp(u);return this._index.query(n.y,n.y,p),u.getLocation()};Tp.prototype.interfaces_=function(){return[wp]};Tp.prototype.getClass=function(){return Tp};_0.SegmentVisitor.get=function(){return Sp};_0.IntervalIndexedGeometry.get=function(){return qu};Object.defineProperties(Tp,_0);var Sp=function(){this._counter=null;var n=arguments[0];this._counter=n};Sp.prototype.visitItem=function(n){var u=n;this._counter.countSegment(u.getCoordinate(0),u.getCoordinate(1))};Sp.prototype.interfaces_=function(){return[Wl]};Sp.prototype.getClass=function(){return Sp};var qu=function(){this._index=new Ea;var n=arguments[0];this.init(n)};qu.prototype.init=function(n){for(var u=this,p=di.getLines(n),m=p.iterator();m.hasNext();){var b=m.next(),T=b.getCoordinates();u.addLine(T)}};qu.prototype.addLine=function(n){for(var u=this,p=1;p<n.length;p++){var m=new Ge(n[p-1],n[p]),b=Math.min(m.p0.y,m.p1.y),T=Math.max(m.p0.y,m.p1.y);u._index.insert(b,T,m)}};qu.prototype.query=function(){if(arguments.length===2){var n=arguments[0],u=arguments[1],p=new Ip;return this._index.query(n,u,p),p.getItems()}else if(arguments.length===3){var m=arguments[0],b=arguments[1],T=arguments[2];this._index.query(m,b,T)}};qu.prototype.interfaces_=function(){return[]};qu.prototype.getClass=function(){return qu};var vd=function(h){function n(){if(h.call(this),this._parentGeom=null,this._lineEdgeMap=new NE,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new gs,arguments.length===2){var u=arguments[0],p=arguments[1],m=jo.OGC_SFS_BOUNDARY_RULE;this._argIndex=u,this._parentGeom=p,this._boundaryNodeRule=m,p!==null&&this.add(p)}else if(arguments.length===3){var b=arguments[0],T=arguments[1],s=arguments[2];this._argIndex=b,this._parentGeom=T,this._boundaryNodeRule=s,T!==null&&this.add(T)}}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.insertBoundaryPoint=function(p,m){var b=this._nodes.addNode(m),T=b.getLabel(),s=1,O=Ct.NONE;O=T.getLocation(p,pe.ON),O===Ct.BOUNDARY&&s++;var V=n.determineBoundary(this._boundaryNodeRule,s);T.setLocation(p,V)},n.prototype.computeSelfNodes=function(){if(arguments.length===2){var p=arguments[0],m=arguments[1];return this.computeSelfNodes(p,m,!1)}else if(arguments.length===3){var b=arguments[0],T=arguments[1],s=arguments[2],O=new xi(b,!0,!1);O.setIsDoneIfProperInt(s);var V=this.createEdgeSetIntersector(),G=this._parentGeom instanceof ga||this._parentGeom instanceof Kn||this._parentGeom instanceof fa,it=T||!G;return V.computeIntersections(this._edges,O,it),this.addSelfIntersectionNodes(this._argIndex),O}},n.prototype.computeSplitEdges=function(p){for(var m=this._edges.iterator();m.hasNext();){var b=m.next();b.eiList.addSplitEdges(p)}},n.prototype.computeEdgeIntersections=function(p,m,b){var T=new xi(m,b,!0);T.setBoundaryNodes(this.getBoundaryNodes(),p.getBoundaryNodes());var s=this.createEdgeSetIntersector();return s.computeIntersections(this._edges,p._edges,T),T},n.prototype.getGeometry=function(){return this._parentGeom},n.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},n.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},n.prototype.addPoint=function(){if(arguments[0]instanceof ho){var p=arguments[0],m=p.getCoordinate();this.insertPoint(this._argIndex,m,Ct.INTERIOR)}else if(arguments[0]instanceof It){var b=arguments[0];this.insertPoint(this._argIndex,b,Ct.INTERIOR)}},n.prototype.addPolygon=function(p){var m=this;this.addPolygonRing(p.getExteriorRing(),Ct.EXTERIOR,Ct.INTERIOR);for(var b=0;b<p.getNumInteriorRing();b++){var T=p.getInteriorRingN(b);m.addPolygonRing(T,Ct.INTERIOR,Ct.EXTERIOR)}},n.prototype.addEdge=function(p){this.insertEdge(p);var m=p.getCoordinates();this.insertPoint(this._argIndex,m[0],Ct.BOUNDARY),this.insertPoint(this._argIndex,m[m.length-1],Ct.BOUNDARY)},n.prototype.addLineString=function(p){var m=yr.removeRepeatedPoints(p.getCoordinates());if(m.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=m[0],null;var b=new Jg(m,new qr(this._argIndex,Ct.INTERIOR));this._lineEdgeMap.put(p,b),this.insertEdge(b),pr.isTrue(m.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,m[0]),this.insertBoundaryPoint(this._argIndex,m[m.length-1])},n.prototype.getInvalidPoint=function(){return this._invalidPoint},n.prototype.getBoundaryPoints=function(){for(var p=this.getBoundaryNodes(),m=new Array(p.size()).fill(null),b=0,T=p.iterator();T.hasNext();){var s=T.next();m[b++]=s.getCoordinate().copy()}return m},n.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},n.prototype.addSelfIntersectionNode=function(p,m,b){if(this.isBoundaryNode(p,m))return null;b===Ct.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(p,m):this.insertPoint(p,m,b)},n.prototype.addPolygonRing=function(p,m,b){if(p.isEmpty())return null;var T=yr.removeRepeatedPoints(p.getCoordinates());if(T.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=T[0],null;var s=m,O=b;Ce.isCCW(T)&&(s=b,O=m);var V=new Jg(T,new qr(this._argIndex,Ct.BOUNDARY,s,O));this._lineEdgeMap.put(p,V),this.insertEdge(V),this.insertPoint(this._argIndex,T[0],Ct.BOUNDARY)},n.prototype.insertPoint=function(p,m,b){var T=this._nodes.addNode(m),s=T.getLabel();s===null?T._label=new qr(p,b):s.setLocation(p,b)},n.prototype.createEdgeSetIntersector=function(){return new RC},n.prototype.addSelfIntersectionNodes=function(p){for(var m=this,b=this._edges.iterator();b.hasNext();)for(var T=b.next(),s=T.getLabel().getLocation(p),O=T.eiList.iterator();O.hasNext();){var V=O.next();m.addSelfIntersectionNode(p,V.coord,s)}},n.prototype.add=function(){if(arguments.length===1){var p=arguments[0];if(p.isEmpty())return null;if(p instanceof fa&&(this._useBoundaryDeterminationRule=!1),p instanceof Kn)this.addPolygon(p);else if(p instanceof Mn)this.addLineString(p);else if(p instanceof ho)this.addPoint(p);else if(p instanceof yp)this.addCollection(p);else if(p instanceof ku)this.addCollection(p);else if(p instanceof fa)this.addCollection(p);else if(p instanceof ki)this.addCollection(p);else throw new Error(p.getClass().getName())}else return h.prototype.add.apply(this,arguments)},n.prototype.addCollection=function(p){for(var m=this,b=0;b<p.getNumGeometries();b++){var T=p.getGeometryN(b);m.add(T)}},n.prototype.locate=function(p){return Ke(this._parentGeom,Xl)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Tp(this._parentGeom)),this._areaPtLocator.locate(p)):this._ptLocator.locate(p,this._parentGeom)},n.prototype.findEdge=function(){if(arguments.length===1){var p=arguments[0];return this._lineEdgeMap.get(p)}else return h.prototype.findEdge.apply(this,arguments)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n.determineBoundary=function(p,m){return p.isInBoundary(m)?Ct.BOUNDARY:Ct.INTERIOR},n}(In),Cp=function(){if(this._li=new Xu,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var n=arguments[0];this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new vd(0,n)}else if(arguments.length===2){var u=arguments[0],p=arguments[1],m=jo.OGC_SFS_BOUNDARY_RULE;u.getPrecisionModel().compareTo(p.getPrecisionModel())>=0?this.setComputationPrecision(u.getPrecisionModel()):this.setComputationPrecision(p.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new vd(0,u,m),this._arg[1]=new vd(1,p,m)}else if(arguments.length===3){var b=arguments[0],T=arguments[1],s=arguments[2];b.getPrecisionModel().compareTo(T.getPrecisionModel())>=0?this.setComputationPrecision(b.getPrecisionModel()):this.setComputationPrecision(T.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new vd(0,b,s),this._arg[1]=new vd(1,T,s)}};Cp.prototype.getArgGeometry=function(n){return this._arg[n].getGeometry()};Cp.prototype.setComputationPrecision=function(n){this._resultPrecisionModel=n,this._li.setPrecisionModel(this._resultPrecisionModel)};Cp.prototype.interfaces_=function(){return[]};Cp.prototype.getClass=function(){return Cp};var Nu=function(){};Nu.prototype.interfaces_=function(){return[]};Nu.prototype.getClass=function(){return Nu};Nu.map=function(){if(arguments[0]instanceof Je&&Ke(arguments[1],Nu.MapOp)){for(var n=arguments[0],u=arguments[1],p=new be,m=0;m<n.getNumGeometries();m++){var b=u.map(n.getGeometryN(m));b!==null&&p.add(b)}return n.getFactory().buildGeometry(p)}else if(Ke(arguments[0],Hn)&&Ke(arguments[1],Nu.MapOp)){for(var T=arguments[0],s=arguments[1],O=new be,V=T.iterator();V.hasNext();){var G=V.next(),it=s.map(G);it!==null&&O.add(it)}return O}};Nu.MapOp=function(){};var lr=function(h){function n(){var u=arguments[0],p=arguments[1];h.call(this,u,p),this._ptLocator=new gs,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new ms,this._resultPolyList=new be,this._resultLineList=new be,this._resultPointList=new be,this._graph=new In(new qE),this._geomFact=u.getFactory()}return h&&(n.__proto__=h),n.prototype=Object.create(h&&h.prototype),n.prototype.constructor=n,n.prototype.insertUniqueEdge=function(p){var m=this._edgeList.findEqualEdge(p);if(m!==null){var b=m.getLabel(),T=p.getLabel();m.isPointwiseEqual(p)||(T=new qr(p.getLabel()),T.flip());var s=m.getDepth();s.isNull()&&s.add(b),s.add(T),b.merge(T)}else this._edgeList.add(p)},n.prototype.getGraph=function(){return this._graph},n.prototype.cancelDuplicateResultEdges=function(){for(var p=this._graph.getEdgeEnds().iterator();p.hasNext();){var m=p.next(),b=m.getSym();m.isInResult()&&b.isInResult()&&(m.setInResult(!1),b.setInResult(!1))}},n.prototype.isCoveredByLA=function(p){return!!(this.isCovered(p,this._resultLineList)||this.isCovered(p,this._resultPolyList))},n.prototype.computeGeometry=function(p,m,b,T){var s=new be;return s.addAll(p),s.addAll(m),s.addAll(b),s.isEmpty()?n.createEmptyResult(T,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(s)},n.prototype.mergeSymLabels=function(){for(var p=this._graph.getNodes().iterator();p.hasNext();){var m=p.next();m.getEdges().mergeSymLabels()}},n.prototype.isCovered=function(p,m){for(var b=this,T=m.iterator();T.hasNext();){var s=T.next(),O=b._ptLocator.locate(p,s);if(O!==Ct.EXTERIOR)return!0}return!1},n.prototype.replaceCollapsedEdges=function(){for(var p=new be,m=this._edgeList.iterator();m.hasNext();){var b=m.next();b.isCollapsed()&&(m.remove(),p.add(b.getCollapsedEdge()))}this._edgeList.addAll(p)},n.prototype.updateNodeLabelling=function(){for(var p=this._graph.getNodes().iterator();p.hasNext();){var m=p.next(),b=m.getEdges().getLabel();m.getLabel().merge(b)}},n.prototype.getResultGeometry=function(p){return this.computeOverlay(p),this._resultGeom},n.prototype.insertUniqueEdges=function(p){for(var m=this,b=p.iterator();b.hasNext();){var T=b.next();m.insertUniqueEdge(T)}},n.prototype.computeOverlay=function(p){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var m=new be;this._arg[0].computeSplitEdges(m),this._arg[1].computeSplitEdges(m),this.insertUniqueEdges(m),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),ju.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(p),this.cancelDuplicateResultEdges();var b=new po(this._geomFact);b.add(this._graph),this._resultPolyList=b.getPolygons();var T=new Xs(this,this._geomFact,this._ptLocator);this._resultLineList=T.build(p);var s=new Yc(this,this._geomFact,this._ptLocator);this._resultPointList=s.build(p),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,p)},n.prototype.labelIncompleteNode=function(p,m){var b=this._ptLocator.locate(p.getCoordinate(),this._arg[m].getGeometry());p.getLabel().setLocation(m,b)},n.prototype.copyPoints=function(p){for(var m=this,b=this._arg[p].getNodeIterator();b.hasNext();){var T=b.next(),s=m._graph.addNode(T.getCoordinate());s.setLabel(p,T.getLabel().getLocation(p))}},n.prototype.findResultAreaEdges=function(p){for(var m=this._graph.getEdgeEnds().iterator();m.hasNext();){var b=m.next(),T=b.getLabel();T.isArea()&&!b.isInteriorAreaEdge()&&n.isResultOfOp(T.getLocation(0,pe.RIGHT),T.getLocation(1,pe.RIGHT),p)&&b.setInResult(!0)}},n.prototype.computeLabelsFromDepths=function(){for(var p=this._edgeList.iterator();p.hasNext();){var m=p.next(),b=m.getLabel(),T=m.getDepth();if(!T.isNull()){T.normalize();for(var s=0;s<2;s++)!b.isNull(s)&&b.isArea()&&!T.isNull(s)&&(T.getDelta(s)===0?b.toLine(s):(pr.isTrue(!T.isNull(s,pe.LEFT),"depth of LEFT side has not been initialized"),b.setLocation(s,pe.LEFT,T.getLocation(s,pe.LEFT)),pr.isTrue(!T.isNull(s,pe.RIGHT),"depth of RIGHT side has not been initialized"),b.setLocation(s,pe.RIGHT,T.getLocation(s,pe.RIGHT))))}}},n.prototype.computeLabelling=function(){for(var p=this,m=this._graph.getNodes().iterator();m.hasNext();){var b=m.next();b.getEdges().computeLabelling(p._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},n.prototype.labelIncompleteNodes=function(){for(var p=this,m=this._graph.getNodes().iterator();m.hasNext();){var b=m.next(),T=b.getLabel();b.isIsolated()&&(T.isNull(0)?p.labelIncompleteNode(b,0):p.labelIncompleteNode(b,1)),b.getEdges().updateLabelling(T)}},n.prototype.isCoveredByA=function(p){return!!this.isCovered(p,this._resultPolyList)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Cp);lr.overlayOp=function(h,n,u){var p=new lr(h,n),m=p.getResultGeometry(u);return m};lr.intersection=function(h,n){if(h.isEmpty()||n.isEmpty())return lr.createEmptyResult(lr.INTERSECTION,h,n,h.getFactory());if(h.isGeometryCollection()){var u=n;return Hc.map(h,{interfaces_:function(){return[Nu.MapOp]},map:function(p){return p.intersection(u)}})}return h.checkNotGeometryCollection(h),h.checkNotGeometryCollection(n),Vi.overlayOp(h,n,lr.INTERSECTION)};lr.symDifference=function(h,n){if(h.isEmpty()||n.isEmpty()){if(h.isEmpty()&&n.isEmpty())return lr.createEmptyResult(lr.SYMDIFFERENCE,h,n,h.getFactory());if(h.isEmpty())return n.copy();if(n.isEmpty())return h.copy()}return h.checkNotGeometryCollection(h),h.checkNotGeometryCollection(n),Vi.overlayOp(h,n,lr.SYMDIFFERENCE)};lr.resultDimension=function(h,n,u){var p=n.getDimension(),m=u.getDimension(),b=-1;switch(h){case lr.INTERSECTION:b=Math.min(p,m);break;case lr.UNION:b=Math.max(p,m);break;case lr.DIFFERENCE:b=p;break;case lr.SYMDIFFERENCE:b=Math.max(p,m);break}return b};lr.createEmptyResult=function(h,n,u,p){var m=null;switch(lr.resultDimension(h,n,u)){case-1:m=p.createGeometryCollection(new Array(0).fill(null));break;case 0:m=p.createPoint();break;case 1:m=p.createLineString();break;case 2:m=p.createPolygon();break}return m};lr.difference=function(h,n){return h.isEmpty()?lr.createEmptyResult(lr.DIFFERENCE,h,n,h.getFactory()):n.isEmpty()?h.copy():(h.checkNotGeometryCollection(h),h.checkNotGeometryCollection(n),Vi.overlayOp(h,n,lr.DIFFERENCE))};lr.isResultOfOp=function(){if(arguments.length===2){var h=arguments[0],n=arguments[1],u=h.getLocation(0),p=h.getLocation(1);return lr.isResultOfOp(u,p,n)}else if(arguments.length===3){var m=arguments[0],b=arguments[1],T=arguments[2];switch(m===Ct.BOUNDARY&&(m=Ct.INTERIOR),b===Ct.BOUNDARY&&(b=Ct.INTERIOR),T){case lr.INTERSECTION:return m===Ct.INTERIOR&&b===Ct.INTERIOR;case lr.UNION:return m===Ct.INTERIOR||b===Ct.INTERIOR;case lr.DIFFERENCE:return m===Ct.INTERIOR&&b!==Ct.INTERIOR;case lr.SYMDIFFERENCE:return m===Ct.INTERIOR&&b!==Ct.INTERIOR||m!==Ct.INTERIOR&&b===Ct.INTERIOR}return!1}};lr.INTERSECTION=1;lr.UNION=2;lr.DIFFERENCE=3;lr.SYMDIFFERENCE=4;var Zl=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new gs,this._seg=new Ge;var n=arguments[0],u=arguments[1];this._g=n,this._boundaryDistanceTolerance=u,this._linework=this.extractLinework(n)};Zl.prototype.isWithinToleranceOfBoundary=function(n){for(var u=this,p=0;p<this._linework.getNumGeometries();p++)for(var m=u._linework.getGeometryN(p),b=m.getCoordinateSequence(),T=0;T<b.size()-1;T++){b.getCoordinate(T,u._seg.p0),b.getCoordinate(T+1,u._seg.p1);var s=u._seg.distance(n);if(s<=u._boundaryDistanceTolerance)return!0}return!1};Zl.prototype.getLocation=function(n){return this.isWithinToleranceOfBoundary(n)?Ct.BOUNDARY:this._ptLocator.locate(n,this._g)};Zl.prototype.extractLinework=function(n){var u=new Mp;n.apply(u);var p=u.getLinework(),m=_r.toLineStringArray(p);return n.getFactory().createMultiLineString(m)};Zl.prototype.interfaces_=function(){return[]};Zl.prototype.getClass=function(){return Zl};var Mp=function(){this._linework=null,this._linework=new be};Mp.prototype.getLinework=function(){return this._linework};Mp.prototype.filter=function(n){var u=this;if(n instanceof Kn){var p=n;this._linework.add(p.getExteriorRing());for(var m=0;m<p.getNumInteriorRing();m++)u._linework.add(p.getInteriorRingN(m))}};Mp.prototype.interfaces_=function(){return[Bs]};Mp.prototype.getClass=function(){return Mp};var Zu=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var n=arguments[0];this._g=n};Zu.prototype.extractPoints=function(n,u,p){for(var m=this,b=n.getCoordinates(),T=0;T<b.length-1;T++)m.computeOffsetPoints(b[T],b[T+1],u,p)};Zu.prototype.setSidesToGenerate=function(n,u){this._doLeft=n,this._doRight=u};Zu.prototype.getPoints=function(n){for(var u=this,p=new be,m=di.getLines(this._g),b=m.iterator();b.hasNext();){var T=b.next();u.extractPoints(T,n,p)}return p};Zu.prototype.computeOffsetPoints=function(n,u,p,m){var b=u.x-n.x,T=u.y-n.y,s=Math.sqrt(b*b+T*T),O=p*b/s,V=p*T/s,G=(u.x+n.x)/2,it=(u.y+n.y)/2;if(this._doLeft){var ot=new It(G-V,it+O);m.add(ot)}if(this._doRight){var dt=new It(G+V,it-O);m.add(dt)}};Zu.prototype.interfaces_=function(){return[]};Zu.prototype.getClass=function(){return Zu};var Co=function h(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=h.TOLERANCE,this._testCoords=new be;var n=arguments[0],u=arguments[1],p=arguments[2];this._boundaryDistanceTolerance=h.computeBoundaryDistanceTolerance(n,u),this._geom=[n,u,p],this._locFinder=[new Zl(this._geom[0],this._boundaryDistanceTolerance),new Zl(this._geom[1],this._boundaryDistanceTolerance),new Zl(this._geom[2],this._boundaryDistanceTolerance)]},t2={TOLERANCE:{configurable:!0}};Co.prototype.reportResult=function(n,u,p){_i.out.println("Overlay result invalid - A:"+Ct.toLocationSymbol(u[0])+" B:"+Ct.toLocationSymbol(u[1])+" expected:"+(p?"i":"e")+" actual:"+Ct.toLocationSymbol(u[2]))};Co.prototype.isValid=function(n){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var u=this.checkValid(n);return u};Co.prototype.checkValid=function(){var n=this;if(arguments.length===1){for(var u=arguments[0],p=0;p<this._testCoords.size();p++){var m=n._testCoords.get(p);if(!n.checkValid(u,m))return n._invalidLocation=m,!1}return!0}else if(arguments.length===2){var b=arguments[0],T=arguments[1];return this._location[0]=this._locFinder[0].getLocation(T),this._location[1]=this._locFinder[1].getLocation(T),this._location[2]=this._locFinder[2].getLocation(T),Co.hasLocation(this._location,Ct.BOUNDARY)?!0:this.isValidResult(b,this._location)}};Co.prototype.addTestPts=function(n){var u=new Zu(n);this._testCoords.addAll(u.getPoints(5*this._boundaryDistanceTolerance))};Co.prototype.isValidResult=function(n,u){var p=lr.isResultOfOp(u[0],u[1],n),m=u[2]===Ct.INTERIOR,b=!(p^m);return b||this.reportResult(n,u,p),b};Co.prototype.getInvalidLocation=function(){return this._invalidLocation};Co.prototype.interfaces_=function(){return[]};Co.prototype.getClass=function(){return Co};Co.hasLocation=function(n,u){for(var p=0;p<3;p++)if(n[p]===u)return!0;return!1};Co.computeBoundaryDistanceTolerance=function(n,u){return Math.min(kn.computeSizeBasedSnapTolerance(n),kn.computeSizeBasedSnapTolerance(u))};Co.isValid=function(n,u,p,m){var b=new Co(n,u,m);return b.isValid(p)};t2.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Co,t2);var bo=function h(n){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=h.extractFactory(n),this._inputGeoms=n};bo.prototype.extractElements=function(n,u){var p=this;if(n===null)return null;for(var m=0;m<n.getNumGeometries();m++){var b=n.getGeometryN(m);p._skipEmpty&&b.isEmpty()||u.add(b)}};bo.prototype.combine=function(){for(var n=this,u=new be,p=this._inputGeoms.iterator();p.hasNext();){var m=p.next();n.extractElements(m,u)}return u.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(u)};bo.prototype.interfaces_=function(){return[]};bo.prototype.getClass=function(){return bo};bo.combine=function(){if(arguments.length===1){var n=arguments[0],u=new bo(n);return u.combine()}else if(arguments.length===2){var p=arguments[0],m=arguments[1],b=new bo(bo.createList(p,m));return b.combine()}else if(arguments.length===3){var T=arguments[0],s=arguments[1],O=arguments[2],V=new bo(bo.createList(T,s,O));return V.combine()}};bo.extractFactory=function(n){return n.isEmpty()?null:n.iterator().next().getFactory()};bo.createList=function(){if(arguments.length===2){var n=arguments[0],u=arguments[1],p=new be;return p.add(n),p.add(u),p}else if(arguments.length===3){var m=arguments[0],b=arguments[1],T=arguments[2],s=new be;return s.add(m),s.add(b),s.add(T),s}};var jn=function(){this._inputPolys=null,this._geomFactory=null;var n=arguments[0];this._inputPolys=n,this._inputPolys===null&&(this._inputPolys=new be)},e2={STRTREE_NODE_CAPACITY:{configurable:!0}};jn.prototype.reduceToGeometries=function(n){for(var u=this,p=new be,m=n.iterator();m.hasNext();){var b=m.next(),T=null;Ke(b,cs)?T=u.unionTree(b):b instanceof Je&&(T=b),p.add(T)}return p};jn.prototype.extractByEnvelope=function(n,u,p){for(var m=new be,b=0;b<u.getNumGeometries();b++){var T=u.getGeometryN(b);T.getEnvelopeInternal().intersects(n)?m.add(T):p.add(T)}return this._geomFactory.buildGeometry(m)};jn.prototype.unionOptimized=function(n,u){var p=n.getEnvelopeInternal(),m=u.getEnvelopeInternal();if(!p.intersects(m)){var b=bo.combine(n,u);return b}if(n.getNumGeometries()<=1&&u.getNumGeometries()<=1)return this.unionActual(n,u);var T=p.intersection(m);return this.unionUsingEnvelopeIntersection(n,u,T)};jn.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var n=new VE(jn.STRTREE_NODE_CAPACITY),u=this._inputPolys.iterator();u.hasNext();){var p=u.next();n.insert(p.getEnvelopeInternal(),p)}this._inputPolys=null;var m=n.itemsTree(),b=this.unionTree(m);return b};jn.prototype.binaryUnion=function(){if(arguments.length===1){var n=arguments[0];return this.binaryUnion(n,0,n.size())}else if(arguments.length===3){var u=arguments[0],p=arguments[1],m=arguments[2];if(m-p<=1){var b=jn.getGeometry(u,p);return this.unionSafe(b,null)}else{if(m-p===2)return this.unionSafe(jn.getGeometry(u,p),jn.getGeometry(u,p+1));var T=Math.trunc((m+p)/2),s=this.binaryUnion(u,p,T),O=this.binaryUnion(u,T,m);return this.unionSafe(s,O)}}};jn.prototype.repeatedUnion=function(n){for(var u=null,p=n.iterator();p.hasNext();){var m=p.next();u===null?u=m.copy():u=u.union(m)}return u};jn.prototype.unionSafe=function(n,u){return n===null&&u===null?null:n===null?u.copy():u===null?n.copy():this.unionOptimized(n,u)};jn.prototype.unionActual=function(n,u){return jn.restrictToPolygons(n.union(u))};jn.prototype.unionTree=function(n){var u=this.reduceToGeometries(n),p=this.binaryUnion(u);return p};jn.prototype.unionUsingEnvelopeIntersection=function(n,u,p){var m=new be,b=this.extractByEnvelope(p,n,m),T=this.extractByEnvelope(p,u,m),s=this.unionActual(b,T);m.add(s);var O=bo.combine(m);return O};jn.prototype.bufferUnion=function(){if(arguments.length===1){var n=arguments[0],u=n.get(0).getFactory(),p=u.buildGeometry(n),m=p.buffer(0);return m}else if(arguments.length===2){var b=arguments[0],T=arguments[1],s=b.getFactory(),O=s.createGeometryCollection([b,T]),V=O.buffer(0);return V}};jn.prototype.interfaces_=function(){return[]};jn.prototype.getClass=function(){return jn};jn.restrictToPolygons=function(n){if(Ke(n,Xl))return n;var u=tl.getPolygons(n);return u.size()===1?u.get(0):n.getFactory().createMultiPolygon(_r.toPolygonArray(u))};jn.getGeometry=function(n,u){return u>=n.size()?null:n.get(u)};jn.union=function(n){var u=new jn(n);return u.union()};e2.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(jn,e2);var Qg=function(){};Qg.prototype.interfaces_=function(){return[]};Qg.prototype.getClass=function(){return Qg};Qg.union=function(n,u){if(n.isEmpty()||u.isEmpty()){if(n.isEmpty()&&u.isEmpty())return lr.createEmptyResult(lr.UNION,n,u,n.getFactory());if(n.isEmpty())return u.copy();if(u.isEmpty())return n.copy()}return n.checkNotGeometryCollection(n),n.checkNotGeometryCollection(u),Vi.overlayOp(n,u,lr.UNION)};function Wu(){return new t_}function t_(){this.reset()}t_.prototype={constructor:t_,reset:function(){this.s=this.t=0},add:function(h){oE(Vg,h,this.t),oE(this,Vg.s,this.s),this.s?this.t+=Vg.t:this.s=Vg.t},valueOf:function(){return this.s}};var Vg=new t_;function oE(h,n,u){var p=h.s=n+u,m=p-n,b=p-m;h.t=n-b+(u-m)}var Cn=1e-6,Kr=Math.PI,Qa=Kr/2,sE=Kr/4,sl=Kr*2,Ou=180/Kr,Ds=Kr/180,zi=Math.abs,NC=Math.atan,Ap=Math.atan2,Yn=Math.cos,$n=Math.sin,Np=Math.sqrt;function r2(h){return h>1?0:h<-1?Kr:Math.acos(h)}function Jc(h){return h>1?Qa:h<-1?-Qa:Math.asin(h)}function xd(){}function e_(h,n){h&&lE.hasOwnProperty(h.type)&&lE[h.type](h,n)}var aE={Feature:function(h,n){e_(h.geometry,n)},FeatureCollection:function(h,n){for(var u=h.features,p=-1,m=u.length;++p<m;)e_(u[p].geometry,n)}},lE={Sphere:function(h,n){n.sphere()},Point:function(h,n){h=h.coordinates,n.point(h[0],h[1],h[2])},MultiPoint:function(h,n){for(var u=h.coordinates,p=-1,m=u.length;++p<m;)h=u[p],n.point(h[0],h[1],h[2])},LineString:function(h,n){Wv(h.coordinates,n,0)},MultiLineString:function(h,n){for(var u=h.coordinates,p=-1,m=u.length;++p<m;)Wv(u[p],n,0)},Polygon:function(h,n){uE(h.coordinates,n)},MultiPolygon:function(h,n){for(var u=h.coordinates,p=-1,m=u.length;++p<m;)uE(u[p],n)},GeometryCollection:function(h,n){for(var u=h.geometries,p=-1,m=u.length;++p<m;)e_(u[p],n)}};function Wv(h,n,u){var p=-1,m=h.length-u,b;for(n.lineStart();++p<m;)b=h[p],n.point(b[0],b[1],b[2]);n.lineEnd()}function uE(h,n){var u=-1,p=h.length;for(n.polygonStart();++u<p;)Wv(h[u],n,1);n.polygonEnd()}function kC(h,n){h&&aE.hasOwnProperty(h.type)?aE[h.type](h,n):e_(h,n)}Wu();Wu();function Hv(h){return[Ap(h[1],h[0]),Jc(h[2])]}function Pp(h){var n=h[0],u=h[1],p=Yn(u);return[p*Yn(n),p*$n(n),$n(u)]}function Ug(h,n){return h[0]*n[0]+h[1]*n[1]+h[2]*n[2]}function r_(h,n){return[h[1]*n[2]-h[2]*n[1],h[2]*n[0]-h[0]*n[2],h[0]*n[1]-h[1]*n[0]]}function Uv(h,n){h[0]+=n[0],h[1]+=n[1],h[2]+=n[2]}function Gg(h,n){return[h[0]*n,h[1]*n,h[2]*n]}function Yv(h){var n=Np(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);h[0]/=n,h[1]/=n,h[2]/=n}Wu();function n2(h,n){function u(p,m){return p=h(p,m),n(p[0],p[1])}return h.invert&&n.invert&&(u.invert=function(p,m){return p=n.invert(p,m),p&&h.invert(p[0],p[1])}),u}function $v(h,n){return[h>Kr?h-sl:h<-Kr?h+sl:h,n]}$v.invert=$v;function FC(h,n,u){return(h%=sl)?n||u?n2(hE(h),pE(n,u)):hE(h):n||u?pE(n,u):$v}function cE(h){return function(n,u){return n+=h,[n>Kr?n-sl:n<-Kr?n+sl:n,u]}}function hE(h){var n=cE(h);return n.invert=cE(-h),n}function pE(h,n){var u=Yn(h),p=$n(h),m=Yn(n),b=$n(n);function T(s,O){var V=Yn(O),G=Yn(s)*V,it=$n(s)*V,ot=$n(O),dt=ot*u+G*p;return[Ap(it*m-dt*b,G*u-ot*p),Jc(dt*m+it*b)]}return T.invert=function(s,O){var V=Yn(O),G=Yn(s)*V,it=$n(s)*V,ot=$n(O),dt=ot*m-it*b;return[Ap(it*m+ot*b,G*u+dt*p),Jc(dt*u-G*p)]},T}function BC(h,n,u,p,m,b){if(u){var T=Yn(n),s=$n(n),O=p*u;m==null?(m=n+p*sl,b=n-O/2):(m=fE(T,m),b=fE(T,b),(p>0?m<b:m>b)&&(m+=p*sl));for(var V,G=m;p>0?G>b:G<b;G-=O)V=Hv([T,-s*Yn(G),-s*$n(G)]),h.point(V[0],V[1])}}function fE(h,n){n=Pp(n),n[0]-=h,Yv(n);var u=r2(-n[1]);return((-n[2]<0?-u:u)+sl-Cn)%sl}function i2(){var h=[],n;return{point:function(u,p){n.push([u,p])},lineStart:function(){h.push(n=[])},lineEnd:xd,rejoin:function(){h.length>1&&h.push(h.pop().concat(h.shift()))},result:function(){var u=h;return h=[],n=null,u}}}function VC(h,n,u,p,m,b){var T=h[0],s=h[1],O=n[0],V=n[1],G=0,it=1,ot=O-T,dt=V-s,xt;if(xt=u-T,!(!ot&&xt>0)){if(xt/=ot,ot<0){if(xt<G)return;xt<it&&(it=xt)}else if(ot>0){if(xt>it)return;xt>G&&(G=xt)}if(xt=m-T,!(!ot&&xt<0)){if(xt/=ot,ot<0){if(xt>it)return;xt>G&&(G=xt)}else if(ot>0){if(xt<G)return;xt<it&&(it=xt)}if(xt=p-s,!(!dt&&xt>0)){if(xt/=dt,dt<0){if(xt<G)return;xt<it&&(it=xt)}else if(dt>0){if(xt>it)return;xt>G&&(G=xt)}if(xt=b-s,!(!dt&&xt<0)){if(xt/=dt,dt<0){if(xt>it)return;xt>G&&(G=xt)}else if(dt>0){if(xt<G)return;xt<it&&(it=xt)}return G>0&&(h[0]=T+G*ot,h[1]=s+G*dt),it<1&&(n[0]=T+it*ot,n[1]=s+it*dt),!0}}}}}function Xg(h,n){return zi(h[0]-n[0])<Cn&&zi(h[1]-n[1])<Cn}function jg(h,n,u,p){this.x=h,this.z=n,this.o=u,this.e=p,this.v=!1,this.n=this.p=null}function o2(h,n,u,p,m){var b=[],T=[],s,O;if(h.forEach(function(xt){if(!((Wt=xt.length-1)<=0)){var Wt,Vt=xt[0],ie=xt[Wt],he;if(Xg(Vt,ie)){for(m.lineStart(),s=0;s<Wt;++s)m.point((Vt=xt[s])[0],Vt[1]);m.lineEnd();return}b.push(he=new jg(Vt,xt,null,!0)),T.push(he.o=new jg(Vt,null,he,!1)),b.push(he=new jg(ie,xt,null,!1)),T.push(he.o=new jg(ie,null,he,!0))}}),!!b.length){for(T.sort(n),dE(b),dE(T),s=0,O=T.length;s<O;++s)T[s].e=u=!u;for(var V=b[0],G,it;;){for(var ot=V,dt=!0;ot.v;)if((ot=ot.n)===V)return;G=ot.z,m.lineStart();do{if(ot.v=ot.o.v=!0,ot.e){if(dt)for(s=0,O=G.length;s<O;++s)m.point((it=G[s])[0],it[1]);else p(ot.x,ot.n.x,1,m);ot=ot.n}else{if(dt)for(G=ot.p.z,s=G.length-1;s>=0;--s)m.point((it=G[s])[0],it[1]);else p(ot.x,ot.p.x,-1,m);ot=ot.p}ot=ot.o,G=ot.z,dt=!dt}while(!ot.v);m.lineEnd()}}}function dE(h){if(n=h.length){for(var n,u=0,p=h[0],m;++u<n;)p.n=m=h[u],m.p=p,p=m;p.n=m=h[0],m.p=p}}function s2(h,n){return h<n?-1:h>n?1:h>=n?0:NaN}function UC(h){return h.length===1&&(h=GC(h)),{left:function(n,u,p,m){for(p==null&&(p=0),m==null&&(m=n.length);p<m;){var b=p+m>>>1;h(n[b],u)<0?p=b+1:m=b}return p},right:function(n,u,p,m){for(p==null&&(p=0),m==null&&(m=n.length);p<m;){var b=p+m>>>1;h(n[b],u)>0?m=b:p=b+1}return p}}}function GC(h){return function(n,u){return s2(h(n),u)}}UC(s2);function a2(h){for(var n=h.length,u,p=-1,m=0,b,T;++p<n;)m+=h[p].length;for(b=new Array(m);--n>=0;)for(T=h[n],u=T.length;--u>=0;)b[--m]=T[u];return b}var bd=1e9,qg=-bd;function jC(h,n,u,p){function m(V,G){return h<=V&&V<=u&&n<=G&&G<=p}function b(V,G,it,ot){var dt=0,xt=0;if(V==null||(dt=T(V,it))!==(xt=T(G,it))||O(V,G)<0^it>0)do ot.point(dt===0||dt===3?h:u,dt>1?p:n);while((dt=(dt+it+4)%4)!==xt);else ot.point(G[0],G[1])}function T(V,G){return zi(V[0]-h)<Cn?G>0?0:3:zi(V[0]-u)<Cn?G>0?2:1:zi(V[1]-n)<Cn?G>0?1:0:G>0?3:2}function s(V,G){return O(V.x,G.x)}function O(V,G){var it=T(V,1),ot=T(G,1);return it!==ot?it-ot:it===0?G[1]-V[1]:it===1?V[0]-G[0]:it===2?V[1]-G[1]:G[0]-V[0]}return function(V){var G=V,it=i2(),ot,dt,xt,Wt,Vt,ie,he,ue,Ne,je,qe,rr={point:tr,lineStart:ae,lineEnd:Tr,polygonStart:hn,polygonEnd:Vr};function tr(vr,$r){m(vr,$r)&&G.point(vr,$r)}function At(){for(var vr=0,$r=0,Vn=dt.length;$r<Vn;++$r)for(var ke=dt[$r],Qn=1,ti=ke.length,Pn=ke[0],Ui,Qr,Ys=Pn[0],go=Pn[1];Qn<ti;++Qn)Ui=Ys,Qr=go,Pn=ke[Qn],Ys=Pn[0],go=Pn[1],Qr<=p?go>p&&(Ys-Ui)*(p-Qr)>(go-Qr)*(h-Ui)&&++vr:go<=p&&(Ys-Ui)*(p-Qr)<(go-Qr)*(h-Ui)&&--vr;return vr}function hn(){G=it,ot=[],dt=[],qe=!0}function Vr(){var vr=At(),$r=qe&&vr,Vn=(ot=a2(ot)).length;($r||Vn)&&(V.polygonStart(),$r&&(V.lineStart(),b(null,null,1,V),V.lineEnd()),Vn&&o2(ot,s,vr,b,V),V.polygonEnd()),G=V,ot=dt=xt=null}function ae(){rr.point=Oe,dt&&dt.push(xt=[]),je=!0,Ne=!1,he=ue=NaN}function Tr(){ot&&(Oe(Wt,Vt),ie&&Ne&&it.rejoin(),ot.push(it.result())),rr.point=tr,Ne&&G.lineEnd()}function Oe(vr,$r){var Vn=m(vr,$r);if(dt&&xt.push([vr,$r]),je)Wt=vr,Vt=$r,ie=Vn,je=!1,Vn&&(G.lineStart(),G.point(vr,$r));else if(Vn&&Ne)G.point(vr,$r);else{var ke=[he=Math.max(qg,Math.min(bd,he)),ue=Math.max(qg,Math.min(bd,ue))],Qn=[vr=Math.max(qg,Math.min(bd,vr)),$r=Math.max(qg,Math.min(bd,$r))];VC(ke,Qn,h,n,u,p)?(Ne||(G.lineStart(),G.point(ke[0],ke[1])),G.point(Qn[0],Qn[1]),Vn||G.lineEnd(),qe=!1):Vn&&(G.lineStart(),G.point(vr,$r),qe=!1)}he=vr,ue=$r,Ne=Vn}return rr}}var Gv=Wu();function qC(h,n){var u=n[0],p=n[1],m=[$n(u),-Yn(u),0],b=0,T=0;Gv.reset();for(var s=0,O=h.length;s<O;++s)if(G=(V=h[s]).length)for(var V,G,it=V[G-1],ot=it[0],dt=it[1]/2+sE,xt=$n(dt),Wt=Yn(dt),Vt=0;Vt<G;++Vt,ot=he,xt=Ne,Wt=je,it=ie){var ie=V[Vt],he=ie[0],ue=ie[1]/2+sE,Ne=$n(ue),je=Yn(ue),qe=he-ot,rr=qe>=0?1:-1,tr=rr*qe,At=tr>Kr,hn=xt*Ne;if(Gv.add(Ap(hn*rr*$n(tr),Wt*je+hn*Yn(tr))),b+=At?qe+rr*sl:qe,At^ot>=u^he>=u){var Vr=r_(Pp(it),Pp(ie));Yv(Vr);var ae=r_(m,Vr);Yv(ae);var Tr=(At^qe>=0?-1:1)*Jc(ae[2]);(p>Tr||p===Tr&&(Vr[0]||Vr[1]))&&(T+=At^qe>=0?1:-1)}}return(b<-Cn||b<Cn&&Gv<-Cn)^T&1}Wu();function mE(h){return h}Wu();Wu();var Lp=1/0,n_=Lp,zd=-Lp,i_=zd,gE={point:ZC,lineStart:xd,lineEnd:xd,polygonStart:xd,polygonEnd:xd,result:function(){var h=[[Lp,n_],[zd,i_]];return zd=i_=-(n_=Lp=1/0),h}};function ZC(h,n){h<Lp&&(Lp=h),h>zd&&(zd=h),n<n_&&(n_=n),n>i_&&(i_=n)}Wu();function l2(h,n,u,p){return function(m,b){var T=n(b),s=m.invert(p[0],p[1]),O=i2(),V=n(O),G=!1,it,ot,dt,xt={point:Wt,lineStart:ie,lineEnd:he,polygonStart:function(){xt.point=ue,xt.lineStart=Ne,xt.lineEnd=je,ot=[],it=[]},polygonEnd:function(){xt.point=Wt,xt.lineStart=ie,xt.lineEnd=he,ot=a2(ot);var qe=qC(it,s);ot.length?(G||(b.polygonStart(),G=!0),o2(ot,WC,qe,u,b)):qe&&(G||(b.polygonStart(),G=!0),b.lineStart(),u(null,null,1,b),b.lineEnd()),G&&(b.polygonEnd(),G=!1),ot=it=null},sphere:function(){b.polygonStart(),b.lineStart(),u(null,null,1,b),b.lineEnd(),b.polygonEnd()}};function Wt(qe,rr){var tr=m(qe,rr);h(qe=tr[0],rr=tr[1])&&b.point(qe,rr)}function Vt(qe,rr){var tr=m(qe,rr);T.point(tr[0],tr[1])}function ie(){xt.point=Vt,T.lineStart()}function he(){xt.point=Wt,T.lineEnd()}function ue(qe,rr){dt.push([qe,rr]);var tr=m(qe,rr);V.point(tr[0],tr[1])}function Ne(){V.lineStart(),dt=[]}function je(){ue(dt[0][0],dt[0][1]),V.lineEnd();var qe=V.clean(),rr=O.result(),tr,At=rr.length,hn,Vr,ae;if(dt.pop(),it.push(dt),dt=null,!!At){if(qe&1){if(Vr=rr[0],(hn=Vr.length-1)>0){for(G||(b.polygonStart(),G=!0),b.lineStart(),tr=0;tr<hn;++tr)b.point((ae=Vr[tr])[0],ae[1]);b.lineEnd()}return}At>1&&qe&2&&rr.push(rr.pop().concat(rr.shift())),ot.push(rr.filter(XC))}}return xt}}function XC(h){return h.length>1}function WC(h,n){return((h=h.x)[0]<0?h[1]-Qa-Cn:Qa-h[1])-((n=n.x)[0]<0?n[1]-Qa-Cn:Qa-n[1])}const _E=l2(function(){return!0},HC,$C,[-Kr,-Qa]);function HC(h){var n=NaN,u=NaN,p=NaN,m;return{lineStart:function(){h.lineStart(),m=1},point:function(b,T){var s=b>0?Kr:-Kr,O=zi(b-n);zi(O-Kr)<Cn?(h.point(n,u=(u+T)/2>0?Qa:-Qa),h.point(p,u),h.lineEnd(),h.lineStart(),h.point(s,u),h.point(b,u),m=0):p!==s&&O>=Kr&&(zi(n-p)<Cn&&(n-=p*Cn),zi(b-s)<Cn&&(b-=s*Cn),u=YC(n,u,b,T),h.point(p,u),h.lineEnd(),h.lineStart(),h.point(s,u),m=0),h.point(n=b,u=T),p=s},lineEnd:function(){h.lineEnd(),n=u=NaN},clean:function(){return 2-m}}}function YC(h,n,u,p){var m,b,T=$n(h-u);return zi(T)>Cn?NC(($n(n)*(b=Yn(p))*$n(u)-$n(p)*(m=Yn(n))*$n(h))/(m*b*T)):(n+p)/2}function $C(h,n,u,p){var m;if(h==null)m=u*Qa,p.point(-Kr,m),p.point(0,m),p.point(Kr,m),p.point(Kr,0),p.point(Kr,-m),p.point(0,-m),p.point(-Kr,-m),p.point(-Kr,0),p.point(-Kr,m);else if(zi(h[0]-n[0])>Cn){var b=h[0]<n[0]?Kr:-Kr;m=u*b/2,p.point(-b,m),p.point(0,m),p.point(b,m)}else p.point(n[0],n[1])}function JC(h,n){var u=Yn(h),p=u>0,m=zi(u)>Cn;function b(G,it,ot,dt){BC(dt,h,n,ot,G,it)}function T(G,it){return Yn(G)*Yn(it)>u}function s(G){var it,ot,dt,xt,Wt;return{lineStart:function(){xt=dt=!1,Wt=1},point:function(Vt,ie){var he=[Vt,ie],ue,Ne=T(Vt,ie),je=p?Ne?0:V(Vt,ie):Ne?V(Vt+(Vt<0?Kr:-Kr),ie):0;if(!it&&(xt=dt=Ne)&&G.lineStart(),Ne!==dt&&(ue=O(it,he),(!ue||Xg(it,ue)||Xg(he,ue))&&(he[0]+=Cn,he[1]+=Cn,Ne=T(he[0],he[1]))),Ne!==dt)Wt=0,Ne?(G.lineStart(),ue=O(he,it),G.point(ue[0],ue[1])):(ue=O(it,he),G.point(ue[0],ue[1]),G.lineEnd()),it=ue;else if(m&&it&&p^Ne){var qe;!(je&ot)&&(qe=O(he,it,!0))&&(Wt=0,p?(G.lineStart(),G.point(qe[0][0],qe[0][1]),G.point(qe[1][0],qe[1][1]),G.lineEnd()):(G.point(qe[1][0],qe[1][1]),G.lineEnd(),G.lineStart(),G.point(qe[0][0],qe[0][1])))}Ne&&(!it||!Xg(it,he))&&G.point(he[0],he[1]),it=he,dt=Ne,ot=je},lineEnd:function(){dt&&G.lineEnd(),it=null},clean:function(){return Wt|(xt&&dt)<<1}}}function O(G,it,ot){var dt=Pp(G),xt=Pp(it),Wt=[1,0,0],Vt=r_(dt,xt),ie=Ug(Vt,Vt),he=Vt[0],ue=ie-he*he;if(!ue)return!ot&&G;var Ne=u*ie/ue,je=-u*he/ue,qe=r_(Wt,Vt),rr=Gg(Wt,Ne),tr=Gg(Vt,je);Uv(rr,tr);var At=qe,hn=Ug(rr,At),Vr=Ug(At,At),ae=hn*hn-Vr*(Ug(rr,rr)-1);if(!(ae<0)){var Tr=Np(ae),Oe=Gg(At,(-hn-Tr)/Vr);if(Uv(Oe,rr),Oe=Hv(Oe),!ot)return Oe;var vr=G[0],$r=it[0],Vn=G[1],ke=it[1],Qn;$r<vr&&(Qn=vr,vr=$r,$r=Qn);var ti=$r-vr,Pn=zi(ti-Kr)<Cn,Ui=Pn||ti<Cn;if(!Pn&&ke<Vn&&(Qn=Vn,Vn=ke,ke=Qn),Ui?Pn?Vn+ke>0^Oe[1]<(zi(Oe[0]-vr)<Cn?Vn:ke):Vn<=Oe[1]&&Oe[1]<=ke:ti>Kr^(vr<=Oe[0]&&Oe[0]<=$r)){var Qr=Gg(At,(-hn+Tr)/Vr);return Uv(Qr,rr),[Oe,Hv(Qr)]}}}function V(G,it){var ot=p?h:Kr-h,dt=0;return G<-ot?dt|=1:G>ot&&(dt|=2),it<-ot?dt|=4:it>ot&&(dt|=8),dt}return l2(T,s,b,p?[0,-h]:[-Kr,h-Kr])}function u2(h){return function(n){var u=new Jv;for(var p in h)u[p]=h[p];return u.stream=n,u}}function Jv(){}Jv.prototype={constructor:Jv,point:function(h,n){this.stream.point(h,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function c2(h,n,u){var p=n[1][0]-n[0][0],m=n[1][1]-n[0][1],b=h.clipExtent&&h.clipExtent();h.scale(150).translate([0,0]),b!=null&&h.clipExtent(null),kC(u,h.stream(gE));var T=gE.result(),s=Math.min(p/(T[1][0]-T[0][0]),m/(T[1][1]-T[0][1])),O=+n[0][0]+(p-s*(T[1][0]+T[0][0]))/2,V=+n[0][1]+(m-s*(T[1][1]+T[0][1]))/2;return b!=null&&h.clipExtent(b),h.scale(s*150).translate([O,V])}function KC(h,n,u){return c2(h,[[0,0],n],u)}var yE=16,QC=Yn(30*Ds);function vE(h,n){return+n?eM(h,n):tM(h)}function tM(h){return u2({point:function(n,u){n=h(n,u),this.stream.point(n[0],n[1])}})}function eM(h,n){function u(p,m,b,T,s,O,V,G,it,ot,dt,xt,Wt,Vt){var ie=V-p,he=G-m,ue=ie*ie+he*he;if(ue>4*n&&Wt--){var Ne=T+ot,je=s+dt,qe=O+xt,rr=Np(Ne*Ne+je*je+qe*qe),tr=Jc(qe/=rr),At=zi(zi(qe)-1)<Cn||zi(b-it)<Cn?(b+it)/2:Ap(je,Ne),hn=h(At,tr),Vr=hn[0],ae=hn[1],Tr=Vr-p,Oe=ae-m,vr=he*Tr-ie*Oe;(vr*vr/ue>n||zi((ie*Tr+he*Oe)/ue-.5)>.3||T*ot+s*dt+O*xt<QC)&&(u(p,m,b,T,s,O,Vr,ae,At,Ne/=rr,je/=rr,qe,Wt,Vt),Vt.point(Vr,ae),u(Vr,ae,At,Ne,je,qe,V,G,it,ot,dt,xt,Wt,Vt))}}return function(p){var m,b,T,s,O,V,G,it,ot,dt,xt,Wt,Vt={point:ie,lineStart:he,lineEnd:Ne,polygonStart:function(){p.polygonStart(),Vt.lineStart=je},polygonEnd:function(){p.polygonEnd(),Vt.lineStart=he}};function ie(tr,At){tr=h(tr,At),p.point(tr[0],tr[1])}function he(){it=NaN,Vt.point=ue,p.lineStart()}function ue(tr,At){var hn=Pp([tr,At]),Vr=h(tr,At);u(it,ot,G,dt,xt,Wt,it=Vr[0],ot=Vr[1],G=tr,dt=hn[0],xt=hn[1],Wt=hn[2],yE,p),p.point(it,ot)}function Ne(){Vt.point=ie,p.lineEnd()}function je(){he(),Vt.point=qe,Vt.lineEnd=rr}function qe(tr,At){ue(m=tr,At),b=it,T=ot,s=dt,O=xt,V=Wt,Vt.point=ue}function rr(){u(it,ot,G,dt,xt,Wt,b,T,m,s,O,V,yE,p),Vt.lineEnd=Ne,Ne()}return Vt}}var rM=u2({point:function(h,n){this.stream.point(h*Ds,n*Ds)}});function nM(h){return iM(function(){return h})()}function iM(h){var n,u=150,p=480,m=250,b,T,s=0,O=0,V=0,G=0,it=0,ot,dt,xt=null,Wt=_E,Vt=null,ie,he,ue,Ne=mE,je=.5,qe=vE(Vr,je),rr,tr;function At(Oe){return Oe=dt(Oe[0]*Ds,Oe[1]*Ds),[Oe[0]*u+b,T-Oe[1]*u]}function hn(Oe){return Oe=dt.invert((Oe[0]-b)/u,(T-Oe[1])/u),Oe&&[Oe[0]*Ou,Oe[1]*Ou]}function Vr(Oe,vr){return Oe=n(Oe,vr),[Oe[0]*u+b,T-Oe[1]*u]}At.stream=function(Oe){return rr&&tr===Oe?rr:rr=rM(Wt(ot,qe(Ne(tr=Oe))))},At.clipAngle=function(Oe){return arguments.length?(Wt=+Oe?JC(xt=Oe*Ds,6*Ds):(xt=null,_E),Tr()):xt*Ou},At.clipExtent=function(Oe){return arguments.length?(Ne=Oe==null?(Vt=ie=he=ue=null,mE):jC(Vt=+Oe[0][0],ie=+Oe[0][1],he=+Oe[1][0],ue=+Oe[1][1]),Tr()):Vt==null?null:[[Vt,ie],[he,ue]]},At.scale=function(Oe){return arguments.length?(u=+Oe,ae()):u},At.translate=function(Oe){return arguments.length?(p=+Oe[0],m=+Oe[1],ae()):[p,m]},At.center=function(Oe){return arguments.length?(s=Oe[0]%360*Ds,O=Oe[1]%360*Ds,ae()):[s*Ou,O*Ou]},At.rotate=function(Oe){return arguments.length?(V=Oe[0]%360*Ds,G=Oe[1]%360*Ds,it=Oe.length>2?Oe[2]%360*Ds:0,ae()):[V*Ou,G*Ou,it*Ou]},At.precision=function(Oe){return arguments.length?(qe=vE(Vr,je=Oe*Oe),Tr()):Np(je)},At.fitExtent=function(Oe,vr){return c2(At,Oe,vr)},At.fitSize=function(Oe,vr){return KC(At,Oe,vr)};function ae(){dt=n2(ot=FC(V,G,it),n);var Oe=n(s,O);return b=p-Oe[0]*u,T=m+Oe[1]*u,Tr()}function Tr(){return rr=tr=null,At}return function(){return n=h.apply(this,arguments),At.invert=n.invert&&hn,ae()}}function h2(h){return function(n,u){var p=Yn(n),m=Yn(u),b=h(p*m);return[b*m*$n(n),b*$n(u)]}}function p2(h){return function(n,u){var p=Np(n*n+u*u),m=h(p),b=$n(m),T=Yn(m);return[Ap(n*b,p*T),Jc(p&&u*b/p)]}}var oM=h2(function(h){return Np(2/(1+h))});oM.invert=p2(function(h){return 2*Jc(h/2)});var f2=h2(function(h){return(h=r2(h))&&h/$n(h)});f2.invert=p2(function(h){return h});function sM(){return nM(f2).scale(79.4188).clipAngle(180-.001)}function xE(h,n){return[h,n]}xE.invert=xE;function aM(h,n,u){u=u||{};var p=u.units||"kilometers",m=u.steps||8;if(!h)throw new Error("geojson is required");if(typeof u!="object")throw new Error("options must be an object");if(typeof m!="number")throw new Error("steps must be an number");if(n===void 0)throw new Error("radius is required");if(m<=0)throw new Error("steps must be greater than 0");var b=[];switch(h.type){case"GeometryCollection":return t0(h,function(T){var s=Wg(T,n,p,m);s&&b.push(s)}),jv(b);case"FeatureCollection":return $w(h,function(T){var s=Wg(T,n,p,m);s&&$w(s,function(O){O&&b.push(O)})}),jv(b)}return Wg(h,n,p,m)}function Wg(h,n,u,p){var m=h.properties||{},b=h.type==="Feature"?h.geometry:h;if(b.type==="GeometryCollection"){var T=[];return t0(h,function(Wt){var Vt=Wg(Wt,n,u,p);Vt&&T.push(Vt)}),jv(T)}var s=lM(b),O={type:b.type,coordinates:m2(b.coordinates,s)},V=new u0,G=V.read(O),it=iC(oC(n,u),"meters"),ot=mi.bufferOp(G,it,p),dt=new FE;if(ot=dt.write(ot),!d2(ot.coordinates)){var xt={type:ot.type,coordinates:g2(ot.coordinates,s)};return wE(xt,m)}}function d2(h){return Array.isArray(h[0])?d2(h[0]):isNaN(h[0])}function m2(h,n){return typeof h[0]!="object"?n(h):h.map(function(u){return m2(u,n)})}function g2(h,n){return typeof h[0]!="object"?n.invert(h):h.map(function(u){return g2(u,n)})}function lM(h){var n=yC(h).geometry.coordinates,u=[-n[0],-n[1]];return sM().rotate(u).scale(sC)}const y0=({target:h,map:n,tolerance:u,bufferRadius:p})=>{var m,b;if(!h.getAttribute("disabled")&&n.getSource("route")){const T=(m=n.getSource("route"))==null?void 0:m._data;if(T){const s=aM(T,p),O=mC(s,{tolerance:u});(b=n.getSource("buffer"))==null||b.setData(O);const V=document.getElementById("polygon-points");V.textContent=`Points: ${O.geometry.coordinates[0].length}`}}},uM=({map:h,firstLngLat:n,lastLngLat:u})=>{const p=`https://api.mapbox.com/directions/v5/mapbox/driving/${n[0]},${n[1]};${u[0]},${u[1]}?geometries=geojson&access_token=pk.eyJ1Ijoib3J1Y2JlIiwiYSI6ImNsbTZuZGxrZjBoN3czamxnM2V6aHBiZGEifQ.Fami0mGh65buxFjfJ0Ppjg`;fetch(p).then(m=>m.json()).then(m=>{const b=m.routes[0].geometry,T={type:"Feature",properties:{},geometry:b};if(h.getSource("route")){h.getSource("route").setData(T);const s=Hg(T);h.fitBounds(s,{padding:100}),document.getElementById("btn-buffer").removeAttribute("disabled")}})},cM=document.getElementById("btn-back");cM.addEventListener("click",()=>{window.location.href="../index.html"});s_.accessToken="pk.eyJ1Ijoib3J1Y2JlIiwiYSI6ImNsbTZuZGxrZjBoN3czamxnM2V6aHBiZGEifQ.Fami0mGh65buxFjfJ0Ppjg";let Nd=[],kd=[],Fc=.0033;const Kv=new s_.Marker({color:"green"}),Qv=new s_.Marker({color:"red"}),uo=new s_.Map({container:"mapContainer",style:"https://demotiles.maplibre.org/style.json",zoom:10,center:[29,41.015137]}),Nc=document.getElementById("btn-start"),kc=document.getElementById("btn-finish"),o_=document.getElementById("btn-draw-line"),hM=document.getElementById("btn-reset"),v_=document.getElementById("btn-buffer"),pM=document.getElementById("polygon-points");Nc.addEventListener("click",()=>{if(Nc.dataset.active==="true"){Nc.dataset.active=!1;return}kc.dataset.active=!1,Nc.dataset.active=!0});kc.addEventListener("click",()=>{if(kc.dataset.active==="true"){kc.dataset.active=!1;return}Nc.dataset.active=!1,kc.dataset.active=!0});o_.addEventListener("click",h=>{h.target.getAttribute("disabled")||uM({map:uo,firstLngLat:Nd,lastLngLat:kd})});v_.addEventListener("click",h=>{h.target.getAttribute("disabled")||y0({target:h.target,map:uo,tolerance:Fc,bufferRadius:.3})});const fM=()=>{Nd=[],Kv.remove(),kd=[],Qv.remove(),Nc.dataset.active=!1,kc.dataset.active=!1,o_.setAttribute("disabled",!0),v_.setAttribute("disabled",!0),pM.textContent="Points: -",uo.getSource("route")&&uo.getSource("route").setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}),uo.getSource("buffer")&&uo.getSource("buffer").setData({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[]}})};hM.addEventListener("click",fM);const _2=document.getElementById("slider-tolerance"),y2=document.getElementById("text-tolerance");_2.addEventListener("input",h=>{Fc=h.target.value,y0({target:v_,map:uo,tolerance:Fc,bufferRadius:.3}),y2.value=String(parseFloat(Fc).toFixed(4)).padEnd(4,"0")});y2.addEventListener("input",h=>{Fc=parseFloat(h.target.value).toFixed(4),y0({target:v_,map:uo,tolerance:Fc,bufferRadius:.3}),_2.value=Fc});const bE=()=>{Nd.length>0&&kd.length>0?o_.removeAttribute("disabled"):o_.setAttribute("disabled",!0)};uo.on("load",()=>{uo.addSource("buffer",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[]}}}),uo.addLayer({id:"buffer",type:"fill",source:"buffer",paint:{"fill-color":"#f00","fill-opacity":.4,"fill-outline-color":"#f00"}}),uo.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}}),uo.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00f","line-width":4}}),uo.on("click",h=>{if(Nc.dataset.active==="true"){Nd=h.lngLat.toArray(),Kv.remove(),Kv.setLngLat(Nd).addTo(uo),bE();return}if(kc.dataset.active==="true"){kd=h.lngLat.toArray(),Qv.remove(),Qv.setLngLat(kd).addTo(uo),bE();return}})});
